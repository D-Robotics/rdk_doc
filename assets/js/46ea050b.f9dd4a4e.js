"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[9120],{28453:(e,n,c)=>{c.d(n,{R:()=>t,x:()=>l});var d=c(96540);const o={},r=d.createContext(o);function t(e){const n=d.useContext(r);return d.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),d.createElement(r.Provider,{value:n},e.children)}},92692:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>t,metadata:()=>d,toc:()=>i});const d=JSON.parse('{"id":"Advanced_development/linux_development/driver_development/driver_pwm_dev","title":"PWM \u9a71\u52a8\u8c03\u8bd5\u6307\u5357","description":"X3\u6709\u4e24\u7c7b\u63a7\u5236\u5668\uff1a\u4e00\u7c7b\u662f\u6807\u51c6PWM\uff0c\u67093\u7ec4\uff0c\u6bcf\u7ec4\u4e09\u4e2a\uff0c\u51719\u4e2a\uff0c\u53e6\u4e00\u7c7b\u662fLPWM\uff0c\u4e3b\u8981\u7528\u4e8e\u652f\u6301Sensor\u7684\u540c\u6b65\u66dd\u5149\u3002","source":"@site/docs/07_Advanced_development/02_linux_development/driver_development/driver_pwm_dev.md","sourceDirName":"07_Advanced_development/02_linux_development/driver_development","slug":"/Advanced_development/linux_development/driver_development/driver_pwm_dev","permalink":"/rdk_doc/Advanced_development/linux_development/driver_development/driver_pwm_dev","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1757049643000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"tutorialSidebar","previous":{"title":"SPI\u8c03\u8bd5\u6307\u5357","permalink":"/rdk_doc/Advanced_development/linux_development/driver_development/driver_spi_dev"},"next":{"title":"BPU\u9a71\u52a8sysfs\u8c03\u8bd5\u63a5\u53e3","permalink":"/rdk_doc/Advanced_development/linux_development/driver_development/driver_bpu_sysfs_dev"}}');var o=c(74848),r=c(28453);const t={sidebar_position:8},l="PWM \u9a71\u52a8\u8c03\u8bd5\u6307\u5357",p={},i=[{value:"\u9a71\u52a8\u4ee3\u7801",id:"\u9a71\u52a8\u4ee3\u7801",level:2},{value:"\u4ee3\u7801\u8def\u5f84",id:"\u4ee3\u7801\u8def\u5f84",level:3},{value:"\u5185\u6838\u914d\u7f6e",id:"\u5185\u6838\u914d\u7f6e",level:3},{value:"DTS\u8282\u70b9\u914d\u7f6e",id:"dts\u8282\u70b9\u914d\u7f6e",level:3},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:2}];function s(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"pwm-\u9a71\u52a8\u8c03\u8bd5\u6307\u5357",children:"PWM \u9a71\u52a8\u8c03\u8bd5\u6307\u5357"})}),"\n",(0,o.jsx)(n.p,{children:"X3\u6709\u4e24\u7c7b\u63a7\u5236\u5668\uff1a\u4e00\u7c7b\u662f\u6807\u51c6PWM\uff0c\u67093\u7ec4\uff0c\u6bcf\u7ec4\u4e09\u4e2a\uff0c\u51719\u4e2a\uff0c\u53e6\u4e00\u7c7b\u662fLPWM\uff0c\u4e3b\u8981\u7528\u4e8e\u652f\u6301Sensor\u7684\u540c\u6b65\u66dd\u5149\u3002"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"PWM \u9ed8\u8ba4\u652f\u6301\u9891\u7387\u8303\u56f4\u662f192MHz\u523046.8KHz\uff0c\u6bcf\u7ec4PWM\u7684\u5360\u7a7a\u6bd4\u5bc4\u5b58\u5668RATIO\u7cbe\u5ea6\u4e3a8bit\u3002"}),"\n",(0,o.jsx)(n.li,{children:"LPWM \u9ed8\u8ba4\u652f\u6301\u9891\u7387\u8303\u56f4\u662f100KHz\u523024.4Hz\uff0c\u6ca1\u6709\u5360\u7a7a\u6bd4\u5bc4\u5b58\u5668\uff0c\u53ea\u6709\u4e00\u4e2a\u9ad8\u7535\u5e73\u6301\u7eed\u65f6\u95f4HIGH\uff0cHIGH\u5bc4\u5b58\u5668\u914d\u7f6e\u5355\u4f4d\u662fus\uff0c\u6700\u5927\u652f\u6301\u8bbe\u7f6e\u9ad8\u7535\u5e73\u4e3a160us\uff0c\u6240\u4ee5LPWM\u7684\u5360\u7a7a\u6bd4\u4e0e\u9891\u7387\u6709\u5173\u3002"}),"\n",(0,o.jsxs)(n.li,{children:["LPWM\u662f\u4e3a\u4e86Sensor \u540c\u6b65\u8bbe\u8ba1\u7684\uff0c\u4e0d\u662f\u4e00\u4e2a\u901a\u7528\u7684PWM\uff0c",(0,o.jsx)(n.strong,{children:"\u5355\u7eafPWM\u529f\u80fd\u5efa\u8bae\u4f7f\u7528PWM\u3002"})]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"\u9a71\u52a8\u4ee3\u7801",children:"\u9a71\u52a8\u4ee3\u7801"}),"\n",(0,o.jsx)(n.h3,{id:"\u4ee3\u7801\u8def\u5f84",children:"\u4ee3\u7801\u8def\u5f84"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:"drivers/pwm/pwm-hobot.c\n"})}),"\n",(0,o.jsx)(n.h3,{id:"\u5185\u6838\u914d\u7f6e",children:"\u5185\u6838\u914d\u7f6e"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"Device Drivers\n    ->  Pulse-Width Modulation (PWM) Support\n        ->  Hobot PWM controller support\n        ->  Hobot lite PWM controller support\n"})}),"\n",(0,o.jsx)(n.h3,{id:"dts\u8282\u70b9\u914d\u7f6e",children:"DTS\u8282\u70b9\u914d\u7f6e"}),"\n",(0,o.jsxs)(n.p,{children:["\u5728",(0,o.jsx)(n.code,{children:"hobot-xj3.dtsi"}),"\u8fd9\u4e2a\u6587\u4ef6\u91cc\u9762\u6709",(0,o.jsx)(n.code,{children:"pwm"}),"\u548c",(0,o.jsx)(n.code,{children:"lpwm"}),"\u7684\u914d\u7f6e\uff0c\u4e00\u822c\u6765\u8bb2\u4e0d\u9700\u8981\u505a\u4efb\u4f55\u4fee\u6539\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:'/* arch/arm64/boot/dts/hobot/hobot-xj3.dtsi */\nlpwm: lpwm@0xA500D000 {\n    compatible = "hobot,hobot-lpwm";\n    reg = <0 0xA5018000 0 0x1000>;\n    interrupt-parent = <&gic>;\n    interrupts = <0 68 4>;\n    pinctrl-names = "lpwm0", "lpwm1","lpwm2","lpwm3", "lpwm_pps";\n    pinctrl-0 = <&lpwm0_func>;\n    pinctrl-1 = <&lpwm1_func>;\n    pinctrl-2 = <&lpwm2_func>;\n    pinctrl-3 = <&lpwm3_func>;\n    pinctrl-4 = <&lpwm_pps>;\n    clocks = <&lpwm_mclk>;\n    clock-names = "lpwm_mclk";\n    status = "disabled";\n};\n\npwm_c0: pwm@0xA500D000 {\n    compatible = "hobot,hobot-pwm";\n    #pwm-cells = <3>;\n    reg = <0 0xA500D000 0 0x1000>;\n    interrupt-parent = <&gic>;\n    interrupts = <0 44 4>;\n    pinctrl-names = "pwm0", "pwm1","pwm2";\n    pinctrl-0 = <&pwm0_func>;\n    pinctrl-1 = <&pwm1_func>;\n    pinctrl-2 = <&pwm2_func>;\n    clocks = <&pwm0_mclk>;\n    clock-names = "pwm_mclk";\n    status = "disabled";\n};\n...\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u5f53\u9700\u8981\u4f7f\u80fd\u5bf9\u5e94\u4e32\u53e3\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5230\u5bf9\u5e94\u7684\u677f\u7ea7\u6587\u4ef6\u4fee\u6539\uff0c\u8fd9\u91cc\u4ee5",(0,o.jsx)(n.code,{children:"hobot-x3-sdb_v4.dts"}),"\u4e3a\u4f8b\uff0c\u4f7f\u80fd",(0,o.jsx)(n.code,{children:"pwm0-2"}),"\u3001",(0,o.jsx)(n.code,{children:"pwm3-5"}),"\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-c",children:'/* arch/arm64/boot/dts/hobot/hobot-x3-sdb_v4.dts */\n...\n&pwm_c0 {\n\tstatus = "okay";\n\tpinctrl-0 = <&pwm0_func>;\n\tpinctrl-1 = <>;\n\tpinctrl-2 = <>;\n};\n&pwm_c1 {\n\tstatus = "okay";\n\tpinctrl-0 = <>;\n\tpinctrl-1 = <&pwm4_func>;\n\tpinctrl-2 = <>;\n};\n...\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u6d4b\u8bd5",children:"\u6d4b\u8bd5"}),"\n",(0,o.jsxs)(n.p,{children:["\u7528\u6237\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u811a\u672c\u8fdb\u884c",(0,o.jsx)(n.code,{children:"pwm"}),"\u529f\u80fd\u6d4b\u8bd5\uff0c\u5e76\u8fdb\u884c\u4fe1\u53f7\u6d4b\u91cf\uff0c\u9a8c\u8bc1",(0,o.jsx)(n.code,{children:"pwm"}),"\u5de5\u4f5c\u662f\u5426\u6b63\u5e38\u3002"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:'echo 8 8 8 8  > /proc/sys/kernel/printk\nfor i in 0 3\ndo\n        cd /sys/class/pwm/pwmchip${i}\n        echo 0 > export\n        echo 1 > export\n        echo 2 > export\n \n        cd pwm0\n        echo 10000 > period\n        echo 3000  > duty_cycle\n        echo 1 > enable\n  \n        cd ../pwm1\n        echo 10000 > period\n        echo 1000  > duty_cycle\n        echo 1 > enable\n \n        cd ../pwm2\n        echo 10000 > period\n        echo 1000  > duty_cycle\n        echo 1 > enable\ndone\n#\u4ee5\u4e0b\u662f\u8fdb\u884c\u5bc4\u5b58\u5668\u8bfb\u53d6\necho "pwm0 pinctrl:`devmem 0xa6004010 32`"\necho "pwm1 pinctrl:`devmem 0xa6004058 32`"\necho "pwm2 pinctrl:`devmem 0xa600405C 32`"\necho "pwm3 pinctrl:`devmem 0xa6004060 32`"\necho "pwm4 pinctrl:`devmem 0xa6004064 32`"\necho "pwm5 pinctrl:`devmem 0xa6004048 32`"\necho "pwm6 pinctrl:`devmem 0xa600404C 32`"\necho "pwm7 pinctrl:`devmem 0xa6004030 32`"\necho "pwm8 pinctrl:`devmem 0xa6004034 32`"\n \necho "Regs of PWM 0 1 2:"\necho "PWM_EN      `devmem 0xA500d000 32`"\necho "PWM_SLICE   `devmem 0xA500d004 32`"\necho "PWM_FREQ    `devmem 0xA500d008 32`"\necho "PWM_FREQ1   `devmem 0xA500d00C 32`"\necho "PWM_RATIO   `devmem 0xA500d014 32`"\necho "PWM_SRCPND  `devmem 0xA500d01C 32`"\necho "PWM_INTMASK `devmem 0xA500d020 32`"\n \necho "Regs of PWM 3 4 5:"\necho "PWM_EN      `devmem 0xA500e000 32`"\necho "PWM_SLICE   `devmem 0xA500e004 32`"\necho "PWM_FREQ    `devmem 0xA500e008 32`"\necho "PWM_FREQ1   `devmem 0xA500e00C 32`"\necho "PWM_RATIO   `devmem 0xA500e014 32`"\necho "PWM_SRCPND  `devmem 0xA500e01C 32`"\necho "PWM_INTMASK `devmem 0xA500e020 32`"\n'})})]})}function m(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(s,{...e})}):s(e)}}}]);