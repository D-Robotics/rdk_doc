"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[89033],{24234:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>l,contentTitle:()=>_,default:()=>o,frontMatter:()=>c,metadata:()=>t,toc:()=>i});const t=JSON.parse('{"id":"Advanced_development/mcu_development/S100/MCU_build_system","title":"MCU\u7cfb\u7edf\u8bf4\u660e","description":"\u7f16\u8bd1\u7cfb\u7edf\u57fa\u672c\u8bf4\u660e","source":"@site/docs_s/07_Advanced_development/05_mcu_development/01_S100/02_MCU_build_system.md","sourceDirName":"07_Advanced_development/05_mcu_development/01_S100","slug":"/Advanced_development/mcu_development/S100/MCU_build_system","permalink":"/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/MCU_build_system","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1751619943000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"MCU\u5feb\u901f\u5165\u95e8\u6307\u5357","permalink":"/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/basic_information"},"next":{"title":"MCU1\u5f00\u53d1\u6307\u5357","permalink":"/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/FreeRTOS_development"}}');var s=r(74848),d=r(28453);const c={sidebar_position:2},_="MCU\u7cfb\u7edf\u8bf4\u660e",l={},i=[{value:"\u7f16\u8bd1\u7cfb\u7edf\u57fa\u672c\u8bf4\u660e",id:"\u7f16\u8bd1\u7cfb\u7edf\u57fa\u672c\u8bf4\u660e",level:2},{value:"MCU1\u7f16\u8bd1\u7cfb\u7edf",id:"mcu1\u7f16\u8bd1\u7cfb\u7edf",level:2},{value:"\u7f16\u8bd1\u6d41\u7a0b\u4ecb\u7ecd",id:"\u7f16\u8bd1\u6d41\u7a0b\u4ecb\u7ecd",level:2},{value:"\u7f16\u8bd1\u4e2d\u7684\u91cd\u70b9\u6587\u4ef6\u5173\u7cfb\u4ecb\u7ecd",id:"\u7f16\u8bd1\u4e2d\u7684\u91cd\u70b9\u6587\u4ef6\u5173\u7cfb\u4ecb\u7ecd",level:2},{value:"MCU1\u955c\u50cflayout",id:"mcu1\u955c\u50cflayout",level:2},{value:"startup.s\u542f\u52a8\u4ee3\u7801\u7b80\u4ecb",id:"startups\u542f\u52a8\u4ee3\u7801\u7b80\u4ecb",level:2}];function a(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,d.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"mcu\u7cfb\u7edf\u8bf4\u660e",children:"MCU\u7cfb\u7edf\u8bf4\u660e"})}),"\n",(0,s.jsx)(e.h2,{id:"\u7f16\u8bd1\u7cfb\u7edf\u57fa\u672c\u8bf4\u660e",children:"\u7f16\u8bd1\u7cfb\u7edf\u57fa\u672c\u8bf4\u660e"}),"\n",(0,s.jsxs)(e.p,{children:["MCU\u7684\u7f16\u8bd1\u7cfb\u7edf\u57fa\u4e8eScons3.0.0\u521b\u5efa\uff08",(0,s.jsx)(e.a,{href:"https://scons.org/doc/3.0.0/HTML/scons-user.html",children:"Scons 3.0.0\u7528\u6237\u624b\u518c\u5b98\u7f51"}),"\uff09\u3002"]}),"\n",(0,s.jsx)(e.h2,{id:"mcu1\u7f16\u8bd1\u7cfb\u7edf",children:"MCU1\u7f16\u8bd1\u7cfb\u7edf"}),"\n",(0,s.jsx)(e.p,{children:"MCU1\u7f16\u8bd1\u7cfb\u7edf\u4f4d\u4e8emcu/Build/FreeRtos_mcu1\uff0c\u5177\u4f53\u76ee\u5f55\u7ed3\u6784\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"FreeRtos_mcu1\n\u251c\u2500\u2500 build_freertos.py                   # \u7f16\u8bd1\u7684\u5165\u53e3\u811a\u672c\n\u251c\u2500\u2500 SConstruct_Lite_FRtos_S100_sip_B    # Scons\u53c2\u4e0e\u7f16\u8bd1\u6587\u4ef6\u5939\u4ee5\u53ca\u8f93\u51fa\u76ee\u5f55\n\u251c\u2500\u2500 settings_freertos.py                # Scons\u7f16\u8bd1\u547d\u4ee4\u53c2\u6570\u76f8\u5173\u7684\u6587\u4ef6\n\u2514\u2500\u2500 Linker                              # \u7f16\u8bd1link\u811a\u672c\u6240\u5728\u76ee\u5f55\n     \u2514\u2500\u2500 gcc\n          \u2514\u2500\u2500 S100.ld\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u7f16\u8bd1\u6d41\u7a0b\u4ecb\u7ecd",children:"\u7f16\u8bd1\u6d41\u7a0b\u4ecb\u7ecd"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/05_mcu_development/01_S100/MCU_build_system/build_freertos.png",alt:""})}),"\n",(0,s.jsx)(e.h2,{id:"\u7f16\u8bd1\u4e2d\u7684\u91cd\u70b9\u6587\u4ef6\u5173\u7cfb\u4ecb\u7ecd",children:"\u7f16\u8bd1\u4e2d\u7684\u91cd\u70b9\u6587\u4ef6\u5173\u7cfb\u4ecb\u7ecd"}),"\n",(0,s.jsx)(e.p,{children:"build_freertos.py\u662f\u7f16\u8bd1\u7684\u6574\u4f53\u5165\u53e3\uff0c\u4f46\u662f\u5b9e\u9645\u8c03\u5ea6\u5230scons\u65f6\uff0c\u80fd\u591f\u5bf9scons\u7f16\u8bd1\u73af\u5883/\u6d41\u7a0b\u4ea7\u751f\u5f71\u54cd\u7684\u65b9\u5f0f\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff1a"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"SConstruct\u6587\u4ef6\uff1aSConstruct\u6587\u4ef6\u662fscons\u7f16\u8bd1\u7684\u5b9a\u4e49\u6587\u4ef6\uff0c\u5b83\u548c\u6bcf\u4e2a\u6a21\u5757\u5185\u7684Sconscript\u7ec4\u6210\u4e86Cmake\u91ccCmakefile\uff1bMake\u7cfb\u7edf\u91ccmakefile\u7684\u4f5c\u7528\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"settings_freertos.py\uff1a\u8be5\u6587\u4ef6\u751f\u6548\u7684\u5165\u53e3\u5b9e\u9645\u4e0a\u662fSConstruct\u91cc\u9762\u7684\u201cVariables\u201d\u7c7b\u7684\u521d\u59cb\u5316\uff0c\u6838\u5fc3\u5728\u4e8e\u5f15\u5165\u4e00\u7cfb\u5217\u9759\u6001\u5b9a\u4e49\u7684\u7f16\u8bd1\u73af\u5883\u53d8\u91cf\uff1b\u73af\u5883\u53d8\u91cf\u7684\u53d8\u91cf\u540d\u5c31\u662fsettings_freertos.py\u91cc\u9762\u7684\u53d8\u91cf\u540d\uff0c\u53d8\u91cf\u503c\u5c31\u662fsettings_freertos.py\u91cc\u9762\u7684\u53d8\u91cf\u540d\u5bf9\u5e94\u7684\u53d8\u91cf\u503c\uff1b\u201cVariables\u201d\u7c7b\u5b9e\u4f8b\u5316\u540e\u7684\u793a\u4f8b\u4f1a\u88abEnvironment\u7c7b\u4f7f\u7528\uff0c\u7528\u4e8escons\u7684\u7f16\u8bd1"}),"\n",(0,s.jsx)(e.li,{children:"gcc_arm.py\uff1a\u5b9e\u9645\u5b9a\u4e49\u7f16\u8bd1\u547d\u4ee4\u7684\u5b9a\u4e49\u6587\u4ef6\uff0c\u771f\u6b63\u751f\u6548\u7684\u5165\u53e3\u662fsettings_freertos.py\u91cc\u9762\u5b9a\u4e49\u7684\u201cCOMPILER_TOOL\u201d\u5b57\u6bb5\uff0cCOMPILER_TOOL\u5b57\u6bb5\u8fdb\u4e00\u6b65\u4f1a\u88abSconscruct\u6587\u4ef6\u7684Variables\u6dfb\u52a0\u5e76\u6700\u540e\u88abenv\u83b7\u53d6\u5230\u5176\u4e2d\u7684\u201cCC\u201d\u7b49\u914d\u7f6e"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"mcu1\u955c\u50cflayout",children:"MCU1\u955c\u50cflayout"}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"\u533a\u57df\u540d\u79f0"}),(0,s.jsx)(e.th,{children:"\u8d77\u59cb\u5730\u5740"}),(0,s.jsx)(e.th,{children:"\u5360\u7528\u5927\u5c0f"}),(0,s.jsx)(e.th,{children:"\u4f5c\u7528"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"FLASH_STARTUP"}),(0,s.jsx)(e.td,{children:"0x0CAB0000"}),(0,s.jsx)(e.td,{children:"1K"}),(0,s.jsx)(e.td,{children:"\u542f\u52a8\u4ee3\u7801\u4f4d\u7f6e"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"FLASH"}),(0,s.jsx)(e.td,{children:"0x0CAB0400"}),(0,s.jsx)(e.td,{children:"2731K"}),(0,s.jsx)(e.td,{children:"\u4ee3\u7801\u3001\u6570\u636e\u3001\u6808\u7b49\u4f7f\u7528\u7684\u533a\u57df"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"FREERTOS_HEAP"}),(0,s.jsx)(e.td,{children:"0x0CD5B000"}),(0,s.jsx)(e.td,{children:"512K"}),(0,s.jsx)(e.td,{children:"\u5806\u7a7a\u95f4"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"LOG_SHARE_Reserved"}),(0,s.jsx)(e.td,{children:"0x0CDDB000"}),(0,s.jsx)(e.td,{children:"8K"}),(0,s.jsx)(e.td,{children:"MCU1 log\u5b58\u653e\u7684\u7a7a\u95f4\uff0clog\u4f1a\u5faa\u73af\u8986\u76d6"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"SCMI_IPC_Reserved"}),(0,s.jsx)(e.td,{children:"0x0CDDD000"}),(0,s.jsx)(e.td,{children:"12K"}),(0,s.jsx)(e.td,{children:"SCMI IPC\u901a\u4fe1\u9700\u8981\u7684\u7a7a\u95f4\uff0c\u7528\u4e8ebuffer\u53ca\u5173\u952e\u6570\u636e"})]})]})]}),"\n",(0,s.jsx)(e.p,{children:"\u5728\u4e0a\u8ff0SRAM\u7684\u6392\u5e03\u4e2d\uff0c \u5f3a\u70c8\u4e0d\u5efa\u8bae\u5ba2\u6237\u4fee\u6539SCMI_IPC_Reserved\u53ca\u5176\u4e4b\u540e\u7684\u533a\u57df\u3002 \u8fd9\u4e9b\u90e8\u5206\u5927\u90e8\u5206\u90fd\u662f\u5176\u4ed6\u57df\u4e00\u5b9a\u4f1a\u4f7f\u7528\u7684\u5173\u952e\u4f4d\u7f6e\uff0c\u4fee\u6539\u53ef\u80fd\u5bfc\u81f4\u5f02\u5e38\u3002\u5982\u679c\u8981\u4fee\u6539\uff0c\u8bf7\u5148\u54a8\u8be2\u5730\u74dc\u76f8\u5173\u652f\u6301\u4eba\u5458\u3002"}),"\n",(0,s.jsx)(e.p,{children:"\u4e0b\u9762\u662f\u5730\u74dc\u7248\u672c\u4e2d\u7684\u94fe\u63a5\u6587\u4ef6\uff0c\u89e3\u91ca\u4e86\u94fe\u63a5\u811a\u672c\u4e2d\u63d0\u4f9b\u7684\u4e00\u4e9b\u53d8\u91cf\u4f5c\u7528\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"MEMORY\n{\n    FLASH_STARTUP(rx)       : org = 0x0CAB0000, len = 1K\n    FLASH(rw)               : org = 0x0CAB0400, len = 2731K\n    FREERTOS_HEAP(rw)       : org = 0x0CD5B000, len = 512K\n    LOG_SHARE_Reserved(rw)  : org = 0x0CDDB000, len = 8K\n    SCMI_IPC_Reserved(rw)   : org = 0x0CDDD000, len = 12K\n}\n\n/* Define output sections */\nSECTIONS {\n     .EL2_core_exceptions_table :\n     {\n          . = ALIGN(32);\n          _start = .;\n          *(.EL2_core_exceptions_table)\n          . = ALIGN(32);\n     } > FLASH_STARTUP\n\n     .EL2_Reset_Handler :\n     {\n          . = ALIGN(32);\n          *(.EL2_Reset_Handler)\n          . = ALIGN(32);\n     } > FLASH_STARTUP\n\n     .EL1_core_exceptions_table :\n     {\n          . = ALIGN(32);\n          *(.EL1_core_exceptions_table)\n          . = ALIGN(32);\n     } > FLASH_STARTUP\n\n     .text :\n     {\n          . = ALIGN(4);\n          *(.text)                 /* .text sections (code) */\n          . = ALIGN(4);\n     } > FLASH\n\n     .shell :\n     {\n          _shell_command_start = .;\n          KEEP (*(shellCommand))\n          _shell_command_end = .;\n     } > FLASH\n\n     .mcal_text :\n     {\n          *(.mcal_text)\n     } > FLASH\n\n     .mcal_const_cfg :\n     {\n          *(.mcal_const_cfg)\n     } > FLASH\n\n     .mcal_const :\n     {\n          *(.mcal_const)\n     } > FLASH\n\n     .common_text :\n     {\n          *(.common_text)\n          PROVIDE(__TEXT_END = .);\n     } > FLASH\n     /******************text end******************/\n\n     .const :\n     {\n          . = ALIGN(32);\n          *(.const)\n          *(.rodata)\n     } > FLASH\n\n\n     .heap :\n     {\n          . = ALIGN(64);\n          __HEAP_START = .;\n          __end__ = .;\n          __heap_start__ = .;\n          PROVIDE(end = .);\n          PROVIDE(_end = .);\n          PROVIDE(__end = .);\n          __HeapBase = .;\n          . += HEAP_SIZE;\n          __HeapLimit = .;\n          __heap_limit = .;\n          __heap_end__ = .;\n     } > FLASH\n\n     .u_boot_list :\n     {\n          . = ALIGN(4);\n          *(SORT(.u_boot_list*))\n          . = ALIGN(4);\n     } > FLASH\n\n     .global_data :\n     {\n          . = ALIGN(64);\n          __DATA_RAM = .;\n          __data_start__ = .;      /* Create a global symbol at data start. */\n          *(.data)                 /* .data sections */\n          . = ALIGN(64);\n          __data_end__ = .;        /* Define a global symbol at data end. */\n          PROVIDE(__DATA_END = .);\n          PROVIDE(__DATA_ROM = .);\n     } > FLASH\n\n     .stack (NOLOAD) :\n     {\n          . = ALIGN(64);\n          __STACK_START = .;\n          __StackLimit = .;\n          __stack_start__ = .;\n          . += STACK_SIZE;\n          __stack_end__ = .;\n          __StackTop = .;\n     } > FLASH\n\n     .stack_exc (NOLOAD) :\n     {\n          . = ALIGN(64);\n          __StackLimit_exc = .;\n          __stack_start_exc__ = .;\n          . += STACK_SIZE_EXC;\n          __stack_end_exc__ = .;\n          __StackTop_exc = .;\n          __STACK_END = .;\n     } > FLASH\n\n     .init_table :\n     {\n          . = ALIGN(64);\n          __COPY_TABLE = .;\n          KEEP(*(.init_table))\n     } > FLASH\n\n     .zero_table :\n     {\n          . = ALIGN(64);\n          __ZERO_TABLE = .;\n          KEEP(*(.zero_table))\n     } > FLASH\n\n     .interrupts :\n     {\n          __VECTOR_TABLE = .;\n          __interrupts_start__ = .;\n          . = ALIGN(4);\n          KEEP(*(.isr_vector))     /* Startup code */\n          __interrupts_end__ = .;\n          . = ALIGN(4);\n     } > FLASH\n\n     __VECTOR_RAM = __VECTOR_TABLE;\n     __RAM_VECTOR_TABLE_SIZE = 0x0;\n     __VECTOR_TABLE_COPY_END = __VECTOR_TABLE + __RAM_VECTOR_TABLE_SIZE;\n\n     .interrupt_drv_shared_memory :\n     {\n          *(.interrupt_drv_shared_memory)\n     } > FLASH\n\n     .handlers :\n     {\n          . = ALIGN(32);\n          *(.handlers)\n     } > FLASH\n\n     .mcal_data :\n     {\n          *(.mcal_data)\n     } > FLASH\n\n     .mcal_shared_data :\n     {\n          *(.mcal_shared_data)\n     } > FLASH\n\n     .bss (NOLOAD) :\n     {\n          . = ALIGN(64);\n          __BSS_START = .;\n          __bss_start__ = .;\n          *(.bss)\n     } > FLASH\n\n     .mcal_bss (NOLOAD) :\n     {\n          . = ALIGN(64);\n          *(.mcal_bss)\n     } > FLASH\n\n     .mcal_shared_bss (NOLOAD) :\n     {\n          . = ALIGN(64);\n          *(.mcal_shared_bss)\n          __DATA_RAM_END = .;\n          __m_ram_init_end = .;\n          __bss_end__ = .;\n          __BSS_END = .;\n     } > FLASH\n\n     .ipc_mdma :\n     {\n          *(.ipc_mdma)\n     } > FLASH\n\n     .ucheap_section (NOLOAD) :\n     {\n          . = ALIGN(64);\n          KEEP(*(.ucheap_section))\n          . = ALIGN(64);\n     } > FREERTOS_HEAP\n\n     .log (NOLOAD) :\n     {\n          *(.log)\n     } > LOG_SHARE_Reserved\n\n     /*-------- LABELS USED IN CODE -------------------------------*/\n     SRAM_START_ADDR         = ORIGIN(FLASH_STARTUP);\n     MCU_LOG_START_ADDR      = ORIGIN(LOG_SHARE_Reserved);\n     __SCMI_IPC_START_ADDR   = ORIGIN(SCMI_IPC_Reserved);\n     NON_SECURE_START_ADDR   = ORIGIN(LOG_SHARE_Reserved);\n\n     PROVIDE(SRAM_SIZE = 0x34FFFF);\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"startups\u542f\u52a8\u4ee3\u7801\u7b80\u4ecb",children:"startup.s\u542f\u52a8\u4ee3\u7801\u7b80\u4ecb"}),"\n",(0,s.jsxs)(e.ol,{children:["\n",(0,s.jsx)(e.li,{children:"\u542f\u52a8\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u5c31\u662f\u8fdb\u5165EL2_core_exceptions_table\u5411\u91cf\u8868"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:'    .text\n    .align 4\n    .section ".EL2_core_exceptions_table", "ax"\n    .globl  EL2_core_exceptions_table\n    .type   EL2_core_exceptions_table, %function\nEL2_core_exceptions_table:\n    b   EL2_Reset_Handler             /* Reset Handler */\n    b   EL2_Undefined_Handler         /* Undefined Handler */\n    b   EL2_HVC_Handler               /* SVCall Handler */\n    b   EL2_Prefetch_Handler          /* Prefetch Handler */\n    b   EL2_Abort_Handler             /* Abort Handler */\n    b   EL2_Trap_Handler              /* Reserved */\n    b   EL2_IRQ_Handler               /* IRQ Handler */\n    b   EL2_FIQ_Handler               /* FIQ Handler */\n'})}),"\n",(0,s.jsxs)(e.ol,{start:"2",children:["\n",(0,s.jsx)(e.li,{children:"\u4ece\u800c\u8fdb\u5165EL2_Reset_Handler\u51fd\u6570\uff0c\u6b63\u5f0f\u5f00\u59cb\u542f\u52a8\uff1b"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"EL2_Reset_Handler:\n    mov r0, #0\n    mov r1, r0\n    mov r2, r0\n    mov r3, r0\n    mov r4, r0\n    mov r5, r0\n    mov r6, r0\n    mov r7, r0\n    mov r8, r0\n    mov r9, r0\n    mov r10, r0\n    mov r11, r0\n    mov r12, r0\n    ldr r0, =0x23000003\n    MCR p15, 0, r0, c15, c0, 0\n\n    b MPU_Init\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"3",children:["\n",(0,s.jsx)(e.li,{children:"\u5728\u505a\u5176\u4ed6\u64cd\u4f5c\u524d\uff0c\u901a\u8fc7MPU\u914d\u7f6e\u540e\u7eed\u53ef\u80fd\u7528\u5230\u7684\u5404\u4e2a\u5730\u5740\u7a7a\u95f4\uff0c\u5728 MPU_Init \u8fd9\u4e2a\u6807\u53f7\uff1bMPU region1\u662fMCU sram\u533a\u57df\uff0c \u7528\u6237\u53ef\u4ee5\u6309\u7167\u81ea\u5df1\u7684\u9700\u6c42\uff0c\u5207\u5206sram\uff0c\u5e76\u914d\u7f6e\u5404\u4e2a\u5207\u5206\u533a\u57df\u7684\u5c5e\u6027 \uff0c\u6bd4\u5982sharebility/non-cache\u7b49\u7b49\uff1b\u542f\u52a8\u4ee3\u7801\u5bf9\u8fd9\u4e00\u90e8\u5206\u7684\u914d\u7f6e\u4ec5\u4f9b\u53c2\u8003\uff0c\u5bf9\u4e8eMCU sram\u533a\u57df\u7684\u5212\u5206\uff0c\u53c2\u8003\u4e0a\u4e00\u8282MCU1\u955c\u50cflayout\uff0cMCU0\u76f8\u5173\u533a\u57df\u7684\u5212\u5206\u56e0MCU0\u7684\u7f18\u6545\u4e0d\u505a\u5c55\u793a\uff1b"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"MPU_Init:\n          //.....\u5176\u4ed6\u7701\u7565\n\n          /*-----region 1 MCU sram\u793a\u4f8b\u914d\u7f6e\uff0c\u6839\u636e\u81ea\u5df1\u9700\u6c42\u4fee\u6539-------*/\n          /*---------------region 1 mcu sram---------------*/\n          /* normal memory attribute */\n          ldr r0, =1                /* Region 1 */\n          mcr p15, 4, r0, c6, c2, 1 /* Write HPRSELR */\n          mcr p15, 0, r0, c6, c2, 1 /* Write PRSELR */\n\n          ldr r0, =0x0C800000       /* Start address */\n          orr r0, r0, #0x2          /* SH=0, AP=1, XN=0*/\n          mcr p15, 4, r0, c6, c3, 0 /* Write HPRBAR */\n          mcr p15, 0, r0, c6, c3, 0 /* Write PRBAR */\n\n          ldr r0, =0x0CDFFFFF      /* End address */\n          and r0, r0, #0xFFFFFFC0\n          orr r0, r0, #0x3          /* AttrIndex=1, non-cacheable, enable region */\n          mcr p15, 4, r0, c6, c3, 1 /* Write HPRLAR */\n          mcr p15, 0, r0, c6, c3, 1 /* Write PRLAR */\n\n          /*---------------region 5 internal gic & peripheral---------------*/\n          /* device memory attribute            */\n          ldr r0, =5                /* Region 5 */\n          mcr p15, 4, r0, c6, c2, 1 /* Write HPRSELR */\n          mcr p15, 0, r0, c6, c2, 1 /* Write PRSELR */\n\n          ldr r0, =0x22000000       /* Start address */\n          orr r0, r0, #0x13         /* SH=2, AP=1, XN=1*/\n          mcr p15, 4, r0, c6, c3, 0 /* Write HPRBAR */\n          mcr p15, 0, r0, c6, c3, 0 /* Write PRBAR */\n\n          ldr r0, =0x223FFFFF       /* End address */\n          sub r0, r0, #1\n          and r0, r0, #0xFFFFFFC0\n          orr r0, r0, #0x7          /* AttrIndex=3, device memory, enable region */\n          mcr p15, 4, r0, c6, c3, 1 /* Write HPRLAR */\n          mcr p15, 0, r0, c6, c3, 1 /* Write PRLAR */\n\n          //.....\u540e\u7eed\u7701\u7565\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"4",children:["\n",(0,s.jsx)(e.li,{children:"\u5730\u74dc\u7248\u672c\u4e2d\u91cd\u8981\u7684MPU region\u8bf4\u660e\u5982\u4e0b\uff1a"}),"\n"]}),"\n",(0,s.jsxs)(e.admonition,{type:"caution",children:[(0,s.jsx)(e.p,{children:"ARM R52\u7684background region\u548cRDK-S100\u82af\u7247\u4e0a\u5b9e\u9645\u5b9e\u73b0\u7684memory map\u662f\u6709\u5dee\u5f02\u7684\u3002"}),(0,s.jsx)(e.p,{children:"\u6bd4\u59820x2200_0000\u5728ARM\u7684background region\u4e2d\u9ed8\u8ba4\u662f\u5c5e\u4e8enormal memory\u7a7a\u95f4\uff0c\u4f46\u5728RDK-S100\u82af\u7247\u4e0a\u8fd9\u6bb5\u5730\u5740\u7a7a\u95f4\u5bf9\u5e94\u662fGIC\u8fd9\u79cddevice\u7c7b\u7684\u5bc4\u5b58\u5668\u7a7a\u95f4\u3002"}),(0,s.jsx)(e.p,{children:"\u6240\u4ee5\uff0c\u50cf\u8fd9\u79cd\u82af\u7247\u5b9e\u9645\u4e0ebackground region\u6709\u5dee\u5f02\u7684\u533a\u57df\uff0c\u5728\u8fdb\u884c\u8bbf\u95ee\u4e4b\u524d\uff0c\u4e00\u5b9a\u8981\u901a\u8fc7MPU\u5c06memory\u7c7b\u578b\u548cRDK-S100\u82af\u7247\u5b9e\u9645\u5b9e\u73b0\u4fdd\u6301\u4e00\u81f4\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u8bbf\u95ee\u5f02\u5e38\u3002"}),(0,s.jsx)(e.p,{children:"\u8fd9\u4e9b\u533a\u57df\u90fd\u662fMCU\u6b63\u5e38\u8fd0\u884c\u53ef\u80fd\u9700\u8981\u8bbf\u95ee\u7684\u7a7a\u95f4\uff0c\u7f3a\u5c11\u8fd9\u4e9b\u7a7a\u95f4\u7684\u914d\u7f6e\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8fd0\u884c\u5f02\u5e38\u3002\u5ba2\u6237\u5728\u81ea\u5df1\u7684\u7248\u672c\u4e2d \u8bf7\u4fdd\u6301\u548c\u5730\u74dc\u7ed9\u7684\u4ee3\u7801\u4e00\u6837\u7684\u5730\u5740\u7a7a\u95f4\u5c5e\u6027\u914d\u7f6e\u3002SRAM\u533a\u57df\uff0c\u5ba2\u6237\u5219\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u9879\u76ee\u7684\u9700\u6c42\u505a\u4e0d\u540c\u7684\u5207\u5206\u3002"})]}),"\n",(0,s.jsxs)(e.table,{children:[(0,s.jsx)(e.thead,{children:(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.th,{children:"MPU region"}),(0,s.jsx)(e.th,{children:"\u8d77\u59cb\u5730\u5740"}),(0,s.jsx)(e.th,{children:"\u7ed3\u675f\u5730\u5740"}),(0,s.jsx)(e.th,{children:"memory\u7c7b\u578b"}),(0,s.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,s.jsxs)(e.tbody,{children:[(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"0"}),(0,s.jsx)(e.td,{children:"0x0800_0000"}),(0,s.jsx)(e.td,{children:"0x0AFF_FFFF"}),(0,s.jsx)(e.td,{children:"normal memory"}),(0,s.jsx)(e.td,{children:"vdsp tcm\u53caMCU TCM\u6240\u5728\u7a7a\u95f4\uff0cSPL\u8fd0\u884c\u4f1a\u4f7f\u7528vdsp tcm"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"7"}),(0,s.jsx)(e.td,{children:"0x2200_0000"}),(0,s.jsx)(e.td,{children:"0x223F_FFFF"}),(0,s.jsx)(e.td,{children:"device memory"}),(0,s.jsx)(e.td,{children:"MCU GIC\u5bc4\u5b58\u5668\u6240\u5728\u5730\u5740\u7a7a\u95f4\uff0c\u5f71\u54cd\u5bf9GIC\u5bc4\u5b58\u5668\u7684\u8bbf\u95ee"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"8"}),(0,s.jsx)(e.td,{children:"0x2300_0000"}),(0,s.jsx)(e.td,{children:"0x25FF_FFFF"}),(0,s.jsx)(e.td,{children:"device memory"}),(0,s.jsx)(e.td,{children:"MCU peri\u5bc4\u5b58\u5668\u6240\u5728\u7a7a\u95f4\uff0c\u5f71\u54cd\u5bf9MCU\u4e0aperi\u5bc4\u5b58\u5668\u7684\u8bbf\u95ee"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"9"}),(0,s.jsx)(e.td,{children:"0x2600_0000"}),(0,s.jsx)(e.td,{children:"0x7FFF_FFFF"}),(0,s.jsx)(e.td,{children:"device memory"}),(0,s.jsx)(e.td,{children:"CPUSYS\u5404\u79cd\u5bc4\u5b58\u5668\u6240\u5728\u7a7a\u95f4\uff0c\u5f71\u54cdMCU\u5bf9Acore\u4fa7\u7684\u5bc4\u5b58\u5668\u8bbf\u95ee"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"10"}),(0,s.jsx)(e.td,{children:"0x8000_0000"}),(0,s.jsx)(e.td,{children:"0xFFFF_FFFF"}),(0,s.jsx)(e.td,{children:"normal memory"}),(0,s.jsx)(e.td,{children:"DDR\u6240\u5728\u5730\u5740\u7a7a\u95f4\uff0c\u5f71\u54cdMCU\u5bf9DDR\u8bbf\u95ee"})]}),(0,s.jsxs)(e.tr,{children:[(0,s.jsx)(e.td,{children:"11"}),(0,s.jsx)(e.td,{children:"0x1800_0000"}),(0,s.jsx)(e.td,{children:"0x1FFF_FFFF"}),(0,s.jsx)(e.td,{children:"device memory"}),(0,s.jsx)(e.td,{children:"XSPI\u6240\u5728\u5730\u5740\u7a7a\u95f4\uff0c\u5f71\u54cdMCU\u5bf9flash\u7684\u4f7f\u7528"})]})]})]}),"\n",(0,s.jsxs)(e.ol,{start:"5",children:["\n",(0,s.jsx)(e.li,{children:"\u542f\u52a8\u4ee3\u7801\u63a5\u4e0b\u6765\u505a\u4e86enable_prefetch/enable_peri_secure/\u4f7f\u80fdVFP/\u914d\u7f6eSYSCNT\u5bc4\u5b58\u5668\u7b49\u64cd\u4f5c\uff0c\u5efa\u8bae\u5ba2\u6237\u4fdd\u7559\u8fd9\u4e9b\u4ee3\u7801\uff1b"}),"\n",(0,s.jsx)(e.li,{children:"\u7d27\u63a5\u7740\u8ba9\u5f53\u524dcore\u4ecehyper\u6a21\u5f0f\u8df3\u8f6c\u5230el1\uff1b"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"     /* Init ELR_hyp with stack_initialization address - init the return address when jumping from EL2 into EL1 */\n     ldr r0, =EL1_Reset_Handler\n     msr ELR_hyp, r0\n\n     //\u7701\u7565\u90e8\u5206\u4ee3\u7801\n\n     /* Exception return - will jump to address pointed by ELR_hyp (main) */\n     eret /* When executed in Hyp mode, ERET loads the PC from ELR_hyp and loads the CPSR from SPSR_hyp */\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"7",children:["\n",(0,s.jsx)(e.li,{children:"\u63a5\u4e0b\u6765\u662f\u505a\u6808\u7684\u521d\u59cb\u5316\uff0c\u6bcf\u4e2acore\u90fd\u6709\u81ea\u5df1\u7684\u4e00\u6bb5\u6808\u533a\u57df\u3002\u542f\u52a8\u4ee3\u7801\u53ea\u521d\u59cb\u5316\u4e86R52+\u4e0aabort/undefined/system mode\u7684\u6808\u5bc4\u5b58\u5668 \uff0c\u5e76\u6ca1\u6709\u521d\u59cb\u5316\u914d\u7f6eirq/fiq mode\u7b49\u7b49\u6808\u5bc4\u5b58\u5668\u3002\u5ba2\u6237\u9700\u8981\u6839\u636e\u81ea\u5df1OS\u7684\u60c5\u51b5\uff0c\u786e\u5b9aR52+\u5404\u4e2a\u6a21\u5f0f\u7684\u6808\u5bc4\u5b58\u5668\u662f\u5426\u9700\u8981\u521d\u59cb\u5316\uff1b"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"     /* Setup the stack for supervisor mode (entered from reset) */\n     mrs         r0, cpsr\n     and         r0, r0, #~0x00FF\n     orr         r0, r0, #0x0033\n     msr         cpsr_c, r0\n     sub         r3, r3, r1\n     mov         SP, r3         /* top of stack to SP_svc */\n\n     ldr         r3, =__StackTop_exc\n     ldr         r2, =__StackLimit_exc\n     sub         r2, r3, r2     /* r2 : size in bytes */\n     mov         r4, #4\n     udiv        r1, r2, r4     /* r1 : size divided by 4 */\n     and         r1, r1, #~0x0f /* r1 size alligned to 16 bytes */\n\n     /* Go to FIQ mode and set stack (below the previous one) */\n     mrs         r0, cpsr\n     and         r0, r0, #~0x003F\n     orr         r0, r0, #0x0031\n     msr         cpsr_c, r0\n     sub         r3, r3, r1\n     mov         SP, r3\n\n     //.....\u540e\u7eed\u7701\u7565\n"})}),"\n",(0,s.jsxs)(e.ol,{start:"8",children:["\n",(0,s.jsx)(e.li,{children:"\u8df3\u8f6c\u5230main"}),"\n"]}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-c",children:"    /* Enable IRQ and FIQ interrupts for the system/user mode */\n    cpsie   i               /* Unmask interrupts (IRQ)*/\n    cpsie   f               /* Unmask fast interrupts (FIQ)*/\n\n    /* Go to supervisor mode */\n    /* mrs         r0, cpsr */\n    /* and         r0, r0, #~0x00FF */\n    /* orr         r0, r0, #0x0033 */\n    /* msr         cpsr_c, r0 */\n\n    /* Jump to the main() method */\n    bl main\n\n\t/* Should never get here */\n\tb .\n    .end\n"})})]})}function o(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},28453:(n,e,r)=>{r.d(e,{R:()=>c,x:()=>_});var t=r(96540);const s={},d=t.createContext(s);function c(n){const e=t.useContext(d);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function _(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),t.createElement(d.Provider,{value:e},n.children)}}}]);