<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Advanced_development/multimedia_development/multimedia_samples" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">7.3.2 示例程序 | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/Advanced_development/multimedia_development/multimedia_samples"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="7.3.2 示例程序 | RDK DOC"><meta data-rh="true" name="description" content="本章简述D-Robotics 多媒体应用示例，所涉及源码可以通过 sudo apt install hobot-multimedia-samples 获得，安装在 /app/multimedia_samples 目录下。"><meta data-rh="true" property="og:description" content="本章简述D-Robotics 多媒体应用示例，所涉及源码可以通过 sudo apt install hobot-multimedia-samples 获得，安装在 /app/multimedia_samples 目录下。"><link data-rh="true" rel="icon" href="/rdk_doc/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/Advanced_development/multimedia_development/multimedia_samples"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Advanced_development/multimedia_development/multimedia_samples" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/Advanced_development/multimedia_development/multimedia_samples" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Advanced_development/multimedia_development/multimedia_samples" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"7. 进阶开发","item":"https://developer.d-robotics.cc/rdk_doc/Advanced_development"},{"@type":"ListItem","position":2,"name":"7.3 RDK X3 多媒体开发指南","item":"https://developer.d-robotics.cc/rdk_doc/03_multimedia_development"},{"@type":"ListItem","position":3,"name":"7.3.2 示例程序","item":"https://developer.d-robotics.cc/rdk_doc/Advanced_development/multimedia_development/multimedia_samples"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script>
<script src="/rdk_doc/js/dify-config.js"></script>
<script src="https://rdk.d-robotics.cc/embed.min.js" id="MltLQTHPb5EeP7uz" defer="defer"></script><link rel="stylesheet" href="/rdk_doc/assets/css/styles.e31f7a90.css">
<script src="/rdk_doc/assets/js/runtime~main.4fc7e593.js" defer="defer"></script>
<script src="/rdk_doc/assets/js/main.329d0d55.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/RDK">RDK X3 / X5</a><a class="navbar__item navbar__link" href="/rdk_doc/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>CN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/Advanced_development/multimedia_development/multimedia_samples" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/Advanced_development/multimedia_development/multimedia_samples" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/RDK">D-Robotics RDK套件</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Quick_start">1. 快速开始</a><button aria-label="展开侧边栏分类 &#x27;1. 快速开始&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/System_configuration">2. 系统配置</a><button aria-label="展开侧边栏分类 &#x27;2. 系统配置&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Basic_Application">3. 基础应用开发 </a><button aria-label="展开侧边栏分类 &#x27;3. 基础应用开发 &#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Basic_Development">4. 算法应用开发</a><button aria-label="展开侧边栏分类 &#x27;4. 算法应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Robot_development">5. 机器人应用开发</a><button aria-label="展开侧边栏分类 &#x27;5. 机器人应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Application_case">6. 应用开发指南</a><button aria-label="展开侧边栏分类 &#x27;6. 应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/Advanced_development">7. 进阶开发</a><button aria-label="折叠侧边栏分类 &#x27;7. 进阶开发&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/hardware_development">7.1 硬件开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.1 硬件开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/linux_development">7.2 Linux开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.2 Linux开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/03_multimedia_development">7.3 RDK X3 多媒体 开发指南</a><button aria-label="折叠侧边栏分类 &#x27;7.3 RDK X3 多媒体开发指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/overview">7.3.1 系统概述</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/multimedia_samples">7.3.2 示例程序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/system_control">7.3.3 系统控制</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/video_input">7.3.4 视频输入</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/isp_system">7.3.5 ISP图像系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/video_processing">7.3.6 视频处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/region_processing">7.3.7 区域处理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/video_output">7.3.8 视频输出</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/video_encode">7.3.9 视频编码</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/video_decode">7.3.10 视频解码</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/debug_info">7.3.11 查询多媒体模块调试信息</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/multimedia_development/performance_debug">7.3.12 多媒体性能调试</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/04_toolchain_development">7.4 算法工具链开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.4 算法工具链开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/FAQ">8. 常见问题</a><button aria-label="展开侧边栏分类 &#x27;8. 常见问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Appendix">9. 附录</a><button aria-label="展开侧边栏分类 &#x27;9. 附录&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/Release_Note/release_note">10. 版本发布</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/rdk_doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/Advanced_development"><span>7. 进阶开发</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/03_multimedia_development"><span>7.3 RDK X3 多媒体开发指南</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">7.3.2 示例程序</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>7.3.2 示例程序</h1></header>
<p>本章简述D-Robotics 多媒体应用示例，所涉及源码可以通过 sudo apt install hobot-multimedia-samples 获得，安装在 /app/multimedia_samples 目录下。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="get_sif_data">get_sif_data 使用说明<a href="#get_sif_data" class="hash-link" aria-label="get_sif_data 使用说明的直接链接" title="get_sif_data 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能">程序功能<a href="#程序功能" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p>下图所示为X3M的视频数据通路框图，其中的专业名词解释请查看 <a href="/rdk_doc/Advanced_development/multimedia_development/overview#terminology">多媒体开发概述-术语约定</a>。</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/image-20220517184132422.png" alt="image-20220517184132422" class="img_ev3q"></p>
<p><code>get_sif_data</code> 完成 <code>sensor</code> 、<code>MIPI CSI</code> 和 <code>SIF</code> 模块的初始化，实现从<code>SIF</code>模块获取视频帧数据的功能，支持从<code>SIF</code>模块获取<code>Raw</code>、<code>YUV</code>两种格式的图像。</p>
<p><code>get_sif_data</code> 可以有效帮助用户调试<code>sensor</code>和<code>X3M</code>的点亮调试，在打通<code>sensor -&gt; SIF</code>的数据通路后，再调试其他模块的功能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发">程序开发<a href="#程序开发" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构">源码结构<a href="#源码结构" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于 <code>/app/multimedia_samples/get_sif_data</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── main.c                       # 主程序，完成sensor列表的加载，和命令控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile			 # 编译makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── module.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── module.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Readme.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sensor_handle.c              # sensor 初始化、从sif中获取图像的接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sensor_handle.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sensors			 # sensor参数配置，每个新sensor在本目录新增一个文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── sensor_f37.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── sensor_imx415.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sensors.lds</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译">编译<a href="#编译" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>进入源码目录，执行以下命令进行编译生成<code>get_sif_data</code>程序</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd sample/get_sif_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get_sif_data  main.c  main.o  Makefile  module.c  module.h  module.o  Readme.md  sensor_handle.c  sensor_handle.h  sensor_handle.o  sensors  sensors.lds</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="添加新sensor">添加新sensor<a href="#添加新sensor" class="hash-link" aria-label="添加新sensor的直接链接" title="添加新sensor的直接链接">​</a></h4>
<p>如果有新sensor需要调试，请参考 sensors 目录下的源码文件，对应添加一个新的sensor配置即可。</p>
<p>以F37为例说明关键代码：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 添加sensor、mipi、sif dev、isp的参数配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 各结构体中参数在代码中有已经有比较详细的注释说明</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 其中isp部分参数在本程序中无需关注</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">set_sensor_param</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;set_sensor_param\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*定义 sensor   初始化的属性信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        snsinfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SENSOR_1LANE_F37_30FPS_10BIT_LINEAR_INFO</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*定义 mipi 初始化参数信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mipi_attr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MIPI_1LANE_SENSOR_F37_30FPS_10BIT_LINEAR_ATTR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*定义 dev 初始化的属性信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        devinfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DEV_ATTR_F37_LINEAR_BASE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*定义 pipe 属性信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipeinfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PIPE_ATTR_F37_LINEAR_BASE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sensor_sif_dev_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 主程序遍历sensor模块时调用本函数完成sensor名和sensor参数配置接口的注册</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sensor_probe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 在sensor_lists里面找到一个空位置 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ARRAY_SIZE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_lists</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_lists</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_tag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ARRAY_SIZE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_lists</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;sensor lists is full\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">strncpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_lists</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_tag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SENSOR_TAG</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">31</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SENSOR_TAG</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SENSOR_TAG</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">31</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sensor_lists</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">func </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> set_sensor_param</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* 注册sensor的模块入口，主程序在遍历sensor时会用到 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">SENSOR_MODULE_INSTALL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_probe</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用">功能使用<a href="#功能使用" class="hash-link" aria-label="功能使用的直接链接" title="功能使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="硬件连接">硬件连接<a href="#硬件连接" class="hash-link" aria-label="硬件连接的直接链接" title="硬件连接的直接链接">​</a></h4>
<p>RDK X3 开发板通过<code>mipi host</code>接口用于连接<code>Sensor</code>模组，请根据当前要调试的<code>Sensor</code>模组型号正确连接。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署">程序部署<a href="#程序部署" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>get_sif_data</code>后，执行该程序，根据提示选择当前连接在开发板上的sensor类别，比如当前连接的是 <code>F37 sensor</code>，则选择 1。</p>
<p>如果初始化成功，会自动获取第一帧图像（pipe0_plane0_1920x1080_frame_001.raw）保存在程序运行的目录下（退出程序后执行 ls -l pipe0_plane0_1920x1080_frame_* 可以查看），并打印用户可以使用的命令，运行过程如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x get_sif_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./get_sif_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D-Robotics Sensor Test Tools V1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">********************** Sensor Lists *************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        0 -- IMX415</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1 -- F37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please select :1 # 选择 sensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段初始化日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">normal pipe_id (0)type(9)frame_id(1)buf_index(0)w x h(1920x1080) data_type 9 img_format 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stride_size(2400) w x h1920 x 1080  size 2592000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe(0)dump normal raw frame id(1),plane(1)size(2592000) # 获取第一帧图像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filedump(pipe0_plane0_1920x1080_frame_001.raw, size(2592000) is successed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time cost 85 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dumpToFile raw cost time 85 ms********************** Command Lists *************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  q     -- quit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  g     -- get one frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l     -- get a set frames</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  h     -- print help message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command: </span><br></span></code></pre></div></div>
<p><strong>命令解释：</strong></p>
<ul>
<li>g： 获取一帧图像，支持输入多个<code>g</code>来连续获取图像，例如输入 <code>gggg</code></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Command: g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">normal pipe_id (0)type(9)frame_id(4078)buf_index(5)w x h(1920x1080) data_type 9 img_format 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stride_size(2400) w x h1920 x 1080  size 2592000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe(0)dump normal raw frame id(4078),plane(1)size(2592000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filedump(pipe0_plane0_1920x1080_frame_4078.raw, size(2592000) is successed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time cost 67 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dumpToFile raw cost time 67 ms</span><br></span></code></pre></div></div>
<ul>
<li>l： 连续获取12帧图像，相当于输入12个 <code>g</code></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Command: l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">normal pipe_id (0)type(9)frame_id(4588)buf_index(3)w x h(1920x1080) data_type 9 img_format 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stride_size(2400) w x h1920 x 1080  size 2592000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe(0)dump normal raw frame id(4588),plane(1)size(2592000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filedump(pipe0_plane0_1920x1080_frame_4588.raw, size(2592000) is successed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time cost 56 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 连续的获取帧数据的打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dumpToFile raw cost time 56 msnormal pipe_id (0)type(9)frame_id(4609)buf_index(7)w x h(1920x1080) data_type 9 img_format 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stride_size(2400) w x h1920 x 1080  size 2592000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe(0)dump normal raw frame id(4609),plane(1)size(2592000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filedump(pipe0_plane0_1920x1080_frame_4609.raw, size(2592000) is successed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time cost 57 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dumpToFile raw cost time 57 ms</span><br></span></code></pre></div></div>
<ul>
<li>q: 退出程序</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Command: Command: q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.825912] [S0][V1]sif_video_streamoff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.826439] SIF close node 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.853045] [S0][V0]sif_video_streamoff SIF last process stream off </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.853922] [S0][V0]sif_video_streamoff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.855476] hobot_dmcfreq_target: dmcfreq-&gt;rate:2666000000, target_rate:2666000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.856460] buf:performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.856460] , powersave_rate:2666000000, dmcfreq-&gt;pre_state:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.857610] [S0][V0]x3_sif_close SIF last process close </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.858301] SIF close node 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.858807] [isp_drv]: camera_sys_stream_off: camera_sys_stream_off success line 1549 dev_name port_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.860006] [isp_drv:cam]: camera_fop_release: line 115 port 0 user_num 0  camera_cdev-&gt;start_num 0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.861229] vps mipi_host1: sensor1_mclk set(1) 0 as 24000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.861980] vps mipi_host1: sensor1_mclk set(0) 0 as 24000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.862741] vps mipi_host0: sensor0_mclk set(2) 0 as 24000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.863491] vps mipi_host0: sensor0_mclk set(1) 0 as 24000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.864241] vps mipi_host0: sensor0_mclk set(0) 0 as 24000000</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行效果说明">运行效果说明<a href="#运行效果说明" class="hash-link" aria-label="运行效果说明的直接链接" title="运行效果说明的直接链接">​</a></h4>
<p>执行程序后会获取到如 <code>pipe0_plane0_1920x1080_frame_4609.raw</code> 一样命名的<code>raw</code>图像，或者如<code>pipe0_1920x1080_frame_1024.yuv</code>一样命名的<code>yuv</code>图像。</p>
<p>请使用 <a href="https://archive.d-robotics.cc/downloads/hobotplayer/hobotplayerv.2.07.1.rar" target="_blank" rel="noopener noreferrer">hobotplayer</a> 工具浏览图像，图像的参数配置说明如下：</p>
<ul>
<li>浏览RAW图</li>
</ul>
<p>按照如下图所示步骤配置选项，其中<code>file config</code>里面关注<code>pic_type</code>、<code>raw_type</code>、 <code>pix_length</code> 、<code>width</code>和<code>height</code>的配置，F37 配置为（PIC_RAW、MIPI_RAW、RAW_BIT_10， 1920，1080），IMX415配置为（PIC_RAW、MIPI_RAW、RAW_BIT_12， 3840，2160）</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/image-20220517211101610.png" alt="image-20220517211101610" class="img_ev3q"></p>
<ul>
<li>浏览YUV图</li>
</ul>
<p>按照如下图所示步骤配置选项，其中<code>file config</code>里面关注<code>pic_type</code>、<code>yuv_type</code>、<code>width</code>和<code>height</code>的配置，F37 配置为（PIC_YUV、YUV_NV12， 1920，1080），IMX415配置为（YUV_NV12， 3840，2160）</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/image-20220517212105959.png" alt="image-20220517212105959" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="get_isp_data">get_isp_data 使用说明<a href="#get_isp_data" class="hash-link" aria-label="get_isp_data 使用说明的直接链接" title="get_isp_data 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-1">程序功能<a href="#程序功能-1" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p>下图所示为X3M的视频数据通路框图，其中的专业名词解释请查看 <a href="/rdk_doc/Advanced_development/multimedia_development/overview#terminology">多媒体开发概述-术语约定</a>。</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/image-20220517184132422.png" alt="image-20220517184132422" class="img_ev3q"></p>
<p><code>get_isp_data</code> 完成 <code>sensor</code> 、<code>MIPI CSI</code>  <code>SIF</code> 和 <code>ISP</code> 模块的初始化，实现从<code>ISP</code>模块获取视频帧数据的功能，支持从<code>ISP</code>模块获取<code>YUV</code>格式的图像。</p>
<p><code>get_isp_data</code> 可以有效帮助用户调试<code>sensor</code>和<code>X3M</code>的ISP效果调试，在打通<code>sensor -&gt; SIF -&gt; ISP </code>的数据通路后，再调试其他模块的功能。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-1">程序开发<a href="#程序开发-1" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构-1">源码结构<a href="#源码结构-1" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于 <code>/app/multimedia_samples/get_isp_data</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── main.c                       # 主程序，完成sensor列表的加载，和命令控制</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile			 # 编译makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── module.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── module.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Readme.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sensor_handle.c              # sensor 初始化、从isp中获取图像的接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sensor_handle.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sensors			 # sensor参数配置，每个新sensor在本目录新增一个文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── sensor_f37.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── sensor_imx415.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sensors.lds</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-1">编译<a href="#编译-1" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译，进入源码目录，执行以下命令进行编译生成<code>get_isp_data</code>程序：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /app/multimedia_samples/get_sif_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get_isp_data  main.c  main.o  Makefile  module.c  module.h  module.o  Readme.md  sensor_handle.c  sensor_handle.h  sensor_handle.o  sensors  sensors.lds</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="添加新sensor-1">添加新sensor<a href="#添加新sensor-1" class="hash-link" aria-label="添加新sensor的直接链接" title="添加新sensor的直接链接">​</a></h4>
<p>如果有新sensor需要调试，请参考 sensors 目录下的源码文件，对应添加一个新的sensor配置即可。</p>
<p>以F37为例说明关键代码：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 添加sensor、mipi、sif dev、isp的参数配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 各结构体中参数在代码中有已经有比较详细的注释说明</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">set_sensor_param</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;set_sensor_param\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*定义 sensor   初始化的属性信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        snsinfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> SENSOR_1LANE_F37_30FPS_10BIT_LINEAR_INFO</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*定义 mipi 初始化参数信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        mipi_attr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MIPI_1LANE_SENSOR_F37_30FPS_10BIT_LINEAR_ATTR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*定义 dev 初始化的属性信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        devinfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DEV_ATTR_F37_LINEAR_BASE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*定义 pipe 属性信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pipeinfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> PIPE_ATTR_F37_LINEAR_BASE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	</span><span class="token comment" style="color:#999988;font-style:italic">/*定义 dis 属性信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	disinfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DIS_ATTR_F37_BASE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	</span><span class="token comment" style="color:#999988;font-style:italic">/*定义 ldc 属性信息 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    	ldcinfo </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> LDC_ATTR_F37_BASE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sensor_sif_dev_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* </span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * 主程序遍历sensor模块时调用本函数完成sensor名和sensor参数配置接口的注册</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">sensor_probe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 在sensor_lists里面找到一个空位置 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ARRAY_SIZE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_lists</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_lists</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_tag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">break</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">i </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ARRAY_SIZE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_lists</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token function" style="color:#d73a49">printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;sensor lists is full\n&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">strncpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_lists</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_tag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> SENSOR_TAG</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">31</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SENSOR_TAG</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">strlen</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">SENSOR_TAG</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">31</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sensor_lists</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">func </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> set_sensor_param</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">/* 注册sensor的模块入口，主程序在遍历sensor时会用到 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">SENSOR_MODULE_INSTALL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sensor_probe</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用-1">功能使用<a href="#功能使用-1" class="hash-link" aria-label="功能使用的直接链接" title="功能使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="硬件连接-1">硬件连接<a href="#硬件连接-1" class="hash-link" aria-label="硬件连接的直接链接" title="硬件连接的直接链接">​</a></h4>
<p>RDK X3 开发板通过<code>mipi host</code>接口用于连接<code>Sensor</code>模组，请根据当前要调试的<code>Sensor</code>模组型号正确连接。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-1">程序部署<a href="#程序部署-1" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>get_isp_data</code>后，执行该程序，根据提示选择当前连接在开发板上的sensor类别，比如当前连接的是 <code>F37 sensor</code>，则选择 1。</p>
<p>如果初始化成功，会自动获取第一帧图像（pipe0_1920x1080_frame_001.yuv）保存在程序运行的目录下（退出程序后执行 ls -l pipe0_1920x1080_frame_* 可以查看），并打印用户可以使用的命令，运行过程如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x get_isp_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./get_isp_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D-Robotics Sensor Test Tools V1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">********************** Sensor Lists *************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        0 -- IMX415</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        1 -- F37</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*************************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Please select :1 # 选择 sensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段初始化日志</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">normal pipe_id (0)type(11)frame_id(1)buf_index(0)w x h(1920x1080) data_type 11 img_format 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stride_size(2400) w x h1920 x 1080  size 2073600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe(0)dump normal yuv frame id(1),plane(1)size(2073600) # 获取第一帧图像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filedump(pipe0_1920x1080_frame_001.yuv, size(2073600) is successed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time cost 63 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dumpToFile yuv cost time 63 ms********************** Command Lists *************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  q     -- quit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  g     -- get one frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  l     -- get a set frames</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  h     -- print help message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Command: </span><br></span></code></pre></div></div>
<p><strong>命令解释：</strong></p>
<ul>
<li>g： 获取一帧图像，支持输入多个<code>g</code>来连续获取图像，例如输入 <code>gggg</code></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Command: g</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">normal pipe_id (0)type(11)frame_id(4078)buf_index(5)w x h(1920x1080) data_type 11 img_format 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stride_size(2400) w x h1920 x 1080  size 2073600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe(0)dump normal yuv frame id(4078),plane(1)size(2073600)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filedump(pipe0_1920x1080_frame_4078.yuv, size(2073600) is successed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time cost 63 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dumpToFile yuv cost time 63 ms</span><br></span></code></pre></div></div>
<ul>
<li>l： 连续获取12帧图像，相当于输入12个 <code>g</code></li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Command: l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">normal pipe_id (0)type(11)frame_id(4588)buf_index(3)w x h(1920x1080) data_type 11 img_format 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stride_size(2400) w x h1920 x 1080  size 2073600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe(0)dump normal yuv frame id(4588),plane(1)size(2073600)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filedump(pipe0_1920x1080_frame_4588.yuv, size(2073600) is successed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time cost 56 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 连续的获取帧数据的打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dumpToFile yuv cost time 56 msnormal pipe_id (0)type(11)frame_id(4609)buf_index(7)w x h(1920x1080) data_type 11 img_format 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stride_size(2400) w x h1920 x 1080  size 2073600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pipe(0)dump normal yuv frame id(4609),plane(1)size(2073600)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filedump(pipe0_1920x1080_frame_4609.yuv, size(2073600) is successed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">time cost 57 ms </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dumpToFile yuv cost time 57 ms</span><br></span></code></pre></div></div>
<ul>
<li>q: 退出程序</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Command: Command: q</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">quit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.825912] [S0][V1]sif_video_streamoff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.826439] SIF close node 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.853045] [S0][V0]sif_video_streamoff SIF last process stream off </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.853922] [S0][V0]sif_video_streamoff</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.855476] hobot_dmcfreq_target: dmcfreq-&gt;rate:2666000000, target_rate:2666000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.856460] buf:performance</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.856460] , powersave_rate:2666000000, dmcfreq-&gt;pre_state:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.857610] [S0][V0]x3_sif_close SIF last process close </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.858301] SIF close node 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.858807] [isp_drv]: camera_sys_stream_off: camera_sys_stream_off success line 1549 dev_name port_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.860006] [isp_drv:cam]: camera_fop_release: line 115 port 0 user_num 0  camera_cdev-&gt;start_num 0 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.861229] vps mipi_host1: sensor1_mclk set(1) 0 as 24000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.861980] vps mipi_host1: sensor1_mclk set(0) 0 as 24000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.862741] vps mipi_host0: sensor0_mclk set(2) 0 as 24000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.863491] vps mipi_host0: sensor0_mclk set(1) 0 as 24000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[  256.864241] vps mipi_host0: sensor0_mclk set(0) 0 as 24000000</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行效果说明-1">运行效果说明<a href="#运行效果说明-1" class="hash-link" aria-label="运行效果说明的直接链接" title="运行效果说明的直接链接">​</a></h4>
<p>执行程序后会获取到如 <code>pipe0_1920x1080_frame_4609.yuv</code> 一样命名的<code>yuv</code>图像</p>
<p>请使用 <a href="https://archive.d-robotics.cc/downloads/hobotplayer/hobotplayerv.2.07.1.rar" target="_blank" rel="noopener noreferrer">hobotplayer</a> 工具浏览图像，图像的参数配置说明如下：</p>
<ul>
<li>浏览YUV图</li>
</ul>
<p>按照如下图所示步骤配置选项，其中<code>file config</code>里面关注<code>pic_type</code>、<code>yuv_type</code>、<code>width</code>和<code>height</code>的配置，F37 配置为（PIC_YUV、YUV_NV12， 1920，1080），IMX415配置为（YUV_NV12， 3840，2160）</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/image-20220517212105959.png" alt="image-20220517212105959" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample_isp">sample_isp 使用说明<a href="#sample_isp" class="hash-link" aria-label="sample_isp 使用说明的直接链接" title="sample_isp 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-2">程序功能<a href="#程序功能-2" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p><code>sample_isp</code>程序完成<code>isp</code>图像接口初始化，主要功能是调用每一个<code>isp</code>图像进行接口动态设置/获取参数，并返回测试结果</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-2">程序开发<a href="#程序开发-2" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构-2">源码结构<a href="#源码结构-2" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于<code>/app/multimedia_samples/sample_isp</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── main.c			# 主程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile			# 编译makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── Readme.md			# 程序说明</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-2">编译<a href="#编译-2" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>进入源码目录，执行以下命令进行编译生成 <code>sample_isp</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /app/multimedia_samples/sample_isp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">main.c  main.o  Makefile  sample_isp</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用-2">功能使用<a href="#功能使用-2" class="hash-link" aria-label="功能使用的直接链接" title="功能使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-2">程序部署<a href="#程序部署-2" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>sample_isp</code>后，运行该程序。</p>
<p>注意此程序运行前需要有当前的sensor程序在运行中，sensor的程序可以直接使用<code>Sunrise_camera</code>, <code>sample_isp</code>运行过程如下</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x sample_isp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ./sample_isp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">APP: ./sample_isp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">a: AE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b: AF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c: AWB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">d: BL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e: DEMOSAIC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">f: SHARPEN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">g: GAMMA</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">h: IRIDIX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">i: CNR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">j: SINTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">k: TEMPER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">l: SCENE_MODES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m: FIRMWARE STATE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">n: MODULE CONTROL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">o: REGISTER</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p: LIBREG_AE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">q: LIBREG_AWB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">r: LIBREG_AF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s: METERING AE(read only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t: METERING AWB(read only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">u: METERING AF(read only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">v: METERING AE_5BIN(read only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">w: METERING_DATA_TIME(read only)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x: SWITCH SCENCE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A: CSC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">B: MESH SHADING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">C: MESH SHADING LUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">D: RADIAL SHADING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">E: RADIAL SHADING LUT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">F: IRIDIX STRENGTH LEVEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">G: IDX_IRQ_SYNC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">H: IDX_AWB_ZONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">I: IDX_AF_ZONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">L: IDX_AF_KERNEL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">M: IDX_AEROI_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">N: IDX_LUMA_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">O: IDX_AEPARAM_INFO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">J: IDX_AE5BIN_ZONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">K: IDX_AE_ZONE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">P: IDX_AE_EX</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">y: Help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Q: Exit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">============================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ISP_TEST&gt;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="命令解释">命令解释：<a href="#命令解释" class="hash-link" aria-label="命令解释：的直接链接" title="命令解释：的直接链接">​</a></h4>
<ul>
<li>
<p>a： 获取/设置AE属性</p>
</li>
<li>
<p>b： 示例中暂不支持</p>
</li>
<li>
<p>c:  获取/设置AWB属性</p>
</li>
<li>
<p>d:  获取/设置BlackLevel属性</p>
</li>
<li>
<p>e:  获取/设置Demosaic属性</p>
</li>
<li>
<p>f:  获取/设置SHARPEN属性</p>
</li>
<li>
<p>g:  获取/设置GAMMA属性</p>
</li>
<li>
<p>h:  获取/设置IRIDIX属性</p>
</li>
<li>
<p>i:  获取/设置CNR属性</p>
</li>
<li>
<p>j:  获取/设置SINTER属性</p>
</li>
<li>
<p>k:  获取/设置TEMPER属性</p>
</li>
<li>
<p>l:  获取/设置SCENE_MODES属性</p>
</li>
<li>
<p>m:  获取/设置FWSTATE属性</p>
</li>
<li>
<p>n:  获取/设置ModuleControl属性</p>
</li>
<li>
<p>o:  获取/设置Register寄存器</p>
</li>
<li>
<p>p:  注册AE回调接口</p>
</li>
<li>
<p>q:  注册AWB回调接口</p>
</li>
<li>
<p>r:  注册AF回调接口</p>
</li>
<li>
<p>s:  获取AE统计信息</p>
</li>
<li>
<p>t:  获取AWB统计信息</p>
</li>
<li>
<p>u:  获取AF统计信息</p>
</li>
<li>
<p>v:  获取AE_5BIN统计信息</p>
</li>
<li>
<p>w:  获取最新的统计信息(代码里面默认获取AWB，可以仿照代码通过传参获取AE,AF统计信息)</p>
</li>
<li>
<p>x:  切换isp效果库(so库需要跟isp_test文件同一目录)</p>
</li>
<li>
<p>A:  获取/设置CSC属性</p>
</li>
<li>
<p>B:  获取/设置MESH_SHADING属性</p>
</li>
<li>
<p>C:  获取/设置MESH SHADING LUT属性</p>
</li>
<li>
<p>D:  获取/设置RADIAL SHADING属性</p>
</li>
<li>
<p>E:  获取/设置RADIAL SHADING LUT属性</p>
</li>
<li>
<p>F:  获取/设置IRIDIX STRENGTH LEVEL属性</p>
</li>
<li>
<p>G:  获取帧同步开始/结束时间</p>
</li>
<li>
<p>H:  设置AWB_ZONE属性</p>
</li>
<li>
<p>I:  设置AF_ZONE属性</p>
</li>
<li>
<p>L:  获取/设置AF_KERNEL_INFO属性</p>
</li>
<li>
<p>M:  获取/设置AEROI信息</p>
</li>
<li>
<p>N:  获取LUMA信息</p>
</li>
<li>
<p>O:  获取/设置AEParam信息</p>
</li>
<li>
<p>J:  设置AE5BIN_ZONE属性</p>
</li>
<li>
<p>K:  设置AEZONE属性</p>
</li>
<li>
<p>P:  获取/设置AE额外属性</p>
</li>
<li>
<p>y:  帮助信息</p>
</li>
<li>
<p>Q:  退出程序</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample_vps">sample_vps 使用说明<a href="#sample_vps" class="hash-link" aria-label="sample_vps 使用说明的直接链接" title="sample_vps 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-3">程序功能<a href="#程序功能-3" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p><code>sample_vps</code> 程序使用一个 <code>vps grp</code> 的多个不同通道，对 <code>YUV</code> 图像进行裁剪，旋转，缩放等操作，展示 <code>vps</code> 的基本用法。更多丰富的 <code>vps</code> 图像处理使用请参考<a href="/rdk_doc/Advanced_development/multimedia_development/video_processing">视频处理</a>章节。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-3">程序开发<a href="#程序开发-3" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构-3">源码结构<a href="#源码结构-3" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于：<code>/app/multimedia_samples/sample_vps</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- 19201080.yuv      # 回灌使用NV12格式文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- main.c            # 主程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`-- Makefile          # 编译makefile</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-3">编译<a href="#编译-3" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>进入源码目录，执行以下命令进行编译生成<code>sample_vps</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /app/multimedia_samples/sample_vps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">19201080.yuv  main.c  main.o  Makefile  sample_vps</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用-3">功能使用<a href="#功能使用-3" class="hash-link" aria-label="功能使用的直接链接" title="功能使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-3">程序部署<a href="#程序部署-3" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>按照上面的编译流程生成出 <code>sample_vps</code> ，确保当前目录下存在<code>19201080.yuv</code>，然后执行程序 <code>./sample_vps</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行效果说明-2">运行效果说明<a href="#运行效果说明-2" class="hash-link" aria-label="运行效果说明的直接链接" title="运行效果说明的直接链接">​</a></h4>
<p><code>YUV</code> 图片通过回灌方式，利用 <code>vps</code> 进行裁剪，旋转，缩放等功能，保存对应处理后的 <code>YUV</code> 图像。</p>
<ul>
<li><code>grp_0_chn_1_out_1280_720.yuv</code> 为原图裁剪到 <code>1280x720</code> 分辨率；</li>
<li><code>grp_0_chn_2_out_1088_1920.yuv</code> 为原图旋转90度的图像；</li>
<li><code>grp_0_chn_3_out_960_540.yuv</code> 为原图缩小到 <code>960x540</code> 分辨率；</li>
<li><code>grp_0_chn_5_out_2880_1620.yuv</code> 为原图放大到 <code>2880x1620</code> 分辨率；</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample_vps_zoom">sample_vps_zoom 使用说明<a href="#sample_vps_zoom" class="hash-link" aria-label="sample_vps_zoom 使用说明的直接链接" title="sample_vps_zoom 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-4">程序功能<a href="#程序功能-4" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p><code>sample_vps_zoom</code> 程序使用 <code>vps</code> 的硬件模块 <code>ipu</code> 和 <code>pym</code> 对 <code>YUV</code> 图像中的部分区域做多倍放大处理，对处理后的 <code>YUV</code>图像编码成 <code>H264</code> 视频流，可以直接使用 <code>MPC-BE</code> 等工具进行预览，类似电子云台中的<code>zoom</code> 功能。整个程序的 <code>Pipeline</code> 如下图所示：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/vps_zoom_pipeline.png" alt="Pipeline" class="img_ev3q"></p>
<p>如 <code>Pipeline</code> 所示，程序通过 <code>vps0</code> 读取 <code>YUV</code> 图像，<code>vps0 chn1</code> 和 <code>vps1</code> 绑定，通过 <code>ipu</code> 和 <code>pym</code> 做 <code>crop</code> 及放大后，将数据送给 <code>venc</code> 的 <code>chn1</code> 做 <code>H264</code> 编码，形成 <code>zoom</code> 放大的效果，同时 <code>vps0 chn2</code> 和 <code>venc chn0</code> 绑定做 <code>H264</code> 编码， <code>vps0 chn3</code> 和 <code>venc chn2</code> 绑定做 <code>H264</code> 编码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-4">程序开发<a href="#程序开发-4" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构-4">源码结构<a href="#源码结构-4" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于：<code>/app/multimedia_samples/sample_vps_zoom</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- 19201080.yuv      # 回灌使用NV12格式文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- main.c            # 主程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">`-- Makefile          # 编译makefile</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-4">编译<a href="#编译-4" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>进入源码目录，执行以下命令进行编译生成<code>sample_vps_zoom</code>程序：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /app/multimedia_samples/sample_vps_zoom</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">19201080.yuv  main.c  main.o  Makefile  sample_vps_zoom</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用-4">功能使用<a href="#功能使用-4" class="hash-link" aria-label="功能使用的直接链接" title="功能使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-4">程序部署<a href="#程序部署-4" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>按照上面的编译流程生成出 <code>sample_vps_zoom</code>，确保当前目录下存在 <code>19201080.yuv</code> 文件</p>
<p>执行 程序 <code>./sample_vps_zoom</code></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行效果说明-3">运行效果说明<a href="#运行效果说明-3" class="hash-link" aria-label="运行效果说明的直接链接" title="运行效果说明的直接链接">​</a></h4>
<p><code>YUV</code> 图片通过回灌方式，利用 <code>ipu</code>, <code>pym</code>, <code>venc</code> 模块编码成平滑放大的zoom <code>H264</code> 码流。效果如下所示。</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/vps_1_chn_5_venc_0.h264_20230523_143448.gif" alt="vps_1_chn_5_venc_0.h264_20230523_143448" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample_osd">sample_osd 使用说明<a href="#sample_osd" class="hash-link" aria-label="sample_osd 使用说明的直接链接" title="sample_osd 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-5">程序功能<a href="#程序功能-5" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p><code>sample_osd</code> 程序用于给 <code>vps</code> 通道输出的 <code>YUV</code> 数据叠加时间戳，汉语文字 <code>osd</code>。更多丰富的 <code>osd</code> 图像处理使用请参考<a href="/rdk_doc/Advanced_development/multimedia_development/region_processing">区域处理</a>章节。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-5">程序开发<a href="#程序开发-5" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构-5">源码结构<a href="#源码结构-5" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于：<code>/app/multimedia_samples/sample_osd</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- 1280720.yuv       # 回灌使用NV12格式文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- main.c            # 主程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-- Makefile          # 编译makefile</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-5">编译<a href="#编译-5" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>进入源码目录，执行以下命令进行编译生成<code>sample_osd</code>程序</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd sample/sample_osd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1280720.yuv  main.c  main.o  Makefile  sample_osd</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用-5">功能使用<a href="#功能使用-5" class="hash-link" aria-label="功能使用的直接链接" title="功能使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-5">程序部署<a href="#程序部署-5" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>sample_osd</code>后，确保当前目录下面存在<code>1280720.yuv</code>，执行<code>sample_osd</code></p>
<p>#v## 运行效果说明</p>
<p>通过 <code>osd</code> 叠加后 <code>vps</code> 通道输出的的 <code>YUV</code> 图像如下图所示：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/image-20220517151700.png" alt="Osd" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample_video_codec">sample video codec 使用说明<a href="#sample_video_codec" class="hash-link" aria-label="sample video codec 使用说明的直接链接" title="sample video codec 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-6">程序功能<a href="#程序功能-6" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p><code>sample_vdec_basic</code> 实现最基础解码功能，读取本地<code>H264</code>/<code>H265</code>/<code>JPEG</code>文件，进行解码保存<code>NV12</code>结果</p>
<p><code>sample_venc_basic</code> 实现最基础编码功能，读取<code>NV12</code>图像，编码为<code>H264</code>（或<code>H265</code>或<code>JPEG</code>），并保存为本地文件</p>
<p><code>sample_vdec_two_channel</code> 面向需要多通道同时解码的场景，在<code>sample_vdec_basic</code> 基础上增加一路解码通道，实现双通道解码功能。读取本地<code>H264</code>/<code>H265</code>/<code>JPEG</code>文件，两路同时进行解码分别保存<code>NV12</code>文件。</p>
<p><code>sample_venc_two_channel</code> 面向需要多通道同时编码的场景，在<code>sample_venc_basic</code> 基础上增加一路编码通道，实现双通道编码功能。读取本地<code>NV12</code>文件，两路同时进行解码分别保存<code>H264</code>（或<code>H265</code>或<code>JPEG</code>）。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-6">程序开发<a href="#程序开发-6" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构-6">源码结构<a href="#源码结构-6" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于：<code>/app/multimedia_samples/sample_video_codec</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── example_vdec_basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── example_vdec_two_channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── example_venc_basic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── example_venc_two_channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sample_vdec_basic.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sample_vdec_two_channel.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sample_venc_basic.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── sample_venc_two_channel.c</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-6">编译<a href="#编译-6" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>进入源码目录，执行以下命令进行编译生成<code>sample_venc_basic</code>、<code>sample_vdec_basic</code>、<code>sample_vdec_two_channel</code>、<code>sample_venc_two_channel</code>程序</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /app/multimedia_samples/sample_video_codec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example_vdec_basic        example_venc_basic        Makefile   sample_vdec_basic    sample_vdec_two_channel    sample_venc_basic    sample_venc_two_channel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example_vdec_two_channel  example_venc_two_channel  README.md  sample_vdec_basic.c  sample_vdec_two_channel.c  sample_venc_basic.c  sample_venc_two_channel.c</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-6">程序部署<a href="#程序部署-6" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample_vdec_basic">sample_vdec_basic<a href="#sample_vdec_basic" class="hash-link" aria-label="sample_vdec_basic的直接链接" title="sample_vdec_basic的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>sample_vdec_basic</code>程序之后</p>
<p>执行 <code>./sample_vdec_basic -w width -h height -t ecode_type -f file</code></p>
<p>其中width为图像宽所包含像素个数</p>
<p>height为为图像高所包含的像素格式</p>
<p>encode_type可以为h264\h265\jpeg</p>
<p>file为要解码的文件名</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample_venc_basic">sample_venc_basic<a href="#sample_venc_basic" class="hash-link" aria-label="sample_venc_basic的直接链接" title="sample_venc_basic的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>sample_venc_basic</code>程序之后</p>
<p>执行 <code>./sample_venc_basic -w width -h height -t ecode_type -f file0 -g file1</code></p>
<p>其中width为图像宽所包含像素个数</p>
<p>height为为图像高所包含的像素格式</p>
<p>ecode_type可以为h264\h265\jpeg</p>
<p>file0为要编码的文件名需要为NV12格式</p>
<p>file1为要  编码的文件名需要为NV12格式，其width和height需要和file0保持一样</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample_vdec_two_channel">sample_vdec_two_channel<a href="#sample_vdec_two_channel" class="hash-link" aria-label="sample_vdec_two_channel的直接链接" title="sample_vdec_two_channel的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>sample_vdec_two_channel</code>程序之后</p>
<p>执行  <code>./sample_vdec_two_channel -w width -h height -t ecode_type -f file</code></p>
<p>其中width为图像宽所包含像素个数</p>
<p>height为为图像高所包含的像素格式</p>
<p>encode_type可以为h264\h265\jpeg</p>
<p>file为要解码的文件名</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample_venc_two_channel">sample_venc_two_channel<a href="#sample_venc_two_channel" class="hash-link" aria-label="sample_venc_two_channel的直接链接" title="sample_venc_two_channel的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>sample_venc_two_channel</code>程序之后</p>
<p>执行   <code>./sample_venc_two_channel -w width -h height -t ecode_type -f file0 -g file1</code></p>
<p>其中width为图像宽所包含像素个数</p>
<p>height为为图像高所包含的像素格式</p>
<p>ecode_type可以为h264\h265\jpeg</p>
<p>file0为要编码的文件名需要为NV12格式</p>
<p>file1为要编码的文件名需要为NV12格式，其width和height需要和file0保持一样</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="运行效果说明-4">运行效果说明<a href="#运行效果说明-4" class="hash-link" aria-label="运行效果说明的直接链接" title="运行效果说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample_vdec_basic-1">sample_vdec_basic<a href="#sample_vdec_basic-1" class="hash-link" aria-label="sample_vdec_basic的直接链接" title="sample_vdec_basic的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:/app/multimedia_samples/sample_video_codec# ./sample_vdec_basic -w 1920 -h 1080 -t h264 -f 1080P.h264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x1769a000, vaddr = 0x7fa49ac000 i = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x17b8d000, vaddr = 0x7fa44b9000 i = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x18080000, vaddr = 0x7fa42be000 i = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x1827b000, vaddr = 0x7fa40c3000 i = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x18634000, vaddr = 0x7f97790000 i = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:0, vir_ptr:548222451712, size:71225</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:1, vir_ptr:548217262080, size:29880</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vdec 1, 1920x1080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:2, vir_ptr:548215185408, size:20136</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:146, vir_ptr:548064448512, size:14653</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:147, vir_ptr:548062371840, size:14555</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:148, vir_ptr:548057182208, size:15637</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:149, vir_ptr:548051447808, size:15966</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">do while</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">There is no more input data, 0!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x1769a000, vaddr = 0x7fa016d000 i = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x17b8d000, vaddr = 0x7f9b2fd000 i = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x18080000, vaddr = 0x7f9b102000 i = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x1827b000, vaddr = 0x7f9ac0f000 i = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x18634000, vaddr = 0x7f9a697000 i = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR][&quot;vdec&quot;][video/src/hb_vdec.c:743] [540.920523]HB_VDEC_GetFrame[743]: [HB_VDEC] HB_VDEC_GetFrame:743 Failed  VdChn = 0 s32Ret = -269024268</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VDEC_GetFrame failed:-269024268</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vp exit ok!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The program exited normally. If you encounter a Get_Frame error, it may be because the file has already been read. Please check.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>输出 log 显示不断在将逐帧处理，最后的 LOG 打印也显示程序正常退出 ， 末尾附近出现的 <code>HB_VDEC_GetFrame Failed</code> 代表已经读不到输入的数据了，说明可能到了文件末尾。</p>
<p>该程序执行完成之后，在当前运行目录会生成 decode.nv12 文件，该文件内容随着解码内容更新。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample_venc_basic-1">sample_venc_basic<a href="#sample_venc_basic-1" class="hash-link" aria-label="sample_venc_basic的直接链接" title="sample_venc_basic的直接链接">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:/app/multimedia_samples/sample_video_codec# ./sample_venc_basic -w 1920 -h 1080 -t h265 -f 1080P_file1.nv12  -g 1080P_file2.nv12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed encode data thread running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> m_VencChnAttr.stRcAttr.enRcMode = 5 mmmmmmmmmmmmmmmmmm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> u32VbvBufferSize = 10 mmmmmmmmmmmmmmmmmm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf:y: vaddr = 0x7f983e5000 paddr = 0x173da000; uv: vaddr = 0x7f982e7000, paddr = 0x178cd000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get encode data thread running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf:y: vaddr = 0x7f915dc000 paddr = 0x18fdd000; uv: vaddr = 0x7f980e8000, paddr = 0x191d8000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C[ERROR][&quot;multimedia&quot;][src/vdi/linux/vdi_osal.c:174] [ERROR][7838.68423][7015:7021][TASK] MCTaskDequeueOutputBufferLocked The component(stream_reader) has been terminated!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR][&quot;venc&quot;][video/src/hb_venc.c:982] [7838.689759]HB_VENC_GetStream[982]: [HB_VENC] HB_VENC_GetStream:982 Failed  VeChn = 0 s32Ret = -268958720</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VENC_GetStream failed. ret=-268958720</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:/app/multimedia_samples/sample_video_codec#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>上述效果我们可以看到使用命令 <code>./sample_venc_basic -w 1920 -h 1080 -t h265 -f 1080P_file1.nv12  -g 1080P_file2.nv12</code> 将 1080P_file1.nv12 和 1080P_file2.nv12 的图像编码成 h265 文件， 按下 <code>ctrl+c</code> 之后停止运行，中止循环编码过程，<code>HB_VENC_GetStream</code> 会获取不到数据，抛出应有的 LOG 打印。</p>
<p>程序结束之后，在当前运行目录下生成sample_venc.h264/sample_venc.h265/sample_venc.jpg。H264/H265文件内容为交替显示是file1和file2</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample_vdec_two_channel-1">sample_vdec_two_channel<a href="#sample_vdec_two_channel-1" class="hash-link" aria-label="sample_vdec_two_channel的直接链接" title="sample_vdec_two_channel的直接链接">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:/app/multimedia_samples/sample_video_codec# ./sample_vdec_two_channel -w 1920 -h 1080 -t h264 -f 1920x1080.h264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x173a2000, vaddr = 0x7f935f5000 i = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x17895000, vaddr = 0x7f93102000 i = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x18080000, vaddr = 0x7f92c0f000 i = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x18573000, vaddr = 0x7f92424000 i = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x18d5e000, vaddr = 0x7f91c39000 i = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x19117000, vaddr = 0x7f916c1000 i = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x19312000, vaddr = 0x7f914c6000 i = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x1950d000, vaddr = 0x7f912cb000 i = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x19852000, vaddr = 0x7f910d0000 i = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzAlloc paddr = 0x19c0b000, vaddr = 0x7f90d17000 i = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try open</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:0, vir_ptr:547928154112, size:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:0, vir_ptr:547933343744, size:40</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:1, vir_ptr:547914661888, size:110529</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:1, vir_ptr:547922964480, size:110529</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:2, vir_ptr:547900624896, size:54178</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:2, vir_ptr:547906359296, size:54178</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:3, vir_ptr:547896471552, size:9596</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:3, vir_ptr:547898548224, size:9596</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:29, vir_ptr:547890491392, size:2444</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:29, vir_ptr:547894394880, size:2444</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:30, vir_ptr:547928154112, size:33999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:30, vir_ptr:547933343744, size:33999</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:31, vir_ptr:547914661888, size:8696</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:31, vir_ptr:547922964480, size:8696</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:32, vir_ptr:547900624896, size:3833</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:32, vir_ptr:547906359296, size:3833</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:33, vir_ptr:547896471552, size:1214</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[pstStream] pts:33, vir_ptr:547898548224, size:1214</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed raw data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^CmmzFree paddr = 0x17895000, vaddr = 0x7f93102000 i = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x18573000, vaddr = 0x7f92424000 i = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x173a2000, vaddr = 0x7f935f5000 i = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x19117000, vaddr = 0x7f916c1000 i = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x18080000, vaddr = 0x7f92c0f000 i = 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x1950d000, vaddr = 0x7f912cb000 i = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x18d5e000, vaddr = 0x7f91c39000 i = 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x19c0b000, vaddr = 0x7f90d17000 i = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x19312000, vaddr = 0x7f914c6000 i = 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mmzFree paddr = 0x19852000, vaddr = 0x7f910d0000 i = 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR][&quot;vdec&quot;][video/src/hb_vdec.c:743] [1636.753595]HB_VDEC_GetFrame[743]: [HB_VDEC] HB_VDEC_GetFrame:743 Failed  VdChn = 0 s32Ret = -269024268</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VDEC_GetFrame failed:-269024268</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR][&quot;vdec&quot;][video/src/hb_vdec.c:743] [1636.756613]HB_VDEC_GetFrame[743]: [HB_VDEC] HB_VDEC_GetFrame:743 Failed  VdChn = 1 s32Ret = -269024268</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VDEC_GetFrame failed:-269024268</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vp exit ok!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:/app/multimedia_samples/sample_video_codec#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>在 h264 文件符合要求的情况下，我们执行类似 <code>./sample_vdec_two_channel -w 1920 -h 1080 -t h264 -f 1920x1080.h264</code> 这样的命令，可以看到 LOG 显示，一直在解码，程序会通过两个解码通道分别执行，在按下 <code>ctrl + c</code> 之后，程序结束，并且会在当前运行目录下生成sample_decode_ch0.nv12和sample_decode_ch1.nv12，该文件内容随着解码内容更新。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sample_venc_two_channel-1">sample_venc_two_channel<a href="#sample_venc_two_channel-1" class="hash-link" aria-label="sample_venc_two_channel的直接链接" title="sample_venc_two_channel的直接链接">​</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:/app/multimedia_samples/sample_video_codec# ./sample_venc_two_channel -w 1920 -h 1080 -t h264 -f 1080P_file1.nv12 -g 1080P_file2.nv12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed encode data thread running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> m_VencChnAttr.stRcAttr.enRcMode = 5 mmmmmmmmmmmmmmmmmm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> u32VbvBufferSize = 10 mmmmmmmmmmmmmmmmmm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get encode data thread running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf:y: vaddr = 0x7f90005000 paddr = 0x176d2000; uv: vaddr = 0x7f8a3da000, paddr = 0x17bc5000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">feed encode data thread running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> m_VencChnAttr.stRcAttr.enRcMode = 5 mmmmmmmmmmmmmmmmmm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> u32VbvBufferSize = 10 mmmmmmmmmmmmmmmmmm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf:y: vaddr = 0x7f88087000 paddr = 0x1830b000; uv: vaddr = 0x7f7b6f2000, paddr = 0x18af6000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">get encode data thread running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf:y: vaddr = 0x7f78758000 paddr = 0x1ac18000; uv: vaddr = 0x7f7845f000, paddr = 0x1b00e000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buf:y: vaddr = 0x7f7855d000 paddr = 0x1ae13000; uv: vaddr = 0x7f78361000, paddr = 0x1b10c000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^C[ERROR][&quot;multimedia&quot;][src/vdi/linux/vdi_osal.c:174] [ERROR][2770.31880][5508:5520][TASK] MCTaskDequeueOutputBufferLocked The component(stream_reader) has been terminated!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR][&quot;multimedia&quot;][src/vdi/linux/vdi_osal.c:174] [ERROR][2770.31897][5508:5514][TASK] MCTaskDequeueOutputBufferLocked The component(stream_reader) has been terminated!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR][&quot;venc&quot;][video/src/hb_venc.c:982] [2770.325412]HB_VENC_GetStream[982]: [HB_VENC] HB_VENC_GetStream:982 Failed  VeChn = 0 s32Ret = -268958720</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VENC_GetStream failed. ret=-268958720</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[ERROR][&quot;venc&quot;][video/src/hb_venc.c:982] [2770.327741]HB_VENC_GetStream[982]: [HB_VENC] HB_VENC_GetStream:982 Failed  VeChn = 1 s32Ret = -268958720</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VENC_GetStream failed. ret=-268958720</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:/app/multimedia_samples/sample_video_codec#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>上述效果我们可以看到使用命令 <code>./sample_venc_two_channel -w 1920 -h 1080 -t h264 -f 1080P_file1.nv12 -g 1080P_file2.nv12</code> 将 1080P_file1.nv12 和 1080P_file2.nv12 编码成 h265 文件，按下 <code>ctrl + c</code> 会结束编码，结束期间，会出现 <code>HB_VENC_GetStream</code> 的打印。<br>
<!-- -->程序结束后会在当前运行目录下生成 sample_venc_ch0.h264（sample_venc_ch0.h265/sample_venc_ch0.jpg） 和 sample_venc_ch1.h264（sample_venc_ch1.h265/sample_venc_ch1.jpg）两个通道的文件。H264/H265文件内容为交替显示是file1和file2。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample_vot">sample_vot 使用说明<a href="#sample_vot" class="hash-link" aria-label="sample_vot 使用说明的直接链接" title="sample_vot 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-7">程序功能<a href="#程序功能-7" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p><code>sample_vot程序</code>完成<code>VOT</code>模块的初始化，实现从当前目录读取一帧nv12的图片数据送到<code>VOT</code>的bt1120输出显示功能</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-7">程序开发<a href="#程序开发-7" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构-7">源码结构<a href="#源码结构-7" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于：<code>/app/multimedia_samples/sample_vot</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 1280_720yuv8.yuv			# 回灌使用720P的NV12格式文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 1920_1080yuv8.yuv			# 回灌使用1080P的NV12格式文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile					# 编译makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Readme.md					# 程序说明</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── vot.c						# 主程序</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-7">编译<a href="#编译-7" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>进入源码目录，执行以下命令进行编译生成<code>sample_vot</code></p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /app/multimedia_samples/sample_vot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1280_720yuv8.yuv  1920_1080yuv8.yuv  Makefile  Readme.md  sample_vot  vot.c  vot.o</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用-6">功能使用<a href="#功能使用-6" class="hash-link" aria-label="功能使用的直接链接" title="功能  使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-7">程序部署<a href="#程序部署-7" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>sample_vot</code></p>
<p>执行程序 <code>./sample_vot 1080P30</code>。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x sample_vot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@x3sdbx3-samsung2G-3200:/userdata# ./sample_vot 1080P60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   26.051955] channel id is 0, enable is 0, reg value is 0x4ef00f.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   26.052744] channel id is 1, enable is 0, reg value is 0x4ef00f.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   26.053520] channel id is 2, enable is 0, reg value is 0x4ef00f.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   26.054339] channel id is 3, enable is 0, reg value is 0x4ef00f.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stLayer width:1920[   26.055263] channel id is 0, enable is 1, reg value is 0x14ef00f.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stLayer height:1080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libiar: hb_disp_set_timing done!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stChnAttr priority :2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stChnAttr src width :1920</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stChnAttr src height :1080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stChnAttr s32X :0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stChnAttr s32Y :0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stChnAttr u32DstWidth :1920</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stChnAttr u32DstHeight :1080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   26.056165] iar_output_stream.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stCrop width :1920</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stCrop height :1080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[   26.059304] channel id is 0, enable is 1, reg value is 0x14ef00f.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">framesize:3110400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">（注意如果是X3 SDB生态板子，那么带的参数只支持1080P60/1080P30，如果是客户自己使用的sil902x的bt1120转换hdmi芯片，那么参数可以是如下：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080P60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080P59.94</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080P50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080P30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080P29.97</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080P25</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080I60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080I59.94</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	1080I50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	720P60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	720P59.94</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	720P50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	720P29.97）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行效果说明-5">运行效果说明<a href="#运行效果说明-5" class="hash-link" aria-label="运行效果说明的直接链接" title="运行效果说明的直接链接">​</a></h4>
<p>程序通过把<code>1920_1080yuv8.yuv</code>读到内存，并通过接口把数据送到<code>VOT</code>模块的<code>bt1120</code>接口,然后通过<code>hdmi</code>转换芯片输出<code>hdmi</code>效果到显示设备如下图</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220520-163716.jpg" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample_lcd">sample_lcd 使用说明<a href="#sample_lcd" class="hash-link" aria-label="sample_lcd 使用说明的直接链接" title="sample_lcd 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-8">程序功能<a href="#程序功能-8" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p><code>sample_lcd程序</code>完成<code>VOT</code>模块的初始化，实现从当前目录读取一帧NV12的图片数据送到<code>VOT</code>的<code>midi-dsi</code>输出到lcd屏幕显示</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-8">程序开发<a href="#程序开发-8" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="源码结构-8">源码结构<a href="#源码结构-8" class="hash-link" aria-label="源码结构的直接链接" title="源码结构的直接链接">​</a></h4>
<p>源码位于：<code>/app/multimedia_samples/sample_lcd</code></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── 720x1280.yuv	# 回灌使用NV12格式文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile		# 编译makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Readme.md		# 程序说明</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── vot.c			# 主程序</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-8">编译<a href="#编译-8" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>进入源码目录，执行以下命令进行编译生成<code>sample_lcd</code>程序</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ cd /app/multimedia_samples/sample_lcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">720x1280.yuv  vot.c  vot.o  Makefile  sample_lcd</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用-7">功能使用<a href="#功能使用-7" class="hash-link" aria-label="功能使用的直接链接" title="功能使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-8">程序部署<a href="#程序部署-8" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>按照上面的编译流程生成出<code>sample_lcd</code>，确保当前目录下存在<code>720x1280.yuv</code>文件</p>
<p>执行程序 <code>./sample_lcd</code>。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x sample_lcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ./sample_lcd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@x3sdbx3-samsung2G-3200:/userdata# ./sample_lcd </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">libiar: hb_disp_set_timing done!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VOT_SetChnAttr 0: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VOT_EnableChn: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HB_VOT_EnableChn: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">framesize:1382400</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行效果说明-6">运行效果说明<a href="#运行效果说明-6" class="hash-link" aria-label="运行效果说明的直接链接" title="运行效果说明的直接链接">​</a></h4>
<p>程序通过把<code>720x1280.yuv</code>读到内存，并通过接口把数据送到<code>VOT</code>模块的<code>midi-dsi</code>接口,然后显示到<code>lcd</code>屏幕设备如下图</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220520-161120.jpg" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sample_usb_cam_4k60">sample_usb_cam_4k60 使用说明<a href="#sample_usb_cam_4k60" class="hash-link" aria-label="sample_usb_cam_4k60 使用说明的直接链接" title="sample_usb_cam_4k60 使用说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序功能-9">程序功能<a href="#程序功能-9" class="hash-link" aria-label="程序功能的直接链接" title="程序功能的直接链接">​</a></h3>
<p><code>sample_usb_cam_4k60程序</code>完成<code>sensor</code>、<code>MIPI CSI</code> 、<code>SIF</code>、 <code>ISP</code> 、<code>VENC</code>、<code>USB</code>模块的初始化，实现从sensor实时采集数据，到编码器编码输出，通过usb模块传输到pc端预览视频的功能</p>
<p>软件框图如下所示：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/4k_60_usb_pipeline.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能使用-8">功能使用<a href="#功能使用-8" class="hash-link" aria-label="功能使用的直接链接" title="功能使用的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="程序部署-9">程序部署<a href="#程序部署-9" class="hash-link" aria-label="程序部署的直接链接" title="程序部署的直接链接">​</a></h4>
<p>把 <code>sample/sample_usb_cam_4k60/out</code>目录通过winscp等工具拷贝到板子的/userdata目录，进入板子的/userdata/out目录执行sh run_usb_cam_imx415.sh可以把程序运行起来，运行结果如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@x3sdbx3-samsung2G-3200:/userdata/out# cd /userdata/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@x3sdbx3-samsung2G-3200:/userdata/out# sh run_usb_cam_imx415.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run_usb_cam_imx415.sh: line 17: can&#x27;t create /sys/bus/platform/drivers/ddr_monitor/read_qos_ctrl/all: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">run_usb_cam_imx415.sh: line 18: can&#x27;t create /sys/bus/platform/drivers/ddr_monitor/write_qos_ctrl/all: Permission denied</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; g1 is exist. delete it!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Detecting platform:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> board : Hobot XJ3 SOC SDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> udc   : b2000000.dwc3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stopping the USB gadget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usb-gadget is not running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Detecting platform:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> board : Hobot XJ3 SOC SDB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> udc   : b2000000.dwc3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">show user config:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USB_VID: 0x1d6b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USB_PID: 0x0102</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SERIAL: 0x6856e824</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MANUF: hobot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PRODUCT: xj3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_UVC: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_HID: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_UAC1: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_UAC2: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_ADB: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_MSD: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_ACM: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_RNDIS: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_ECM: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating the USB gadget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Loading composite module</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating gadget directory g_comp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">init configfs...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting Vendor and Product ID&#x27;s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">single function gadget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Setting English strings</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating Config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Init functions...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">funciton_init, but do nothing, please init on demand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bind functions...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bind functions according to .usb-config file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bind uvc...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Creating UVC gadget functionality : uvc.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sh: 0: unknown operand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pre run userspace daemons(eg. adb)...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">waiting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Binding USB Device Controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run some userspace daemons(eg. usb_camera)...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usb-gadget start succeed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Open config file ./config/vin_vps_config_usb_cam.json success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Open config file1 ./config/vin_vps_config_usb_cam.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Can not find key: tailWeight</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Can not find key: manualTimeCount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Can not find key: autoTimeCount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Can not find key: manualAeM1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">imx415_init_3840x2160_60_fps_linear_setting OK!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">hb_vps_init grp_attr.maxW = 3840, grp_attr.maxH = 2160</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chn_attr.width = 3840,chn_attr.height = 2160</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set ipu chn Attr ok: GrpId = 0, chn_id = 2, chn_attr.enMirror = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start grp ok: grp_id = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us0 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us1 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us2 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us3 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us4 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us5 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us0 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us1 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us2 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us3 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us4 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us5 factor:0 x:0 y:0 w:968 h:544</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us0 factor:0 x:0 y:0 w:648 h:364</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us1 factor:0 x:0 y:0 w:648 h:364</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us2 factor:0 x:0 y:0 w:648 h:364</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us3 factor:0 x:0 y:0 w:648 h:364</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us4 factor:0 x:0 y:0 w:648 h:364</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vps1 us5 factor:0 x:0 y:0 w:648 h:364</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try to construct empty ring queue##function uvc_gadget_init in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">udc_find_video_device g_webcam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function name not matched. g_comp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:g_webcam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">udc_find_video_device g_comp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using uvc device: /dev/video8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">###uvc_gadget_init###</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using uvc device: /dev/video8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">width: 1280</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">height: 720</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">format: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">io_method: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bulk_mode: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nbufs: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mult: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">burst: 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">speed: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mult_alts: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">h264_quirk: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">maxpkt_quirk: 3072</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uvc device is dwc3-gadget on bus gadget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uvc open succeeded, file descriptor = 22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uvc_size=4, maxpkt_size=3072</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">##function uvc_gadget_init succeed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">##function uvc_gadget_start in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">##function uvc_gadget_start succeed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">##function uvc_loop in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(1), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 01 req 86 cs 04)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(1), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 01 req 86 cs 09)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(1), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 01 req 86 cs 0b)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(1), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 01 req 86 cs 0f)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(2), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 02 req 86 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(2), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 02 req 86 cs 03)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(2), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 02 req 86 cs 06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(2), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 02 req 86 cs 07)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(2), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 02 req 86 cs 08)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(2), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 02 req 86 cs 09)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev-&gt;mask (0x0), entity_id(4), setup_ops((nil)), app doesn&#x27;t care</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 04 req 85 cs 01)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send real error code last prepared(06)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">control request (entity_id 00 req 81 cs 02)</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行效果说明-7">运行效果说明<a href="#运行效果说明-7" class="hash-link" aria-label="运行效果说明的直接链接" title="运行效果说明的直接链接">​</a></h4>
<p>通过Potplayer播放器选择UVC Camera，分辨率选择H264 3840x2160P 60,打开设备就可以播放UVC视频流，打开视频流后x3侧的打印如下图:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220523-173933.png" alt="20220523-173933" class="img_ev3q"></p>
<p>potplayer跑起来后的截图如下：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220527131109.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="程序开发-9">程序开发<a href="#程序开发-9" class="hash-link" aria-label="程序开发的直接链接" title="程序开发的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="模块划分">模块划分<a href="#模块划分" class="hash-link" aria-label="模块划分的直接链接" title="模块划分的直接链接">​</a></h4>
<table><thead><tr><th><strong>模块</strong></th><th><strong>目录</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>头文件</td><td>inc</td><td>依赖的sensor头文件，json头文件，utils公共接口头文件，vio依赖公共头文件</td></tr><tr><td>vio源代码模块</td><td>src</td><td>sensor源代码文件，json配置文件解析源文件，utils公共接口源文件，系统vio公共接口源文件</td></tr><tr><td>主程序</td><td>sample_usb_cam.cpp</td><td>main函数入口</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="顶层源码结构">顶层源码结构<a href="#顶层源码结构" class="hash-link" aria-label="顶层源码结构的直接链接" title="顶层源码结构的直接链接">​</a></h5>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile							#编译的主程序CMakeLists文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── vin_vps_config_usb_cam.json			#imx415 sensor配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── inc								</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── camera									#sensor依赖头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── json									#json依赖头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── utils									#编译依赖的公共头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── vio										#x3m的vio依赖头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── jsoncpp									#依赖的json库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── libguvc.so									#4k60的usb cam依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── libimx415.so								#4k60的sensor驱动库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md									#程序说明文档</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── run_usb_cam_imx415.sh						#程序运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sample_usb_cam.cpp							#主程序代码				</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── camera									#sensor驱动配置代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── utils									#编译依赖的公共源代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── vio										#x3m的vio依赖源文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── usb-gadget.sh								#4k60的usb cam驱动加载脚本</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="头文件结构">头文件结构<a href="#头文件结构" class="hash-link" aria-label="头文件结构的直接链接" title="头文件结构的直接链接">​</a></h5>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── camera</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── camera.h						#sensor依赖头文件，增加新sensor需要修改此文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── json								#开源的json库头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── allocator.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── assertions.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── autolink.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── config.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── features.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── forwards.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── json.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── reader.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── value.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── version.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── writer.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── utils		</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── utils.h							#ringbuf定义,dump图片视频等到文件功能的公共接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── yuv2yuv.h						#使用neon加速的yuv格式转换标准接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── vio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_cfg.h						#json配置文件解析头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_cfg_type.h					#json配置属性值头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_log.h						#打印控制头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_sys.h						#vp初始化反初始化，系统vio各模块绑定接口头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_venc.h						#X3系统编码模块初始化反初始化，启停，数据输入输出处理接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_video.h						#视频格式枚举定义等通用接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_vin.h						#vin结构体定义，初始化反初始化，启停，数据处理接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── vio_vps.h						#vps初始化反初始化，启停，数据处理接口</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="源代码结构">源代码结构<a href="#源代码结构" class="hash-link" aria-label="源代码结构的直接链接" title="源代码结构的直接链接">​</a></h5>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── camera				#sensor依赖源代码文件，增加新sensor需要在此增加对对应sensor源代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── camera_base.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── camera_imx415.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── utils.cpp		#dump图片视频等到文件功能的  公共接口源代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── yuv2yuv.c		#使用neon加速的yuv格式转换标准接口源代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── vio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_cfg.cpp		#json配置文件解析源代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_sys.cpp		#vp初始化反初始化，系统vio各模块绑定接口源代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_venc.cpp	#X3系统编码模块初始化反初始化，启停，数据输入输出处理接口源代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_video.cpp	#视频格式枚举定义等通用接口源代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── vio_vin.cpp		#vin初始化反初始化，启停，数据处理接口源代码文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── vio_vps.cpp		#vps初始化反初始化，启停，数据处理接口源代码文件</span><br></span></code></pre></div></div>
<p>程序启动流程图如下：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/4k60usbcam.drawio.png" alt="" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译-9">编译<a href="#编译-9" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h4>
<p>当前代码通过一个Makefile文件配置编译</p>
<p>依赖的多媒体头文件和库文件分别在BSP SDK的appsdk目录和system/rootfs_yocto/root目录下，编译时需要注意这两个依赖目录位置是否存在</p>
<p>安装交叉编译工具链后，安装交叉编译工具链后，执行 make 命令直接可以编译生成 sample_usb_cam 程序</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd sample/sample_usb_cam_4k60</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make clean # 清理源码，保持干净的代码环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... ... # 一大段编译打印</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Makefile  sample_usb_cam  inc  README.md  vin_vps_config_usb_cam.json  libguvc.so  libimx415.so  sample_usb_cam.cpp  sample_usb_cam.d  src  lib  run_usb_cam_imx415.sh  sample_usb_cam.obj </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usb-gadget.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ make install # 把产出物安装到 out 目录下</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="添加新sensor-2">添加新sensor<a href="#添加新sensor-2" class="hash-link" aria-label="添加新sensor的直接链接" title="添加新sensor的直接链接">​</a></h4>
<p>如果有新sensor需要调试，请参考 src/camera 目录下的源码文件，对应添加一个新的sensor配置即可。</p>
<p>以IMX415的camera_imx415.cpp为例说明关键代码，需要添加MIPI_SENSOR_INFO_S、MIPI_ATTR_S、VIN_DEV_ATTR_S、VIN_PIPE_ATTR_S、VIN_DIS_ATTR_S、VIN_LDC_ATTR_S的新sensor结构体变量：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220525-112411.jpg" alt="" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220525-112559.png" alt="" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220525-112809.png" alt="" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220525-112844.png" alt="" class="img_ev3q"></p>
<p>同时需要在inc/camera/camera.h把增加的新sensor的变量extern出来如下图imx415示例</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/multimedia_samples/20220525-113456.png" alt="" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2026-02-13T03:58:53.000Z" itemprop="dateModified">2026年2月13日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/Advanced_development/multimedia_development/overview"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">7.3.1 系统概述</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/Advanced_development/multimedia_development/system_control"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">7.3.3 系统控制</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#get_sif_data" class="table-of-contents__link toc-highlight">get_sif_data 使用说明</a><ul><li><a href="#程序功能" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译" class="table-of-contents__link toc-highlight">编译</a></li><li><a href="#添加新sensor" class="table-of-contents__link toc-highlight">添加新sensor</a></li></ul></li><li><a href="#功能使用" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#硬件连接" class="table-of-contents__link toc-highlight">硬件连接</a></li><li><a href="#程序部署" class="table-of-contents__link toc-highlight">程序部署</a></li><li><a href="#运行效果说明" class="table-of-contents__link toc-highlight">运行效果说明</a></li></ul></li></ul></li><li><a href="#get_isp_data" class="table-of-contents__link toc-highlight">get_isp_data 使用说明</a><ul><li><a href="#程序功能-1" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发-1" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构-1" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译-1" class="table-of-contents__link toc-highlight">编译</a></li><li><a href="#添加新sensor-1" class="table-of-contents__link toc-highlight">添加新sensor</a></li></ul></li><li><a href="#功能使用-1" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#硬件连接-1" class="table-of-contents__link toc-highlight">硬件连接</a></li><li><a href="#程序部署-1" class="table-of-contents__link toc-highlight">程序部署</a></li><li><a href="#运行效果说明-1" class="table-of-contents__link toc-highlight">运行效果说明</a></li></ul></li></ul></li><li><a href="#sample_isp" class="table-of-contents__link toc-highlight">sample_isp 使用说明</a><ul><li><a href="#程序功能-2" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发-2" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构-2" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译-2" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#功能使用-2" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#程序部署-2" class="table-of-contents__link toc-highlight">程序部署</a></li><li><a href="#命令解释" class="table-of-contents__link toc-highlight">命令解释：</a></li></ul></li></ul></li><li><a href="#sample_vps" class="table-of-contents__link toc-highlight">sample_vps 使用说明</a><ul><li><a href="#程序功能-3" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发-3" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构-3" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译-3" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#功能使用-3" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#程序部署-3" class="table-of-contents__link toc-highlight">程序部署</a></li><li><a href="#运行效果说明-2" class="table-of-contents__link toc-highlight">运行效果说明</a></li></ul></li></ul></li><li><a href="#sample_vps_zoom" class="table-of-contents__link toc-highlight">sample_vps_zoom 使用说明</a><ul><li><a href="#程序功能-4" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发-4" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构-4" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译-4" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#功能使用-4" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#程序部署-4" class="table-of-contents__link toc-highlight">程序部署</a></li><li><a href="#运行效果说明-3" class="table-of-contents__link toc-highlight">运行效果说明</a></li></ul></li></ul></li><li><a href="#sample_osd" class="table-of-contents__link toc-highlight">sample_osd 使用说明</a><ul><li><a href="#程序功能-5" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发-5" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构-5" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译-5" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#功能使用-5" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#程序部署-5" class="table-of-contents__link toc-highlight">程序部署</a></li></ul></li></ul></li><li><a href="#sample_video_codec" class="table-of-contents__link toc-highlight">sample video codec 使用说明</a><ul><li><a href="#程序功能-6" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发-6" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构-6" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译-6" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#程序部署-6" class="table-of-contents__link toc-highlight">程序部署</a><ul><li><a href="#sample_vdec_basic" class="table-of-contents__link toc-highlight">sample_vdec_basic</a></li><li><a href="#sample_venc_basic" class="table-of-contents__link toc-highlight">sample_venc_basic</a></li><li><a href="#sample_vdec_two_channel" class="table-of-contents__link toc-highlight">sample_vdec_two_channel</a></li><li><a href="#sample_venc_two_channel" class="table-of-contents__link toc-highlight">sample_venc_two_channel</a></li></ul></li><li><a href="#运行效果说明-4" class="table-of-contents__link toc-highlight">运行效果说明</a><ul><li><a href="#sample_vdec_basic-1" class="table-of-contents__link toc-highlight">sample_vdec_basic</a></li><li><a href="#sample_venc_basic-1" class="table-of-contents__link toc-highlight">sample_venc_basic</a></li><li><a href="#sample_vdec_two_channel-1" class="table-of-contents__link toc-highlight">sample_vdec_two_channel</a></li><li><a href="#sample_venc_two_channel-1" class="table-of-contents__link toc-highlight">sample_venc_two_channel</a></li></ul></li></ul></li><li><a href="#sample_vot" class="table-of-contents__link toc-highlight">sample_vot 使用说明</a><ul><li><a href="#程序功能-7" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发-7" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构-7" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译-7" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#功能使用-6" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#程序部署-7" class="table-of-contents__link toc-highlight">程序部署</a></li><li><a href="#运行效果说明-5" class="table-of-contents__link toc-highlight">运行效果说明</a></li></ul></li></ul></li><li><a href="#sample_lcd" class="table-of-contents__link toc-highlight">sample_lcd 使用说明</a><ul><li><a href="#程序功能-8" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#程序开发-8" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#源码结构-8" class="table-of-contents__link toc-highlight">源码结构</a></li><li><a href="#编译-8" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#功能使用-7" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#程序部署-8" class="table-of-contents__link toc-highlight">程序部署</a></li><li><a href="#运行效果说明-6" class="table-of-contents__link toc-highlight">运行效果说明</a></li></ul></li></ul></li><li><a href="#sample_usb_cam_4k60" class="table-of-contents__link toc-highlight">sample_usb_cam_4k60 使用说明</a><ul><li><a href="#程序功能-9" class="table-of-contents__link toc-highlight">程序功能</a></li><li><a href="#功能使用-8" class="table-of-contents__link toc-highlight">功能使用</a><ul><li><a href="#程序部署-9" class="table-of-contents__link toc-highlight">程序部署</a></li><li><a href="#运行效果说明-7" class="table-of-contents__link toc-highlight">运行效果说明</a></li></ul></li><li><a href="#程序开发-9" class="table-of-contents__link toc-highlight">程序开发</a><ul><li><a href="#模块划分" class="table-of-contents__link toc-highlight">模块划分</a><ul><li><a href="#顶层源码结构" class="table-of-contents__link toc-highlight">顶层源码结构</a></li><li><a href="#头文件结构" class="table-of-contents__link toc-highlight">头文件结构</a></li><li><a href="#源代码结构" class="table-of-contents__link toc-highlight">源代码结构</a></li></ul></li><li><a href="#编译-9" class="table-of-contents__link toc-highlight">编译</a></li><li><a href="#添加新sensor-2" class="table-of-contents__link toc-highlight">添加新sensor</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">古月居<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">联系我们</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/437998606" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiLiBiLi<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 D-Robotics.</div></div></div></footer></div>
</body>
</html>