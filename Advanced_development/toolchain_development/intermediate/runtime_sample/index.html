<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Advanced_development/toolchain_development/intermediate/runtime_sample" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">模型上板运行应用开发说明 | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/Advanced_development/toolchain_development/intermediate/runtime_sample"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="模型上板运行应用开发说明 | RDK DOC"><meta data-rh="true" name="description" content="RDK X3"><meta data-rh="true" property="og:description" content="RDK X3"><link data-rh="true" rel="icon" href="/rdk_doc/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/Advanced_development/toolchain_development/intermediate/runtime_sample"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Advanced_development/toolchain_development/intermediate/runtime_sample" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/Advanced_development/toolchain_development/intermediate/runtime_sample" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Advanced_development/toolchain_development/intermediate/runtime_sample" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"7. 进阶开发","item":"https://developer.d-robotics.cc/rdk_doc/Advanced_development"},{"@type":"ListItem","position":2,"name":"7.4 算法工具链开发指南","item":"https://developer.d-robotics.cc/rdk_doc/04_toolchain_development"},{"@type":"ListItem","position":3,"name":"7.4.2 进阶指南","item":"https://developer.d-robotics.cc/rdk_doc/Advanced_development/toolchain_development/intermediate/"},{"@type":"ListItem","position":4,"name":"模型上板运行应用开发说明","item":"https://developer.d-robotics.cc/rdk_doc/Advanced_development/toolchain_development/intermediate/runtime_sample"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/assets/css/styles.0fbd7d27.css">
<script src="/rdk_doc/assets/js/runtime~main.916b30d7.js" defer="defer"></script>
<script src="/rdk_doc/assets/js/main.ae5673da.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/RDK">RDK X3 / X5</a><a class="navbar__item navbar__link" href="/rdk_doc/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>CN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/runtime_sample" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/Advanced_development/toolchain_development/intermediate/runtime_sample" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/RDK">D-Robotics RDK套件</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Quick_start">1. 快速开始</a><button aria-label="展开侧边栏分类 &#x27;1. 快速开始&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/System_configuration">2. 系统配置</a><button aria-label="展开侧边栏分类 &#x27;2. 系统配置&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Basic_Application">3. 基础应用开发</a><button aria-label="展开侧边栏分类 &#x27;3. 基础应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Basic_Development">4. 算法应用开发</a><button aria-label="展开侧边栏分类 &#x27;4. 算法应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Robot_development">5. 机器人应用开发</a><button aria-label="展开侧边栏分类 &#x27;5. 机器人应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Application_case">6. 应用开发指南</a><button aria-label="展开侧边栏分类 &#x27;6. 应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/Advanced_development">7. 进阶开发</a><button aria-label="折叠侧边栏分类 &#x27;7. 进阶开发&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/hardware_development">7.1 硬件开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.1 硬件开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/linux_development">7.2 Linux开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.2 Linux开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/03_multimedia_development">7.3 RDK X3 多 媒体开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.3 RDK X3 多媒体开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/04_toolchain_development">7.4 算法工具链开发指南</a><button aria-label="折叠侧边栏分类 &#x27;7.4 算法工具链开发指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/toolchain_development/overview">7.4.1 简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/Advanced_development/toolchain_development/intermediate/">7.4.2 进阶指南</a><button aria-label="折叠侧边栏分类 &#x27;7.4.2 进阶指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config">环境安装</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process">PTQ原理及步骤详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/Advanced_development/toolchain_development/intermediate/supported_op_list">模型算子支持列表</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/Advanced_development/toolchain_development/intermediate/runtime_sample">模型上板运行应用开发说明</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/Advanced_development/toolchain_development/expert/">7.4.3 高阶指南</a><button aria-label="展开侧边栏分类 &#x27;7.4.3 高阶指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/FAQ">8. 常见问题</a><button aria-label="展开侧边栏分类 &#x27;8. 常见问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/Appendix">9. 附录</a><button aria-label="展开侧边栏分类 &#x27;9. 附录&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/Release_Note/release_note">10. 版本发布</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/rdk_doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/Advanced_development"><span>7. 进阶开发</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/04_toolchain_development"><span>7.4 算法工具链开发指南</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/Advanced_development/toolchain_development/intermediate/"><span>7.4.2 进阶指南</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">模型上板运行应用开发说明</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>模型上板运行应用开发说明</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rdk-x3">RDK X3<a href="#rdk-x3" class="hash-link" aria-label="RDK X3的直接链接" title="RDK X3的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理dnn-api使用示例说明">模型推理DNN API使用示例说明<a href="#模型推理dnn-api使用示例说明" class="hash-link" aria-label="模型推理DNN API使用示例说明的直接链接" title="模型推理DNN API使用示例说明的直接  链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="概述">概述<a href="#概述" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h4>
<p>本章节介绍模型上板运行 horizon_runtime_sample 示例包的具体用法，开发者可以体验并基于这些示例进行应用开发，降低开发门槛。</p>
<p>示例包提供三个方面的示例：</p>
<ul>
<li>模型推理 dnn API使用示例。</li>
<li>自定义算子（custom OP）等特殊功能示例。</li>
<li>非NV12输入模型的杂项示例。</li>
</ul>
<p>详细内容请阅读下文。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>horizon_runtime_sample 示例包获取请参考 <a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config">交付物说明</a>。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码包结构介绍">示例代码包结构介绍<a href="#示例代码包结构介绍" class="hash-link" aria-label="示例代码包结构介绍的直接链接" title="示例代码包结构介绍的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +---horizon_runtime_sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── code                                      # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 00_quick_start                        # 快速入门示例，用mobilenetv1读取单张图片进行推理的示例代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists_x86.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 01_api_tutorial                       # BPU SDK DNN API使用示例代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── mem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── resize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── roi_infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 02_advanced_samples                   # 特殊功能示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── custom_identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── multi_input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── multi_model_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── nv12_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 03_misc                               # 杂项示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── lenet_gray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── resnet_feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── build_ultra.sh                        # aarch64编译脚本   RDK Ultra 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── build_xj3.sh                          # aarch64编译脚本   RDK X3 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── deps_gcc9.3                           # 编译依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── aarch64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── ultra</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── data                                  # 预置数据文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── cls_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── custom_identity_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── det_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── misc_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   └── runtime -&gt; ../../../model_zoo/runtime/horizon_runtime_sample   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── script                                # aarch64示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── script_x86                            # x86示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── xj3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data                                  # 预置数据文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cls_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── custom_identity_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── det_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── misc_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   └── runtime -&gt; ../../../model_zoo/runtime/horizon_runtime_sample   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── script                                # aarch64示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── script_x86                            # x86示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── README.md</span><br></span></code></pre></div></div>
<ul>
<li><strong>00_quick_start</strong>：快速入门示例，基于 <code>dnn</code> API，用mobilenetv1进行单张图片模型推理和结果解析。</li>
<li><strong>01_api_tutorial</strong>： <code>dnn</code> API使用教学代码， 包括 <strong>mem</strong>， <strong>model</strong>， <strong>resize</strong>， <strong>roi_infer</strong> 和 <strong>tensor</strong> 五部分。</li>
<li><strong>02_advanced_samples</strong>：特殊功能示例，包括 <strong>custom_identity</strong>， <strong>multi_input</strong>， <strong>multi_model_batch</strong> 和 <strong>nv12_batch</strong> 功能。。</li>
<li><strong>03_misc</strong>：非NV12输入模型的杂项示例。</li>
<li><strong>xj3</strong>：RDK X3开发板示例运行脚本，预置了数据和相关模型。</li>
<li><strong>ultra</strong>: RDK Ultra开发板示例运行脚本，预置了数据和相关模型。</li>
<li><strong>build_xj3.sh</strong>：RDK X3程序一键编译脚本。</li>
<li><strong>build_ultra.sh</strong>：RDK Ultra程序一键编译脚本。</li>
<li><strong>deps/deps_gcc9.3</strong>：示例代码所需要的三方依赖, 用户在开发自己代码程序的时候可以根据实际情况替换或者裁剪。</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>私有模型上板运行，请参考 <code>00_quick_start/src/run_mobileNetV1_224x224.cc</code> 示例代码流程进行代码重写，编译成功后可以在开发板上测试验证！</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="环境构建">环境构建<a href="#环境构建" class="hash-link" aria-label="环境构建的直接链接" title="环境构建的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="开发板准备">开发板准备<a href="#开发板准备" class="hash-link" aria-label="开发板准备的直接链接" title="开发板准备的直接链接">​</a></h5>
<ol>
<li>
<p>拿到开发板后，请将开发版镜像更新到最新版本，升级方法请参考<a href="/rdk_doc/Quick_start/install_os/rdk_x3"><strong>系统更新</strong></a> 章节内容。</p>
</li>
<li>
<p>确保本地开发机和开发板可以远程连接。</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="编译">编译<a href="#编译" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h5>
<p>编译需要当前环境安装好交叉编译工具： <code>aarch64-linux-gnu-g++</code> ， <code>aarch64-linux-gnu-gcc</code>。 请使用D-Robotics 提供的开发机Docker镜像，直接进行编译使用。开发机Docker环境的获取及使用方法，请阅读<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config"><strong>环境安装</strong></a> 章节内容；
根据自身使用的开发板情况，请使用horizon_runtime_sample/code目录下的 <code>build_xj3.sh</code> 或 <code>build_ultra.sh</code> 脚本，即可一键编译开发板环境下的可执行程序，可执行程序和对应依赖会自动复制到 <code>xj3/script</code> 目录下的 <code>aarch64</code> 目录下 或 <code>ultra/script</code> 目录下的 <code>aarch64</code> 目录下。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>工程通过获取环境变量 <code>LINARO_GCC_ROOT</code> 来指定交叉编译工具的路径，用户使用之前可以检查本地的环境变量是否为目标交叉编译工具。
如果需要指定交叉编译工具路径，可以设置环境变量 <code>LINARO_GCC_ROOT</code> , 或者直接修改脚本 <code>build_xj3.sh</code> 或 <code>build_ultra.sh</code>，指定变量 <code>CC</code> 和 <code>CXX</code>。</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  export CC=${GCC_ROOT}/bin/aarch64-linux-gnu-gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export CXX=${GCC_ROOT}/bin/aarch64-linux-gnu-g++</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例使用">示例使用<a href="#示例使用" class="hash-link" aria-label="示例使用的直接链接" title="示例使用的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="basic_samples-示例">basic_samples 示例<a href="#basic_samples-示例" class="hash-link" aria-label="basic_samples 示例的直接链接" title="basic_samples 示例的直接链接">​</a></h5>
<p>模型推理​示例脚本主要在 xj3/script 和 xj3/script_x86 目录下，编译程序后目录结构如下:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK X3 使用脚本信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_mobilenetV1.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── resize_bgr.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── resize_y.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── roi_infer.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── sys_mem.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── tensor.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_resnet50_feature.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── aarch64                        # 编译产生可执行程序及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── model_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── resize_bgr_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── resize_y_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── roi_infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_custom_op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_lenet_gray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_mobileNetV1_224x224</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_multi_model_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_resnet_feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── sys_mem_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── tensor_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── libdnn.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── libhbrt_bernoulli_aarch64.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       └── libopencv_world.so.3.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK Ultra 使用脚本信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_mobilenetV1.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── roi_infer.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── sys_mem.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── tensor.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── run_multi_input.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_nv12_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_resnet50_feature.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── aarch64                        # 编译产生可执行程序及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── model_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── roi_infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_custom_op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_lenet_gray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_mobileNetV1_224x224</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_multi_input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_multi_model_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_nv12_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_resnet_feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── sys_mem_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── tensor_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── libdnn.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── libhbrt_bayes_aarch64.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       └── libopencv_world.so.3.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li>model文件夹下包含模型的路径，其中 <code>runtime</code> 文件夹为软链接，链接路径为 <code>../../../model_zoo/runtime/horizon_runtime_sample</code> ，可直接找到交付包中的模型路径</li>
<li>板端运行环境需要将模型放至 <code>model</code> 文件夹下</li>
</ul></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="quick_start">quick_start<a href="#quick_start" class="hash-link" aria-label="quick_start的直接链接" title="quick_start的直接链接">​</a></h5>
<p>00_quick_start 目录下的是模型推理的快速开始示例：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  00_quick_start/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_mobilenetV1.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>run_mobilenetV1.sh</code> ：该脚本实现使用mobilenetv1模型读取单张图片进行推理的示例功能。</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="api_tutorial">api_tutorial<a href="#api_tutorial" class="hash-link" aria-label="api_tutorial的直接链接" title="api_tutorial的直接链接">​</a></h5>
<p>01_api_tutorial 目录下的示例，用于介绍如何使用嵌入式API。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── resize_bgr.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── resize_y.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── roi_infer.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── sys_mem.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── tensor.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>model.sh</code> ：该脚本主要实现读取模型信息的功能。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh model.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/01_api_tutorial# sh model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/model_example --model_file_list=../../model/runtime/mobilenetv1/mobilenetv1_nv12_hybrid_horizonrt.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 24638 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 04:19:27.245879 24638 model_example.cc:104] model count:1, model[0]: mobilenetv1_nv12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 04:19:27.246064 24638 model_example.cc:112] hbDNNGetModelHandle [mobilenetv1_nv12] success!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 04:19:27.246139 24638 model_example.cc:189] [mobilenetv1_nv12] Model Info:  input num: 1, input[0] validShape: ( 1, 3, 224, 224 ), alignedShape: ( 1, 4, 224, 224 ), tensorLayout: 2, tensorType: 1, output num: 1, output[0] validShape: ( 1, 1000, 1, 1 ), alignedShape: ( 1, 1000, 1, 1 ), tensorLayout: 2, tensorType: 13</span><br></span></code></pre></div></div>
<ul>
<li><code>resize_bgr.sh</code> ：该脚本主要引导如何使用 <code>hbDNNResize</code> 这个API，
示例实现的代码功能是将一张1352x900大小的图片，截取图片中坐标为[5，19，340，343]的部分，然后resize到402x416并保存下来。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh resize_bgr.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/01_api_tutorial# sh resize_bgr.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/resize_bgr_example --image_file=../../data/det_images/kite.jpg --resize_height=416 --resize_width=402 --resized_image=./resize_bgr.jpg --crop_x1=5 --crop_x2=340 --crop_y1=19 --crop_y2=343</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 24975 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:58:03.327212 24975 resize_bgr_example.cc:116] Original shape: 1352x900 ,dest shape:402x416 ,aligned shape:402x416</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:58:03.328739 24975 resize_bgr_example.cc:139] resize success!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:58:03.335835 24975 resize_bgr_example.cc:143] wait task done finished!</span><br></span></code></pre></div></div>
<p>执行成功后，当前目录会成功保存名称为resize_bgr.jpg的图片。</p>
<ul>
<li><code>resize_y.sh</code> ：该脚本主要引导如何使用 <code>hbDNNResize</code> 这个API，示例代码实现的功能是将一张图片resize到416x402。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh resize_y.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/01_api_tutorial# sh resize_y.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/resize_y_example --image_file=../../data/det_images/kite.jpg --resize_height=416 --resize_width=402 --resized_image=./resize_y.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 24992 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:59:36.887241 24992 resize_y_example.cc:101] Original shape: 1352x900 ,dest shape:402x416 ,aligned shape:402x416</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:59:36.888770 24992 resize_y_example.cc:119] resize success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:59:36.891711 24992 resize_y_example.cc:123] wait resize success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:59:36.891798 24992 resize_y_example.cc:129] spent time: 0.003463</span><br></span></code></pre></div></div>
<p>​执行成功后，当前目录会成功保存名称为resize_y.jpg的图片。</p>
<ul>
<li>
<p><code>roi_infer.sh</code> ： 该脚本主要引导如何使用 <code>hbDNNRoiInfer</code> 这个API，示例代码实现的功能是将一张图片resize到模型输入大小，转为nv12数据，并给定roi框进行模型推理（infer）。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh roi_infer.sh</code> 即可。</p>
</li>
<li>
<p><code>sys_mem.sh</code> ：该脚本主要引导如何使用 <code>hbSysAllocMem</code>、 <code>hbSysFlushMem</code> 和 <code>hbSysFreeMem</code> 这几个API。使用的时候，直接进入 01_api_tutorial 目录，执行 <code>sh sys_mem.sh</code> 即可。</p>
</li>
<li>
<p><code>tensor.sh</code> ：该脚本主要引导如何准备模型输入和输出的tensor。
使用的时候，直接进入 01_api_tutorial 目录，执行 <code>sh tensor.sh</code> 即可，如下所示：</p>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/01_api_tutorial# sh tensor.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:0, Tensor layout: 2, shape:1x1x721x1836, aligned shape:1x1x721x1840</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:1, Tensor layout: 2, shape:1x3x773x329, aligned shape:1x3x773x336</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:2, Tensor layout: 2, shape:1x3x108x1297, aligned shape:1x3x108x1312</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:5, Tensor layout: 2, shape:1x3x858x477, aligned shape:1x3x858x477</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:5, Tensor layout: 0, shape:1x920x102x3, aligned shape:1x920x102x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:4, Tensor layout: 2, shape:1x3x723x1486, aligned shape:1x3x723x1486</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:4, Tensor layout: 0, shape:1x372x366x3, aligned shape:1x372x366x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:3, Tensor layout: 2, shape:1x3x886x291, aligned shape:1x3x886x291</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:3, Tensor layout: 0, shape:1x613x507x3, aligned shape:1x613x507x3</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="advanced_samples">advanced_samples<a href="#advanced_samples" class="hash-link" aria-label="advanced_samples的直接链接" title="advanced_samples的直接链接">​</a></h5>
<p>02_advanced_samples 目录下的示例，用于介绍自定义算子特殊功能的使用。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_multi_model_batch.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>custom_arm_op_custom_identity.sh</code> ：该脚本主要实现自定义算子模型推理功能，
使用的时候，进入 02_advanced_samples 目录, 然后直接执行 <code>sh custom_arm_op_custom_identity.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/02_advanced_samples# sh custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_custom_op --model_file=../../model/runtime/custom_op/custom_op_featuremap.bin --input_file=../../data/custom_identity_data/input0.bin,../../data/custom_identity_data/input1.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 30421 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.172068 30421 main.cpp:212] hbDNNRegisterLayerCreator success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.172335 30421 main.cpp:217] hbDNNRegisterLayerCreator success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.3.1)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.15.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [DNN] Runtime version = 1.15.2_(3.15.3 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [A][DNN][packed_model.cpp:217](1563865572232) [HorizonRT] The model builder version = 1.13.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.240696 30421 main.cpp:232] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.240784 30421 main.cpp:239] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.240819 30421 main.cpp:245] hbDNNGetInputCount success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file length: 602112</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file length: 602112</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.243616 30421 main.cpp:268] hbDNNGetOutputCount success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.244102 30421 main.cpp:297] hbDNNInfer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.257903 30421 main.cpp:302] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:14.277941 30421 main.cpp:306] write output tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  模型的第一个输出数据保存至 ``output0.txt`` 文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li><code>run_multi_model_batch.sh</code> ：该脚本主要实现多个小模型批量推理功能，
使用的时候，进入 02_advanced_samples 目录, 然后直接执行 <code>sh run_multi_model_batch.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    root@x3sdbx3-hynix2G-3200:/userdata/chaoliang/xj3/script/02_advanced_samples# sh run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_multi_model_batch --model_file=../../model/runtime/googlenet/googlenet_224x224_nv12.bin,../../model/runtime/mobilenetv2/mobilenetv2_224x224_nv12.bin --input_file=../../data/cls_images/zebra_cls.jpg,../../data/cls_images/zebra_cls.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 17060 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.13.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.1.1)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.249785 17060 main.cpp:119] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.250029 17060 main.cpp:127] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.250071 17060 main.cpp:141] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.283633 17060 main.cpp:155] read image to nv12 success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.284270 17060 main.cpp:172] prepare input tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.284456 17060 main.cpp:184] prepare output tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.285344 17060 main.cpp:218] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.296559 17060 main.cpp:223] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.296701 17060 main.cpp:228] googlenet class result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.296805 17060 main.cpp:232] mobilenetv2 class result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.296887 17060 main.cpp:236] release task success</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="misc">misc<a href="#misc" class="hash-link" aria-label="misc 的直接链接" title="misc的直接链接">​</a></h5>
<p>03_misc 目录下的示例，用于介绍非nv12输入模型的使用。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_resnet50_feature.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>run_lenet.sh</code> ：该脚本主要实现Y数据输入的lenet模型推理功能，
使用的时候，进入 03_misc 目录, 然后直接执行 <code>sh run_lenet.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/03_misc# sh run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_lenet_gray --model_file=../../model/runtime/lenet_gray/lenet_gray_hybrid_horizonrt.bin --data_file=../../data/misc_data/7.bin --image_height=28 --image_width=28 --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 25139 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.507514 25139 run_lenet_gray.cc:145] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.507737 25139 run_lenet_gray.cc:153] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.507771 25139 run_lenet_gray.cc:160] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.508070 25139 run_lenet_gray.cc:176] prepare y tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.508178 25139 run_lenet_gray.cc:189] prepare tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.509909 25139 run_lenet_gray.cc:200] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510721 25139 run_lenet_gray.cc:205] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510790 25139 run_lenet_gray.cc:210] task post process finished</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510832 25139 run_lenet_gray.cc:217] TOP 0 result id: 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510857 25139 run_lenet_gray.cc:217] TOP 1 result id: 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510879 25139 run_lenet_gray.cc:217] TOP 2 result id: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510903 25139 run_lenet_gray.cc:217] TOP 3 result id: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510927 25139 run_lenet_gray.cc:217] TOP 4 result id: 2</span><br></span></code></pre></div></div>
<ul>
<li><code>run_resnet50_feature.sh</code> ：该脚本主要实现feature数据输入的resnet50模型推理功能，示例代码对feature数据做了quantize和padding以满足模型的输入条件，然后输入到模型进行infer。
使用的时候，进入 03_misc 目录, 然后直接执行 <code>sh run_resnet50_feature.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/03_misc# sh run_resnet50_feature.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_resnet_feature --model_file=../../model/runtime/resnet50_feature/resnet50_feature_hybrid_horizonrt.bin --data_file=../../data/misc_data/np_0 --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 25155 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.300466 25155 run_resnet_feature.cc:136] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.300708 25155 run_resnet_feature.cc:144] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.300741 25155 run_resnet_feature.cc:151] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.302760 25155 run_resnet_feature.cc:166] prepare feature tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.302919 25155 run_resnet_feature.cc:176] prepare tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.304678 25155 run_resnet_feature.cc:187] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373052 25155 run_resnet_feature.cc:192] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373328 25155 run_resnet_feature.cc:197] task post process finished</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373374 25155 run_resnet_feature.cc:204] TOP 0 result id: 74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373399 25155 run_resnet_feature.cc:204] TOP 1 result id: 815</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373422 25155 run_resnet_feature.cc:204] TOP 2 result id: 73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373445 25155 run_resnet_feature.cc:204] TOP 3 result id: 78</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373468 25155 run_resnet_feature.cc:204] TOP 4 result id: 72</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="辅助工具和常用操作">辅助工具和常用操作<a href="#辅助工具和常用操作" class="hash-link" aria-label="辅助工具和常用操作的直接链接" title="辅助工具和常用操作的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="日志">日志<a href="#日志" class="hash-link" aria-label="日志的直接链接" title="日志的直接链接">​</a></h5>
<p>本章节主要包括 <code>示例日志</code> 和 <code>模型推理 DNN API日志</code> 两部分。
其中示例日志是指交付包示例代码中的应用日志；模型推理 dnn API日志是指嵌入式dnn库中的日志。用户根据不同的需求可以获取不同的日志信息。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例日志">示例日志<a href="#示例日志" class="hash-link" aria-label="示例日志的直接链接" title="示例日志的直接链接">​</a></h5>
<p>示例日志主要采用glog中的vlog，basic_samples参考示例中，日志内容会全部输出。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理-dnn-api日志">模型推理 DNN API日志<a href="#模型推理-dnn-api日志" class="hash-link" aria-label="模型推理 DNN API日志的直接链接" title="模型推理 DNN API日志的直接链接">​</a></h5>
<p>关于模型推理 DNN API日志的配置，请阅读<a href="/rdk_doc/04_Algorithm_Application/02_cdev_dnn_api/cdev_dnn_api.md">《模型推理DNN API使用说明》</a> 文档中的 <code>配置信息</code> 一节内容。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="公版模型性能精度测评说明">公版模型性能精度测评说明<a href="#公版模型性能精度测评说明" class="hash-link" aria-label="公版模型性能精度测评说明的直接链接" title="公版模型性能精度测评说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="公版模型性能精度指标">公版模型性能精度指标<a href="#公版模型性能精度指标" class="hash-link" aria-label="公版模型性能精度指标的直接链接" title="公版模型性能精度指标的直接链接">​</a></h4>
<p>下表提供了 典型深度神经网络模型在X3处理器上的性能、精度指标。</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/model_accuracy.png" alt="model_accuracy" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><ol>
<li>
<p>表格中的数据均为在D-Robotics RDK X3开发板的实测结果，测试模型均来自于<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config">horizon_model_convert_sample</a> 模型示例包；</p>
</li>
<li>
<p>对于模型示例包中的 BPU/CPU 混合异构模型，单帧的耗时主要由输入量化CPU节点、模型BPU算子、模型CPU算子、输出反量化CPU节点、CPU后处理等模块构成，具体说明如下：</p>
<p>a. 输入量化CPU节点：完成float32到int8的输入量化操作，该节点只在使用 featuremap 输入的模型中包含。量化耗时与输入 shape 大小成正比</p>
<p>b. 模型CPU算子：</p>
<p>ⅰ. 检测模型中未包含 CPU 算子</p>
<p>ⅱ. 分类模型尾部的 Softmax 和 Reshape 为 CPU 算子</p>
<p>ⅲ. 分割模型 DeepLabV3+ 尾部的 Argmax 为 CPU 算子</p>
<p>c. 输出反量化CPU节点：完成int8到float32的输出反量化操作。量化耗时与输出 shape 大小成正比</p>
<p>d. D-Robotics 目前支持将模型的 量化/反量化节点手动摘除，由用户自行融入前后处理代码中实现，以减少数据重复遍历的损耗。以 EfficientDet 模型为例，摘除了反量化节点合入后处理，推理性能从 66FPS提高到100FPS</p>
<p>e. 目前D-Robotics 示例模型的后处理均未做针对性的性能优化，您可以根据实际需求采用如近似高效实现等优化手段进行代码级加速</p>
</li>
<li>
<p>在实际应用中，BPU 和 CPU 可以并发运行，提高整体推理速度。</p>
</li>
<li>
<p>若实测性能与上述表格的测试结果不一致，有几个方面可能导致此种情况：</p>
<p>a. DDR带宽的影响，开发板只能运行ai_benchmark程序。</p>
<p>b. 算法工具链版本与系统镜像版本不完全匹配，最理想的情况是配套使用发布包的算法工具链和系统镜像。</p>
<p>c. CPU降频影响，目前开发板重启后默认启用自动降频，为了获得最好的性能，您需要在开发板上执行关闭降频命令： <code>echo performance &gt; /sys/devices/system/cpu/cpufreq/policy0/scaling_governor</code>。</p>
</li>
</ol></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="评测方法说明">评测方法说明<a href="#评测方法说明" class="hash-link" aria-label="评测方法说明的直接链接" title="评测方法说明的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h5>
<p>本章节介绍公版模型精度性能评测 ai_benchmark 示例包的具体用法， 示例包中预置了源码、可执行程序和评测脚本，开发者可以直接在D-Robotics 开发板上体验并基于这些示例进行嵌入式应用开发，降低开发门槛。</p>
<p>示例包提供常见的分类、检测和分割模型的性能评测和精度评测示例，详细内容请阅读下文。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>公版模型精度性能评测 ai_benchmark 示例包获取，请参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config#deliverables_instructions">《交付物说明》</a>。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码包结构">示例代码包结构<a href="#示例代码包结构" class="hash-link" aria-label="示例代码包结构的直接链接" title="示例代码包结构的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ai_benchmark/code                     # 示例源码文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── build_ptq_xj3.sh                  # RDK X3 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── build_ptq_ultra.sh                # RDK Ultra 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── deps/deps_gcc9.3                  # 第三方依赖  库，gcc9.3为deps_gcc9.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── aarch64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── vdsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── include                           # 源码头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── src                               # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── simple_example.cc             # 示例主程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_benchmark/xj3                      # 示例包运行环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── ptq                               # PTQ方案模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data                          # 模型精度评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── mini_data                     # 模型性能评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cifar10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── coco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── culane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── flyingchairs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── imagenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── kitti3d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── mot17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── nuscenes_lidar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── voc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── model                         # PTQ方案nv12模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── runtime -&gt; ../../../../model_zoo/runtime/ai_benchmark/ptq   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── script                        # 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── aarch64                   # 编译产生可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── classification            # 分类模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── googlenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── mobilenetv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── resnet18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── config                    # 模型推理配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── data_name_list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── detection                 # 检测模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── centernet_resnet50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientdetd0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── ssd_mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov2_darknet19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov3_darknet53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── yolov5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── segmentation              # 分割模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── fastscnn_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── unet_mobilenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── base_config.sh            # 基础配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── tools                         # 精度评测工具</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── python_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_benchmark/ultra                       # 示例包运行环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── ptq                               # PTQ方案模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data                          # 模型精度评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── mini_data                     # 模型性能评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cifar10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── coco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── culane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── flyingchairs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── imagenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── kitti3d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── mot17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── nuscenes_lidar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── voc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── model                         # PTQ方案nv12模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── runtime -&gt; ../../../../model_zoo/runtime/ai_benchmark/ptq   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── script                        # 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── aarch64                   # 编译产生可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── classification            # 分类模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnasnet_m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnasnet_s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── googlenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── mobilenetv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── resnet18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── vargconvnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── config                    # 模型推理配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── detection                 # 检测模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── centernet_resnet101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── ssd_mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov2_darknet19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov3_darknet53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov3_vargdarknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── yolov5x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── segmentation              # 分割模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── deeplabv3plus_efficientnetm1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── deeplabv3plus_efficientnetm2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── fastscnn_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── env.sh                    # 基础环境脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── tools                         # 精度评测工具</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             ├── python_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             └── README.md</span><br></span></code></pre></div></div>
<ul>
<li><strong>code</strong>：该目录内是评测程序的源码，用来进行模型性能和精度评测。</li>
<li><strong>xj3</strong>： 提供了已经编译好的应用程序，以及各种评测脚本，用来测试多种模型在D-Robotics BPU上运行的性能，精度等(<strong>RDK X3</strong> 使用)。</li>
<li><strong>ultra</strong>： 提供了已经编译好的应用程序，以及各种评测脚本，用来测试多种模型在D-Robotics BPU上运行的性能，精度等(<strong>RDK Ultra</strong> 使用)。</li>
<li><strong>build_ptq_xj3.sh</strong>：开发板程序一键编译脚本(<strong>RDK X3</strong> 使用)。</li>
<li><strong>build_ptq_ultra.sh</strong>：开发板程序一键编译脚本(<strong>RDK Ultra</strong> 使用)。</li>
<li><strong>deps/deps_gcc9.3</strong>：示例代码所需要的依赖，主要如下所示:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  gflags  glog  hobotlog nlohmann opencv  rapidjson</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例模型">示例模型<a href="#示例模型" class="hash-link" aria-label="示例模型的直接链接" title="示例模型的直接链接">​</a></h5>
<p>我们提供了开源的模型库，里面包含常用的分类、检测和分割模型，模型的命名规则为：<code>{model_name}_{backbone}_{input_size}_{input_type}</code>，开发者可以直接使用。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>以下表格中的bin模型都是通过 horizon_model_convert_sample 模型转换示例包转换编译出来的，请阅读<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config#deliverables_instructions">《交付物说明》</a> 章节内容进行获取。</p></div></div>
<table><thead><tr><th>MODEL</th><th>MODEL NAME</th></tr></thead><tbody><tr><td>centernet_resnet101</td><td>centernet_resnet101_512x512_nv12.bin</td></tr><tr><td>deeplabv3plus_efficientnetb0</td><td>deeplabv3plus_efficientnetb0_1024x2048_nv12.bin</td></tr><tr><td>deeplabv3plus_efficientnetm1</td><td>deeplabv3plus_efficientnetm1_1024x2048_nv12.bin</td></tr><tr><td>efficientnasnet_m</td><td>efficientnasnet_m_300x300_nv12.bin</td></tr><tr><td>efficientnet_lite4</td><td>efficientnet_lite4_300x300_nv12.bin</td></tr><tr><td>fastscnn_efficientnetb0</td><td>fastscnn_efficientnetb0_1024x2048_nv12.bin</td></tr><tr><td>googlenet</td><td>googlenet_224x224_nv12.bin</td></tr><tr><td>mobilenetv1</td><td>mobilenetv1_224x224_nv12.bin</td></tr><tr><td>mobilenetv2</td><td>mobilenetv2_224x224_nv12.bin</td></tr><tr><td>preq_qat_fcos_efficientnetb0</td><td>fcos_efficientnetb0_512x512_nv12.bin</td></tr><tr><td>preq_qat_fcos_efficientnetb2</td><td>fcos_efficientnetb2_768x768_nv12.bin</td></tr><tr><td>resnet18</td><td>resnet18_224x224_nv12.bin</td></tr><tr><td>ssd_mobilenetv1</td><td>ssd_mobilenetv1_300x300_nv12.bin</td></tr><tr><td>vargconvnet</td><td>vargconvnet_224x224_nv12.bin</td></tr><tr><td>yolov3_darknet53</td><td>yolov3_darknet53_416x416_nv12.bin</td></tr><tr><td>yolov5s</td><td>yolov5s_672x672_nv12.bin</td></tr><tr><td>yolov5x</td><td>yolov5x_672x672_nv12.bin</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="公共数据集">公共数据集<a href="#公共数据集" class="hash-link" aria-label="公共数据集的直接链接" title="公共数据集的直接链接">​</a></h5>
<p>测评示例中用到的数据集主要有VOC数据集、COCO数据集、ImageNet、Cityscapes数据集、FlyingChairs数据集、KITTI数据集、Culane数据集、Nuscenes数据集和Mot17数据集。</p>
<p>请在linux环境下进行下载  ，获取方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  VOC：http://host.robots.ox.ac.uk/pascal/VOC/  （使用VOC2012版本）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COCO：https://cocodataset.org/#download</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ImageNet：https://www.image-net.org/download.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cityscapes：https://github.com/mcordts/cityscapesScripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FlyingChairs：https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KITTI3D：https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CULane：https://xingangpan.github.io/projects/CULane.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nuScenes：https://www.nuscenes.org/nuscenes#download</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mot17：https://opendatalab.com/MOT17</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="环境构建-1">环境构建<a href="#环境构建-1" class="hash-link" aria-label="环境构建的直接链接" title="环境构建的直接链接">​</a></h5>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="开发板准备-1">开发板准备<a href="#开发板准备-1" class="hash-link" aria-label="开发板准备的直接链接" title="开发板准备的直接链接">​</a></h5>
<ol>
<li>
<p>拿到开发板后，请将开发版镜像更新到最新版本，升级方法请参考<a href="/rdk_doc/Quick_start/install_os/rdk_x3"><strong>安装系统</strong></a> 章节内容。</p>
</li>
<li>
<p>确保本地开发机和开发板可以远程连接。</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="编译环境准备">编译环境准备<a href="#编译环境准备" class="hash-link" aria-label="编译环境准备的直接链接" title="编译环境准备的直接链接">​</a></h5>
<p>编译需要当前环境安装好交叉编译工具 <code>gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu</code>。请使用D-Robotics 提供的开发机Docker镜像，直接进行编译使用。开发机Docker环境的获取及使用方法，请阅读<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config"><strong>环境安装</strong></a> 章  节内容；
请使用code目录下的 <code>build_ptq_xj3.sh</code> 或 <code>build_ptq_ultra.sh</code> 脚本，即可一键编译开发板环境下的可执行程序，可执行程序和对应依赖会自动复制到 <code>xj3/ptq/script</code> 目录下的 <code>aarch64</code> 目录下 或 <code>ultra/ptq/script</code> 目录下的 <code>aarch64</code> 目录下。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>需要注意 <code>build_ptq_xj3.sh</code> 和 <code>build_ptq_ultra.sh</code> 脚本里指定的交叉编译工具链的位置是 <code>/opt</code> 目录下，用户如果安装在其他位置，可以手动修改下脚本。</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  export CC=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export CXX=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-g++</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="测评示例使用说明">测评示例使用说明<a href="#测评示例使用说明" class="hash-link" aria-label="测评示例使用说明的直接链接" title="测评示例使用说明  的直接链接">​</a></h5>
<p>评测示例脚本主要在 <code>script</code> 和 <code>tools</code> 目录下。 script是开发板上运行的评测脚本，包括常见分类，检测和分割模型。每个模型下面有三个脚本，分别表示：</p>
<ul>
<li>fps.sh：利用多线程调度实现fps统计，用户可以根据需求自由设置线程数。</li>
<li>latency.sh：实现单帧延迟统计（一个线程，单帧）。</li>
<li>accuracy.sh：用于精度评测。</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── aarch64             # 编译产生的可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── base_config.sh      # 基础配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── config              # image_name配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── data_name_list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   ├── coco_detlist.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   |   ├── imagenet.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   |   └── voc_detlist.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── classification      # 分类模型评测</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── efficientnet_lite0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── fps.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── latency.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_accuracy.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_fps.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── workflow_latency.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── .....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── resnet18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── detection           # 检测模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   ├── centernet_resnet50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── fps.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── latency.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_accuracy.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_fps.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── workflow_latency.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── yolov2_darknet19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── yolov3_darknet53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── efficientdetd0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── segmentation       # 分割模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── fps.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── latency.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── workflow_accuracy.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── workflow_fps.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── workflow_latency.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── fastscnn_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── unet_mobilenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>tools目录下是精度评测需要的脚本。主要包括 <code>python_tools</code> 下的精度计算脚本。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  tools:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── accuracy_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cityscapes_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cls_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── coco_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── coco_det_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── config.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── parsing_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── voc_det_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── voc_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>评测前需要执行以下命令，将 <code>ptq</code> 目录拷贝到开发板上，然后将 <code>model_zoo/runtime</code> 拷贝到 <code>ptq/model</code> 目录下。</p></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  scp -r ai_toolchain_package/Ai_Toolchain_Package-release-vX.X.X-OE-vX.X.X/ai_benchmark/xj3/ptq root@192.168.1.10:/userdata/ptq/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scp -r model_zoo/runtime root@192.168.1.10:/userdata/ptq/model/</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="性能评测">性能评测<a href="#性能评测" class="hash-link" aria-label="性能评测的直接链接" title="性能评测的直接链接">​</a></h5>
<p>性能评测分为latency和fps两方面。</p>
<ul>
<li>测评脚本使用说明</li>
</ul>
<p>进入到需要评测的模型目录下，执行 <code>sh latency.sh</code> 即可测试出单帧延迟。如下图所示：</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 02:35:07.041095 39124 output_plugin.cc:80]  Infer latency:  [avg:  13.124ms,  max:  13.946ms,  min:  13.048ms], Post process latency: [avg:  3.584ms,  max:  3.650ms,  min:  3.498ms].</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>infer</code> 表示模型推理耗时。</li>
<li><code>Post process</code> 表示后处理耗时。</li>
</ul></div></div>
<p>进入到需要评测的模型目录下执行 <code>sh fps.sh</code> 即可测试出帧率。如下图所示：</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 02:35:00.044417 39094 output_plugin.cc:109]  Throughput: 176.39fps      # 模型帧率</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>该功能采用多线程并发方式，旨在让模型可以在BPU上达到极致的性能。由于多线程并发及数据采样的原因，在程序启动阶段帧率值会较低，之后帧率会上升并逐渐趋于稳定，帧率的浮动范围控制在0.5%之内。</p></div></div>
<ul>
<li>命令行参数说明</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<p><code>fps.sh</code> 脚本内容如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source ../../base_config.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export SHOW_FPS_LOG=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export STAT_CYCLE=10                             # 设置环境变量，FPS 统计周期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${app} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --config_file=workflow_fps.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log_level=1</span><br></span></code></pre></div></div>
<p><code>latency.sh</code> 脚本内容如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source ../../base_config.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export SHOW_LATENCY_LOG=1                            # 设置环境变量，打印 LATENCY 级别log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export STAT_CYCLE=5                                  # 设置环境变量，LATENCY 统计周期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${app} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --config_file=workflow_latency.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log_level=1</span><br></span></code></pre></div></div>
<ul>
<li>配置文件说明</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>注意：max_cache参数生效时会预处理图片并读取到内存中，为保障您的程序稳定运行，请不要设置过大的值，建议您的数值设置不超过30。</p></div></div>
<p>以fcos_efficientnetb0模型为例，workflow_fps.json 配置文件内容如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;input_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;input_type&quot;: &quot;image&quot;,                                    # 输入数据格式，支持图像或者bin文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;height&quot;: 512,                                            # 输入数据高度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;width&quot;: 512,                                             # 输入数据宽度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;data_type&quot;: 1,                                           # 输入数据类型：HB_DNN_IMG_TYPE_NV12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;image_list_file&quot;: &quot;../../../mini_data/coco/coco.lst&quot;,    # 预处理数据集lst文件所在  路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;need_pre_load&quot;: true,                                    # 是否使用预加载方式读取数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;limit&quot;: 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;need_loop&quot;: true,                                        # 是否循环读取数据进行评测</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;max_cache&quot;: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;output_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_type&quot;: &quot;image&quot;,                                   # 可视化输出数据类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;image_list_enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;in_order&quot;: false                                         # 是否按顺序输出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;workflow&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_type&quot;: &quot;InferMethod&quot;,                           # Infer推理方式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unique_name&quot;: &quot;InferMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;core&quot;: 0,                                            # 推理core id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;model_file&quot;: &quot;../../../model/runtime/fcos_efficientnetb0/fcos_efficientnetb0_512x512_nv12.bin&quot; # 模型文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;thread_count&quot;: 4,                                      # 后处理线程数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_type&quot;: &quot;PTQFcosPostProcessMethod&quot;,              # 后处理方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unique_name&quot;: &quot;PTQFcosPostProcessMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_config&quot;: {                                      # 后处理参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;strides&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            32,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;class_num&quot;: 80,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;score_threshold&quot;: 0.5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;topk&quot;: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;det_name_list&quot;: &quot;../../config/data_name_list/coco_detlist.list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre></div></div>
<p>workflow_latency.json 如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;input_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;input_type&quot;: &quot;image&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;height&quot;: 512,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;width&quot;: 512,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;data_type&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;image_list_file&quot;: &quot;../../../mini_data/coco/coco.lst&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;need_pre_load&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;limit&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;need_loop&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;max_cache&quot;: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;output_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_type&quot;: &quot;image&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;image_list_enable&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;workflow&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_type&quot;: &quot;InferMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unique_name&quot;: &quot;InferMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;core&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;model_file&quot;: &quot;../../../model/runtime/fcos_efficientnetb0/fcos_efficientnetb0_512x512_nv12.bin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;thread_count&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_type&quot;: &quot;PTQFcosPostProcessMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unique_name&quot;: &quot;PTQFcosPostProcessMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;strides&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            32,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;class_num&quot;: 80,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;score_threshold&quot;: 0.5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;topk&quot;: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;det_name_list&quot;: &quot;../../config/data_name_list/coco_detlist.list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="精度评测">精度评测<a href="#精度评测" class="hash-link" aria-label="精度评测的直接链接" title="精度评测的直接链接">​</a></h5>
<p>模型精度评测分为四步：</p>
<ol>
<li>数据预处理。</li>
<li>数据挂载。</li>
<li>模型推理。</li>
<li>精度计算。</li>
</ol>
<ul>
<li>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="数据预处理">数据预处理<a href="#数据预处理" class="hash-link" aria-label="数据预处理的直接链接" title="数据预处理的直接链接">​</a></h5>
</li>
</ul>
<p>对于PTQ模型：数据预处理需要在x86开发机环境下运行 <code>hb_eval_preprocess</code> 工具，对数据集进行预处理。
所谓预处理是指图片数据在送入模型之前的特定处理操作，例如：图片resize、crop和padding等。
该工具集成于开发机 模型转换编译的环境中，原始数据集经过工具预处理之后，会生成模型对应的前处理二进制文件.bin文件集.
直接运行 <code>hb_eval_preprocess --help</code> 可查看工具使用规则。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><ol>
<li>关于 <code>hb_eval_preprocess</code> 工具命令行参数，可键入 <code>hb_eval_preprocess -h</code>， 或查看 PTQ量化原理及步骤说明的
<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md"><strong>hb_eval_preprocess工具</strong></a> 一节内容。</li>
</ol></div></div>
<p>下面将详细介绍示例包中每一个模型对应的数据集，以及对应数据集的预处理操作：</p>
<ul>
<li><code>VOC数据集</code> ：该数据集主要用于ssd_mobilenetv1模型的评测，
其目录结构如下，示例中主要用到 <code>Main</code> 文件下的val.txt文件， <code>JPEGImages</code> 中的源图片和 <code>Annotations</code> 中的标注数据：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── VOCdevkit                  # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── VOC2012                # 不同年份的数据集，这里只下载了2012的，还有2007等其它年份的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── Annotations        # 存放xml文件，与JPEGImages中的图片一一对应，解释图片的内容等等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── ImageSets          # 该目录下存放的都是txt文件，txt文件中每一行包含一个图片的名称，末尾会加上±1表示正负样本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Layout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   └── Segmentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── JPEGImages         # 存放源图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── SegmentationClass  # 存放的是图片，语义分割相关</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── SegmentationObject # 存放的是图片，实例分割相关</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m ssd_mobilenetv1 -i VOCdevkit/VOC2012/JPEGImages -v VOCdevkit/VOC2012/ImageSets/Main/val.txt -o ./pre_ssd_mobilenetv1</span><br></span></code></pre></div></div>
<ul>
<li><code>COCO数据集</code> ：该数据集主要用于yolov2_darknet19、yolov3_darknet53、yolov5s、efficientdetd0、fcos_efficientnetb0和centernet_resnet50等检测模型的评测，
其目录如下，示例中主要用到 <code>annotations</code> 文件夹下的instances_val2017.json标注文件和 <code>images</code> 中的图片：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── annotations    # 存放标注数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── images         # 存放源图片</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m model_name -i coco/coco_val2017/images -o ./pre_model_name</span><br></span></code></pre></div></div>
<ul>
<li><code>ImageNet数据集</code> ：该数据集主要用于EfficientNet_lite0、EfficientNet_Lite1、EfficientNet_Lite2、EfficientNet_Lite3、EfficientNet_Lite4、MobileNet、GoogleNet、ResNet等分类模型的评测，
示例中主要用到了标注文件val.txt 和 <code>val</code> 目录中的源图片:</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── val.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── val</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m model_name -i imagenet/val -o ./pre_model_name</span><br></span></code></pre></div></div>
<ul>
<li><code>Cityscapes数据集</code> ：该数据集用于deeplabv3plus_efficientnetb0、deeplabv3plus_efficientnetm1、deeplabv3plus_efficientnetm2和fastscnn_efficientnetb0等分割模型的评测。
示例中主要用到了 <code>./gtFine/val</code> 中的标注文件和 <code>./leftImg8bit/val</code> 中的源图片。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── gtFine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── frankfurt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── lindau</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── munster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── leftImg8bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── frankfurt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── lindau</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── munster</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m unet_mobilenet -i cityscapes/leftImg8bit/val -o ./pre_unet_mobilenet</span><br></span></code></pre></div></div>
<p>示例中精度计算脚本的运行流程是：</p>
<p>1、根据 <code>workflow_accurary.json</code> 中的 <code>image_list_file</code> 参数值，去寻找对应数据集的 <code>lst</code> 文件；</p>
<p>2、根据 <code>lst</code> 文件存储的前处理文件路径信息，去加载每一个前处理文件，然后进行推理</p>
<p>所以，生成预处理文件之后，需要生成对应的lst文件，将每一张前处理文件的路径写入到lst文件中，而这个路径与数据集在开发板端的存放位置有关。
这里我们推荐其存放位置与 <code>script</code> 文件夹同级目录，如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK X3 使用如下格式：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-- ptq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- xxxx.bin             # 前处理好的二进制文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- cityscapes.lst       # lst文件：记录每一个前处理文件的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- coco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- coco.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- imagenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- imagenet.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   `-- voc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |       `-- voc.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK Ultra 使用如下格式：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-- ptq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- xxxx.bin                            # 前处理好的二进制文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetb0.lst    # lst文件：记录每一个前处理文件的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetm1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetm1.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetm2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetm2.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_fastscnn_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_fastscnn_efficientnetb0.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- coco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_centernet_resnet101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_centernet_resnet101.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov3_darknet53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov3_darknet53.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov3_vargdarknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov3_vargdarknet.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov5x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov5x.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb0.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb2.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb3.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- imagenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnasnet_m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnasnet_m.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnasnet_s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnasnet_s.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnet_lite4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnet_lite4.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_googlenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_googlenet.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_mobilenetv1.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_mobilenetv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_mobilenetv2.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_resnet18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_resnet18.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_vargconvnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_vargconvnet.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- voc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_ssd_mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_ssd_mobilenetv1.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>与之对应的lst文件，参考生成方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK X3 请使用如下命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/coco/fcos -name &quot;*bin*&quot; &gt; ../../../data/coco/coco.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK Ultra 请使用如下命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/coco/pre_centernet_resnet101 -name &quot;*bin*&quot; &gt; ../../../data/coco/pre_centernet_resnet101.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>这样生成的lst文件中存储的路径为一个相对路径： <code>../../../data/</code> 或 <code>../../../data/coco/pre_centernet_resnet101/</code> ，可以与 <code>workflow_accuracy.json</code> 默认的配置路径吻合。
如果需要更改前处理数据集的存放位置，则需要确保对应的 <code>lst</code> 文件可以被 <code>workflow_accuracy.json</code> 读取到；其次需要确保程序根据 <code>lst</code> 中的路径信息，能读取到对应的前处理文件。</p>
<ul>
<li>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="数据挂载">数据挂载<a href="#数据挂载" class="hash-link" aria-label="数据挂载的直接链接" title="数据挂载的直接链接">​</a></h5>
</li>
</ul>
<p>由于数据集相对较大，不适合直接放在开发板上，可以采用nfs挂载的方式供开发板读取。</p>
<p>开发机PC端（需要root权限）：</p>
<ol>
<li>编辑 /etc/exports, 增加一行：
<code>/nfs *(insecure,rw,sync,all_squash,anonuid=1000,anongid=1000,no_subtree_check)</code>。
<code>/nfs</code> 表示本机挂载路径，可替换为用户指定目录</li>
<li>执行命令 <code>exportfs -a -r</code>，使/etc/exports 生效。</li>
</ol>
<p>开发板端：</p>
<ol>
<li>创建需要挂载的目录：<code>mkdir -p /mnt</code>。</li>
<li><code>mount -t nfs {PC端IP}:/nfs /mnt -o nolock</code>。</li>
</ol>
<p>完成将PC端的/nfs文件夹挂载至板端/mnt文件夹。按照此方式，将包含预处理数据的文件夹挂载至板端，并将/data目录软链接至板端/ptq目录下，与/script同级目录。</p>
<ul>
<li>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理">模型推理<a href="#模型推理" class="hash-link" aria-label="模型推理的直接链接" title="模型推理的直接链接">​</a></h5>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<p>挂载完数据后，请登录开发板，开发板登录方法，请阅读<a href="/rdk_doc/Quick_start/remote_login"><strong>开发板登录</strong></a> 章节内容，登录成功后，执行 <code>fcos_efficientnetb0/</code> 目录下的accuracy.sh脚本，如下所示：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  /userdata/ptq/script/detection/fcos# sh accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ../../aarch64/bin/example --config_file=workflow_accuracy.json --log_level=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 03:14:51.158655 39555 infer_method.cc:107] Predict DoProcess finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 03:14:51.187361 39556 ptq_fcos_post_process_method.cc:123] PTQFcosPostProcessMethod DoProcess finished, predict result: [{&quot;bbox&quot;:[-1.518860,71.691170,574.934631,638.294922],&quot;prob&quot;:0.750647,&quot;label&quot;:21,&quot;class_name&quot;:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0118 14:02:43.636204 24782 ptq_fcos_post_process_method.cc:123] PTQFcosPostProcessMethod DoProcess finished, predict result: [{&quot;bbox&quot;:[3.432283,164.936249,157.480042,264.276825],&quot;prob&quot;:0.544454,&quot;label&quot;:62,&quot;class_name&quot;:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre></div></div>
<p>开发板端程序会在当前目录生成 <code>eval.log</code> 文件，该文件就是预测结果文件。</p>
<ul>
<li>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="精度计算">精度计算<a href="#精度计算" class="hash-link" aria-label="精度计算的直接链接" title="精度计算的直接链接">​</a></h5>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>精度计算部分请在 <code>开发机</code> 模型转换的环境下操作</p></div></div>
<p>精度计算的脚本在 <code>python_tools</code> 目录下，其中 <code>accuracy_tools</code> 中的：
cls_eval.py是用来计算分类模型的精度；
coco_det_eval.py是用来计算使用COCO数据集评测的检测模型的精度；
parsing_eval.py是用来计算使用Cityscapes数据集评测的分割模型的精度。
voc_det_eval.py是用来计算使用VOC数据集评测的检测模型的精度。</p>
<ul>
<li>分类模型</li>
</ul>
<p>使用CIFAR-10数据集和ImageNet数据集的分类模型计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 cls_eval.py --log_file=eval.log --gt_file=val.txt</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>log_file</code>：分类模型的预测结果文件。</li>
<li><code>gt_file</code>：CIFAR-10和ImageNet数据集的标注文件。</li>
</ul></div></div>
<ul>
<li>检测模型</li>
</ul>
<p>使用COCO数据集的检测模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 coco_det_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>eval_result_path</code>：检测模型的预测结果文件。</li>
<li><code>annotation_path</code>：COCO数据集的标注文件。</li>
</ul></div></div>
<p>使用VOC数据集的检测模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 voc_det_eval.py --eval_result_path=eval.log --annotation_path=../Annotations --val_txt_path=../val.txt</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>eval_result_path</code>：检测模型的预测结果文件。</li>
<li><code>annotation_path</code>：VOC数据集的标注文件。</li>
<li><code>val_txt_path</code>：VOC数据集中ImageSets/Main文件夹下的val.txt文件。</li>
</ul></div></div>
<ul>
<li>分割模型</li>
</ul>
<p>使用Cityscapes数据集的分割模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  :linenos:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 parsing_eval.py --width=output_width --height=output_height --log_file=eval.log --gt_path=cityscapes/gtFine/val</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>width</code>: 分割模型的输出宽度</li>
<li><code>height</code>: 分割模型的输出高度</li>
<li><code>log_file</code>：分割模型的预测结果文件。</li>
<li><code>gt_path</code>：Cityscapes数据集的标注文件。</li>
</ul></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="模型集成">模型集成<a href="#模型集成" class="hash-link" aria-label="模型集成的直接链接" title="模型集成的直接链接">​</a></h5>
<p>模型后处理集成主要有2个步骤，以centernet_resnet50模型集成为例：</p>
<ol>
<li>增加后处理文件 <code>ptq_centernet_post_process_method.cc</code>，以及头文件 <code>ptq_centernet_post_process_method.h</code>。</li>
<li>增加模型运行脚本及配置文件。</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="后处理文件添加">后处理文件添加<a href="#后处理文件添加" class="hash-link" aria-label="后处理文件添加的直接链接" title="后处理文件添加的直接链接">​</a></h5>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板举例，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体为准！</p></div></div>
<p>后处理代码文件可直接复用src/method目录下任意后处理文件，主要修改 <code>InitFromJsonString</code> 函数，以及 <code>PostProcess</code> 函数即可。</p>
<p><code>InitFromJsonString</code> 函数主要是读取workflow.json中的后处理相关的参数配置，用户可自定义设置相应的输入参数。
<code>PostProcess</code> 函数主要完成后处理的逻辑。</p>
<p>后处理.cc文件放置于 <code>ai_benchmark/code/src/method/</code> 路径下，
.h头文件放置于 <code>ai_benchmark/code/include/method/</code> 路径下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  |--ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |--code                                                 # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |--include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |--method                                         # 在此文件夹中添加头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--ptq_centernet_post_process_method.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--ptq_yolo5_post_process_method.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |--src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |--method                                         # 在此文件夹中添加后处理.cc文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--ptq_centernet_post_process_method.cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--ptq_yolo5_post_process_method.cc</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="增加模型运行脚本及配置文件">增加模型运行脚本及配置文件<a href="#增加模型运行脚本及配置文件" class="hash-link" aria-label="增加模型运行脚本及配置文件的直接链接" title="增加模型运行脚本及配置文件的直接链接">​</a></h5>
<p>脚本目录结构如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  |--ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |--xj3/ptq/script                                      # 示例脚本文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |--detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |--centernet_resnet50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--accuracy.sh                                # 精度测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--fps.sh                                     # 性能测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--latency.sh                                 # 单帧延时示例脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--workflow_accuracy.json                     # 精度配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--workflow_fps.json                          # 性能配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--workflow_latency.json                      # 单帧延时配置文件</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="辅助工具和常用操作-1">辅助工具和常用操作<a href="#辅助工具和常用操作-1" class="hash-link" aria-label="辅助工具和常用操作的直接链接" title="辅助工具和常用操作的直接链接">​</a></h5>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="日志系统使用说明">日志系统使用说明<a href="#日志系统使用说明" class="hash-link" aria-label="日志系统使用说明的直接链接" title="日志系统使用说明的直接链接">​</a></h5>
<p>日志系统主要包括 <code>示例日志</code> 和 <code>模型推理API DNN日志</code> 两部分。
其中示例日志是指交付包示例代码中的应用日志；DNN日志是指lib dnn库中的日志。
用户根据不同的需求可以获取不同的日志。</p>
<ul>
<li>示例日志</li>
</ul>
<ol>
<li>日志等级。示例日志主要采用glog中的vlog，主要分为四个自定义等级：</li>
</ol>
<ul>
<li><code>0</code> (SYSTEM)，该等级主要用来输出报错信息；</li>
<li><code>1</code> (REPORT)，该等级在示例代码中主要用来输出性能数据；</li>
<li><code>2</code> (DETAIL)，该等级在示例代码中主要用来输出系统当前状态信息；</li>
<li><code>3</code> (DEBUG)，该等级在示例代码中主要用来输出调试信息。
日志等级设置规则：假设设置了级别为 <code>P</code>，如果发生了一个级别 <code>Q</code> 比 <code>P</code> 低，
则可以启动，否则屏蔽掉；默认DEBUG&gt;DETAIL&gt;REPORT&gt;SYSTEM。</li>
</ul>
<ol start="2">
<li>日志等级设置。通过 <code>log_level</code> 参数来设置日志等级，在运行示例的时候，指定 <code>log_level</code> 参数来设置等级，
比如指定 <code>log_level=0</code>，即输出SYSTEM日志；如果指定 <code>log_level=3</code>，
则输出DEBUG、DETAIL、REPORT和SYSTEM日志。</li>
</ol>
<ul>
<li>模型推理API DNN日志</li>
</ul>
<p>关于模型推理 DNN API日志的配置，请阅读<a href="/rdk_doc/clang_development/cdev_dnn_api/model_debug#configuration_information">《模型推理DNN API使用说明》</a>文档中的 <code>配置信息</code> 一节内容</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="算子耗时说明">算子耗时说明<a href="#算子耗时说明" class="hash-link" aria-label="算子耗时说明的直接链接" title="算子耗时说明的直接链接">​</a></h5>
<p>对模型算子(OP)性能的统计是通过设置 <code>HB_DNN_PROFILER_LOG_PATH</code> 环境变量实现的，本节介绍模型的推理性能分析，有助于开发者了解模型的真实推理性能情况。
对该变量的类型和取值说明如下：</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p><code>export HB_DNN_PROFILER_LOG_PATH=${path}</code>：表示OP节点dump的输出路径，程序正常运行完退出后，产生profiler.log文件。</p></div></div>
<ul>
<li>示例说明</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板举例，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体为准！</p></div></div>
<p>以下代码块以mobilenetv1模型为例，开启单个线程同时RunModel，设置 <code>export HB_DNN_PROFILER_LOG_PATH=./</code>，则统计输出的信息如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;perf_result&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;FPS&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">677.6192525182025</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;average_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.506142616271973</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;running_condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;core_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;frame_count&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;model_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mobilenetv1_224x224_nv12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;run_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">295.151</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;thread_num&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;chip_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;BPU_inference_time_cost&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.09122</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.54</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.439</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;CPU_inference_time_cost&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.18836999999999998</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.4630000000000001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.127</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;model_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;BPU_MOBILENET_subgraph_0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.09122</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.54</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.439</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Dequantize_fc7_1_HzDequantize&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.07884999999999999</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.158</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.068</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;MOBILENET_subgraph_0_output_layout_convert&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.018765</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.08</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Preprocess&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0065</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.058</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.003</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Softmax_prob&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.084255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.167</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.046</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;task_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;TaskPendingTime&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.029375</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.059</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.009</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;TaskRunningTime&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.40324</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.801</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.008</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>以上输出了 <code>model_latency</code> 和 <code>task_latency</code>。其中model_latency中输出了模型每个OP运行所需要的耗时情况，task_latency中输出了模型运行中各个task模块的耗时情况。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>程序只有正常退出才会输出profiler.log文件。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="dump工具">dump工具<a href="#dump工具" class="hash-link" aria-label="dump工具的直接链接" title="dump工具的直接链接">​</a></h5>
<p>本节主要介绍dump工具的开启方法，一般不需要关注，只有在模型精度异常情况时开启使用。
​通过设置 <code>export HB_DNN_DUMP_PATH=${path}</code> 这个环境变量，可以dump出模型推理过程中每个节点的输入和输出, 根据dump的输出结果，可以排查模型推理在开发机模拟器和开发板是否存在一致性问题：即相同模型，相同输入，开发板和开发机模拟器的输出结果是否完全相同。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型上板分析工具说明">模型上板分析工具说明<a href="#模型上板分析工具说明" class="hash-link" aria-label="模型上板分析工具说明的直接链接" title="模型上板分析工具说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="概述-1">概述<a href="#概述-1" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h4>
<p>本章节介绍D-Robotics 算法工具链中模型上板推理的快速验证工具，方便开发者可以快速获取到 <code>***.bin</code> 模型的信息、模型推理的性能、模型debug等内容。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hrt_model_exec-工具使用说明">hrt_model_exec 工具使用说明<a href="#hrt_model_exec-工具使用说明" class="hash-link" aria-label="hrt_model_exec 工具使用说明的直接链接" title="hrt_model_exec 工具使用说明的直接链接">​</a></h4>
<p><code>hrt_model_exec</code> 工具，可以快速在开发板上评测模型的推理性能、获取模型信息等。</p>
<p>目前工具提供了三类功能，如下表所示：</p>
<table><thead><tr><th><strong>编号</strong></th><th><strong>子命令</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>1</td><td><code>model_info</code></td><td>获取模型信息，如：模型的输入输出信息等。</td></tr><tr><td>2</td><td><code>infer</code></td><td>执行模型推理，获取模型推理结果。</td></tr><tr><td>3</td><td><code>perf</code></td><td>执行模型性能分析，获取性能分析结果。</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>工具也可以通过 <code>-v</code> 或者 <code>--version</code> 命令，查看工具的 <code>dnn</code> 预测库版本号。</p><p>例如： hrt_model_exec -v 或 hrt_model_exec --version</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数描述">输入参数描述<a href="#输入参数描述" class="hash-link" aria-label="输入参数描述的直接链接" title="输入参数描述的直接链接">​</a></h5>
<p>在开发板上运行 <code>hrt_model_exec</code> 、 <code>hrt_model_exec -h</code> 或 <code>hrt_model_exec --help</code> 获取工具的使用参数详情。
如下图中所示：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/hrt_model_exec_help.png" alt="hrt_model_exec_help" class="img_ev3q"></p>
<table><thead><tr><th><strong>编号</strong></th><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>1</td><td><code>model_file</code></td><td>string</td><td>模型文件路径，多个路径可通过逗号分隔。</td></tr><tr><td>2</td><td><code>model_name</code></td><td>string</td><td>指定模型中某个模型的名称。</td></tr><tr><td>3</td><td><code>core_id</code></td><td>int</td><td>指定运行核。</td></tr><tr><td>4</td><td><code>input_file</code></td><td>string</td><td>模型输入信息，多个可通过逗号分隔。</td></tr><tr><td>5</td><td><code>roi_infer</code></td><td>bool</td><td>使能resizer模型推理。</td></tr><tr><td>6</td><td><code>roi</code></td><td>string</td><td>指定推理resizer模型 时所需的roi区域。</td></tr><tr><td>7</td><td><code>frame_count</code></td><td>int</td><td>执行模型运行帧数。</td></tr><tr><td>8</td><td><code>dump_intermediate</code></td><td>string</td><td>dump模型每一层输入和输出。</td></tr><tr><td>9</td><td><code>enable_dump</code></td><td>bool</td><td>使能dump模型输入和输出。</td></tr><tr><td>10</td><td><code>dump_precision</code></td><td>int</td><td>控制txt格式输出float型数据的小数点位数。</td></tr><tr><td>11</td><td><code>hybrid_dequantize_process</code></td><td>bool</td><td>控制txt格式输出float类型数据。</td></tr><tr><td>12</td><td><code>dump_format</code></td><td>string</td><td>dump模型输入和输出的格式。</td></tr><tr><td>13</td><td><code>dump_txt_axis</code></td><td>int</td><td>控制txt格式输入输出的换行规则。</td></tr><tr><td>14</td><td><code>enable_cls_post_process</code></td><td>bool</td><td>使能分类后处理。</td></tr><tr><td>15</td><td><code>perf_time</code></td><td>int</td><td>执行模型运行时间。</td></tr><tr><td>16</td><td><code>thread_num</code></td><td>int</td><td>指定程序运行线程数。</td></tr><tr><td>17</td><td><code>profile_path</code></td><td>string</td><td>模型性能/调度性能统计数据的保存路径。</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明">使用说明<a href="#使用说明" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h5>
<p>本节介绍 <code>hrt_model_exec</code> 工具的三个子功能的具体使用方法</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="model_info"><code>model_info</code><a href="#model_info" class="hash-link" aria-label="model_info的直接链接" title="model_info的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于获取模型信息，模型支持范围：QAT模型，PTQ模型。
该参数与 <code>model_file</code> 一起使用，用于获取模型的详细信息；
模型的 信息包括：模型输入输出信息 <code>hbDNNTensorProperties</code> 和模型的分段信息 <code>stage</code> ；模型的分段信息是：一张图片可以分多个阶段进行推理，stage信息为[x1, y1, x2, y2]，分别为图片推理的左上角和右下角坐标，目前D-Robotics RDK Ultra的bayes架构支持这类分段模型的推理，RDK X3上模型均为1个stage。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>不指定 <code>model_name</code> ，则会输出模型中所有模型信息，指定 <code>model_name</code> ，则只输出对应模型的信息。</p></div></div>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型（输出所有模型信息）</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin,xxx.bin</span><br></span></code></pre></div></div>
<ol start="3">
<li>多模型--pack模型（输出指定模型信息）</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin --model_name=xx</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/model_info.png" alt="model_info" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明"><code>输入参数补充说明</code><a href="#输入参数补充说明" class="hash-link" aria-label="输入参数补充说明的直接链接" title="输入参数补充说明的直接链接">​</a></h5>
<ul>
<li>重复输入</li>
</ul>
<p>若重复指定参数输入，则会发生参数覆盖的情况，例如：获取模型信息时重复指定了两个模型文件，则会取后面指定的参数输入 <code>yyy.bin</code>：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin --model_file=yyy.bin</span><br></span></code></pre></div></div>
<p>若重复指定输入时，未加命令行参--model_file，则会取命令行参数后面的值，未加参数的不识别，
例如：下例会忽略 <code>yyy.bin</code>，参数值为 <code>xxx.bin</code>：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin yyy.bin</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="infer"><code>infer</code><a href="#infer" class="hash-link" aria-label="infer的直接链接" title="infer的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于输入自定义图片后，模型推理一帧，并给出模型推理结果。
该参数需要与 <code>input_file</code> 一起使用，指定输入图片路径，工具根据模型信息resize图片，整理模型输入信息。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小 技巧</div><div class="admonitionContent_BuS1"><p>程序单线程运行单帧数据，输出模型运行的时间。</p></div></div>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=xxx.jpg</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin,xxx.bin --model_name=xx --input_file=xxx.jpg</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/infer.png" alt="infer" class="img_ev3q"></p>
<ul>
<li>
<p>可选参数</p>
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>core_id</code></td><td>指定模型推理的核id，0：任意核，1：core0，2：core1；默认为 <code>0</code>。</td></tr><tr><td><code>roi_infer</code></td><td>使能resizer模型推理；若模型输入包含resizer源，设置为 <code>true</code>，默认为 <code>false</code>。</td></tr><tr><td><code>roi</code></td><td><code>roi_infer</code> 为 <code>true</code> 时生效，设置推理resizer模型时所需的 <code>roi</code> 区 域以分号间隔。</td></tr><tr><td><code>frame_count</code></td><td>设置 <code>infer</code> 运行帧数，单帧重复推理，可与 <code>enable_dump</code> 并用，验证输出一致性，默认为 <code>1</code>。</td></tr><tr><td><code>dump_intermediate</code></td><td>dump模型每一层输入数据和输出数据，默认值 <code>0</code>，不dump数据。 <code>1</code>：输出文件类型为 <code>bin</code>；<code>2</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为aligned数据； <code>3</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为valid数据。</td></tr><tr><td><code>enable_dump</code></td><td>dump模型输出数据，默认为 <code>false</code>。</td></tr><tr><td><code>dump_precision</code></td><td>控制txt格式输出float型数据的小数点位数，默认为 <code>9</code>。</td></tr><tr><td><code>hybrid_dequantize_process</code></td><td>控制txt格式输出float类型数据，若输出为定点数据将其进行反量化处理，目前只支持四维模型。</td></tr><tr><td><code>dump_format</code></td><td>dump模型输出文件的类型，可选参数为 <code>bin</code> 或 <code>txt</code>，默认为 <code>bin</code>。</td></tr><tr><td><code>dump_txt_axis</code></td><td>dump模型txt格式输出的换行规则；若输出维度为n，则参数范围为[0, n], 默认为 <code>4</code>。</td></tr><tr><td><code>enable_cls_post_process</code></td><td>使能分类后处理，目前只支持ptq分类模型，默认 <code>false</code>。</td></tr></tbody></table>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="多输入模型说明"><code>多输入模型说明</code><a href="#多输入模型说明" class="hash-link" aria-label="多输入模型说明的直接链接" title="多输入模型说明的直接链接">​</a></h5>
<p>工具 <code>infer</code> 推理功能支持多输入模型的推理，支持图片输入、二进制文件输入以及文本文件输入，输入数据用  逗号隔开。
模型的输入信息可以通过 <code>model_info</code> 进行查看。</p>
<ul>
<li>示例说明</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=xxx.jpg,input.txt</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明-1"><code>输入参数补充说明</code><a href="#输入参数补充说明-1" class="hash-link" aria-label="输入参数补充说明-1的直接链接" title="输入参数补充说明-1的直接链接">​</a></h5>
<ul>
<li><code>input_file</code></li>
</ul>
<p>图片类型的输入，其文件名后缀必须为 <code>bin</code> / <code>JPG</code> / <code>JPEG</code> / <code>jpg</code> / <code>jpeg</code> 中的一种，feature输入后缀名必须为 <code>bin</code> / <code>txt</code> 中的一种。
每个输入之间需要用英文字符的逗号隔开 <code>,</code>，例如： <code>xxx.jpg,input.txt</code>。</p>
<ul>
<li><code>enable_cls_post_process</code></li>
</ul>
<p>使能分类后处理。子命令为 <code>infer</code> 时配合使用，目前只支持在PTQ分类模型的后处理时使用，变量为 <code>true</code> 时打印分类结果。
参见下图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/enable_cls_post_process.png" alt="enable_cls_post_process" class="img_ev3q"></p>
<ul>
<li><code>roi_infer</code></li>
</ul>
<p>若模型包含resizer输入源， <code>infer</code> 和 <code>perf</code> 功能都需要设置 <code>roi_infer</code> 为true，并且配置与 输入源一一对应的 <code>input_file</code> 和 <code>roi</code> 参数。
如：模型有三个输入，输入源顺序分别为[<code>ddr</code>, <code>resizer</code>, <code>resizer</code>]，则推理两组输入数据的命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx0.bin,xx1.jpg,xx2.jpg,xx3.bin,xx4.jpg,xx5.jpg&quot;  --roi=&quot;2,4,123,125;6,8,111,113;27,46,143,195;16,28,131,183&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // perf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin --input_file=&quot;xx0.bin,xx1.jpg,xx2.jpg,xx3.bin,xx4.jpg,xx5.jpg&quot;   --roi=&quot;2,4,123,125;6,8,111,113;27,46,143,195;16,28,131,183&quot;</span><br></span></code></pre></div></div>
<p>每个 <code>roi</code> 输入之间需要用英文字符的分号隔开。</p>
<ul>
<li><code>dump_intermediate</code></li>
</ul>
<p>dump模型每一层节点的输入数据和输出数据。 <code>dump_intermediate=0</code> 时，默认dump功能关闭；
<code>dump_intermediate=1</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 方式保存，其中 <code>BPU</code> 节点输出为 <code>aligned</code> 数据；
<code>dump_intermediate=2</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 和 <code>txt</code> 两种方式保存，其中 <code>BPU</code> 节点输出为 <code>aligned</code> 数据；
<code>dump_intermediate=3</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 和 <code>txt</code> 两种方式保存，其中 <code>BPU</code> 节点输出为 <code>valid</code> 数据。
如： 模型有两个输入，输入源顺序分别为[<code>pyramid</code>， <code>ddr</code>]，将模型每一层节点的输入和输出保存为 <code>bin</code> 文件，其中 <code>BPU</code> 节点输出按 <code>aligned</code> 类型保存，则推理命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx0.jpg,xx1.bin&quot;  --dump_intermediate=1</span><br></span></code></pre></div></div>
<p><code>dump_intermediate</code> 参数支持 <code>infer</code> 和 <code>perf</code> 两种模式。</p>
<ul>
<li><code>hybrid_dequantize_process</code></li>
</ul>
<p>控制txt格式输出float类型数据。 <code>hybrid_dequantize_process</code> 参数在 <code>enable_dump=true</code> 时生效。
当 <code>enable_dump=true</code> 时，若设置 <code>hybrid_dequantize_process=true</code> ，反量化整型输出数据，将所有输出按float类型保存为 <code>txt</code> 文件，其中模型输出为 <code>valid</code> 数据，支持配置 <code>dump_txt_axis</code> 和 <code>dump_precision</code>；
若设置 <code>hybrid_dequantize_process=false</code> ，直接保存模型输出的 <code>aligned</code> 数据，不做任何处理。
如： 模型有3个输出，输出Tensor数据类型顺序分别为[float，int32，int16]， 输出txt格式float类型的 <code>valid</code> 数据， 则推理命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // 输出float类型数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx.bin&quot;  --enable_dump=true --hybrid_dequantize_process=true</span><br></span></code></pre></div></div>
<p><code>hybrid_dequantize_process</code> 参数目前只支持四维模型。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="perf"><code>perf</code><a href="#perf" class="hash-link" aria-label="perf的直接链接" title="perf的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于测试模型的推理性能。
使用此工具命令，用户无需输入数据，程序会根据模型信息自动构造模型的输入tensor，tensor数据为随机数。
程序默认单线程运行200帧数据，当指定perf_time参数时，frame_count参数失效，程序会执行指定时间后退出。
程序运行完成后，会输出模型运行的程序线程数、帧数、模型推理总时间，模型推理平均latency，帧率信息等。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>程序每200帧打印一次性能信息：latnecy的最大、最小、平均值，不足200帧程序运行结束打印一次。</p></div></div>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin,xxx.bin --model_name=xx</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/perf.png" alt="perf" class="img_ev3q"></p>
<ul>
<li>
<p>可选参数</p>
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>core_id</code></td><td>指定模型推理的核id，0：任意核，1：core0，2：core1；默认为 <code>0</code>。</td></tr><tr><td><code>input_file</code></td><td>模型输入信息，多个可通过逗号分隔。</td></tr><tr><td><code>roi_infer</code></td><td>使能resizer模型推理；若模型输入包含resizer源，设置为 <code>true</code>，默认为 <code>false</code>。</td></tr><tr><td><code>roi</code></td><td><code>roi_infer</code> 为 <code>true</code> 时生效，设置推理resizer模型时所需的 <code>roi</code> 区域以分号间隔。</td></tr><tr><td><code>frame_count</code></td><td>设置 <code>perf</code> 运行帧数，当perf_time为0时生效，默认为 <code>200</code>。</td></tr><tr><td><code>dump_intermediate</code></td><td>dump模型每一层输入数据和输出数据，默认值 <code>0</code>，不dump数据。 <code>1</code>：输出文件类型为 <code>bin</code>；</td></tr><tr><td></td><td><code>2</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为aligned数据； <code>3</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为valid数据。</td></tr><tr><td><code>perf_time</code></td><td>设置 <code>perf</code> 运行时间，单位：分钟，默认为 <code>0</code>。</td></tr><tr><td><code>thread_num</code></td><td>设置程序运行线程数，范围[1, 8], 默认为 <code>1</code>, 设置大于8时按照8个线程处理。</td></tr><tr><td><code>profile_path</code></td><td>统计工具日志产生路径，运行产生profiler.log和profiler.csv，分析op耗时和调度耗时。时。</td></tr></tbody></table>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="多线程latency数据说明"><code>多线程Latency数据说明</code><a href="#多线程latency数据说明" class="hash-link" aria-label="多线程latency数据说明的直接链接" title="多线程latency数据说明的直接链接">​</a></h5>
<p>多线程的目的是为了充分利用BPU资源，多线程共同处理 <code>frame_count</code> 帧数据或执行perf_time时间，直至数据处理完成/执行时间结束程序结束。
在多线程 <code>perf</code> 过程中可以执行以下命令，实时获取BPU资源占用率情况。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrut_somstatus -n 10000 –d 1</span><br></span></code></pre></div></div>
<p>输出内容如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  =====================1=====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  temperature--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          CPU      : 37.5 (C)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu frequency--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                min       cur     max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu0: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu1: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu2: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu3: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bpu status information----&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              min        cur             max             ratio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bpu0: 400000000 1000000000      1000000000      0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bpu1: 400000000 1000000000      1000000000      0</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>以上示例展示的为 <strong>RDK X3</strong> 开发板的输出日志， 若使用 <strong>RDK Ultra</strong> 开发板，直接使用上述命令获取即可。
在 <code>perf</code> 模式下，单线程的latency时间表示模型的实测上板性能，
而多线程的latency数据表示的是每个线程的模型单帧处理时间，其相对于单线程的时间要长，但是多线程的总体处理时间减少，其帧率是提升的。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明-2"><code>输入参数补充说明</code><a href="#输入参数补充说明-2" class="hash-link" aria-label="输入参数补充说明-2的直接链接" title="输入参数补充说明-2的直接链接">​</a></h5>
<ul>
<li><code>profile_path</code></li>
</ul>
<p>profile日志文件产生目录。
该参数通过设置环境变量 <code>export HB_DNN_PROFILER_LOG_PATH=${path}</code> 查看模型运行过程中OP以及任务调度耗时。
一般设置 <code>--profile_path=&quot;.&quot;</code> 即可，代表在当前目录下生成日志文件，日志文件为profiler.log。</p>
<ul>
<li><code>thread_num</code></li>
</ul>
<p>线程数(并行度)，数值表示最多有多少个任务在并行处理。
测试延时时，数值需要设置为1，没有资源抢占发生，延时测试更准确。
测试吞吐时，建议设置&gt;2 (BPU核心个数)，调整线程数使BPU利用率尽量高，吞吐测试更准确。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // 双核FPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file xxx.bin --thread_num 8 --core_id 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file xxx.bin --thread_num 1 --core_id 1</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hrt_bin_dump-工具使用说明">hrt_bin_dump 工具使用说明<a href="#hrt_bin_dump-工具使用说明" class="hash-link" aria-label="hrt_bin_dump 工具使用说明的直接链接" title="hrt_bin_dump 工具使用说明的直接链接">​</a></h4>
<p><code>hrt_bin_dump</code> 是 PTQ debug模型的layer dump工具，工具的输出文件为二进制文件。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数描述-1">输入参数描述<a href="#输入参数描述-1" class="hash-link" aria-label="输入参数描述的直接链接" title="输入参数描述的直接链接">​</a></h5>
<table><thead><tr><th>编号</th><th>参数</th><th>类型</th><th>描述</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td><code>model_file</code></td><td>string</td><td>模型文件路径。</td><td>必须为debug model。即模型的编译参数 <code>layer_out_dump</code> 需要设置为 <code>True</code>，指定模型转换过程中输出各层的中间结果。</td></tr><tr><td>2</td><td><code>input_file</code></td><td>string</td><td>输入文件路径。</td><td>模型的输入文件，支持 <code>hbDNNDataType</code> 所有类型的输入； IMG类型文件需为二进制文件（后缀必须为.bin），二进制文件的大小应与模型的输入信息相匹配，如：YUV444文件大小为 :math:<code>height * width * 3</code>； TENSOR类型文件需为二进制文件或文本文件（后缀必须为.bin/.txt），二进制文件的大小应与模型的输入信息相匹配，文本文件的读入数据个数必须大于等于模型要求的输入数据个数，多余的数据会被丢弃；每个输入之间通过逗号分隔，如：模型有两个输入，则： <code>--input_file=kite.bin,input.txt</code>。</td></tr><tr><td>3</td><td><code>conv_mapping_file</code></td><td>string</td><td>模型卷积层配置文件。</td><td>模型layer配置文件，配置文件中标明了模型各层信息，在模型编译过程中生成。文件名称一般为： <code>model_name_quantized_model_conv_output_map.json</code>。</td></tr><tr><td>4</td><td><code>conv_dump_path</code></td><td>string</td><td>工具输出路径。</td><td>工具的输出路径，该路径应为合法路径。</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-1">使用说明<a href="#使用说明-1" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h5>
<p>工具提供dump卷积层输出功能，输出文件为二进制文件。
直接运行 <code>hrt_bin_dump</code> 获取工具使用详情。
参见下图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/hrt_bin_dump_help.png" alt="hrt_bin_dump_help" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>工具也可以通过 <code>-v</code> 或者 <code>--version</code> 命令，查看工具的 <code>dnn</code> 预测库版本号。</p><p>例如： hrt_bin_dump -v 或 hrt_bin_dump --version</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明">示例说明<a href="#示例说明" class="hash-link" aria-label="示例说明的直接链接" title="示例说明的直接链接">​</a></h5>
<p>以mobilenetv1的debug模型为例，创建outputs文件夹，执行以下命令：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ./hrt_bin_dump --model_file=./mobilenetv1_hybrid_horizonrt.bin --conv_mapping_file=./mobilenetv1_quantized_model_conv_output_map.json --conv_dump_path=./outputs --input_file=./zebra_cls.bin</span><br></span></code></pre></div></div>
<p>运行日志参见以下截图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/run_log.png" alt="run_log" class="img_ev3q"></p>
<p>在路径 <strong>outputs/</strong> 文件夹下可以查看输出，参见以下截图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/output.png" alt="output" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rdk-x5">RDK X5<a href="#rdk-x5" class="hash-link" aria-label="RDK X5的直接链接" title="RDK X5的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理dnn-api使用示例说明-1"><span id="dnn_runtime_sample"></span>模型推理DNN API使用示例说明<a href="#模型推理dnn-api使用示例说明-1" class="hash-link" aria-label="模型推理dnn-api使用示例说明-1的直接链接" title="模型推理dnn-api使用示例说明-1的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="概述-2">概述<a href="#概述-2" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h4>
<p>本章节介绍模型上板运行 horizon_runtime_sample 示例包的具体用法，开发者可以体验并基于这些示例进行应用开发，降低开发门槛。</p>
<p>示例包提供三个方面的示例：</p>
<ul>
<li>模型推理 dnn API使用示例。</li>
<li>自定义算子（custom OP）等特殊功能示例。</li>
<li>非NV12输入模型的杂项示例。</li>
</ul>
<p>详细内容请阅读下文。</p>
<p><strong>小技巧：</strong></p>
<p>horizon_runtime_sample 示例包获取请参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config#deliverables_instructions">《交付物说明》</a>。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码包结构介绍-1">示例代码包结构介绍<a href="#示例代码包结构介绍-1" class="hash-link" aria-label="示例代码包结构介绍的直接链接" title="示例代  码包结构介绍的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +---horizon_runtime_sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-- code                                      # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- 00_quick_start                        # 快速入门示例，用mobilenetv1读取单张图片进行推理的示例代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- CMakeLists_x86.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   `-- src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- 01_api_tutorial                       # BPU SDK DNN API使用示例代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- mem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- roi_infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   `-- tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- 02_advanced_samples                   # 特殊功能示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- custom_identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- multi_input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- multi_model_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   `-- nv12_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- 03_misc                               # 杂项示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- lenet_gray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   `-- resnet_feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- build_x5.sh                           # 上板aarch64编译脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- build_x86.sh                          # PC端X86编译脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- CMakeLists_x86.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   `-- deps_gcc11.3                           # 编译依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |       |-- aarch64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |       `-- x86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-- README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  `-- x5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-- data                                  # 预置数据文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- cls_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- custom_identity_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- det_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- dsl_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   `-- misc_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-- model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   `-- runtime -&gt; ../../../model_zoo/runtime/horizon_runtime_sample   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |-- script                                # aarch64示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   |-- 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   `-- README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      `-- script_x86                            # x86示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          |-- 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          `-- README.md</span><br></span></code></pre></div></div>
<ul>
<li><strong>code</strong>：该目录内是示例的源码。</li>
<li><strong>code/00_quick_start</strong>：快速入门示例，基于 <strong>dnn API</strong>，用mobilenetv1进行单张图片模型推理和结果解析。</li>
<li><strong>code/01_api_tutorial</strong>：dnn API使用教学代码，包括 <strong>mem</strong>， <strong>model</strong> ， <strong>roi_infer</strong> 和 <strong>tensor</strong> 四部分。</li>
<li><strong>code/02_advanced_samples</strong>：特殊功能示例，包括 <strong>custom_identity</strong>， <strong>multi_input</strong>， <strong>multi_model_batch</strong> 和 <strong>nv12_batch</strong> 功能。</li>
<li><strong>ode/03_misc</strong>：非NV12输入模型的杂项示例。</li>
<li><strong>code/build_x5.sh</strong>：程序一键编译脚本。</li>
<li><strong>code/build_x86.sh</strong>：x86仿真环境一键编译脚本。</li>
<li><strong>code/deps_gcc11.3</strong>：示例代码所需要的三方依赖, 用户在开发自己代码程序的时候可以根据实际情况替换或者裁剪。</li>
<li><strong>x5</strong>：示例运行脚本，预置了数据和相关模型</li>
</ul>
<p><strong>注意：</strong></p>
<p>私有模型上板运行，请参考 <code>00_quick_start/src/run_mobileNetV1_224x224.cc</code> 示例代码流程进行代码重写，编译成功后可以在开发板上测试验证！</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="环境构建-2">环境构建<a href="#环境构建-2" class="hash-link" aria-label="环境构建的直接链接" title="环境构建的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="开发板准备-2">开发板准备<a href="#开发板准备-2" class="hash-link" aria-label="开发板准备的直接链接" title="开发板准备的直接链接">​</a></h5>
<ol>
<li>
<p>拿到开发板后，请将开发版镜像更新到最新版本，升级方法请参考<a href="/rdk_doc/Quick_start/install_os/rdk_x5"><strong>系统更新</strong></a> 章节内容。</p>
</li>
<li>
<p>确保本地开发机和开发板可以远程连接。</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="编译-1">编译<a href="#编译-1" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h5>
<p>编译需要当前环境安装好交叉编译工具： <code>arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu</code>。 请使用X5算法工具链提供的开发机Docker镜像，直接进行编译使用。开发机Docker环境的获取及使用方法，请阅读<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config"><strong>环境安装</strong></a> 章节内容；
根据自身使用的开发板情况，请使用horizon_runtime_sample/code目录下的 <code>build_x5.sh</code> 脚本，即可一键编译开发板环境下的可执行程序，可执行程序和对应依赖会自动复制到 <code>x5/script</code> 目录下的 <code>aarch64</code> 目录下。</p>
<p><strong>备注：</strong>
工程通过获取环境变量 <code>LINARO_GCC_ROOT</code> 来指定交叉编译工具的路径，用户使用之前可以检查本地的环境变量是否为目标交叉编译工具。
如果需要指定交叉编译工具路径，可以设置环境变量 <code>LINARO_GCC_ROOT</code> , 或者直接修改脚本 <code>build_x5.sh</code>，指定变量 <code>CC</code> 和 <code>CXX</code> 。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  export CC=/opt/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export CXX=/opt/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-g++</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例使用-1">示例使用<a href="#示例使用-1" class="hash-link" aria-label="示例使用的直接链接" title="示例使用的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="basic_samples-示例-1">basic_samples 示例<a href="#basic_samples-示例-1" class="hash-link" aria-label="basic_samples 示例的直接链接" title="basic_samples 示例的直接链接">​</a></h5>
<p>模型推理​示例脚本主要在 x5/script 和 x5/script_x86 目录下，编译程序后目录结构如下:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># X5 使用脚本信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── cls_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── cat_cls.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── zebra_cls.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── custom_identity_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── input0.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── input1.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── det_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── kite.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── dsl_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── zebra_bgr.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── misc_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── 7.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── np_0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── runtime -&gt; ../../../model_zoo/runtime/horizon_runtime_sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── script                        # 编译产生可执行程序及依 赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── run_mobilenetV1.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── roi_infer.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── sys_mem.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── tensor.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   │   └── custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── run_multi_input.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── run_nv12_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── run_resnet50_feature.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── aarch64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       │   ├── model_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       │   ├── roi_infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       │   ├── run_custom_op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       │   ├── run_lenet_gray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       │   ├── run_mobileNetV1_224x224</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       │   ├── run_multi_model_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       │   ├── run_resnet_feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │       │   ├── sys_mem_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       │   └── tensor_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │           ├── libdnn.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │           ├── libhbrt_bayes_aarch64.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │           └── libopencv_world.so.3.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── script_x86</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_mobilenetV1.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>model文件夹下包含模型的路径，其中 <code>runtime</code> 文件夹为软链接，链接路径为 <code>../../../model_zoo/runtime/horizon_runtime_sample</code> ，可直接找到交付包中的模型路径</li>
<li>板端运行环境需要将模型放至 <code>model</code> 文件夹下</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="quick_start-1">quick_start<a href="#quick_start-1" class="hash-link" aria-label="quick_start的直接链接" title="quick_start的直接链接">​</a></h5>
<p>00_quick_start 目录下的是模型推理的快速开始示例：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  00_quick_start/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_mobilenetV1.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>run_mobilenetV1.sh</code> ：该脚本实现使用mobilenetv1模型读取单张图片进行推理的示例功能。使用的时候，进入 00_quick_start 目录, 然后直接执行 sh run_mobilenetV1.sh 即可，如下代码块所示：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  root@x5dvb:/userdata/app/horizon/basic_samples/x5/script/00_quick_start# sh run_mobilenetV1.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ../aarch64/bin/run_mobileNetV1_224x224 --model_file=../../model/runtime/mobilenetv1/mobilenetv1_224x224_nv12.bin --image_file=../../data/cls_images/zebra_cls.jpg --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0000 00:00:00.000000 10765 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [BPU_PLAT]BPU Platform Version(1.3.3)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [HBRT] set log level as 0. version = 3.15.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [A][DNN][packed_model.cpp:225][Model](2023-04-11,17:51:17.206.804) [HorizonRT] The model builder version = 1.15.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.244180 10765 run_mobileNetV1_224x224.cc:135] DNN runtime version: 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.244376 10765 run_mobileNetV1_224x224.cc:252] input[0] name is data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.244508 10765 run_mobileNetV1_224x224.cc:268] output[0] name is prob</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.260176 10765 run_mobileNetV1_224x224.cc:159] read image to tensor as nv12 success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.262075 10765 run_mobileNetV1_224x224.cc:194] TOP 0 result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.262118 10765 run_mobileNetV1_224x224.cc:194] TOP 1 result id: 292</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.262148 10765 run_mobileNetV1_224x224.cc:194] TOP 2 result id: 282</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.262177 10765 run_mobileNetV1_224x224.cc:194] TOP 3 result id: 83</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:51:17.262205 10765 run_mobileNetV1_224x224.cc:194] TOP 4 result id: 290</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="api_tutorial-1">api_tutorial<a href="#api_tutorial-1" class="hash-link" aria-label="api_tutorial的直接链接" title="api_tutorial的直接链接">​</a></h5>
<p>01_api_tutorial 目录下的示例，用于介绍如何使用嵌入式API。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── roi_infer.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── sys_mem.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── tensor.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>model.sh</code> ：该脚本主要实现读取模型信息的功能。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh model.sh</code> 即可，如下所示：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  root@x5dvb-hynix8G:/userdata/horizon/x5/script/01_api_tutorial# sh model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ../aarch64/bin/model_example --model_file_list=../../model/runtime/mobilenetv1/mobilenetv1_224x224_nv12.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0000 00:00:00.000000 10810 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [BPU_PLAT]BPU Platform Version(1.3.3)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [HBRT] set log level as 0. version = 3.15.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  [A][DNN][packed_model.cpp:225][Model](2023-04-11,17:53:28.970.396) [HorizonRT] The model builder version = 1.15.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:53:29.007853 10810 model_example.cc:104] model count:1, model[0]: mobilenetv1_224x224_nv12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:53:29.007939 10810 model_example.cc:112] hbDNNGetModelHandle [mobilenetv1_224x224_nv12] success!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0411 17:53:29.008011 10810 model_example.cc:186] [mobilenetv1_224x224_nv12] Model Info:  input num: 1, input[0] validShape: ( 1, 3, 224, 224 ), alignedShape: ( 1, 3, 224, 224 ), tensorType: 1, output num: 1, output[0] validShape: ( 1, 1000, 1, 1 ), alignedShape: ( 1, 1000, 1, 1 ), tensorType: 13</span><br></span></code></pre></div></div>
<ul>
<li>
<p><code>roi_infer.sh</code> ： 该脚本主要引导如何使用 <code>hbDNNRoiInfer</code> 这个API，示例代码实现的功能是将一张图片resize到模型输入大小，转为nv12数据，并给定roi框进行模型推理（infer）。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh roi_infer.sh</code> 即可。</p>
</li>
<li>
<p><code>sys_mem.sh</code> ：该脚本主要引导如何使用 <code>hbSysAllocMem</code>、 <code>hbSysFlushMem</code> 和 <code>hbSysFreeMem</code> 这几个API。使用的时候，直接进入 01_api_tutorial 目录，执行 <code>sh sys_mem.sh</code> 即可。</p>
</li>
<li>
<p><code>tensor.sh</code> ：该脚本主要引导如何准备模型输入和输出的tensor。
使用的时候，直接进入 01_api_tutorial 目录，执行 <code>sh tensor.sh</code> 即可，如下所示：</p>
</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  root@x5dvb-hynix8G:/userdata/horizon/x5/script/01_api_tutorial# sh tensor.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *****************************test_prepare_free_fn*************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:0, Tensor layout: 2, shape:1x1x721x1836, aligned shape:1x1x721x1840</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:1, Tensor layout: 2, shape:1x3x773x329, aligned shape:1x3x773x336</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:2, Tensor layout: 2, shape:1x3x108x1297, aligned shape:1x3x108x1312</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:5, Tensor layout: 2, shape:1x3x858x477, aligned shape:1x3x858x477</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:5, Tensor layout: 0, shape:1x920x102x3, aligned shape:1x920x102x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:4, Tensor layout: 2, shape:1x3x723x1486, aligned shape:1x3x723x1486</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:4, Tensor layout: 0, shape:1x372x366x3, aligned shape:1x372x366x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:3, Tensor layout: 2, shape:1x3x886x291, aligned shape:1x3x886x291</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:3, Tensor layout: 0, shape:1x613x507x3, aligned shape:1x613x507x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *****************************test_prepare_free_fn************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *****************************test_info_fn********************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:14, shape:1x1x1x3x2, stride:24x24x24x8x4, ndim: 5, data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [[[[[0, 1], [2, 3], [4, 5]]]]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:9, shape:3x3x1x2x1, stride:6x2x2x1x1, ndim: 5, data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [[[[[0], [1]]], [[[2], [3]]], [[[4], [5]]]], [[[[6], [7]]], [[[8], [9]]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      [[[10], [11]]]], [[[[12], [13]]], [[[14], [15]]], [[[16], [17]]]]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *****************************test_info_fn********************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ********************test_dequantize_fn***********************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:8, shape:1x1x2x4, ndim: 4, quantiType: 2, quantizeAxis: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantizeValue: (0.1,), data: [[[[0, 1, 2, 3], [4, 5, 6, 7]]]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dequantize data: [[[[0, 0.1, 0.2, 0.3], [0.4, 0.5, 0.6, 0.7]]]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Tensor data type:8, shape:2x4x1x1, ndim: 4, quantiType: 2, quantizeAxis: 3,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantizeValue: (0.1,),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data: [[[[0]], [[1]], [[2]], [[3]]], [[[4]], [[5]], [[6]], [[7]]]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dequantize data: [[[[0]], [[0.1]], [[0.2]], [[0.3]]], [[[0.4]], [[0.5]], [[0.6]], [[0.7]]]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ********************test_dequantize_fn***********************************************************</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="advanced_samples-1">advanced_samples<a href="#advanced_samples-1" class="hash-link" aria-label="advanced_samples的直接链接" title="advanced_samples的直接链接">​</a></h5>
<p>02_advanced_samples 目录下的示例，用于介绍自定义算子特殊功能的使用。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │    └── custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── run_multi_input.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_nv12_batch.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>custom_arm_op_custom_identity.sh</code> ：该脚本主要实现自定义算子模型推理功能，
使用的时候，进入 02_advanced_samples 目录, 然后直接执行 <code>sh custom_arm_op_custom_identity.sh</code> 即可，如下所示：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    root@x5dvb-hynix8G:/userdata/horizon/x5/script/02_advanced_samples# sh custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../../aarch64/bin/run_custom_op --model_file=../../../model/runtime/custom_op/custom_op_featuremap.bin --input_file=../../../data/custom_identity_data/input0.bin,../../../data/custom_identity_data/input1.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 10841 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:55:59.928918 10841 main.cpp:212] hbDNNRegisterLayerCreator success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:55:59.929064 10841 main.cpp:217] hbDNNRegisterLayerCreator success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.3.3)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.15.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [A][DNN][packed_model.cpp:225][Model](2023-04-11,17:56:00.667.991) [HorizonRT] The model builder version = 1.15.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:56:00.676071 10841 main.cpp:232] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:56:00.676204 10841 main.cpp:239] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:56:00.676276 10841 main.cpp:245] hbDNNGetInputCount success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file length: 602112</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file length: 602112</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:56:00.687402 10841 main.cpp:268] hbDNNGetOutputCount success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:56:00.687788 10841 main.cpp:297] hbDNNInfer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:56:00.695663 10841 main.cpp:302] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:56:03.145243 10841 main.cpp:306] write output tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>模型的第一个输出数据保存至 output0.txt 文件。</p>
<ul>
<li><code>run_multi_input.sh</code> ：该脚本主要实现多个小模型批量推理功能，
使用的时候，进入 02_advanced_samples 目录, 然后直接执行 <code>sh run_multi_input.sh</code> 即可，如下所示：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    root@x5dvb:/userdata/horizon/x5/script/02_advanced_samples# sh run_multi_input.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_multi_input --model_file=../../model/runtime/mobilenetv2/mobilenetv2_multi_224x224_gray.bin --image_file=../../data/cls_images/zebra_cls.jpg --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 10893 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.3.3)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.15.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [A][DNN][packed_model.cpp:225][Model](2023-04-11,17:57:03.277.375) [HorizonRT] The model builder version = 1.15.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:03.327527 10893 multi_input.cc:148] read image to tensor as bgr success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:03.329546 10893 multi_input.cc:183] TOP 0 result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:03.329598 10893 multi_input.cc:183] TOP 1 result id: 292</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:03.329628 10893 multi_input.cc:183] TOP 2 result id: 352</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:03.329656 10893 multi_input.cc:183] TOP 3 result id: 351</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:03.329684 10893 multi_input.cc:183] TOP 4 result id: 282</span><br></span></code></pre></div></div>
<ul>
<li><code>run_multi_model_batch.sh</code>：该脚本主要实现多个小模型批量推理功能， 使用的时候，进入 02_advanced_samples 目录, 然后直接执行 <code>sh run_multi_model_batch.sh</code> 即可，如下代码块所示：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    root@x5dvb-hynix8G:/userdata/horizon/x5/script/02_advanced_samples# sh run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_multi_model_batch --model_file=../../model/runtime/googlenet/googlenet_224x224_nv12.bin,../../model/runtime/mobilenetv2/mobilenetv2_224x224_nv12.bin --input_file=../../data/cls_images/zebra_cls.jpg,../../data/cls_images/zebra_cls.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 10916 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.3.3)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.15.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [A][DNN][packed_model.cpp:225][Model](2023-04-11,17:57:43.547.52) [HorizonRT] The model builder version = 1.15.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [A][DNN][packed_model.cpp:225][Model](2023-04-11,17:57:51.811.477) [HorizonRT] The model builder version = 1.15.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.844280 10916 main.cpp:117] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.844388 10916 main.cpp:125] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.844424 10916 main.cpp:139] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.875140 10916 main.cpp:153] read image to nv12 success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.875686 10916 main.cpp:170] prepare input tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.875875 10916 main.cpp:182] prepare output tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.876082 10916 main.cpp:216] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.878844 10916 main.cpp:221] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.878948 10916 main.cpp:226] googlenet class result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.879084 10916 main.cpp:230] mobilenetv2 class result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 17:57:51.879177 10916 main.cpp:234] release task success</span><br></span></code></pre></div></div>
<ul>
<li><code>run_nv12_batch.sh</code>：该脚本主要实现batch模型推理功能，Infer1是分开设置输入张量每个batch的地址，Infer2是只设置一个地址，包含所有的batch， 使用的时候，进入 <code>02_advanced_samples</code> 目录, 然后直接执行 <code>sh run_nv12_batch.sh</code> 即可，如下代码块所示：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    root@x5dvb:/userdata/horizon/x5/script/02_advanced_samples# sh run_nv12_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_nv12_batch --model_file=../../model/runtime/googlenet/googlenet_4x224x224_nv12.bin --image_file=../../data/cls_images/zebra_cls.jpg,../../data/cls_images/cat_cls.jpg,../../data/cls_images/zebra_cls.jpg,../../data/cls_images/cat_cls.jpg --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 21511 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.3.3)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.15.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.429180 21511 nv12_batch.cc:151] Infer1 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.488143 21511 nv12_batch.cc:166] read image to tensor as nv12 success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491156 21511 nv12_batch.cc:201] Batch[0]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491211 21511 nv12_batch.cc:203] TOP 0 result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491240 21511 nv12_batch.cc:203] TOP 1 result id: 83</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491266 21511 nv12_batch.cc:203] TOP 2 result id: 41</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491298 21511 nv12_batch.cc:203] TOP 3 result id: 912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491324 21511 nv12_batch.cc:203] TOP 4 result id: 292</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491348 21511 nv12_batch.cc:201] Batch[1]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491374 21511 nv12_batch.cc:203] TOP 0 result id: 282</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491398 21511 nv12_batch.cc:203] TOP 1 result id: 281</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491422 21511 nv12_batch.cc:203] TOP 2 result id: 285</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491447 21511 nv12_batch.cc:203] TOP 3 result id: 287</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491472 21511 nv12_batch.cc:203] TOP 4 result id: 283</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491497 21511 nv12_batch.cc:201] Batch[2]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491514 21511 nv12_batch.cc:203] TOP 0 result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491539 21511 nv12_batch.cc:203] TOP 1 result id: 83</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491564 21511 nv12_batch.cc:203] TOP 2 result id: 41</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491587 21511 nv12_batch.cc:203] TOP 3 result id: 912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491612 21511 nv12_batch.cc:203] TOP 4 result id: 292</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491637 21511 nv12_batch.cc:201] Batch[3]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491662 21511 nv12_batch.cc:203] TOP 0 result id: 282</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491685 21511 nv12_batch.cc:203] TOP 1 result id: 281</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491710 21511 nv12_batch.cc:203] TOP 2 result id: 285</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491734 21511 nv12_batch.cc:203] TOP 3 result id: 287</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.491760 21511 nv12_batch.cc:203] TOP 4 result id: 283</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.492235 21511 nv12_batch.cc:223] Infer1 end</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.492276 21511 nv12_batch.cc:228] Infer2 start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.549713 21511 nv12_batch.cc:243] read image to tensor as nv12 success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552248 21511 nv12_batch.cc:278] Batch[0]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552292 21511 nv12_batch.cc:280] TOP 0 result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552320 21511 nv12_batch.cc:280] TOP 1 result id: 83</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552345 21511 nv12_batch.cc:280] TOP 2 result id: 41</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552371 21511 nv12_batch.cc:280] TOP 3 result id: 912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552397 21511 nv12_batch.cc:280] TOP 4 result id: 292</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552421 21511 nv12_batch.cc:278] Batch[1]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552445 21511 nv12_batch.cc:280] TOP 0 result id: 282</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552469 21511 nv12_batch.cc:280] TOP 1 result id: 281</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552495 21511 nv12_batch.cc:280] TOP 2 result id: 285</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552520 21511 nv12_batch.cc:280] TOP 3 result id: 287</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552567 21511 nv12_batch.cc:280] TOP 4 result id: 283</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552592 21511 nv12_batch.cc:278] Batch[2]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552616 21511 nv12_batch.cc:280] TOP 0 result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552641 21511 nv12_batch.cc:280] TOP 1 result id: 83</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552665 21511 nv12_batch.cc:280] TOP 2 result id: 41</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552690 21511 nv12_batch.cc:280] TOP 3 result id: 912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552716 21511 nv12_batch.cc:280] TOP 4 result id: 292</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552739 21511 nv12_batch.cc:278] Batch[3]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552763 21511 nv12_batch.cc:280] TOP 0 result id: 282</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552788 21511 nv12_batch.cc:280] TOP 1 result id: 281</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552812 21511 nv12_batch.cc:280] TOP 2 result id: 285</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552837 21511 nv12_batch.cc:280] TOP 3 result id: 287</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.552861 21511 nv12_batch.cc:280] TOP 4 result id: 283</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0705 11:39:43.553154 21511 nv12_batch.cc:300] Infer2 end</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="misc-1">misc<a href="#misc-1" class="hash-link" aria-label="misc的直接链接" title="misc的直接链接">​</a></h5>
<p>03_misc 目录下的示例，用于介绍非nv12输入模型的使用。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_resnet50_feature.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>run_lenet.sh</code> ：该脚本主要实现Y数据输入的lenet模型推理功能，
使用的时候，进入 03_misc 目录, 然后直接执行 <code>sh run_lenet.sh</code> 即可，如下所示：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    root@x5dvb-hynix8G:/userdata/horizon/x5/script/03_misc# sh run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_lenet_gray --model_file=../../model/runtime/lenet_gray/lenet_28x28_gray.bin --data_file=../../data/misc_data/7.bin --image_height=28 --image_width=28 --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 10979 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.3.3)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.15.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [A][DNN][packed_model.cpp:225][Model](2023-04-11,18:02:12.605.436) [HorizonRT] The model builder version = 1.15.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.613317 10979 run_lenet_gray.cc:128] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.613404 10979 run_lenet_gray.cc:136] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.613440 10979 run_lenet_gray.cc:143] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.614181 10979 run_lenet_gray.cc:159] prepare y tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.614310 10979 run_lenet_gray.cc:172] prepare tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.614503 10979 run_lenet_gray.cc:182] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.615538 10979 run_lenet_gray.cc:187] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [W][DNN][hb_sys.cpp:108][Mem](2023-04-11,18:02:12.615.583) memory is noncachable, ignore flush operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.615624 10979 run_lenet_gray.cc:192] task post process finished</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.615667 10979 run_lenet_gray.cc:198] TOP 0 result id: 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.615698 10979 run_lenet_gray.cc:198] TOP 1 result id: 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.615727 10979 run_lenet_gray.cc:198] TOP 2 result id: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.615754 10979 run_lenet_gray.cc:198] TOP 3 result id: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:02:12.615782 10979 run_lenet_gray.cc:198] TOP 4 result id: 2</span><br></span></code></pre></div></div>
<ul>
<li><code>run_resnet50_feature.sh</code> ：该脚本主要实现feature数据输入的resnet50模型推理功能，示例代码对feature数据做了quantize和padding以满足模型的输入条件，然后输入到模型进行infer。
使用的时候，进入 03_misc 目录, 然后直接执行 <code>sh run_resnet50_feature.sh</code> 即可，如下所示：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    root@x5dvb-hynix8G:/userdata/horizon/x5/script/03_misc# sh run_resnet50_feature.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_resnet_feature --model_file=./resnet50_64x56x56_featuremap_modified.bin --data_file=../../data/misc_data/np_0 --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 11024 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.3.3)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.15.18.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [A][DNN][packed_model.cpp:225][Model](2023-04-11,18:03:30.317.594) [HorizonRT] The model builder version = 1.15.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.523054 11024 run_resnet_feature.cc:160] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.523152 11024 run_resnet_feature.cc:168] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.523188 11024 run_resnet_feature.cc:175] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.529860 11024 run_resnet_feature.cc:346] input data size: 802816; input valid size: 200704; input aligned size: 229376</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.536860 11024 run_resnet_feature.cc:357] tensor padding featuremap success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.536912 11024 run_resnet_feature.cc:190] prepare feature tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.537052 11024 run_resnet_feature.cc:200] prepare tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.537197 11024 run_resnet_feature.cc:210] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.541096 11024 run_resnet_feature.cc:215] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [W][DNN][hb_sys.cpp:108][Mem](2023-04-11,18:03:30.541.149) memory is noncachable, ignore flush operation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.541409 11024 run_resnet_feature.cc:220] task post process finished</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.541453 11024 run_resnet_feature.cc:226] TOP 0 result id: 74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.541483 11024 run_resnet_feature.cc:226] TOP 1 result id: 815</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.541512 11024 run_resnet_feature.cc:226] TOP 2 result id: 73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.541538 11024 run_resnet_feature.cc:226] TOP 3 result id: 78</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0411 18:03:30.541565 11024 run_resnet_feature.cc:226] TOP 4 result id: 72</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="辅助工具和常用操作-2">辅助工具和常用操作<a href="#辅助工具和常用操作-2" class="hash-link" aria-label="辅助工具和常用操作的直接链接" title="辅助工具和常用操作的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="日志-1">日志<a href="#日志-1" class="hash-link" aria-label="日志的直接链接" title="日志的直接链接">​</a></h5>
<p>本章节主要包括 <code>示例日志</code> 和 <code>模型推理 DNN API日志</code> 两部分。
其中示例日志是指交付包示例代码中的应用日志；模型推理 dnn API日志是指嵌入式dnn库中的日志。用户根据不同的需求可以获取不同的日志信息。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例日志-1">示例日志<a href="#示例日志-1" class="hash-link" aria-label="示例日志的直接链接" title="示例日志的直接链接">​</a></h5>
<p>示例日志主要采用glog中的vlog，basic_samples参考示例中，日志内容会全部输出。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理-dnn-api日志-1">模型推理 DNN API日志<a href="#模型推理-dnn-api日志-1" class="hash-link" aria-label="模型推理 DNN API日志的直接链接" title="模型推理 DNN API日志的直接链接">​</a></h5>
<p>关于模型推理 DNN API日志的配置，请阅读<a href="/rdk_doc/04_Algorithm_Application/02_cdev_dnn_api/cdev_dnn_api.md">《模型推理DNN API使用说明》</a> 文档中的 <code>配置信息</code> 一节内容。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="公版模型性能精度测评说明-1">公版模型性能精度测评说明<a href="#公版模型性能精度测评说明-1" class="hash-link" aria-label="公版模型性能精度测评说明的直接链接" title="公版模型性能精度测评说明的直接链接">​</a></h3>
<p>本章节介绍公版模型精度性能评测 ai_benchmark 示例包的具体用法， 示例包中预置了源码、可执行程序和评测脚本，开发者可以直接在X5开发板上体验并基于这些示例进行嵌入式应用开发，降低开发门槛。</p>
<p>示例包提供常见的分类、检测、分割、光流、追踪估计，雷达多任务，bev和深度估计模型的性能和精度评测示例，详细内容请阅读下文。</p>
<p><strong>小技巧：</strong></p>
<p>公版模型精度性能评测 ai_benchmark 示例包获取，请参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config#deliverables_instructions">《交付物说明》</a>。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="发布物说明">发布物说明<a href="#发布物说明" class="hash-link" aria-label="发布物说明的直接链接" title="发布物说明的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码包结构-1">示例代码包结构<a href="#示例代码包结构-1" class="hash-link" aria-label="示例代码包结构的直接链接" title="示例代码包结构的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ai_benchmark/code/                    # 示例源码文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── build_ptq_x5.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── build_qat_x5.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── deps_gcc11.3                      # 第三方依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── include                           # 源码头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── src                               # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_benchmark/x5                       # 示例包运行环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── ptq                               # PTQ方案模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── data                          # 模型精度评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── mini_data                     # 模型性能评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── model                         # PTQ方案nv12模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── runtime -&gt; ../../../../model_zoo/runtime/ai_benchmark/ptq   # 软链接指向工具链SDK包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── script                        # 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── aarch64                   # 编译产生可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── classification            # 分类模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── config                    # 模型推理配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── detection                 # 检测模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── segmentation              # 分割模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── env.sh                    # 基础环境脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── tools                         # 精度评测工具</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── qat                               # QAT方案模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data                          # 模型精度评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── mini_data                     # 模型性能评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── model                         # QAT方案nv12模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── runtime -&gt; ../../../../model_zoo/runtime/ai_benchmark/qat    # 软链接指向工具链SDK包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── script                        # 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── aarch64                   # 编译产生可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── bev                       # bev模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── classification            # 分类模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── config                    # 模型推理配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── detection                 # 检测模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── disparity_pred            # 深度估计模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── multitask                 # 多任务模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── opticalflow               # 光流模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── segmentation              # 分割模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── tracking                  # 追踪模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── traj_pred                 # 轨迹预测示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── env.sh                    # 基础环境脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── tools                         # 前处理及精度评测工具</span><br></span></code></pre></div></div>
<ul>
<li><strong>code</strong>：该目录内是评测程序的源码，用来进行模型性能和精度评测。</li>
<li><strong>x5</strong>：该目录内提供了已经编译好的应用程序，以及各种评测脚本，用来测试多种模型在X5 BPU上运行的性能和精度等。</li>
<li><strong>build_ptq_x5.sh</strong>：PTQ真机程序一键编译脚本。</li>
<li><strong>build_qat_x5.sh</strong>：QAT真机程序一键编译脚本。</li>
<li><strong>deps_gcc11.3</strong>：示例代码所需要的依赖，主要如下所示:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  appsdk  gflags  glog  nlohmann  opencv  rapidjson</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例模型-1">示例模型<a href="#示例模型-1" class="hash-link" aria-label="示例模型的直接链接" title="示例模型的直接链接">​</a></h5>
<p>示例包的模型发布物包括PTQ模型和QAT模型发布物：</p>
<ul>
<li>
<p>PTQ模型model_zoo请在 <code>horizon_model_convert_sample/01_common/model_zoo/runtime/ai_benchmark/ptq</code> 路径下进行获取。</p>
</li>
<li>
<p>QAT模型model_zoo请在 <code>horizon_model_convert_sample/01_common/model_zoo/runtime/ai_benchmark/qat</code> 路径下进行获取。</p>
</li>
</ul>
<p>其中包含常用的分类、检测、分割和光流预测等模型，模型命名规则为 <strong><code>{model_name}_{backbone}_{input_size}_{input_type}</code></strong>。</p>
<p><strong>小技巧：</strong> <code>horizon_model_convert_sample</code> 模型转换示例包，请在linux服务器上执行命令： <code>wget -c ftp://oeftp@sunrise.horizon.cc:10021/model_convert_sample/horizon_model_convert_sample.tar.xz --ftp-password=Oeftp~123$%</code> 获取。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="公共数据集-1">公共数据集<a href="#公共数据集-1" class="hash-link" aria-label="公共数据集的直接链接" title="公共数据集的直接链接">​</a></h5>
<p>测评示例中用到的数据集主要有VOC数据集、COCO数据集、ImageNet、Cityscapes数据集、FlyingChairs数据集、KITTI数据集、Culane数据集、Nuscenes数据集、Mot17数据集、Carfusion数据集、Argoverse 1数据集和SceneFlow数据集。</p>
<p>请在Linux环境下进行下载，获取方式如下：</p>
<table><thead><tr><th><strong>数据集</strong></th><th><strong>下载地址</strong></th><th><strong>下载结构</strong></th></tr></thead><tbody><tr><td>ImageNet</td><td><a href="https://www.image-net.org/download.php" target="_blank" rel="noopener noreferrer">https://www.image-net.org/download.php</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>COCO</td><td><a href="https://cocodataset.org/" target="_blank" rel="noopener noreferrer">https://cocodataset.org/</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>VOC</td><td><a href="http://host.robots.ox.ac.uk/pascal/VOC/" target="_blank" rel="noopener noreferrer">http://host.robots.ox.ac.uk/pascal/VOC/</a></td><td>需要下载2007和2012两个版本，下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>Cityscapes</td><td><a href="https://github.com/mcordts/cityscapesScripts" target="_blank" rel="noopener noreferrer">https://github.com/mcordts/cityscapesScripts</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>CIFAR-10</td><td><a href="http://www.cs.toronto.edu/~kriz/cifar.html" target="_blank" rel="noopener noreferrer">http://www.cs.toronto.edu/~kriz/cifar.html</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>FlyingChairs</td><td><a href="https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html" target="_blank" rel="noopener noreferrer">https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>KITTI3D</td><td><a href="https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d" target="_blank" rel="noopener noreferrer">https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>CULane</td><td><a href="https://xingangpan.github.io/projects/CULane.html" target="_blank" rel="noopener noreferrer">https://xingangpan.github.io/projects/CULane.html</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>Nuscenes</td><td><a href="https://www.nuscenes.org/nuscenes" target="_blank" rel="noopener noreferrer">https://www.nuscenes.org/nuscenes</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>Mot17</td><td><a href="https://opendatalab.com/MOT17" target="_blank" rel="noopener noreferrer">https://opendatalab.com/MOT17</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>Carfusion</td><td><a href="http://www.cs.cmu.edu/~ILIM/projects/IM/CarFusion/cvpr2018/index.html" target="_blank" rel="noopener noreferrer">http://www.cs.cmu.edu/~ILIM/projects/IM/CarFusion/cvpr2018/index.html</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr><tr><td>Argoverse 1</td><td><a href="https://www.argoverse.org/av1.html" target="_blank" rel="noopener noreferrer">https://www.argoverse.org/av1.html</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a>中的相关描述</td></tr><tr><td>SceneFlow</td><td><a href="https://lmb.informatik.uni-freiburg.de/resources/datasets/SceneFlowDatasets.en.html" target="_blank" rel="noopener noreferrer">https://lmb.informatik.uni-freiburg.de/resources/datasets/SceneFlowDatasets.en.html</a></td><td>下载结构请您参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md">数据预处理</a> 中的相关描述</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="环境构建-3">环境构建<a href="#环境构建-3" class="hash-link" aria-label="环境构建的直接链接" title="环境构建的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="开发板准备-3">开发板准备<a href="#开发板准备-3" class="hash-link" aria-label="开发板准备的直接链接" title="开发板准备的直接链接">​</a></h5>
<ol>
<li>
<p>拿到开发板后，请将开发版镜像更新到最新版本，升级方法请参考<a href="/rdk_doc/Quick_start/install_os/rdk_x5"><strong>安装系统</strong></a> 章节内容。</p>
</li>
<li>
<p>确保本地开发机和开发板可以远程连接。</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="编译环境准备-1">编译环境准备<a href="#编译环境准备-1" class="hash-link" aria-label="编译环境准备的直接链接" title="编译环境准备的直接链接">​</a></h5>
<p>编译需要当前环境安装好交叉编译工具 <code>arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-gcc</code>。请使用X5算法工具链提供的开发机Docker镜像，直接进行编译使用。开发机Docker环境的获取及使用方法，请阅读<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config"><strong>环境安装</strong></a> 章节内容；
请使用code目录下的 <code>build_ptq_x5.sh</code> 脚本，即可一键编译开发板环境下的可执行程序，可执行程序和对应依赖会自动复制到 <code>x5/ptq/script</code> 目录下的 <code>aarch64</code> 目录下。</p>
<p><strong>备注：</strong>
需要注意 <code>build_ptq_x5.sh</code> 脚本里指定的交叉编译工具链的位置是 <code>/opt</code> 目录下，用户如果安装在其他位置，可以手动修改下脚本。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  export CC=/opt/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export CXX=/opt/arm-gnu-toolchain-11.3.rel1-x86_64-aarch64-none-linux-gnu/bin/aarch64-none-linux-gnu-g++</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="测评示例使用说明-1">测评示例使用说明<a href="#测评示例使用说明-1" class="hash-link" aria-label="测评示例使用说明的直接链接" title="测评示例使用说明的直接链接">​</a></h4>
<p>评测示例脚本主要在 <code>script</code> 和 <code>tools</code> 目录下。 script是开发板上运行的评测脚本，包括常见分类，检测和分割模型。每个模型下面有三个脚本，分别表示：</p>
<ul>
<li>fps.sh：利用多线程调度实现fps统计，用户可以根据需求自由设置线程数。</li>
<li>latency.sh：实现单帧延迟统计（一个线程，单帧）。</li>
<li>accuracy.sh：用于精度评测。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── aarch64                                    # 编译产生的可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── env.sh                                     # 基础配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── data_name_list                     # image_name配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── input_init                         # 模型输入配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── preprocess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── centerpoint_preprocess_5dim.json   # 前处理配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── reference_points                       # 模型参考点信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── bev_mt_gkt_mixvargenet_multitask_nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── detection                                  # 检测模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── fcos_efficientnetb0_mscoco                    # 在此目录中还有其他模型, 仅以此模型目录为参考</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── fps.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── latency.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_accuracy.json             # 精度配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_fps.json                  # 性能配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── workflow_latency.json              # 单帧延时配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └──...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li><strong>ptq/tools</strong> 目录下主要包括 python_tools 下的精度计算脚本，用于PTQ模型的精度评测。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── accuracy_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cityscapes_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cls_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── coco_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── config.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── coco_det_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── parsing_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── voc_det_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── voc_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li><strong>qat/tools</strong> 目录下主要包括前处理脚本及精度计算脚本，用于QAT模型的精度评测。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  tools/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── eval_preprocess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │     ├── util</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │     ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │     └── voc.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── python_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │     └── accuracy_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │         ├── argoverse_util</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │         ├── nuscenes_metric_pro</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │         ├── whl_package</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │         ├── bev_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │         ├── ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │         └── yolov3_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>注意：</strong></p>
<p>评测前需要执行以下命令，将 <code>ptq</code> 或 <code>qat</code> 目录拷贝到  开发板上，然后将 <code>model_zoo/runtime</code> 拷贝到 <code>ptq/model</code> 或 <code>qat/model</code>目录下。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  scp -r ai_toolchain_package/Ai_Toolchain_Package-release-vX.X.X-OE-vX.X.X/ai_benchmark/x5/ptq root@192.168.1.10:/userdata/ptq/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scp -r model_zoo/runtime root@192.168.1.10:/userdata/ptq/model/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scp -r ai_toolchain_package/Ai_Toolchain_Package-release-vX.X.X-OE-vX.X.X/ai_benchmark/x5/qat root@192.168.1.10:/userdata/ptq/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scp -r model_zoo/runtime root@192.168.1.10:/userdata/qat/model/</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="json配置文件参数信息">json配置文件参数信息<a href="#json配置文件参数信息" class="hash-link" aria-label="json配置文件参数信息的直接链接" title="json配置文件参数信息的直接链接">​</a></h5>
<p>本小节按照输入配置项（input_config）、输出配置项（output_config）及workflow配置项的维度， 分别对workflow_fps.json、workflow_latency.json及workflow_accuracy.json中的配置项进行简单说明。</p>
<p><strong>注意：</strong> 下方给出的配置项参数信息为通用配置项信息，一些示例模型由于模型特殊性，还会有额外的配置项，具体请您参考示例模型json文件。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="输入配置项input_config">输入配置项（input_config）<a href="#输入配置项input_config" class="hash-link" aria-label="输入配置项（input_config）的直接链接" title="输入配置项（input_config）的直接链接">​</a></h6>
<table><thead><tr><th><strong>参数名称</strong></th><th><strong>参数说明</strong></th><th><strong>涉及json文件</strong></th></tr></thead><tbody><tr><td>input_type</td><td>设置输入数据格式，支持图像或者bin文件。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>height</td><td>设置输入数据高度。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>width</td><td>设置输入数据宽度。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>data_type</td><td>设置输入数据类型，支持类型可参考 hbDNNDataType 小节。 <br>对应数据类型由上到下排序，分别对应数字0,1,2...  <br> 如HB_DNN_IMG_TYPE_Y对应数字0， <br>HB_DNN_IMG_TYPE_NV12对应数字1，<br>HB_DNN_IMG_TYPE_NV12_SEPARATE对应数字2...</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>image_list_file</td><td>设置预处理数据集lst文件所在路径。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>need_pre_load</td><td>设置是否使用预加载方式对数据集读取。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>limit</td><td>设置处理中和处理完的输入数据量间差值的阈值，用于控制输入数据的处理线程。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>need_loop</td><td>设置是否循环读取数据进行评测。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>max_cache</td><td>设置预加载的数据个数。 <strong>请注意:</strong> 此参数生效时会预处理图片并读取到内存中，为保障您的程序稳定运行，请不要设置过大的值，建议您的数值设置不超过30。</td><td>fps.json、latency.json、accuracy.json</td></tr></tbody></table>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="输出配置项output_config">输出配置项（output_config）<a href="#输出配置项output_config" class="hash-link" aria-label="输出配置项（output_config）的直接链接" title="输出配置项（output_config）的直接链接">​</a></h6>
<table><thead><tr><th><strong>参数名称</strong></th><th><strong>参数说明</strong></th><th><strong>涉及json文件</strong></th></tr></thead><tbody><tr><td>output_type</td><td>设置输出数据类型。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>in_order</td><td>设置是否按顺序进行输出。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>enable_view_output</td><td>设置是否将输出结果可视化。</td><td>fps.json、latency.json</td></tr><tr><td>image_list_enable</td><td>可视化时，设置为true，则可将输出结果保存为图像类型。</td><td>fps.json、latency.json</td></tr><tr><td>view_output_dir</td><td>设置可视化结果输出文件路径。</td><td>fps.json、latency.json</td></tr><tr><td>eval_enable</td><td>设置是否对精度进行评估。</td><td>accuracy.json</td></tr><tr><td>output_file</td><td>设置模型输出结果文件。</td><td>accuracy.json</td></tr></tbody></table>
<ul>
<li><strong>workflow配置项</strong></li>
</ul>
<p><strong>模型推理配置项</strong>：</p>
<table><thead><tr><th><strong>参数名称</strong></th><th><strong>参数说明</strong></th><th><strong>涉及json文件</strong></th></tr></thead><tbody><tr><td>method_type</td><td>设置模型推理方法，此处需配置为 <code>InferMethod</code>。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>method_config</td><td>设置模型推理参数。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td></td><td>- core：设置推理core id。 <strong>请注意：</strong> x5只有一个bpu核，这里只能设置为0（core any）或者1（core 0）。</td><td></td></tr><tr><td></td><td>- model_file：指定模型文件。</td><td></td></tr></tbody></table>
<ul>
<li><strong>后处理配置项</strong>：</li>
</ul>
<table><thead><tr><th><strong>参数名称</strong></th><th><strong>参数说明</strong></th><th><strong>涉及json文件</strong></th></tr></thead><tbody><tr><td>thread_count</td><td>设置后处理线程数，取值范围为 <code>1-8</code>。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>method_type</td><td>设置后处理方法。</td><td>fps.json、latency.json、accuracy.json</td></tr><tr><td>method_config</td><td>设置后处理参数。</td><td>fps.json、latency.json、accuracy.json</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="性能评测-1">性能评测<a href="#性能评测-1" class="hash-link" aria-label="性能评测的直接链接" title="性能评测的直接链接">​</a></h5>
<p>性能评测分为latency和fps两方面。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="测评脚本使用说明">测评脚本使用说明<a href="#测评脚本使用说明" class="hash-link" aria-label="测评脚本使用说明的直接链接" title="测评脚本使用说明的直接链接">​</a></h6>
<p>进入到需要评测的模型目录下，执行 <code>sh latency.sh</code> 即可测试出单帧延迟。如下图所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 02:35:07.041095 39124 output_plugin.cc:80]  Infer latency:  [avg:  13.124ms,  max:  13.946ms,  min:  13.048ms], Post process latency: [avg:  3.584ms,  max:  3.650ms,  min:  3.498ms].</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li><code>infer</code> 表示模型推理耗时。</li>
<li><code>Post process</code> 表示后处理耗时。</li>
</ul>
<p>进入到需要评测的模型目录下执行 <code>sh fps.sh</code> 即可测试出帧率。如下图所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 02:35:00.044417 39094 output_plugin.cc:109]  Throughput: 1129.39fps      # 模型帧率</span><br></span></code></pre></div></div>
<p><strong>备注：</strong> 该功能采用多线程并发方式，旨在让模型可以在BPU上达到极致的性能。由于多线程并发及数据采样的原因，在程序启动阶段帧率值会较低，之后帧率会上升并逐渐趋于稳定，帧率的浮动范围控制在0.5%之内。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="命令行参数说明">命令行参数说明<a href="#命令行参数说明" class="hash-link" aria-label="命令行参数说明的直接链接" title="命令行参数说明的直接链接">​</a></h6>
<p><code>fps.sh</code> 脚本内容如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source ../../base_config.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export SHOW_FPS_LOG=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export STAT_CYCLE=100                             # 设置环境变量，FPS 统计周期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${app} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --config_file=workflow_fps.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log_level=1</span><br></span></code></pre></div></div>
<p><code>latency.sh</code> 脚本内容如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source ../../base_config.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export SHOW_LATENCY_LOG=1                            # 设置环境变量，打印 LATENCY 级别log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export STAT_CYCLE=50                                  # 设置环境变量，LATENCY 统计周期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${app} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --config_file=workflow_latency.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log_level=1</span><br></span></code></pre></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="结果可视化">结果可视化<a href="#结果可视化" class="hash-link" aria-label="结果可视化的直接链接" title="结果可视化的直接链接">​</a></h6>
<p>如果您希望可以看到模型单次推理出来效果，可以修改workflow_latency.json，重新运行latency.sh脚本，即可在output_dir目录下生成展示效果。</p>
<p><strong>注意：</strong> 生成展示效果时，由于dump效果的原因，脚本运行会变慢。 <strong>仅支持运行latency.sh脚本dump</strong>。</p>
<p><strong>可视化操作步骤</strong> 参考如下：</p>
<ol>
<li>修改workflow_latency.json配置文件</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     &quot;output_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;output_type&quot;: &quot;image&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;enable_view_output&quot;: true,                         # 开启可视化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;view_output_dir&quot;: &quot;./output_dir&quot;,                  # 可视化结果输出路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;image_list_enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       &quot;in_order&quot;: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span><br></span></code></pre></div></div>
<ol start="2">
<li>执行latency.sh脚本</li>
</ol>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     sh latency.sh</span><br></span></code></pre></div></div>
<p><strong>注意：</strong> bev模型可视化需要指定场景信息和homography矩阵路径，homography矩阵用于相机视角和鸟瞰图的转换，不同场景有各自的homography矩阵。</p>
<p>bev模型的workflow_latency.json配置文件建议修改成如下形式：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;output_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;output_type&quot;: &quot;image&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;enable_view_output&quot;: true,                            # 开启可视化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;view_output_dir&quot;: &quot;./output_dir&quot;,                     # 可视化结果输出路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;bev_ego2img_info&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;../../config/visible/bev/scenes.json&quot;,              # 输入的场景信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;../../config/visible/bev/boston.bin&quot;,               # boston场景的homography矩阵</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;../../config/visible/bev/singapore.bin&quot;             # singapore场景的homography矩阵</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;image_list_enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;in_order&quot;: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>不同类别的模型可以实现的 <strong>可视化效果</strong> 也不相同，参考下表：</p>
<ul>
<li><strong>分类</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/classification.JPEG" alt="classification" class="img_ev3q"></p>
<ul>
<li><strong>2d检测</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/detection2d.jpg" alt="detection2d" class="img_ev3q"></p>
<ul>
<li><strong>3d检测</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/detection3d.png" alt="detection3d" class="img_ev3q"></p>
<ul>
<li><strong>分割</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/seg.png" alt="seg" class="img_ev3q"></p>
<ul>
<li><strong>关键点</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/keypoint.jpg" alt="keypoint" class="img_ev3q"></p>
<ul>
<li><strong>车道线</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/land_pred.png" alt="land_pred" class="img_ev3q"></p>
<ul>
<li><strong>光流</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/opticalflow.png" alt="opticalflow" class="img_ev3q"></p>
<ul>
<li><strong>雷达</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/lidar.png" alt="lidar" class="img_ev3q"></p>
<ul>
<li><strong>雷达多任务</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/lidar_det.png" alt="lidar_det" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/lidar_seg.png" alt="lidar_seg" class="img_ev3q"></p>
<ul>
<li><strong>bev</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/bev_cam_front_left.png" alt="bev_cam_front_left" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/bev_cam_front.png" alt="bev_cam_front" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/bev_cam_front_right.png" alt="bev_cam_front_right" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/bev_cam_back_left.png" alt="bev_cam_back_left" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/bev_cam_back.png" alt="bev_cam_back" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/bev_cam_back_right.png" alt="bev_cam_back_right" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/bev_ego.png" alt="bev_ego" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/bev_seg.png" alt="bev_seg" class="img_ev3q"></p>
<ul>
<li><strong>轨迹预测</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/1_6191.png" alt="1_6191" class="img_ev3q"></p>
<ul>
<li><strong>深度估计</strong></li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/stereonet_disparity.png" alt="stereonet_disparity" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/stereonet_depth.png" alt="stereonet_depth" class="img_ev3q"></p>
<p><strong>注意：</strong> 轨迹预测可视化时如果需要可视化minidata以外的图片，需要额外配置道路信息、轨迹信息文件到 <strong>minidata/argoverse1/visualization</strong> 中，生成配置文件可使用 <strong>densetnt_process.py</strong> 预处理脚本，将 <strong>--is-gen-visual-config</strong> 参数设为 <strong>true</strong>。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="精度评测-1">精度评测<a href="#精度评测-1" class="hash-link" aria-label="精度评测的直接链接" title="精度评测的直接链接">​</a></h5>
<p>模型精度评测分为四步：</p>
<ol>
<li>数据预处理。</li>
<li>生成lst文件。</li>
<li>数据挂载。</li>
<li>模型推理。</li>
<li>精度计算。</li>
</ol>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="数据预处理-1"><span id="data_preprocess"></span>数据预处理<a href="#数据预处理-1" class="hash-link" aria-label="数据预处理-1的直接链接" title="数据预处理-1的直接链接">​</a></h6>
<p>对于PTQ模型：数据预处理需要在x86开发机环境下运行 <code>hb_eval_preprocess</code> 工具，对数据集进行预处理。
所谓预处理是指图片数据在送入模型之前的特定处理操作，例如：图片resize、crop和padding等。
该工具集成于开发机模型转换编译的环境中，原始数据集经过工具预处理之后，会生成模型对应的前处理二进制文件.bin文件集.
直接运行 <code>hb_eval_preprocess --help</code> 可查看工具使用规则。</p>
<p><strong>小技巧：</strong></p>
<ol>
<li>关于 <code>hb_eval_preprocess</code> 工具命令行参数，可键入 <code>hb_eval_preprocess -h</code>， 或查看 PTQ量化原理及步骤说明的
<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md"><strong>hb_eval_preprocess工具</strong></a> 一节内容。</li>
</ol>
<p><strong>PTQ模型数据预处理</strong>：</p>
<p>下面将详细介绍示例包中每一个模型对应的数据集，以及对应数据集的预处理操作：</p>
<p>PTQ模型使用到的数据集包括以下几种：</p>
<ul>
<li><code>VOC数据集</code> ：该数据集主要用于ssd_mobilenetv1模型的评测，
其目录结构如下，示例中主要用到 <code>Main</code> 文件下的val.txt文件， <code>JPEGImages</code> 中的源图片和 <code>Annotations</code> 中的标注数据：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── VOCdevkit                  # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── VOC2012                # 不同年份的数据集，这里只下载了2012的，还有2007等其它年份的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── Annotations        # 存放xml文件，与JPEGImages中的图片一一对应，解释图片的内容等等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── ImageSets          # 该目录下存放的都是txt文件，txt文件中每一行包含一个图片的名称，末尾会加上±1表示正负样本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Layout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   └── Segmentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── JPEGImages         # 存放源图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── SegmentationClass  # 存放的是图片，语义分割相关</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── SegmentationObject # 存放的是图片，实例分割相关</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m ssd_mobilenetv1 -i VOCdevkit/VOC2012/JPEGImages -v VOCdevkit/VOC2012/ImageSets/Main/val.txt -o ./pre_ssd_mobilenetv1</span><br></span></code></pre></div></div>
<ul>
<li><code>COCO数据集</code> ：该数据集主要用于centernet_resnet101、detr_efficientnetb3_mscoco、detr_resnet50_mscoco、yolov2_darknet19、yolov3_darknet53、yolov3_vargdarknet、yolov5x、preq_qat_fcos_efficientnetb0、preq_qat_fcos_efficientnetb2和preq_qat_fcos_efficientnetb3等检测模型的评测，
其目录如下，示例中主要用到 <code>annotations</code> 文件夹下的instances_val2017.json标注文件和 <code>images</code> 中的图片：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── annotations    # 存放标注数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── images         # 存放源图片</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m model_name -i coco/coco_val2017/images -o ./pre_model_name</span><br></span></code></pre></div></div>
<ul>
<li><code>ImageNet数据集</code> ：该数据集主要用于efficientnasnet_m、efficientnasnet_s、efficientnet_lite0、efficientnet_lite1、efficientnet_lite2、efficientnet_lite3、efficientnet_lite4、googlenet、mobilenetv1、mobilenetv2、resnet18和vargconvnet等分类模型的评测，
示例中主要用到了标注文件val.txt 和 <code>val</code> 目录中的源图片:</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── val.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── val</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m model_name -i imagenet/val -o ./pre_model_name</span><br></span></code></pre></div></div>
<ul>
<li><code>Cityscapes数据集</code> ：该数据集用于deeplabv3plus_efficientnetb0、deeplabv3plus_efficientnetm1、deeplabv3plus_efficientnetm2和fastscnn_efficientnetb0等分割模型的  评测。
示例中主要用到了 <code>./gtFine/val</code> 中的标注文件和 <code>./leftImg8bit/val</code> 中的源图片。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── gtFine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── frankfurt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── lindau</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── munster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── leftImg8bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── frankfurt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── lindau</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── munster</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m model_name -i cityscapes/leftImg8bit/val -o ./pre_model_name</span><br></span></code></pre></div></div>
<p><strong>QAT模型数据预处理</strong>：</p>
<p>QAT模型数据预处理需要在x86仿真环境下执行 <code>ai_benchmark/x5/qat/tools/eval_preprocess</code> 中对应模型的前处理脚本。
下面将详细介绍示例包中模型对应的数据集，以及其预处理操作。</p>
<p><strong>请注意：</strong> 使用前请修改脚本中的数据集路径及保存路径使脚本正常运行。</p>
<ul>
<li><code>ImageNet数据集</code> ：该数据集主要用于QAT分类模型mixvargenet_imagenet、mobilenetv1_imagenet、mobilenetv2_imagenet、resnet50_imagenet、horizon_swin_transformer_imagenet和vargnetv2_imagenet的评测.</li>
</ul>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python3 imagenet.py --image-path=./standard_imagenet/val/ --save-path=./pre_model_name</span><br></span></code></pre></div></div>
<ul>
<li><code>VOC数据集</code> ：该数据集主要用于检测模型yolo_mobilenetv1_voc的评测。</li>
</ul>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python3 voc.py --image-path=./VOCdevkit/VOC2012/JPEGImages/ --save-path=./pre_yolov3_mobilenetv1</span><br></span></code></pre></div></div>
<ul>
<li><code>COCO数据集</code> ：该数据集主要用于QAT检测模型fcos_efficientnetb0_mscoco和retinanet_vargnetv2_fpn_mscoco的评测。</li>
</ul>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # fcos_efficientnetb0_mscoco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 fcos_process.py --image-path=./mscoco/images/val2017/ --label-path=./mscoco/images/annotations/instances_val2017.json --save-path=./pre_fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # retinanet_vargnetv2_fpn_mscoco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 retinanet_process.py --image-path=./mscoco/images/val2017/  --label-path=./mscoco/images/annotations/instances_val2017.json --save-path=./pre_retinanet</span><br></span></code></pre></div></div>
<ul>
<li>
<p><code>Cityscapes</code> ：该数据集主要用于QAT分割模型unet_mobilenetv1_cityscapes的评测，不需要前处理直接使用验证集数据即可。</p>
</li>
<li>
<p><code>FlyingChairs</code> ：该数据集主要用于QAT光流模型pwcnet_pwcnetneck_flyingchairs的评测。本数据集您可以于 <code>FlyingChairs数据集官网下载地址 &lt;https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html&gt;</code>_ 下载，示例中主要用到了 <strong>FlyingChairs_release/data</strong> 中的数据和 <strong>./FlyingChairs_train_val.txt</strong> 标注文件。</p>
</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── FlyingChairs_release</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── 00001_img1.ppm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── 00001_img2.ppm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── 00001_flow.ppm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── FlyingChairs_train_val.txt</span><br></span></code></pre></div></div>
<p><strong>注意：</strong></p>
<ul>
<li><code>{id}_img1.ppm和{id}_img2.ppm</code>是一个图像对，图像宽度大小是512，高度大小是38，id是从00001至22872的序号，每一图像对的标签是<code>{id}_flow.flo</code>。</li>
<li><strong>FlyingChairs_train_val</strong> 文件是用于划分训练集和验证集，标签值为2表示验证集。</li>
</ul>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python3 pwcnet_process.py --input-path=./flyingchairs/FlyingChairs_release/data/ --val-file=./flyingchairs/FlyingChairs_train_val.txt --output-path=./pre_pwcnet_opticalflow</span><br></span></code></pre></div></div>
<ul>
<li><code>Kitti3D</code> ：该数据集主要用于QAT检测模型pointpillars_kitti_car的评测。本数据集您可以于 <code>Kitti3D数据集官网下载地址 &lt;https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d&gt;</code>_ 下载。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── kitti3d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data_object_calib.zip        # camera calibration matrices of object data set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data_object_image_2.zip      # left color images of object data set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data_object_label_2.zip      # taining labels of object data set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── data_object_veloodyne.zip    # velodyne point cloud</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── kitti3d_origin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── ImageSets</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── test.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── train.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── trainval.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── val.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── testing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── calib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── image_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── velodyne</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── training</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── calib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── image_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── label_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── velodyne</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python3 pointpillars_process.py --data-path=./kitti3d_origin  --save-path=./pre_kitti3d  --height=1 --width=150000</span><br></span></code></pre></div></div>
<ul>
<li><code>Culane</code> ：该数据集主要用于QAT检测模型ganet_mixvargenet_culane的评测。本数据集您可以于 <code>Culane数据集官网下载地址 &lt;https://xingangpan.github.io/projects/CULane.html&gt;</code>_ 下载。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── culane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── annotations_new.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_23_30frame.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_37_30frame.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_100_30frame.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_161_90frame.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_182_30frame.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_193_90frame.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── laneseg_label_w16.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── list.tar.gz</span><br></span></code></pre></div></div>
<p>其中 <strong>annotations_new.tar.gz</strong> 需要最后解压，以对原始的注释文件进行更正，建议您将下载的数据集解压成如下结构：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── culane                     # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_23_30frame      # 数据集和注释</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 05151640_0419.MP4  # 数据集的一段，包含每一帧图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├──00000.jpg       # 源图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├──00000.lines.txt # 注释文件，其中每个行给出车道标记关键点的x，y坐标</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_37_30frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_100_30frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_161_90frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_182_30frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── driver_193_90frame</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── laneseg_label_w16      # 车道分段标签</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── list                   # 训练，验证，测试列表</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python3 ganet_process.py --image-path=./culane  --save-path=./pre_culane</span><br></span></code></pre></div></div>
<ul>
<li><code>Nuscenes</code> ：该数据集主要用于QAT检测模型fcos3d_efficientnetb0_nuscenes，centerpoint_pointpillar_nuscenes，lidar多任务模型centerpoint_mixvargnet_multitask_nuscenes和bev模型bev_gkt_mixvargenet_multitask_nuscenes，bev_lss_efficientnetb0_multitask_nuscenes，bev_ipm_efficientnetb0_multitask_nuscenes，bev_ipm_4d_efficientnetb0_multitask_nuscenes，detr3d_efficientnetb3_nuscenes的评测。本数据集您可以于 <code>Nuscenes数据集官网下载地址 &lt;https://www.nuscenes.org/nuscenes#download&gt;</code>_ 下载。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── nuScenes-map-expansion-v1.3.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── nuScenes-map-expansion-v1.2.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── nuScenes-map-expansion-v1.1.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── nuScenes-map-expansion-v1.0.zip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-mini.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-test_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-test_meta.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval01_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval02_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval03_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval04_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval05_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval06_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval07_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval08_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval09_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-trainval10_blobs.tar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── v1.0-trainval_meta.tar</span><br></span></code></pre></div></div>
<p>对于lidar多任务模型，还需从官网下载lidar分割标签lidarseg，并按照nuscenes官网教程更新v1.0-trainval，建议您将下载的数据集解压成如下结构：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── Nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── can_bus</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── lidarseg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── maps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── meta</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── maps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── v1.0-mini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       └── v1.0-trainval</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── sweeps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── v1.0-mini</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── v1.0-trainval</span><br></span></code></pre></div></div>
<p><strong>请注意：</strong></p>
<ul>
<li>fcos3d_process.py除了生成预处理图片外，还会对待使用的相机内参进行处理，生成相应的相机内参配置文件。</li>
<li>centerpoint_preprocess.py，bev_preprocess.py和lidar_preprocess.py除了生成预处理数据外，还会在预处理数据路径下生成一个 <code>val_gt_infos.pkl</code> 文件用于精度计算。</li>
<li>bev_preprocess.py需要通过 <code>--model</code> 指定模型的名称，可选项有bev_gkt_mixvargenet_multitask_nuscenes，bev_ipm_4d_efficientnetb0_multitask_nuscenes，bev_ipm_efficientnetb0_multitask_nuscenes，bev_lss_efficientnetb0_multitask_nuscenes，detr3d_efficientnetb3_nuscenes。</li>
</ul>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # fcos3d_efficientnetb0_nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 fcos3d_process.py --src-data-dir=./Nuscenes --file-path=../../script/config/model/data_name_list/nuscenes_names.txt --save-path=./processed_fcos3d_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # centerpoint_pointpillar_nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 centerpoint_preprocess.py --data-path=./Nuscenes --save-path=./nuscenes_lidar_val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # bev model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 bev_preprocess.py --model=model_name --data-path=./Nuscenes --meta-path=./Nuscenes/meta --reference-path=../../script/config/reference_points --save-path=./nuscenes_bev_val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # centerpoint_mixvargnet_multitask_nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 lidar_preprocess.py --data-path=./Nuscenes --save-path=./nuscenes_lidar_val</span><br></span></code></pre></div></div>
<ul>
<li><code>Mot17</code> ：该数据集用于QAT追踪模型motr_efficientnetb3_mot17的评测。本数据集您可以于 <code>Mot17数据集官网下载地址 &lt;https://opendatalab.com/MOT17&gt;</code>_ 下载。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── valdata                     # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── gt_val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── MOT17-02-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── MOT17-04-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── MOT17-05-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── MOT17-09-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── MOT17-10-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── MOT17-11-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── MOT17-13-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── train</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── MOT17-04-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── MOT17-05-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── MOT17-09-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── MOT17-10-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── MOT17-11-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── MOT17-13-SDP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── mot17.val</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python3 motr_process.py --image-path=./valdata/images/train --save-path=./processed_motr</span><br></span></code></pre></div></div>
<ul>
<li><code>Carfusion</code> ：该数据集用于QAT检测模型keypoint_efficientnetb0_carfusion的评测。本数据集您可以于 <code>Carfusion数据集官网下载地址 &lt;http://www.cs.cmu.edu/~ILIM/projects/IM/CarFusion/cvpr2018/index.html&gt;</code>_ 下载。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── carfusion                     # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── train</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── test</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # 首先生成评测需要的数据（如您第一次使用本数据集，必须使用下方脚本生成）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 gen_carfusion_data.py --src-data-path=carfusion --out-dir=cropped_data --num-workers 2</span><br></span></code></pre></div></div>
<p>执行第一个脚本后的目录如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── cropped_data                     # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── simple_anno</span><br></span></code></pre></div></div>
<p>保证data-root指定的地址与cropped_data同一级，然后运行下方指令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python3 keypoints_preprocess.py --data-root=./ --label-path=cropped_data/simple_anno/keypoints_test.json --save-path=./processed_carfusion</span><br></span></code></pre></div></div>
<ul>
<li><code>Argoverse1</code> ：该数据集用于QAT检测模型densetnt_vectornet_argoverse1的评测。本数据集您可以于 <code>Argoverse1数据集官网下载地址 &lt;https://www.argoverse.org/av1.html&gt;</code>_ 下载。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── carfusion                     # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── train</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── test</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # 首先生成评测需要的数据（如您第一次使用本数据集，必须使用下方脚本生成）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 gen_carfusion_data.py --src-data-path=carfusion --out-dir=cropped_data --num-workers 2</span><br></span></code></pre></div></div>
<p>执行第一个脚本后的目录如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── arogverse-1                     # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── map_files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── val</span><br></span></code></pre></div></div>
<p>densetnt_process.py除了生成预处理输入外，还会在src-path下生成相应的评测meta文件。评测仅需使用 <code>--src-path</code> 和 <code>--dst-path</code> 两个参数即可，无需关注其他参数。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  python3 densetnt_process.py --src-path=arogverse-1 --dst-path=processed_arogverse1</span><br></span></code></pre></div></div>
<ul>
<li><code>SceneFlow</code> ：该数据集用于QAT深度估计模型stereonetplus_mixvargenet_sceneflow的评测。本数据集您可以于 <code>SceneFlow数据集官网下载地址 &lt;https://lmb.informatik.uni-freiburg.de/resources/datasets/SceneFlowDatasets.en.html&gt;</code>_ 下载。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── SceneFlow                     # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── FlyingThings3D</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── disparity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── frames_finalpass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── SceneFlow_finalpass_test.txt</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # stereonet_preprocess.py除了生成预处理数据外，还会在预处理数据路径下生成一个 ``val_gt_infos.pkl`` 文件用于精度计算。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 stereonet_preprocess.py --data-path=SceneFlow/  --data-list=SceneFlow/SceneFlow_finalpass_test.txt --save-path=sceneflow_val</span><br></span></code></pre></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="生成lst文件">生成lst文件<a href="#生成lst文件" class="hash-link" aria-label="生成lst文件的直接链接" title="生成lst文件的直接链接">​</a></h6>
<p>示例中精度计算脚本的运行流程是：</p>
<p>1、根据 <code>workflow_accurary.json</code> 中的 <code>image_list_file</code> 参数值，去寻找对应数据集的 <code>lst</code> 文件；</p>
<p>2、根据 <code>lst</code> 文件存储的前处理文件路径信息，去加载每一个前处理文件，然后进行推理</p>
<p>所以，生成预处理文件之后，需要生成对应的lst文件，将每一张前处理文件的路径写入到lst文件中，而这个路径与数据集在板端的存放位置有关。
这里我们推荐其存放位置与 <code>./data/dataset_name/pre_model_name</code> 预处理数据文件夹同级目录。</p>
<p>PTQ预处理数据集结构如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   |── ptq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |── data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |── cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |── pre_deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |── xxxx.bin                            # 前处理好的二进制文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |── ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |── pre_deeplabv3plus_efficientnetb0.lst    # lst文件：记录每一个前处理文件的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |── ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |── ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |── script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>QAT预处理数据集结构如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |── qat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |── data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |── carfusion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |── pre_keypoints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |── xxxx                   # 前处理好的数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |── ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |── pre_carfusion.lst          # lst文件：记录每一个前处理文件的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |── ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |── script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>与之对应的lst文件，参考生成方式如下：</p>
<p><strong>注意：</strong> <code>除Densetnt_vectornet_argoverse1、Bev、Motr_efficientnetb3_mot17和Stereonetplus_mixvargenet_sceneflow模型外</code>，其余模型的lst文件参考生成方式：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/coco/pre_centernet_resnet101 -name &quot;*bin*&quot; &gt; ../../../data/coco/pre_centernet_resnet101.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>注意：</strong>  <code>-name</code> 后的参数需要根据预处理后的数据集格式进行对应调整，如bin、png。</p>
<p>这样生成的lst文件中存储的路径为一个相对路径： <code>../../../data/</code> 或 <code>../../../data/coco/pre_centernet_resnet101/</code> ，可以与 <code>workflow_accuracy.json</code> 默认的配置路径吻合。
如果需要更改前处理数据集的存放位置，则需要确保对应的 <code>lst</code> 文件可以被 <code>workflow_accuracy.json</code> 读取到；其次需要确保程序根据 <code>lst</code> 中的路径信息，能读取到对应的前处理文件。</p>
<ul>
<li><code>argoverse1</code>：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  sh generate_acc_lst.sh</span><br></span></code></pre></div></div>
<p>这样生成的lst文件中存储的路径为一个相对路径： <code>../../../data/argoverse1/densetnt/</code> ，可以与 <code>workflow_accuracy.json</code> 默认的配置路径吻合。</p>
<p>对于Densetnt_vectornet_argoverse1、Bev、Motr_efficientnetb3_mot17和Stereonetplus_mixvargenet_sceneflow模型，lst文件参考生成方式：</p>
<ul>
<li><code>Densetnt</code>：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  sh generate_acc_lst.sh</span><br></span></code></pre></div></div>
<p>这样生成的lst文件中存储的路径为一个相对路径： <code>../../../data/argoverse1/densetnt/</code> ，可以与 <code>workflow_accuracy.json</code> 默认的配置路径吻合。</p>
<ul>
<li><code>Bev</code>：</li>
</ul>
<p>以bev_ipm_efficientnetb0_multitask模型为例，该模型有图像和参考点两种输入，同一帧输入的图片和参考点名称相同。为了保证输入相对应，在执行 <code>find</code> 命令时需要添加 <code>sort</code> 按名称进行排序。参考生成方式：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/nuscenes_bev/images -name &quot;*bin*&quot; | sort &gt; ../../../data/nuscenes_bev/images.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/nuscenes_bev/reference_points0 -name &quot;*bin*&quot; | sort &gt; ../../../data/nuscenes_bev/reference_points0.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>detr3d_efficientnetb3_nuscenes，除了图像和参考点还有coords，masks和position embedding输入，生成lst方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # detr3d_efficientnetb3_nuscenes：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/nuscenes_bev/coords0 -name &quot;*bin*&quot; | sort &gt; ../../../data/nuscenes_bev/coords0.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/nuscenes_bev/coords1 -name &quot;*bin*&quot; | sort &gt; ../../../data/nuscenes_bev/coords1.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/nuscenes_bev/coords2 -name &quot;*bin*&quot; | sort &gt; ../../../data/nuscenes_bev/coords2.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/nuscenes_bev/coords3 -name &quot;*bin*&quot; | sort &gt; ../../../data/nuscenes_bev/coords3.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/nuscenes_bev/masks -name &quot;*bin*&quot; | sort &gt; ../../../data/nuscenes_bev/masks.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>请注意：</strong> bev模型中，detr3d_efficientnetb3_nuscenes的 <code>reference_points</code> 用于模型后处理，需要在 <code>workflow_accuracy.json</code> 配置正确的路径，确保程序能够读到对应的参考点文件。此外，bev_ipm_4d_efficientnetb0_multitask是时序模型，该模型对输入顺序有要求。因此，我们提供了专门的脚本 <code>gen_file_list.sh</code> 用于生成lst文件，使用方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  sh gen_file_list.sh</span><br></span></code></pre></div></div>
<p>这样生成的lst文件中存储的路径为一个相对路径： <code>../../../data/nuscenes_bev/</code> ，可以与 <code>workflow_accuracy.json</code> 默认的配置路径吻合。如果需要更改前处理数据集的存放位置，则需要确保对应的 <code>lst</code> 文件可以被 <code>workflow_accuracy.json</code> 读取到。其次需要确保程序根据 <code>lst</code> 中的路径信息，能读取到对应的前处理文件。</p>
<ul>
<li><code>Motr</code>：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  sh generate_acc_lst.sh</span><br></span></code></pre></div></div>
<p>这样生成的lst文件中存储的路径为一个相对路径： <code>../../../data/mot17/motr/</code> ，可以与 <code>workflow_accuracy.json</code> 默认的配置路径吻合。如果需要更改前处理数据集的存放位置，则需要确保对应的 <code>lst</code> 文件可以被 <code>workflow_accuracy.json</code> 读取到。其次需要确保程序根据 <code>lst</code> 中的路径信息，能读取到对应的前处理文件。</p>
<ul>
<li><code>Stereonetplus</code>：</li>
</ul>
<p>以stereonetplus_mixvargenet_sceneflow模型为例，为了保证同一帧输入的左右视图相对应，在执行 <code>find</code> 命令时需要添加 <code>sort</code> 按名称进行排序，参考生成方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/sceneflow/left -name &quot;*png*&quot; | sort &gt; ../../../data/sceneflow/left.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/sceneflow/right -name &quot;*png*&quot; | sort &gt; ../../../data/sceneflow/right.lst</span><br></span></code></pre></div></div>
<p>这样生成的lst文件中存储的路径为一个相对路径： <code>../../../data/mot17/motr/</code> ，可以与 <code>workflow_accuracy.json</code> 默认的配置路径吻合。如果需要更改前处理数  据集的存放位置，则需要确保对应的 <code>lst</code> 文件可以被 <code>workflow_accuracy.json</code> 读取到。其次需要确保程序根据 <code>lst</code> 中的路径信息，能读取到对应的前处理文件。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="数据挂载-1">数据挂载<a href="#数据挂载-1" class="hash-link" aria-label="数据挂载的直接链接" title="数据挂载的直接链接">​</a></h6>
<p>由于数据集相对较大，不适合直接放在开发板上，可以采用nfs挂载的方式供开发板读取。</p>
<p>开发机PC端（需要root权限）：</p>
<ol>
<li>编辑 /etc/exports, 增加一行：
<code>/nfs *(insecure,rw,sync,all_squash,anonuid=1000,anongid=1000,no_subtree_check)</code>。
<code>/nfs</code> 表示本机挂载路径，可替换为用户指定目录</li>
<li>执行命令 <code>exportfs -a -r</code>，使/etc/exports 生效。</li>
</ol>
<p>开发板端：</p>
<ol>
<li>创建需要挂载的目录：<code>mkdir -p /mnt</code>。</li>
<li><code>mount -t nfs {PC端IP}:/nfs /mnt -o nolock</code>。</li>
</ol>
<p>完成将PC端的/nfs文件夹挂载至板端/mnt文件夹。按照此方式，将包含预处理数据的文件夹挂载至板端，并将/data目录软链接至板端/ptq目录下，与/script同级目录。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理-1">模型推理<a href="#模型推理-1" class="hash-link" aria-label="模型推理的直接链接" title="模型推理的直接链接">​</a></h6>
<p>挂载完数据后，请登录开发板，开发板登录方法，请阅读<a href="/rdk_doc/Quick_start/remote_login"><strong>开发板登录</strong></a> 章节内容，登录成功后，执行 <code>centernet_resnet101/</code> 目录下的accuracy.sh脚本，如下所示：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  /userdata/ptq/script/detection/centernet_resnet101# sh accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ../../aarch64/bin/example --config_file=workflow_accuracy.json --log_level=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 03:14:51.158655 39555 infer_method.cc:107] Predict DoProcess finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 03:14:51.187361 39556 ptq_centernet_post_process_method.cc:558] PTQCenternetPostProcessMethod DoProcess finished, predict result: [{&quot;bbox&quot;:[-1.518860,71.691170,574.934631,638.294922],&quot;prob&quot;:0.750647,&quot;label&quot;:21,&quot;class_name&quot;:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0118 14:02:43.636204 24782 ptq_centernet_post_process_method.cc:558] PTQCenternetPostProcessMethod DoProcess finished, predict result: [{&quot;bbox&quot;:[3.432283,164.936249,157.480042,264.276825],&quot;prob&quot;:0.544454,&quot;label&quot;:62,&quot;class_name&quot;:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre></div></div>
<p>开发板端程序会在当前目录生成 <code>eval.log</code> 文件，该文件就是预测结果文件。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="精度计算-1">精度计算<a href="#精度计算-1" class="hash-link" aria-label="精度计算的直接链接" title="精度计算的直接链接">​</a></h6>
<p><strong>注意：</strong></p>
<p>精度计算部分请在 <code>开发机</code> 模型转换的环境下操作</p>
<p><strong>PTQ模型精度计算</strong>：</p>
<p>PTQ模型精度计算的脚本在 <strong>ptq/tools/python_tools/accuracy_tools</strong> 目录下，其中：</p>
<ul>
<li>
<p>cls_eval.py用于计算分类模型的精度。</p>
</li>
<li>
<p>coco_det_eval.py用于计算使用COCO数据集评测的检测模型的精度。</p>
</li>
<li>
<p>parsing_eval.py用于计算使用Cityscapes数据集评测的分割模型的精度。</p>
</li>
<li>
<p>voc_det_eval.py用于计算使用VOC数据集评测的检测模型的精度。</p>
</li>
</ul>
<p>以下为您说明不同类型的PTQ模型精度计算方式：</p>
<ul>
<li><strong>分类模型</strong></li>
</ul>
<p>使用CIFAR-10数据集和ImageNet数据集的分类模型计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 cls_eval.py --log_file=eval.log --gt_file=val.txt</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>log_file</code>：分类模型的预测结果文件。</p>
</li>
<li>
<p><code>gt_file</code>：CIFAR-10和ImageNet数据集的标注文件。</p>
</li>
<li>
<p><strong>检测模型</strong></p>
</li>
</ul>
<p>使用COCO数据集的检测模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 coco_det_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li><code>eval_result_path</code>：检测模型的预测结果文件。</li>
<li><code>annotation_path</code>：COCO数据集的标注文件。</li>
</ul>
<p>使用VOC数据集的检测模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 voc_det_eval.py --eval_result_path=eval.log --annotation_path=../Annotations --val_txt_path=../val.txt</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>eval_result_path</code>：检测模型的预测结果文件。</p>
</li>
<li>
<p><code>annotation_path</code>：VOC数据集的标注文件。</p>
</li>
<li>
<p><code>val_txt_path</code>：VOC数据集中ImageSets/Main文件夹下的val.txt文件。</p>
</li>
<li>
<p><strong>分割模型</strong></p>
</li>
</ul>
<p>使用Cityscapes数据集的分割模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 parsing_eval.py --log_file=eval.log --gt_path=cityscapes/gtFine/val</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li><code>log_file</code>：分割模型的预测结果文件。</li>
<li><code>gt_path</code>：Cityscapes数据集的标注文件。</li>
</ul>
<p><strong>QAT模型精度计算</strong>：</p>
<p>QAT模型的精度计算脚本在 <strong>qat/tools/python_tools/accuracy_tools</strong> 目录下，其中：</p>
<ul>
<li>
<p>bev_eval.py用于计算bev模型的精度。</p>
</li>
<li>
<p>centerpoint_eval.py用于计算雷达3D模型centerpoint_pointpillar_nuscenes的精度。</p>
</li>
<li>
<p>cls_eval.py用于计算分类模型的精度。</p>
</li>
<li>
<p>densetnt_eval.py用于计算densetnt轨迹预测模型densetnt_vectornet_argoverse1的精度。</p>
</li>
<li>
<p>detr_eval.py用于计算detr检测模型的精度。</p>
</li>
<li>
<p>fcos3d_eval.py用于计算检测模型fcos3d_efficientnetb0_nuscenes的精度。</p>
</li>
<li>
<p>fcos_eval.py用于计算fcos检测模型的精度。</p>
</li>
<li>
<p>ganet_eval.py用于计算检测模型ganet_mixvargenet_culane的精度。</p>
</li>
<li>
<p>keypoints_eval.py用于计算检测模型keypoint_efficientnetb0_carfusion的精度。</p>
</li>
<li>
<p>lidar_multitask_eval.py用于计算lidar多任务模型centerpoint_mixvargnet_multitask_nuscenes的精度。</p>
</li>
<li>
<p>motr_eval.py用于计算motr检测模型motr_efficientnetb3_mot17的精度。</p>
</li>
<li>
<p>parsing_eval.py用于计算使用Cityscapes数据集评测的分割模型的精度。</p>
</li>
<li>
<p>pointpillars_eval.py用于计算检测模型pointpillars_kitti_car的精度。</p>
</li>
<li>
<p>pwcnet_eval.py用于计算使用FlyingChairs数据集评测的光流模型pwcnet_pwcnetneck_flyingchairs的精度。</p>
</li>
<li>
<p>retinanet_eval.py用于计算检测模型retinanet_vargnetv2_fpn_mscoco的精度。</p>
</li>
<li>
<p>yolov3_eval.py用于计算yolov3检测模型的精度。</p>
</li>
<li>
<p>stereonet_eval.py用于计算深度估计模型stereonetplus_mixvargenet_sceneflow的精度。</p>
</li>
</ul>
<p>以下为您说明不同类型的QAT模型精度计算方式：</p>
<ul>
<li><strong>Bev模型</strong></li>
</ul>
<p>使用nuscenes数据集的bev模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 bev_eval.py --det_eval_path=bev_det_eval.log --seg_eval_path=bev_seg_eval.log --gt_files_path=./nuscenes_bev_val/val_gt_infos.pkl --meta_dir=./Nuscenes/meta/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # detr3d_efficientnetb3_nuscenes为bev检测模型，不需要指定 --seg_eval_path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 bev_eval.py --det_eval_path=eval.log --gt_files_path=./nuscenes_bev_val/val_gt_infos.pkl --meta_dir=./Nuscenes/meta/</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>det_eval_path</code>：bev模型检测任务的预测结果文件。</p>
</li>
<li>
<p><code>seg_eval_path</code>：bev模型分割任务的预测结果文件。</p>
</li>
<li>
<p><code>gt_files_path</code>：对nuscenes数据集进行预处理生成的gt文件。</p>
</li>
<li>
<p><code>meta_dir</code>：nuscenes数据集的meta信息路径。</p>
</li>
<li>
<p><strong>分类模型</strong></p>
</li>
</ul>
<p>使用CIFAR-10数据集和ImageNet数据集的分类模型计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 cls_eval.py --log_file=eval.log --gt_file=val.txt</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>log_file</code>：分类模型的预测结果文件。</p>
</li>
<li>
<p><code>gt_file</code>：CIFAR-10和ImageNet数据集的标注文件。</p>
</li>
<li>
<p><strong>检测模型</strong></p>
</li>
<li>
<p>1.使用COCO数据集的检测模型精度计算方式示例如下：</p>
</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 fcos_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json --image_path=./mscoco/images/val2017/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # qat fcos模型需要增加--is_qat=True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 fcos_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json --image_path=./mscoco/images/val2017/ --is_qat=True</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li><code>eval_result_path</code>：fcos检测模型的预测结果文件。</li>
<li><code>annotation_path</code>：COCO数据集的标注文件。</li>
<li><code>image_path</code>：COCO原始数据集。</li>
<li><code>is_qat</code>：是否是qat fcos模型结果评测。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 retinanet_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json --image_path=./mscoco/images/val2017/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li><code>eval_result_path</code>：retinanet检测模型的预测结果文件。</li>
<li><code>annotation_path</code>：COCO数据集的标注文件。</li>
<li><code>image_path</code>：COCO原始数据集。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 detr_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json  --image_path=./mscoco/images/val2017/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>eval_result_path</code>：retinanet检测模型的预测结果文件。</p>
</li>
<li>
<p><code>annotation_path</code>：COCO数据集的标注文件。</p>
</li>
<li>
<p><code>image_path</code>：COCO原始数据集。</p>
</li>
<li>
<p>2.使用VOC数据集的检测模型精度计算方式示例如下：</p>
</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 yolov3_eval.py --eval_result_path=eval.log --annotation_path=../Annotations --val_txt_path=../val.txt --image_height=416  --image_width=416</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>eval_result_path</code>：检测模型的预测结果文件。</p>
</li>
<li>
<p><code>annotation_path</code>：VOC数据集的标注文件。</p>
</li>
<li>
<p><code>val_txt_path</code>：VOC数据集中ImageSets/Main文件夹下的val.txt文件。</p>
</li>
<li>
<p><code>image_height</code>: 图像的高度。</p>
</li>
<li>
<p><code>image_width</code>: 图像的宽度。</p>
</li>
<li>
<p>3.使用Kitti数据集的检测模型精度计算方式如下：</p>
</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 pointpillars_eval.py --eval_result_path=eval.log --annotation_path=./val_gt_infos.pkl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>eval_result_path</code>：检测模型的预测结果文件。</p>
</li>
<li>
<p><code>annotation_path</code>：预处理过程中生成的kitti3d数据集的标注文件val_gt_infos.pkl。</p>
</li>
<li>
<p>4.使用Culane数据集的检测模型精度计算方式如下：</p>
</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 ganet_eval.py --eval_path=eval.log --image_path=./culane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>eval_result_path</code>：检测模型的预测结果文件。</p>
</li>
<li>
<p><code>image_path</code>：culane数据集。</p>
</li>
<li>
<p>5.使用Nuscenes数据集的检测模型精度计算方式如下：</p>
</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 fcos3d_eval.py --eval_result_path=eval.log --image_path=./Nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li><code>eval_result_path</code>：检测模型的预测结果文件。</li>
<li><code>image_path</code>：nuscenes数据集。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 centerpoint_eval.py --predict_result_path=eval.log --gt_files_path=./nuscenes_lidar_val/val_gt_infos.pkl --meta_dir=./Nuscenes/meta/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>predict_result_path</code>：检测模型的预测结果文件。</p>
</li>
<li>
<p><code>gt_files_path</code>： 对nuscenes数据集进行预处理生成的gt文件。</p>
</li>
<li>
<p><code>meta_dir</code>： nuscenes数据集的meta信息路径。</p>
</li>
<li>
<p>6.使用Carfusion数据集的检测模型精度计算方式如下：</p>
</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 keypoints_eval.py --anno_path=./processed_carfusion/processed_anno.json --eval_result_path=eval.log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>anno_path</code>：预处理生成的processed_anno.json文件。</p>
</li>
<li>
<p><code>eval_result_path</code>：检测模型的预测结果文件。</p>
</li>
<li>
<p><strong>分割模型</strong></p>
</li>
</ul>
<p>使用Cityscapes数据集的分割模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 parsing_eval.py --log_file=eval.log --gt_path=cityscapes/gtFine/val</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>log_file</code>：分割模型的预测结果文件。</p>
</li>
<li>
<p><code>gt_path</code>：Cityscapes数据集的标注文件。</p>
</li>
<li>
<p><strong>光流模型</strong></p>
</li>
</ul>
<p>使用FlyingChairs数据集的光流模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 pwcnet_eval.py --log_file=eval.log --gt_path=./flyingchairs/FlyingChairs_release/data/  --val_file=./flyingchairs/FlyingChairs_train_val.txt</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>log_file</code>：光流模型的预测结果文件。</p>
</li>
<li>
<p><code>val_file</code>：FlyingChairs数据集标签文件。</p>
</li>
<li>
<p><code>gt_path</code>：FlyingChairs数据集原始文件。</p>
</li>
<li>
<p><strong>追踪模型</strong></p>
</li>
</ul>
<p>使用mot17数据集的追踪模型计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 motr_eval.py --eval_result_path=eval_log --gt_val_path=valdata/gt_val</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>eval_result_path</code>：追踪模型的预测结果文件夹。</p>
</li>
<li>
<p><code>gt_val_path</code>：mot17数据集的标注文件。</p>
</li>
<li>
<p><strong>多任务模型</strong></p>
</li>
</ul>
<p>使用nuscenes数据集的lidar多任务模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 lidar_multitask_eval.py --det_eval_path=det_eval.log --seg_eval_path=seg_eval.log --gt_files_path=./nuscenes_lidar_val/val_gt_infos.pkl --data_dir=./Nuscenes</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>det_eval_path</code>: 检测任务的预测结果文件。</p>
</li>
<li>
<p><code>seg_eval_path</code>: 分割任务的预测结果文件。</p>
</li>
<li>
<p><code>gt_files_path</code>: 对nuscenes数据集进行预处理生成的gt文件。</p>
</li>
<li>
<p><code>data_dir</code>: nuscenes数据集路径。</p>
</li>
<li>
<p><strong>轨迹预测模型</strong></p>
</li>
</ul>
<p>使用argoverse1数据集的追踪模型计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 densetnt_eval.py --eval_result_path=eval.log --meta_path=argoverse1/meta</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li>
<p><code>eval_result_path</code>：轨迹预测的预测结果文件。</p>
</li>
<li>
<p><code>meta_path</code>：argoverse1数据集生成的的标注文件，使用预处理脚本后，生成在原数据集目录meta中。</p>
</li>
<li>
<p><strong>深度估计模型</strong></p>
</li>
</ul>
<p>使用Sceneflow数据集的深度估计模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 stereonet_eval.py --log_file=eval.log --gt_files=val_gt_infos.pkl</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<ul>
<li><code>log_file</code>：深度估计模型的预测结果文件。</li>
<li><code>gt_files</code>：对Sceneflow数据集进行预处理生成的gt文件。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="模型集成-1">模型集成<a href="#模型集成-1" class="hash-link" aria-label="模型集成的直接链接" title="模型集成的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="前处理">前处理<a href="#前处理" class="hash-link" aria-label="前处理的直接链接" title="前处理的直接链接">​</a></h5>
<p>您可根据需要自行添加模型前处理，将其部署到 <code>CPU</code> 上，以centerpoint_pointpillar_nuscenes为例：</p>
<p>1.增加前处理文件qat_centerpoint_preprocess_method.cc，以及头文件qat_centerpoint_preprocess_method.h。</p>
<p>2.增加模型前处理配置文件。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="前处理文件及头文件添加">前处理文件及头文件添加<a href="#前处理文件及头文件添加" class="hash-link" aria-label="前处理文件及头文件添加的直接链接" title="前处理文件及头文件添加的直接链接">​</a></h6>
<p>前处理文件 <code>qat_centerpoint_preprocess_method.cc</code> 放置于 <strong>ai_benchmark/code/src/method/</strong> 路径下，
头文件 <code>qat_centerpoint_preprocess_method.h</code> 放置于 <strong>ai_benchmark/code/include/method/</strong> 路径下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |── ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |── code                                                 # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |── method                                         # 在此文件夹中添加头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── qat_centerpoint_preprocess_method.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |── method                                         # 在此文件夹中添加前处理.cc文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── qat_centerpoint_preprocess_method.cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── ...</span><br></span></code></pre></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="模型前处理配置文件添加">模型前处理配置文件添加<a href="#模型前处理配置文件添加" class="hash-link" aria-label="模型前处理配置文件添加的直接链接" title="模型前处理配置文件添加的直接链接">​</a></h6>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |── ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |── x5/qat/script                                       #   示例脚本文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |── preprocess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── centerpoint_preprocess_5dim.json           # 前处理配置脚本</span><br></span></code></pre></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="前处理单帧延时评测">前处理单帧延时评测<a href="#前处理单帧延时评测" class="hash-link" aria-label="前处理单帧延时评测的直接链接" title="前处理单帧延时评测的直接链接">​</a></h6>
<p>执行 <code>sh latency.sh</code> 脚本可对前处理的单帧延迟情况进行测试。如下所示：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0615 13:30:40.772293  3670 output_plugin.cc:91]  Pre process latency: [avg:  20.295ms,  max:  28.690ms,  min:  18.512ms], Infer latency:  [avg:  25.053ms,  max:  31.943ms,  min:  24.702ms], Post process latency: [avg:  52.760ms,  max:  54.099ms,  min:  51.992ms].</span><br></span></code></pre></div></div>
<p>其中：</p>
<ul>
<li>
<p><code>Pre process</code> 表示前处理耗时。</p>
</li>
<li>
<p><code>Infer</code> 表示模型推理耗时。</p>
</li>
<li>
<p><code>Post process</code> 表示后处理耗时。</p>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="后处理">后处理<a href="#后处理" class="hash-link" aria-label="后处理的直接链接" title="后处理的直接链接">​</a></h5>
<p>后处理集成主要有2个步骤，以CenterNet模型集成为例：</p>
<ol>
<li>增加后处理文件 <code>ptq_centernet_post_process_method.cc</code>，以及头文件 <code>ptq_centernet_post_process_method.h</code>。</li>
<li>增加模型运行脚本及配置文件。</li>
</ol>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="后处理文件及头文件添加">后处理文件及头文件添加<a href="#后处理文件及头文件添加" class="hash-link" aria-label="后处理文件及头文件添加的直接链接" title="后处理文件及头文件添加的直接链接">​</a></h6>
<p>后处理代码文件可直接复用src/method目录下任意后处理文件，主要修改 <code>InitFromJsonString</code> 函数，以及 <code>PostProcess</code> 函数即可。</p>
<p><code>InitFromJsonString</code> 函数主要是读取workflow.json中的后处理相关的参数配置，用户可自定义设置相应的输入参数。
<code>PostProcess</code> 函数主要完成后处理的逻辑。</p>
<p>后处理.cc文件放置于 <code>ai_benchmark/code/src/method/</code> 路径下，
.h头文件放置于 <code>ai_benchmark/code/include/method/</code> 路径下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  |── ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |── code                                                 # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |── method                                         # 在此文件夹中添加头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── ptq_centernet_post_process_method.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |── method                                         # 在此文件夹中添加后处理.cc文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── ptq_centernet_post_process_method.cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |── ...</span><br></span></code></pre></div></div>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="增加模型运行脚本及配置文件-1">增加模型运行脚本及配置文件<a href="#增加模型运行脚本及配置文件-1" class="hash-link" aria-label="增加模型运行脚本及配置文件的直接链接" title="增加模型运行脚本及配置文件的直接链接">​</a></h6>
<p>模型运行脚本及配置文件完成添加后的目录结构参考如下：</p>
<ul>
<li>centerpoint_pointpillar_nuscenes模型：</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    |── ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |── x5/qat/script                                       # 示例脚本文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |── detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |── centerpoint_pointpillar_nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── accuracy.sh                                # 精度测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── fps.sh                                     # 性能测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── latency.sh                                 # 单帧延时示例脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_accuracy                          # 精度配置文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_fps.json                          # 性能配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_latency.json                      # 单帧延时配置文件</span><br></span></code></pre></div></div>
<ul>
<li>motr_efficientnetb3_mot17模型：</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    |── ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |── x5/qat/script                                       # 示例脚本文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |── tracking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |── motr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── accuracy.sh                                # 精度测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── fps.sh                                     # 性能测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── generate_acc_lst.sh                        # 生成精度lst脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── latency.sh                                 # 单帧延时示例脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_accuracy                          # 精度配置文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_fps.json                          # 性能配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_latency.json                      # 单帧延时配置文件</span><br></span></code></pre></div></div>
<ul>
<li>除centerpoint_pointpillar_nuscenes模型及motr_efficientnetb3_mot17外其他模型：</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    |── ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |── x5/ptq/script                                       # 示例脚本文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |── detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |── centernet_resnet101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── accuracy.sh                                # 精度测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── fps.sh                                     # 性能测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── latency.sh                                 # 单帧延时示例脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_accuracy.json                     # 精度配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_fps.json                          # 性能配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |  |  |  |  |── workflow_latency.json                      # 单帧延时配置文件</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="辅助工具和常用操作-3">辅助工具和常用操作<a href="#辅助工具和常用操作-3" class="hash-link" aria-label="辅助工具和常用操作的直接链接" title="辅助工具和常用操作的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="日志系统  使用说明-1">日志系统使用说明<a href="#日志系统使用说明-1" class="hash-link" aria-label="日志系统使用说明的直接链接" title="日志系统使用说明的直接链接">​</a></h5>
<p>日志系统主要包括 <code>示例日志</code> 和 <code>模型推理API DNN日志</code> 两部分。
其中示例日志是指交付包示例代码中的应用日志；DNN日志是指lib dnn库中的日志。
用户根据不同的需求可以获取不同的日志。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="示例日志-2">示例日志<a href="#示例日志-2" class="hash-link" aria-label="示例日志的直接链接" title="示例日志的直接链接">​</a></h6>
<ol>
<li>日志等级。示例日志主要采用glog中的vlog，主要分为四个自定义等级：</li>
</ol>
<ul>
<li><code>0</code> (SYSTEM)，该等级主要用来输出报错信息；</li>
<li><code>1</code> (REPORT)，该等级在示例代码中主要用来输出性能数据；</li>
<li><code>2</code> (DETAIL)，该等级在示例代码中主要用来输出系统当前状态信息；</li>
<li><code>3</code> (DEBUG)，该等级在示例代码中主要用来输出调试信息。
日志等级设置规则：假设设置了级别为 <code>P</code>，如果发生了一个级别 <code>Q</code> 比 <code>P</code> 低，
则可以启动，否则屏蔽掉；默认DEBUG&gt;DETAIL&gt;REPORT&gt;SYSTEM。</li>
</ul>
<ol start="2">
<li>日志等级设置。通过 <code>log_level</code> 参数来设置日志等级，在运行示例的时候，指定 <code>log_level</code> 参数来设置等级，
比如指定 <code>log_level=0</code>，即输出SYSTEM日志；如果指定 <code>log_level=3</code>，
则输出DEBUG、DETAIL、REPORT和SYSTEM日志。</li>
</ol>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理api-dnn日志">模型推理API DNN日志<a href="#模型推理api-dnn日志" class="hash-link" aria-label="模型推理API DNN日志的直接链接" title="模型推理API DNN日志的直接链接">​</a></h6>
<p>关于模型推理 DNN API日志的配置，请阅读<a href="/rdk_doc/04_Algorithm_Application/02_cdev_dnn_api/cdev_dnn_api.md">《模型推理DNN API使用说明》</a>文档中的 <code>配置信息</code> 一节内容</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="算子耗时说明-1">算子耗时说明<a href="#算子耗时说明-1" class="hash-link" aria-label="算子耗时说明的直接链接" title="算子耗时说明的直接链接">​</a></h5>
<p>对模型算子(OP)性能的统计是通过设置 <code>HB_DNN_PROFILER_LOG_PATH</code> 环境变量实现的，本节介绍模型的推理性能分析，有助于开发者了解模型的真实推理性能情况。
对该变量的类型和取值说明如下：</p>
<p><strong>备注：</strong></p>
<p><code>export HB_DNN_PROFILER_LOG_PATH=${path}</code>：表示OP节点dump的输出路径，程序正常运行完退出后，产生profiler.log文件。</p>
<ul>
<li>示例说明</li>
</ul>
<p>以下代码块以mobilenetv1模型为例，开启单个线程同时RunModel，设置 <code>export HB_DNN_PROFILER_LOG_PATH=./</code>，则统计输出的信息如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;perf_result&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;FPS&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">677.6192525182025</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;average_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.506142616271973</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;running_condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;core_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;frame_count&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;model_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mobilenetv1_224x224_nv12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;run_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">295.151</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;thread_num&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;chip_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;BPU_inference_time_cost&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.09122</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.54</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.439</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;CPU_inference_time_cost&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.18836999999999998</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.4630000000000001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.127</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;model_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;BPU_MOBILENET_subgraph_0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.09122</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.54</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.439</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Dequantize_fc7_1_HzDequantize&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.07884999999999999</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.158</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.068</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;MOBILENET_subgraph_0_output_layout_convert&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.018765</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.08</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Preprocess&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0065</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.058</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.003</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Softmax_prob&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.084255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.167</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.046</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;task_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;TaskPendingTime&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.029375</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.059</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.009</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;TaskRunningTime&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.40324</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.801</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.008</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>以上输出了 <code>model_latency</code> 和 <code>task_latency</code>。其中model_latency中输出了模型每个OP运行所需要的耗时情况，task_latency中输出了模型运行中各个task模块的耗时情况。</p>
<p><strong>备注：</strong></p>
<p>程序只有正常退出才会输出profiler.log文件。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="dump工具-1">dump工具<a href="#dump工具-1" class="hash-link" aria-label="dump工具的直接链接" title="dump工具的直接链接">​</a></h5>
<p>本节主要介绍dump工具的开启方法，一般不需要关注，只有在模型精度异常情况时开启使用。
​通过设置 <code>export HB_DNN_DUMP_PATH=${path}</code> 这个环境变量，可以dump出模型推理过程中每个节点的输入和输出, 根据dump的输出结果，可以排查模型推理在开发机模拟器和开发板是否存在一致性问题：即相同模型，相同输入，开发板和开发机模拟器的输出结果是否完全相同。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型上板分析工具说明-1">模型上板分析工具说明<a href="#模型上板分析工具说明-1" class="hash-link" aria-label="模型上板分析工具说明的直接链接" title="模型上板分析工具说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="概述-3">概述<a href="#概述-3" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h4>
<p>本章节介绍X5算法工具链中模型上板推理的快速验证工具，方便开发者可以快速获取到 <code>***.bin</code> 模型的信息、模型推理的性能、模型debug等内容。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hrt_model_exec-工具使用说明-1">hrt_model_exec 工具使用说明<a href="#hrt_model_exec-工具使用说明-1" class="hash-link" aria-label="hrt_model_exec 工具使用说明的直接链接" title="hrt_model_exec 工具使用说明的直接链接">​</a></h4>
<p><code>hrt_model_exec</code> 工具，可以快速在开发板上评测模型的推理性能、获取模型信息等。</p>
<p>目前工具提供了三类功能，如下表所示：</p>
<table><thead><tr><th><strong>编号</strong></th><th><strong>子命令</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>1</td><td><code>model_info</code></td><td>获取模型信息，如：模型的输入输出信息等。</td></tr><tr><td>2</td><td><code>infer</code></td><td>执行模型推理，获取模型推理结果。</td></tr><tr><td>3</td><td><code>perf</code></td><td>执行模型性能分析，获取性能分析结果。</td></tr></tbody></table>
<p><strong>小技巧：</strong></p>
<p>工具也可以通过 <code>-v</code> 或者 <code>--version</code> 命令，查看工具的 <code>dnn</code> 预测库版本号。</p>
<p>例如： hrt_model_exec -v 或 hrt_model_exec --version</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数描述-2">输入参数描述<a href="#输入参数描述-2" class="hash-link" aria-label="输入参数描述的直接链接" title="输入参数描述的直接链接">​</a></h5>
<p>在开发板上运行 <code>hrt_model_exec</code> 、 <code>hrt_model_exec -h</code> 或 <code>hrt_model_exec --help</code> 获取工具的使用参数详情。
如下图中所示：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/hrt_model_exec_help_x5.png" alt="hrt_model_exec_help" class="img_ev3q"></p>
<table><thead><tr><th><strong>编号</strong></th><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>1</td><td><code>model_file</code></td><td>string</td><td>模型文件路径，多个路径可通过逗号分隔。</td></tr><tr><td>2</td><td><code>model_name</code></td><td>string</td><td>指定模型中某个模型的名称。</td></tr><tr><td>3</td><td><code>core_id</code></td><td>int</td><td>指定运行核。0：任意核，1：core0，2：core1；默认为 <code>0</code>。</td></tr><tr><td>4</td><td><code>input_file</code></td><td>string</td><td>模型输入信息。图片输入后缀必须为 <code>bin</code> / <code>JPG</code> / <code>JPEG</code> / <code>jpg</code> / <code>jpeg</code> / <code>png</code> / <code>PNG</code>中的一种。feature输入后缀名必须为 <code>bin</code> / <code>txt</code> 中的一种。 每个输入之间需要用英文字符的逗号隔开 <code>,</code>，如： <code>xxx.jpg,input.txt</code>。当模型中含有对输入数据有要求的算子时，推荐使用指定数据进行perf，如：Gather算子的index输入需要满足一定范围。</td></tr><tr><td>5</td><td><code>roi_infer</code></td><td>bool</td><td>使能resizer模型推理。 若模型存在resizer输入源的输入，需设置为 <code>true</code>， 并且配置与输入源一一对应的 <code>input_file</code> 和 <code>roi</code> 参数。</td></tr><tr><td>6</td><td><code>roi</code></td><td>string</td><td>指定推理resizer模型时所需的roi区域。 多个roi之间通过英文分号间隔。如：--roi=&quot;2,4,123,125;6,8,111,113&quot;</td></tr><tr><td>7</td><td><code>frame_count</code></td><td>int</td><td>执行模型运行帧数。</td></tr><tr><td>8</td><td><code>dump_intermediate</code></td><td>string</td><td>dump模型每一层输入和输出。<br>- <code>dump_intermediate=0</code> 时，默认dump功能关闭。  <br>- <code>dump_intermediate=1</code> 时，模型中每一层节点输入数据输出数据以 <code>bin</code> 方式保存，其中 <code>BPU</code> 节点输出为 <code>aligned</code> 数据。<br>- <code>dump_intermediate=2</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code>和 <code>txt</code> 两种方式保存，其中 <code>BPU</code> 节点输出为 <code>aligned</code> 数据。 <br>- <code>dump_intermediate=3</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 和 <code>txt</code> 两种方式保存，其中 <code>BPU</code> 节点输出为 <code>valid</code> 数据。</td></tr><tr><td>9</td><td><code>enable_dump</code></td><td>bool</td><td>使能dump模型输入和输出，默认为 <code>false</code>。</td></tr><tr><td>10</td><td><code>dump_precision</code></td><td>int</td><td>控制txt格式输出float型数据的小数点位数，默认为 <code>9</code>。</td></tr><tr><td>11</td><td><code>hybrid_dequantize_process</code></td><td>bool</td><td>对原始输出进行后处理后保存。在 <code>enable_dump=true</code> 时生效，且只支持四维模型。后处理包括对定点输出进行反量化操作、去除 <code>padding</code> 操作。</td></tr><tr><td>12</td><td><code>dump_format</code></td><td>string</td><td>dump模型输入和输出的格式。</td></tr><tr><td>13</td><td><code>dump_txt_axis</code></td><td>int</td><td>控制txt格式输入输出的换行规则。</td></tr><tr><td>14</td><td><code>enable_cls_post_process</code></td><td>bool</td><td>使能分类后处理，默认为 <code>false</code>。子命令为 <code>infer</code> 时配合使用，目前只支持ptq分类模型的后处理，打印分类结果。</td></tr><tr><td>15</td><td><code>perf_time</code></td><td>int</td><td>执行模型运行时间。</td></tr><tr><td>16</td><td><code>thread_num</code></td><td>int</td><td>线程数(并行度)，数值可以表示最多有多少个任务在并行处理。测试延时，数值需要设置为1，没有资源抢占发生，延时测试更准确。测试吞吐，建议设置&gt;2 (BPU核心个数)，调整线程数使BPU利用率尽量高，吞吐测试更准确。</td></tr><tr><td>17</td><td><code>profile_path</code></td><td>string</td><td>统计工具日志产生路径，运行产生profiler.log和profiler.csv ，分析op耗时和调度耗时。一般设置 <code>--profile_path=&quot;.&quot;</code> 即可，代表在当前目录下生成日志文件。</td></tr><tr><td>18</td><td><code>dump_path</code></td><td>string</td><td>工具dump输出文件路径，enable_dump或dump_intermediate都会产生输出文件，指定路径后,文件将输出在指定路径下，若路径不存在，则工具会自动创建。</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-2">使用说明<a href="#使用说明-2" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h5>
<p>本节介绍 <code>hrt_model_exec</code> 工具的三个子功能的具体使用方法</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="model_info-1"><code>model_info</code><a href="#model_info-1" class="hash-link" aria-label="model_info-1的直接链接" title="model_info-1的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于获取模型信息，模型支持范围：QAT模型，PTQ模型。
该参数与 <code>model_file</code> 一起使用，用于获取模型的详细信息；
模型的信息包括：模型输入输出信息 <code>hbDNNTensorProperties</code> 和模型的分段信息 <code>stage</code> ；模型的分段信息是：一张图片可以分多个阶段进行推理，stage信息为[x1, y1, x2, y2]，分别为图片推理的左上角和右下角坐标，目前X5的bayes架构支持这类分段模型的推理，X3上模型均为1个stage。</p>
<p><strong>小技巧：</strong></p>
<p>不指定 <code>model_name</code> ，则会输出模型中所有模型信息，指定 <code>model_name</code> ，则只输出对应模型的信息。</p>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型（输出所有模型信息）</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin,xxx.bin</span><br></span></code></pre></div></div>
<ol start="3">
<li>多模型--pack模型（输出指定模型信息）</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin --model_name=xx</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/model_info_x5.png" alt="model_info" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明-3"><code>输入参数补充说明</code><a href="#输入参数补充说明-3" class="hash-link" aria-label="输入参数补充说明-3的直接链接" title="输入参数补充说明-3的直接链接">​</a></h5>
<ul>
<li>重复输入</li>
</ul>
<p>若重复指定参数输入，则会发生参数覆盖的情况，例如：获取模型  信息时重复指定了两个模型文件，则会取后面指定的参数输入 <code>yyy.bin</code>：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin --model_file=yyy.bin</span><br></span></code></pre></div></div>
<p>若重复指定输入时，未加命令行参--model_file，则会取命令行参数后面的值，未加参数的不识别，
例如：下例会忽略 <code>yyy.bin</code>，参数值为 <code>xxx.bin</code>：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin yyy.bin</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="infer-1"><code>infer</code><a href="#infer-1" class="hash-link" aria-label="infer-1的直接链接" title="infer-1的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于输入自定义图片后，模型推理一帧，并给出模型推理结果。
该参数需要与 <code>input_file</code> 一起使用，指定输入图片路径，工具根据模型信息resize图片，整理模型输入信息。</p>
<p><strong>小技巧：</strong></p>
<p>程序单线程运行单帧数据，输出模型运行的时间。</p>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=xxx.jpg</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin,xxx.bin --model_name=xx --input_file=xxx.jpg</span><br></span></code></pre></div></div>
<ol start="3">
<li>resizer模型</li>
</ol>
<p>模型有三个输入，输入源顺序分别为[<code>ddr</code>, <code>resizer</code>, <code>resizer</code>]。</p>
<p>推理两帧数据，假设第一帧输入为[xx0.bin,xx1.jpg,xx2.jpg]，roi为[2,4,123,125;6,8,111,113]，第二帧输入为[xx3.bin,xx4.jpg,xx5.jpg]，roi为[27,46,143,195;16,28,131,183]，则推理命令如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --roi_infer=true --model_file=xxx.bin --input_file=&quot;xx0.bin,xx1.jpg,xx2.jpg,xx3.bin,xx4.jpg,xx5.jpg&quot;  --roi=&quot;2,4,123,125;6,8,111,113;27,46,143,195;16,28,131,183&quot;</span><br></span></code></pre></div></div>
<p><strong>注意：</strong> 多帧输入之间用英文逗号隔离，roi之间使用分号隔离。</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/perf_x5.png" alt="infer" class="img_ev3q"></p>
<ul>
<li>
<p>可选参数</p>
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>core_id</code></td><td>指定模型推理的核id，0：任意核，1：core0，2：core1；默认为 <code>0</code>，X5上因为只有一个BPU核，配置 <code>0</code> 或 <code>1</code>。</td></tr><tr><td><code>roi_infer</code></td><td>使能resizer模型推理；若模型输入包含resizer源，设置为 <code>true</code>，默认为 <code>false</code>。</td></tr><tr><td><code>roi</code></td><td><code>roi_infer</code> 为 <code>true</code> 时生效，设置推理resizer模型时所需的 <code>roi</code> 区域以分号间隔。</td></tr><tr><td><code>frame_count</code></td><td>设置 <code>infer</code> 运行帧数，单帧重复推理，可与 <code>enable_dump</code> 并用，验证输出一致性，默认为 <code>1</code>。</td></tr><tr><td><code>dump_intermediate</code></td><td>dump模型每一层输入数据和输出数据，默认值 <code>0</code>，不dump数据。 <code>1</code>：输出文件类型为 <code>bin</code>；<code>2</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为aligned数据； <code>3</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为valid数据。</td></tr><tr><td><code>enable_dump</code></td><td>dump模型输出数据，默认为 <code>false</code>。</td></tr><tr><td><code>dump_precision</code></td><td>控制txt格式输出float型数据的小数点位数，默认为 <code>9</code>。</td></tr><tr><td><code>hybrid_dequantize_process</code></td><td>控制txt格式输出float类型数据，若输出为定点数据将其进行反量化处理，目前只支持四维模型。</td></tr><tr><td><code>dump_format</code></td><td>dump模型输出文件的类型，可选参数为 <code>bin</code> 或 <code>txt</code>，默认为 <code>bin</code>。</td></tr><tr><td><code>dump_txt_axis</code></td><td>dump模型txt格式输出的换行规则；若输出维度为n，则参数范围为[0, n], 默认为 <code>-1</code>，一行一个数据。</td></tr><tr><td><code>enable_cls_post_process</code></td><td>使能分类后处理，目前只支持ptq分类模型，默认 <code>false</code>。</td></tr><tr><td><code>dump_path</code></td><td>指定dump输出路径，默认当前路径。</td></tr></tbody></table>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="多输入模型说明-1"><code>多输入模型说明</code><a href="#多输入模型说明-1" class="hash-link" aria-label="多输入模型说明-1的直接链接" title="多输入模型说明-1的直接链接">​</a></h5>
<p>工具 <code>infer</code> 推理功能支持多输入模型的推理，支持图片输入、二进制文件输入以及文本文件输入，输入数据用逗号隔开。
模型的输入信息可以通过 <code>model_info</code> 进行查看。</p>
<ul>
<li>示例说明</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=xxx.jpg,input.txt</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明-4"><code>输入参数补充说明</code><a href="#输入参数补充说明-4" class="hash-link" aria-label="  输入参数补充说明-4的直接链接" title="输入参数补充说明-4的直接链接">​</a></h5>
<ul>
<li><code>input_file</code></li>
</ul>
<p>图片类型的输入，其文件名后缀必须为 <code>bin</code> / <code>JPG</code> / <code>JPEG</code> / <code>jpg</code> / <code>jpeg</code> / <code>png</code> 中的一种，feature输入后缀名必须为 <code>bin</code> / <code>txt</code> 中的一种。
每个输入之间需要用英文字符的逗号隔开 <code>,</code>，例如： <code>xxx.jpg,input.txt</code>。</p>
<ul>
<li><code>enable_cls_post_process</code></li>
</ul>
<p>使能分类后处理。子命令为 <code>infer</code> 时配合使用，目前只支持在PTQ分类模型的后处理时使用，变量为 <code>true</code> 时打印分类结果。
参见下图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/enable_cls_post_process_x5.png" alt="enable_cls_post_process" class="img_ev3q"></p>
<ul>
<li><code>roi_infer</code></li>
</ul>
<p>若模型包含resizer输入源， <code>infer</code> 和 <code>perf</code> 功能都需要设置 <code>roi_infer</code> 为true，并且配置与输入源一一对应的 <code>input_file</code> 和 <code>roi</code> 参数。
如：模型有三个输入，输入源顺序分别为[<code>ddr</code>, <code>resizer</code>, <code>resizer</code>]，则推理两组输入数据的命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx0.bin,xx1.jpg,xx2.jpg,xx3.bin,xx4.jpg,xx5.jpg&quot;  --roi=&quot;2,4,123,125;6,8,111,113;27,46,143,195;16,28,131,183&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // perf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin --input_file=&quot;xx0.bin,xx1.jpg,xx2.jpg,xx3.bin,xx4.jpg,xx5.jpg&quot;   --roi=&quot;2,4,123,125;6,8,111,113;27,46,143,195;16,28,131,183&quot;</span><br></span></code></pre></div></div>
<p>每个 <code>roi</code> 输入之间需要用英文字符的分号隔开。</p>
<ul>
<li><code>dump_intermediate</code></li>
</ul>
<p>dump模型每一层节点的输入数据和输出数据。 <code>dump_intermediate=0</code> 时，默认dump功能关闭；
<code>dump_intermediate=1</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 方式保存，其中 <code>BPU</code> 节点输出为 <code>aligned</code> 数据；
<code>dump_intermediate=2</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 和 <code>txt</code> 两种方式保存，其中 <code>BPU</code> 节点输出为 <code>aligned</code> 数据；
<code>dump_intermediate=3</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 和 <code>txt</code> 两种方式保存，其中 <code>BPU</code> 节点输出为 <code>valid</code> 数据。
如： 模型有两个输入，输入源顺序分别为[<code>pyramid</code>， <code>ddr</code>]，将模型每一层节点的输入和输出保存为 <code>bin</code> 文件，其中 <code>BPU</code> 节点输出按 <code>aligned</code> 类型保存，则推理命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx0.jpg,xx1.bin&quot;  --dump_intermediate=1</span><br></span></code></pre></div></div>
<p><code>dump_intermediate</code> 参数支持 <code>infer</code> 和 <code>perf</code> 两种模式。</p>
<ul>
<li><code>hybrid_dequantize_process</code></li>
</ul>
<p>控制txt格式输出float类型数据。 <code>hybrid_dequantize_process</code> 参数在 <code>enable_dump=true</code> 时生效。
当 <code>enable_dump=true</code> 时，若设置 <code>hybrid_dequantize_process=true</code> ，反量化整型输出数据，将所有输出按float类型保存为 <code>txt</code> 文件，其中模型输出为 <code>valid</code> 数据，支持配置 <code>dump_txt_axis</code> 和 <code>dump_precision</code>；
若设置 <code>hybrid_dequantize_process=false</code> ，直接保存模型输出的 <code>aligned</code> 数据，不做任何处理。
如： 模型有3个输出，输出Tensor数据类型顺序分别为[float，int32，int16]， 输出txt格式float类型的 <code>valid</code> 数据， 则推理命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // 输出float类型数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx.bin&quot;  --enable_dump=true --hybrid_dequantize_process=true</span><br></span></code></pre></div></div>
<p><code>hybrid_dequantize_process</code> 参数目前只支持四维模型。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="perf-1"><code>perf</code><a href="#perf-1" class="hash-link" aria-label="perf-1的直接链接" title="perf-1的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于测试模型的推理性能。
使用此工具命令，用户无需输入数据，程序会根据模型信息自动构造模型的输入tensor，tensor数据为随机数。
程序默认单线程运行200帧数据，当指定perf_time参数时，frame_count参数失效，程序会执行指定时间后退出。
程序运行完成后，会输出模型运行的程序线程数、帧数、模型推理总时间，模型推理平均latency，帧率信息等。</p>
<p><strong>小技巧：</strong></p>
<p>程序每200帧打印一次性能信息：latnecy的最大、最小、平均值，不足200帧程序运行结束打印一次。</p>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin,xxx.bin --model_name=xx</span><br></span></code></pre></div></div>
<ol start="3">
<li>resizer模型</li>
</ol>
<p>模型有三个输入，输入源顺序分别为[<code>ddr</code>, <code>resizer</code>, <code>resizer</code>]。</p>
<p>推理两帧数据，假设第一帧输入为[xx0.bin,xx1.jpg,xx2.jpg]，roi为[2,4,123,125;6,8,111,113]，第二帧输入为[xx3.bin,xx4.jpg,xx5.jpg]，roi为[27,46,143,195;16,28,131,183]，则推理命令如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --roi_infer=true --model_file=xxx.bin --input_file=&quot;xx0.bin,xx1.jpg,xx2.jpg,xx3.bin,xx4.jpg,xx5.jpg&quot;   --roi=&quot;2,4,123,125;6,8,111,113;27,46,143,195;16,28,131,183&quot;</span><br></span></code></pre></div></div>
<p><strong>注意：</strong> 多帧输入之间用英文逗号隔离，roi之间使用分号隔离。</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/perf_x5.png" alt="perf" class="img_ev3q"></p>
<ul>
<li>
<p>可选参数</p>
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>core_id</code></td><td>指定模型推理的核id，0：任意核，1：core0，2：core1；默认为 <code>0</code>，X5上因为只有一个BPU核，配置 <code>0</code> 或 <code>1</code>。</td></tr><tr><td><code>input_file</code></td><td>模型输入信息，多个可通过逗号分隔。</td></tr><tr><td><code>roi_infer</code></td><td>使能resizer模型推理；若模型输入包含resizer源，设置为 <code>true</code>，默认为 <code>false</code>。</td></tr><tr><td><code>roi</code></td><td><code>roi_infer</code> 为 <code>true</code> 时生效，设置推理resizer模型时所需的 <code>roi</code> 区域以英文分号间隔。</td></tr><tr><td><code>frame_count</code></td><td>设置 <code>perf</code> 运行帧数，当perf_time为0时生效，默认为 <code>200</code>。</td></tr><tr><td><code>perf_time</code></td><td>设置 <code>perf</code> 运行时间，单位：分钟，默认为 <code>0</code>。</td></tr><tr><td><code>thread_num</code></td><td>设置程序运行线程数，范围[1, 8], 默认为 <code>1</code>, 设置大于8时按照8个线程处理。</td></tr><tr><td><code>profile_path</code></td><td>统计工具日志产生路径，运行产生profiler.log和profiler.csv，分析op耗时和调度耗时。</td></tr></tbody></table>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="多线程latency数据说明-1"><code>多线程Latency数据说明</code><a href="#多线程latency数据说明-1" class="hash-link" aria-label="多线程latency数据说明-1的直接链接" title="多线程latency数据说明-1的直接链接">​</a></h5>
<p>多线程的目的是为了充分利用BPU资源，多线程共同处理 <code>frame_count</code> 帧数据或执行perf_time时间，直至数据处理完成/执行时间结束程序结束。
在多线程 <code>perf</code> 过程中可以执行以下命令，实时获取BPU资源占用率情况。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrut_somstatus -n 10000 –d 1</span><br></span></code></pre></div></div>
<p><strong><code>X3</code></strong> 输出内容如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  =====================1=====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  temperature--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          CPU      : 37.5 (C)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu frequency--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                min       cur     max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu0: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu1: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu2: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu3: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bpu status information----&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              min        cur             max             ratio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bpu0: 400000000 1000000000      1000000000      0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bpu1: 400000000 1000000000      1000000000      0</span><br></span></code></pre></div></div>
<p><strong><code>X5</code></strong> 输出内容如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  =====================1=====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  temperature--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          DDR      : 57.0 (C)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cat: /sys/class/hwmon/hwmon0/temp2_input: Connection timed out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          BPU      : 0.0 (C)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          CPU      : 56.6 (C)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu frequency--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                min(M)    cur(M)  max(M)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu0: 300       1500    1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu1: 300       1500    1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu2: 300       1500    1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu3: 300       1500    1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu4: 300       1500    1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu5: 300       1500    1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu6: 300       1500    1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu7: 300       1500    1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bpu status information----&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                min(M)    cur(M)  max(M)  ratio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bpu0: 500       1000    1000    0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ddr frequency information----&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                min(M)    cur(M)  max(M)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ddr:  266       3200    3200</span><br></span></code></pre></div></div>
<p><strong>备注：</strong></p>
<p>在 <code>perf</code> 模式下，单线程的latency时间表示模型的实测上板性能，
而多线程的latency数据表示的是每个线程的模型单帧处理时间，其相对于单线程的时间要长，但是多线程的总体处理时间减少，其帧率是提升的。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明-5"><code>输入参数补充说明</code><a href="#输入参数补充说明-5" class="hash-link" aria-label="输入参数补充说明-5的直接链接" title="输入参数补充说明-5的直接链接">​</a></h5>
<ul>
<li><code>profile_path</code></li>
</ul>
<p>profile日志文件产生目录。
该参数通过设置环境变量 <code>export HB_DNN_PROFILER_LOG_PATH=${path}</code> 查看模型运行过程中OP以及任务调度耗时。
一般设置 <code>--profile_path=&quot;.&quot;</code> 即可，代表在当前目录下生成日志文件，日志文件为profiler.log。</p>
<ul>
<li><code>thread_num</code></li>
</ul>
<p>线程数(并行度)，数值表示最多有多少个任务在并行处理。
测试延时时，数值需要设置为1，没有资源抢占发生，延时测试更准确。
测试吞吐时，建议设置&gt;2 (BPU核心个数)，调整线程数使BPU利用率尽量高，吞吐测试更准确。
<strong>注意： <code>X5只有一个BPU核，core_id 只能设置为 0 或 1</code></strong></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // 多线程FPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file xxx.bin --thread_num 8 --core_id 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file xxx.bin --thread_num 1 --core_id 1</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="常见问题">常见问题<a href="#常见问题" class="hash-link" aria-label="常见问题的直接链接" title="常见问题的直接链接">​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="latencyfps数据是如何统计的">Latency、FPS数据是如何统计的？<a href="#latencyfps数据是如何统计的" class="hash-link" aria-label="Latency、FPS数据是如何统计的？的直接链接" title="Latency、FPS数据是如何统计的？的直接链接">​</a></h6>
<p>Latency是指单流程推理模型所耗费的平均时间，重在表示在资源充足的情况下推理一帧的平均耗时，体现在上板运行是单核单线程统计；统计方法伪代码如  下：</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Load model and prepare input and output tensor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Loop run inference and get latency</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int32_t</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> loop_num</span><span class="token punctuation" style="color:#393A34">{</span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">chrono</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">steady_clock</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int32_t</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> loop_num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hbDNNInferCtrlParam infer_ctrl_param</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">HB_DNN_INITIALIZE_INFER_CTRL_PARAM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">infer_ctrl_param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">hbDNNInfer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">task_handle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">output</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  input_tensors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  dnn_handle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">infer_ctrl_param</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// wait task done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">hbDNNWaitTaskDone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task_handle</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// release task handle</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">hbDNNReleaseTask</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">task_handle</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        task_handle </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nullptr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    end </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">chrono</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">steady_clock</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">now</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    latency </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">end </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> start</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> loop_num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// release tensor and model</span><br></span></code></pre></div></div>
<p>FPS是指多流程同时进行模型推理平均一秒推理的帧数，重在表示充分使用资源情况下模型的吞吐，体现在上板运行为单核多线程；统计方法是同时起多个线程进行模型推理，计算平均1s推理的总帧数。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="通过latency推算fps与工具测出的fps为什么不一致">通过Latency推算FPS与工具测出的FPS为什么不一致？<a href="#通过latency推算fps与工具测出的fps为什么不一致" class="hash-link" aria-label="通过Latency推算FPS与工具测出的FPS为什么不一致？的直接链接" title="通过Latency推算FPS与工具测出的FPS为什么不一致？的直接链接">​</a></h6>
<p>Latency与FPS的统计情景不同，Latency为单流程（单核单线程）推理，FPS为多流程（单核多线程）推理，因此推算不一致；若统计FPS时将流程（线程）数量设置为 <code>1</code> ，则通过Latency推算FPS和测出的一致。</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="工具如何评测自定义算子模型">工具如何评测自定义算子模型？<a href="#工具如何评测自定义算子模型" class="hash-link" aria-label="工具如何评测自定义算子模型？的直接链接" title="工具如何评测自定义算子模型？的直接链接">​</a></h6>
<p>参考horizon_runtime_sample/code/02_advanced_samples/custom_identity示例开发自定义算子，将自定义算子编译成动态库，在工具使用之前指定该动态库路径即可。
例如动态库路径为：/userdata/plugins/libplugin.so，工具运行含该自定义算子的模型，仅需指定该动态库所在路径即可。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export HB_DNN_PLUGIN_PATH=/userdata/plugins/</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hrt_bin_dump-工具使用说明-1">hrt_bin_dump 工具使用说明<a href="#hrt_bin_dump-工具使用说明-1" class="hash-link" aria-label="hrt_bin_dump 工具使用说明的直接链接" title="hrt_bin_dump 工具使用说明的直接链接">​</a></h4>
<p><code>hrt_bin_dump</code> 是模型的layer dump工具，工具的输出文件为二进制文件。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数描述-3">输入参数描述<a href="#输入参数描述-3" class="hash-link" aria-label="输入参数描述的直接链接" title="输入参数描述的直接链接">​</a></h5>
<table><thead><tr><th>编号</th><th>参数</th><th>类型</th><th>描述</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td><code>model_file</code></td><td>string</td><td>模型文件路径。</td><td>指定模型文件路径，可dump模型所有节点的输入和输出文件</td></tr><tr><td>2</td><td><code>input_file</code></td><td>string</td><td>输入文件路径。</td><td>模型的输入文件，支持 <code>hbDNNDataType</code> 所有类型的输入； IMG类型文件需为二进制文件（后缀必须为.bin），二进制文件的大小应与模型的输入信息相匹配，如：YUV444文件大小为 :math:<code>height * width * 3</code>； TENSOR类型文件需为二进制文件或文本文件（后缀必须为.bin/.txt），二进制文件的大小应与模型的输入信息相匹配，文本文件的读入数据个数必须大于等于模型要求的输入数据个数，多余的数据会被丢弃；每个输入之间通过逗号分隔，如：模型有两个输入，则： <code>--input_file=kite.bin,input.txt</code>。</td></tr><tr><td>3</td><td><code>dump_path</code></td><td>string</td><td>工具输出路径。</td><td>工具的输出路径，该路径应为合法路径。</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-3">使用说明<a href="#使用说明-3" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h5>
<p>工具提供模型节点输入输出dump卷积层输出功能，输出文件为二进制文件。
直接运行 <code>hrt_bin_dump</code> 获取工具使用详情。
参见下图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/hrt_bin_dump_help_x5.png" alt="hrt_bin_dump_help" class="img_ev3q"></p>
<p><strong>小技巧：</strong>
工具也可以通过 <code>-v</code> 或者 <code>--version</code> 命令，查看工具的 <code>dnn</code> 预测库版本号。</p>
<p>例如： hrt_bin_dump -v 或 hrt_bin_dump --version</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-1">示例说明<a href="#示例说明-1" class="hash-link" aria-label="示例说明的直接链接" title="示例说明的直接链接">​</a></h5>
<p>以mobilenetv1的模型为例，创建outputs文件夹，执行以下命令：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ./hrt_bin_dump --model_file=./mobilenetv1.bin --dump_path=./outputs --input_file=./input.bin</span><br></span></code></pre></div></div>
<p>运行日志参见以下截图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/run_log_x5.png" alt="run_log" class="img_ev3q"></p>
<p>在路径 <strong>outputs/</strong> 文件夹下可以查看输出，参见以下截图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/output_x5.png" alt="output" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rdk-ultra">RDK Ultra<a href="#rdk-ultra" class="hash-link" aria-label="RDK Ultra的直接链接" title="RDK Ultra的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理dnn-api使用示例说明-2">模型推理DNN API使用示例说明<a href="#模型推理dnn-api使用示例说明-2" class="hash-link" aria-label="模型推理DNN API使用示例说明的直接链接" title="模型推理DNN API使用示例说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="概述-4">概述<a href="#概述-4" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h4>
<p>本章节介绍模型上板运行 horizon_runtime_sample 示例包的具体用法，开发者可以体验并基于这些示例进行应用开发，降低开发门槛。</p>
<p>示例包提供三个方面的示例：</p>
<ul>
<li>模型推理 dnn API使用示例。</li>
<li>自定义算子（custom OP）等特殊功能示例。</li>
<li>非NV12输入模型的杂项示例。</li>
</ul>
<p>详细内容请阅读下文。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>horizon_runtime_sample 示例包获取请参考 <a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config">交付物说明</a>。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码包结构介绍-2">示例代码包结构介绍<a href="#示例代码包结构介绍-2" class="hash-link" aria-label="示例代码包结构介绍的直接链接" title="示例代码包结构介绍的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  +---horizon_runtime_sample</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── code                                      # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 00_quick_start                        # 快速入门示例，用mobilenetv1读取单张图片进行推理的示例代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists_x86.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 01_api_tutorial                       # BPU SDK DNN API使用示例代码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── mem</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── resize</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── roi_infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 02_advanced_samples                   # 特殊功能示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── custom_identity</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── multi_input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── multi_model_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── nv12_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── 03_misc                               # 杂项示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── lenet_gray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── resnet_feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── build_ultra.sh                        # aarch64编译脚本   RDK Ultra 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── build_xj3.sh                          # aarch64编译脚本   RDK X3 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── deps_gcc9.3                           # 编译依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── aarch64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── ultra</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── data                                  # 预置数据文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── cls_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── custom_identity_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── det_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── misc_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   └── runtime -&gt; ../../../model_zoo/runtime/horizon_runtime_sample   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── script                                # aarch64示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── script_x86                            # x86示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── xj3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── data                                  # 预置数据文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cls_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── custom_identity_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── det_images</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── misc_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |   └── runtime -&gt; ../../../model_zoo/runtime/horizon_runtime_sample   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── script                                # aarch64示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── script_x86                            # x86示例运行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── README.md</span><br></span></code></pre></div></div>
<ul>
<li><strong>00_quick_start</strong>：快速入门示例，基于 <code>dnn</code> API，用mobilenetv1进行单张图片模型推理和结果解析。</li>
<li><strong>01_api_tutorial</strong>： <code>dnn</code> API使用教学代码， 包括 <strong>mem</strong>， <strong>model</strong>， <strong>resize</strong>， <strong>roi_infer</strong> 和 <strong>tensor</strong> 五部分。</li>
<li><strong>02_advanced_samples</strong>：特殊功能示例，包括 <strong>custom_identity</strong>， <strong>multi_input</strong>， <strong>multi_model_batch</strong> 和 <strong>nv12_batch</strong> 功能。。</li>
<li><strong>03_misc</strong>：非NV12输入模型的杂项示例。</li>
<li><strong>xj3</strong>：RDK X3开发板示例运行脚本，预置了数据和相关模型。</li>
<li><strong>ultra</strong>: RDK Ultra开发板示例运行脚本，预置了数据和相关模型。</li>
<li><strong>build_xj3.sh</strong>：RDK X3程序一键编译脚本。</li>
<li><strong>build_ultra.sh</strong>：RDK Ultra程序一键编译脚本。</li>
<li><strong>deps/deps_gcc9.3</strong>：示例代码所需要的三方依赖, 用户在开发自己代码程序的时候可以根据实际情况替换或者裁剪。</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>私有模型上板运行，请参考 <code>00_quick_start/src/run_mobileNetV1_224x224.cc</code> 示例代码流程进行代码重写，编译成功后可以在开发板上测试验证！</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="环境构建-4">环境构建<a href="#环境构建-4" class="hash-link" aria-label="环境构建的直接链接" title="环境构建的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="开发板准备-4">开发板准备<a href="#开发板准备-4" class="hash-link" aria-label="开发板准备的直接链接" title="开发板准备的直接链接">​</a></h5>
<ol>
<li>
<p>拿到开发板后，请将开发版镜像更新到最新版本，升级方法请参考<a href="/rdk_doc/Quick_start/install_os/rdk_ultra"><strong>系统更新</strong></a> 章节内容。</p>
</li>
<li>
<p>确保本地开发机和开发板可以远程连接。</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="编译-2">编译<a href="#编译-2" class="hash-link" aria-label="编译的直接链接" title="编译的直接链接">​</a></h5>
<p>编译需要当前环境安装好交叉编译工具： <code>aarch64-linux-gnu-g++</code> ， <code>aarch64-linux-gnu-gcc</code>。 请使用D-Robotics 提供的开发机Docker镜像，直接进行编译使用。开发机Docker环境的获取及使用方法，请阅读<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config"><strong>环境安装</strong></a> 章节内容；
根据自身使用的开发板情况，请使用horizon_runtime_sample/code目录下的 <code>build_xj3.sh</code> 或 <code>build_ultra.sh</code> 脚本，即可一键编译开发板环境下的可执行程序，可执行程序和对应依赖会自动复制到 <code>xj3/script</code> 目录下的 <code>aarch64</code> 目录下 或 <code>ultra/script</code> 目录下的 <code>aarch64</code> 目录下。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>工程通过获取环境变量 <code>LINARO_GCC_ROOT</code> 来指定交叉编译工具的路径，用户使用之前可以检查本地的环境变量是否为目标交叉编译工具。
如果需要指定交叉编译工具路径，可以设置环境变量 <code>LINARO_GCC_ROOT</code> , 或者直接修改脚本 <code>build_xj3.sh</code> 或 <code>build_ultra.sh</code>，指定变量 <code>CC</code> 和 <code>CXX</code>。</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  export CC=${GCC_ROOT}/bin/aarch64-linux-gnu-gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export CXX=${GCC_ROOT}/bin/aarch64-linux-gnu-g++</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="示例使用-2">示例使用<a href="#示例使用-2" class="hash-link" aria-label="示例使用的直接链接" title="示例使用的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="basic_samples-示例-2">basic_samples 示例<a href="#basic_samples-示例-2" class="hash-link" aria-label="basic_samples 示例的直接链接" title="basic_samples 示例的直接链接">​</a></h5>
<p>模型推理​示例脚本主要在 xj3/script 和 xj3/script_x86 目录下，编译程序后目录  结构如下:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK X3 使用脚本信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_mobilenetV1.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── resize_bgr.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── resize_y.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── roi_infer.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── sys_mem.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── tensor.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_resnet50_feature.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── aarch64                        # 编译产生可执行程序及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── model_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── resize_bgr_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── resize_y_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── roi_infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_custom_op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_lenet_gray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_mobileNetV1_224x224</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_multi_model_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_resnet_feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── sys_mem_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── tensor_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── libdnn.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── libhbrt_bernoulli_aarch64.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       └── libopencv_world.so.3.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK Ultra 使用脚本信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├─script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 00_quick_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_mobilenetV1.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 01_api_tutorial</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── roi_infer.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── sys_mem.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── tensor.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 02_advanced_samples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── run_multi_input.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_nv12_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── 03_misc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── run_resnet50_feature.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── aarch64                        # 编译产生可执行程序及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── model_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── roi_infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_custom_op</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_lenet_gray</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_mobileNetV1_224x224</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_multi_input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_multi_model_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_nv12_batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── run_resnet_feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── sys_mem_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── tensor_example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── libdnn.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       ├── libhbrt_bayes_aarch64.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │       └── libopencv_world.so.3.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li>model文件夹下包含模型的路径，其中 <code>runtime</code> 文件夹为软链接，链接路径为 <code>../../../model_zoo/runtime/horizon_runtime_sample</code> ，可直接找到交付包中的模型路径</li>
<li>板端运行环境需要将模型放至 <code>model</code> 文件夹下</li>
</ul></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="quick_start-2">quick_start<a href="#quick_start-2" class="hash-link" aria-label="quick_start的直接链接" title="quick_start的直接链接">​</a></h5>
<p>00_quick_start 目录下的是模型推理的快速开始示例：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  00_quick_start/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_mobilenetV1.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>run_mobilenetV1.sh</code> ：该脚本实现使用mobilenetv1模型读取单张图片进行推理的示例功能。</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="api_tutorial-2">api_tutorial<a href="#api_tutorial-2" class="hash-link" aria-label="api_tutorial的直接链接" title="api_tutorial的直接链接">​</a></h5>
<p>01_api_tutorial 目录下的示例，用于介绍如何使用嵌入式API。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── resize_bgr.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── resize_y.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── roi_infer.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── sys_mem.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── tensor.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>model.sh</code> ：该脚 本主要实现读取模型信息的功能。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh model.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/01_api_tutorial# sh model.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/model_example --model_file_list=../../model/runtime/mobilenetv1/mobilenetv1_nv12_hybrid_horizonrt.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 24638 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 04:19:27.245879 24638 model_example.cc:104] model count:1, model[0]: mobilenetv1_nv12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 04:19:27.246064 24638 model_example.cc:112] hbDNNGetModelHandle [mobilenetv1_nv12] success!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 04:19:27.246139 24638 model_example.cc:189] [mobilenetv1_nv12] Model Info:  input num: 1, input[0] validShape: ( 1, 3, 224, 224 ), alignedShape: ( 1, 4, 224, 224 ), tensorLayout: 2, tensorType: 1, output num: 1, output[0] validShape: ( 1, 1000, 1, 1 ), alignedShape: ( 1, 1000, 1, 1 ), tensorLayout: 2, tensorType: 13</span><br></span></code></pre></div></div>
<ul>
<li><code>resize_bgr.sh</code> ：该脚本主要引导如何使用 <code>hbDNNResize</code> 这个API，
示例实现的代码功能是将一张1352x900大小的图片，截取图片中坐标为[5，19，340，343]的部分，然后resize到402x416并保存下来。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh resize_bgr.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/01_api_tutorial# sh resize_bgr.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/resize_bgr_example --image_file=../../data/det_images/kite.jpg --resize_height=416 --resize_width=402 --resized_image=./resize_bgr.jpg --crop_x1=5 --crop_x2=340 --crop_y1=19 --crop_y2=343</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 24975 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:58:03.327212 24975 resize_bgr_example.cc:116] Original shape: 1352x900 ,dest shape:402x416 ,aligned shape:402x416</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:58:03.328739 24975 resize_bgr_example.cc:139] resize success!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:58:03.335835 24975 resize_bgr_example.cc:143] wait task done finished!</span><br></span></code></pre></div></div>
<p>执行成功后，当前目录会成功保存名称为resize_bgr.jpg的图片。</p>
<ul>
<li><code>resize_y.sh</code> ：该脚本主要引导如何使用 <code>hbDNNResize</code> 这个API，示例代码实现的功能是将一张图片resize到416x402。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh resize_y.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/01_api_tutorial# sh resize_y.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/resize_y_example --image_file=../../data/det_images/kite.jpg --resize_height=416 --resize_width=402 --resized_image=./resize_y.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 24992 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:59:36.887241 24992 resize_y_example.cc:101] Original shape: 1352x900 ,dest shape:402x416 ,aligned shape:402x416</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:59:36.888770 24992 resize_y_example.cc:119] resize success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:59:36.891711 24992 resize_y_example.cc:123] wait resize success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 06:59:36.891798 24992 resize_y_example.cc:129] spent time: 0.003463</span><br></span></code></pre></div></div>
<p>​执行成功后，当前目录会成功保存名称为resize_y.jpg的图片。</p>
<ul>
<li>
<p><code>roi_infer.sh</code> ： 该脚本主要引导如何使用 <code>hbDNNRoiInfer</code> 这个API，示例代码实现的功能是将一张图片resize到模型输入大小，转为nv12数据，并给定roi框进行模型推理（infer）。
使用的时候，直接进入 01_api_tutorial 目录，然后直接执行 <code>sh roi_infer.sh</code> 即可。</p>
</li>
<li>
<p><code>sys_mem.sh</code> ：该脚本主要引导如何使用 <code>hbSysAllocMem</code>、 <code>hbSysFlushMem</code> 和 <code>hbSysFreeMem</code> 这几个API。使用的时候，直接进入 01_api_tutorial 目录，执行 <code>sh sys_mem.sh</code> 即可。</p>
</li>
<li>
<p><code>tensor.sh</code> ：该脚本主要引导如何准备模型输入和输出的tensor。
使用的时候，直接进入 01_api_tutorial 目录，执行 <code>sh tensor.sh</code> 即可，如下所示：</p>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/01_api_tutorial# sh tensor.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:0, Tensor layout: 2, shape:1x1x721x1836, aligned shape:1x1x721x1840</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:1, Tensor layout: 2, shape:1x3x773x329, aligned shape:1x3x773x336</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:2, Tensor layout: 2, shape:1x3x108x1297, aligned shape:1x3x108x1312</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:5, Tensor layout: 2, shape:1x3x858x477, aligned shape:1x3x858x477</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:5, Tensor layout: 0, shape:1x920x102x3, aligned shape:1x920x102x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:4, Tensor layout: 2, shape:1x3x723x1486, aligned shape:1x3x723x1486</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:4, Tensor layout: 0, shape:1x372x366x3, aligned shape:1x372x366x3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:3, Tensor layout: 2, shape:1x3x886x291, aligned shape:1x3x886x291</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Tensor data type:3, Tensor layout: 0, shape:1x613x507x3, aligned shape:1x613x507x3</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="advanced_samples-2">advanced_samples<a href="#advanced_samples-2" class="hash-link" aria-label="advanced_samples的直接链接" title="advanced_samples的直接链接">​</a></h5>
<p>02_advanced_samples 目录下的示例，用于介绍自定义算子特殊功能的使用。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_multi_model_batch.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>custom_arm_op_custom_identity.sh</code> ：该脚本主要实现自定义算子模型推理功能，
使用的时候，进入 02_advanced_samples 目录, 然后直接执行 <code>sh custom_arm_op_custom_identity.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/02_advanced_samples# sh custom_arm_op_custom_identity.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_custom_op --model_file=../../model/runtime/custom_op/custom_op_featuremap.bin --input_file=../../data/custom_identity_data/input0.bin,../../data/custom_identity_data/input1.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 30421 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.172068 30421 main.cpp:212] hbDNNRegisterLayerCreator success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.172335 30421 main.cpp:217] hbDNNRegisterLayerCreator success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.3.1)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.15.3.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [DNN] Runtime version = 1.15.2_(3.15.3 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [A][DNN][packed_model.cpp:217](1563865572232) [HorizonRT] The model builder version = 1.13.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.240696 30421 main.cpp:232] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.240784 30421 main.cpp:239] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.240819 30421 main.cpp:245] hbDNNGetInputCount success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file length: 602112</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    file length: 602112</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.243616 30421 main.cpp:268] hbDNNGetOutputCount success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.244102 30421 main.cpp:297] hbDNNInfer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:12.257903 30421 main.cpp:302] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0723 15:06:14.277941 30421 main.cpp:306] write output tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  模型的第一个输出数据保存至 ``output0.txt`` 文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li><code>run_multi_model_batch.sh</code> ：该脚本主要实现多个小模型批量推理功能，
使用的时候，进入 02_advanced_samples 目录, 然后直接执行 <code>sh run_multi_model_batch.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    root@x3sdbx3-hynix2G-3200:/userdata/chaoliang/xj3/script/02_advanced_samples# sh run_multi_model_batch.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_multi_model_batch --model_file=../../model/runtime/googlenet/googlenet_224x224_nv12.bin,../../model/runtime/mobilenetv2/mobilenetv2_224x224_nv12.bin --input_file=../../data/cls_images/zebra_cls.jpg,../../data/cls_images/zebra_cls.jpg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 17060 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.13.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.1.1)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.249785 17060 main.cpp:119] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.250029 17060 main.cpp:127] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.250071 17060 main.cpp:141] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.283633 17060 main.cpp:155] read image to nv12 success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.284270 17060 main.cpp:172] prepare input tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.284456 17060 main.cpp:184] prepare output tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.285344 17060 main.cpp:218] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.296559 17060 main.cpp:223] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.296701 17060 main.cpp:228] googlenet class result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.296805 17060 main.cpp:232] mobilenetv2 class result id: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0317 12:37:18.296887 17060 main.cpp:236] release task success</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="misc-2">misc<a href="#misc-2" class="hash-link" aria-label="misc的直接链接" title="misc的直接链接">​</a></h5>
<p>03_misc 目录下的示例，用于介绍非nv12输入模型的使用。其目录包含以下脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ├── run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── run_resnet50_feature.sh</span><br></span></code></pre></div></div>
<ul>
<li><code>run_lenet.sh</code> ：该脚本主要实现Y数据输入的lenet模型推理功能，
使用的时候，进入 03_misc 目录, 然后直接执行 <code>sh run_lenet.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/03_misc# sh run_lenet.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_lenet_gray --model_file=../../model/runtime/lenet_gray/lenet_gray_hybrid_horizonrt.bin --data_file=../../data/misc_data/7.bin --image_height=28 --image_width=28 --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 25139 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.507514 25139 run_lenet_gray.cc:145] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.507737 25139 run_lenet_gray.cc:153] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.507771 25139 run_lenet_gray.cc:160] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.508070 25139 run_lenet_gray.cc:176] prepare y tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.508178 25139 run_lenet_gray.cc:189] prepare tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.509909 25139 run_lenet_gray.cc:200] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510721 25139 run_lenet_gray.cc:205] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510790 25139 run_lenet_gray.cc:210] task post process finished</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510832 25139 run_lenet_gray.cc:217] TOP 0 result id: 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510857 25139 run_lenet_gray.cc:217] TOP 1 result id: 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510879 25139 run_lenet_gray.cc:217] TOP 2 result id: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510903 25139 run_lenet_gray.cc:217] TOP 3 result id: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:23:35.510927 25139 run_lenet_gray.cc:217] TOP 4 result id: 2</span><br></span></code></pre></div></div>
<ul>
<li><code>run_resnet50_feature.sh</code> ：该脚本主要实现feature数据输入的resnet50模型推理功能，示例代码对feature数据做了quantize和padding以满足模型的输入条件，然后输入到模型进行infer。
使用的时候，进入 03_misc 目录, 然后直接执行 <code>sh run_resnet50_feature.sh</code> 即可，如下所示：</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例日志都是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板日志信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    /userdata/ruxin.song/xj3/script/03_misc# sh run_resnet50_feature.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ../aarch64/bin/run_resnet_feature --model_file=../../model/runtime/resnet50_feature/resnet50_feature_hybrid_horizonrt.bin --data_file=../../data/misc_data/np_0 --top_k=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0000 00:00:00.000000 25155 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HBRT] set log level as 0. version = 3.12.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BPU_PLAT]BPU Platform Version(1.2.2)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [HorizonRT] The model builder version = 1.3.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.300466 25155 run_resnet_feature.cc:136] hbDNNInitializeFromFiles success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.300708 25155 run_resnet_feature.cc:144] hbDNNGetModelNameList success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.300741 25155 run_resnet_feature.cc:151] hbDNNGetModelHandle success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.302760 25155 run_resnet_feature.cc:166] prepare feature tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.302919 25155 run_resnet_feature.cc:176] prepare tensor success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.304678 25155 run_resnet_feature.cc:187] infer success</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373052 25155 run_resnet_feature.cc:192] task done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373328 25155 run_resnet_feature.cc:197] task post process finished</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373374 25155 run_resnet_feature.cc:204] TOP 0 result id: 74</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373399 25155 run_resnet_feature.cc:204] TOP 1 result id: 815</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373422 25155 run_resnet_feature.cc:204] TOP 2 result id: 73</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373445 25155 run_resnet_feature.cc:204] TOP 3 result id: 78</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    I0108 07:25:41.373468 25155 run_resnet_feature.cc:204] TOP 4 result id: 72</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="辅助工具和常用操作-4">辅助工具和常用操作<a href="#辅助工具和常用操作-4" class="hash-link" aria-label="辅助工具和常用操作的直接链接" title="辅助工具和常用操作的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="日志-2">日志<a href="#日志-2" class="hash-link" aria-label="日志的直接链接" title="日志的直接链接">​</a></h5>
<p>本章节主要包括 <code>示例日志</code> 和 <code>模型推理 DNN API日志</code> 两部分。
其中示例日志是指交付包示例代码中的应用日志；模型推理 dnn API日志是指嵌入式dnn库中的日志。用户根据不同的需求可以获取不同的日志信息。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例日志-3">示例日志<a href="#示例日志-3" class="hash-link" aria-label="示例日志的直接链接" title="示例日志的直接链接">​</a></h5>
<p>示例日志主要采用glog中的vlog，basic_samples参考  示例中，日志内容会全部输出。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理-dnn-api日志-2">模型推理 DNN API日志<a href="#模型推理-dnn-api日志-2" class="hash-link" aria-label="模型推理 DNN API日志的直接链接" title="模型推理 DNN API日志的直接链接">​</a></h5>
<p>关于模型推理 DNN API日志的配置，请阅读<a href="/rdk_doc/04_Algorithm_Application/02_cdev_dnn_api/cdev_dnn_api.md">《模型推理DNN API使用说明》</a> 文档中的 <code>配置信息</code> 一节内容。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="公版模型性能精度测评说明-2">公版模型性能精度测评说明<a href="#公版模型性能精度测评说明-2" class="hash-link" aria-label="公版模型性能精度测评说明的直接链接" title="公版模型性能精度测评说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="评测方法说明-1">评测方法说明<a href="#评测方法说明-1" class="hash-link" aria-label="评测方法说明的直接链接" title="评测方法说明的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="简介-1">简介<a href="#简介-1" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h5>
<p>本章节介绍公版模型精度性能评测 ai_benchmark 示例包的具体用法， 示例包中预置了源码、可执行程序和评测脚本，开发者可以直接在D-Robotics 开发板上体验并基于这些示例进行嵌入式应用开发，降低开发门槛。</p>
<p>示例包提供常见的分类、检测和分割模型的性能评测和精度评测示例，详细内容请阅读下文。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>公版模型精度性能评测 ai_benchmark 示例包获取，请参考<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config#deliverables_instructions">《交付物说明》</a>。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例代码包结构-2">示例代码包结构<a href="#示例代码包结构-2" class="hash-link" aria-label="示例代码包结构的直接链接" title="示例代码包结构的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ai_benchmark/code                     # 示例源码文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── build_ptq_xj3.sh                  # RDK X3 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── build_ptq_ultra.sh                # RDK Ultra 使用</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── deps/deps_gcc9.3                  # 第三方依赖库，gcc9.3为deps_gcc9.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── aarch64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── vdsp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── include                           # 源码头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── base</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── src                               # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── simple_example.cc             # 示例主程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── utils</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_benchmark/xj3                      # 示例包运行环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── ptq                               # PTQ方案模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data                          # 模型精度评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── mini_data                     # 模型性能评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cifar10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── coco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── culane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── flyingchairs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── imagenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── kitti3d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── mot17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── nuscenes_lidar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── voc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── model                         # PTQ方案nv12模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── runtime -&gt; ../../../../model_zoo/runtime/ai_benchmark/ptq   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── script                        # 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── aarch64                   # 编译产生可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── classification            # 分类模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── googlenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── mobilenetv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── resnet18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── config                    # 模型推理配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── data_name_list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── detection                 # 检测模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── centernet_resnet50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientdetd0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── ssd_mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov2_darknet19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov3_darknet53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── yolov5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── segmentation              # 分割模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── fastscnn_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── unet_mobilenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── base_config.sh            # 基础配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── tools                         # 精度评测工具</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── python_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_benchmark/ultra                       # 示例包运行环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── ptq                               # PTQ方案模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── data                          # 模型精度评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── mini_data                     # 模型性能评测数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cifar10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── coco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── culane</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── flyingchairs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── imagenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── kitti3d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── mot17</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── nuscenes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── nuscenes_lidar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── voc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── model                         # PTQ方案nv12模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── runtime -&gt; ../../../../model_zoo/runtime/ai_benchmark/ptq   # 软链接指向OE包中的模型，板端运行环境需要自行指定模型路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── script                        # 执行脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── aarch64                   # 编译产生可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── classification            # 分类模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnasnet_m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnasnet_s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── efficientnet_lite4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── googlenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── mobilenetv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── resnet18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── vargconvnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── config                    # 模型推理配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── detection                 # 检测模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── centernet_resnet101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── preq_qat_fcos_efficientnetb3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── ssd_mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov2_darknet19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov3_darknet53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── yolov3_vargdarknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── yolov5x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── segmentation              # 分割模型示例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── deeplabv3plus_efficientnetm1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   ├── deeplabv3plus_efficientnetm2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   │   └── fastscnn_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── env.sh                    # 基础环境脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── tools                         # 精度评测工具</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             ├── python_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             └── README.md</span><br></span></code></pre></div></div>
<ul>
<li><strong>code</strong>：该目录内是评测程序的源码，用来进行模型性能和精度评测。</li>
<li><strong>xj3</strong>： 提供了已经编译好的应用程序，以及各种评测脚本，用来测试多种模型在D-Robotics BPU上运行的性能，精度等(<strong>RDK X3</strong> 使用)。</li>
<li><strong>ultra</strong>： 提供了已经编译好的应用程序，以及各种评测脚本，用来测试多种模型在D-Robotics BPU上运行的性能，精度等(<strong>RDK Ultra</strong> 使用)。</li>
<li><strong>build_ptq_xj3.sh</strong>：开发板程序一键编译脚本(<strong>RDK X3</strong> 使用)。</li>
<li><strong>build_ptq_ultra.sh</strong>：开发 板程序一键编译脚本(<strong>RDK Ultra</strong> 使用)。</li>
<li><strong>deps/deps_gcc9.3</strong>：示例代码所需要的依赖，主要如下所示:</li>
</ul>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  gflags  glog  hobotlog nlohmann opencv  rapidjson</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例模型-2">示例模型<a href="#示例模型-2" class="hash-link" aria-label="示例模型的直接链接" title="示例模型的直接链接">​</a></h5>
<p>我们提供了开源的模型库，里面包含常用的分类、检测和分割模型，模型的命名规则为：<code>{model_name}_{backbone}_{input_size}_{input_type}</code>，开发者可以直接使用。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>以下表格中的bin模型都是通过 horizon_model_convert_sample 模型转换示例包转换编译出来的，请阅读<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config#deliverables_instructions">《交付物说明》</a>  章节内容进行获取。</p></div></div>
<table><thead><tr><th>MODEL</th><th>MODEL NAME</th></tr></thead><tbody><tr><td>centernet_resnet101</td><td>centernet_resnet101_512x512_nv12.bin</td></tr><tr><td>deeplabv3plus_efficientnetb0</td><td>deeplabv3plus_efficientnetb0_1024x2048_nv12.bin</td></tr><tr><td>deeplabv3plus_efficientnetm1</td><td>deeplabv3plus_efficientnetm1_1024x2048_nv12.bin</td></tr><tr><td>efficientnasnet_m</td><td>efficientnasnet_m_300x300_nv12.bin</td></tr><tr><td>efficientnet_lite4</td><td>efficientnet_lite4_300x300_nv12.bin</td></tr><tr><td>fastscnn_efficientnetb0</td><td>fastscnn_efficientnetb0_1024x2048_nv12.bin</td></tr><tr><td>googlenet</td><td>googlenet_224x224_nv12.bin</td></tr><tr><td>mobilenetv1</td><td>mobilenetv1_224x224_nv12.bin</td></tr><tr><td>mobilenetv2</td><td>mobilenetv2_224x224_nv12.bin</td></tr><tr><td>preq_qat_fcos_efficientnetb0</td><td>fcos_efficientnetb0_512x512_nv12.bin</td></tr><tr><td>preq_qat_fcos_efficientnetb2</td><td>fcos_efficientnetb2_768x768_nv12.bin</td></tr><tr><td>resnet18</td><td>resnet18_224x224_nv12.bin</td></tr><tr><td>ssd_mobilenetv1</td><td>ssd_mobilenetv1_300x300_nv12.bin</td></tr><tr><td>vargconvnet</td><td>vargconvnet_224x224_nv12.bin</td></tr><tr><td>yolov3_darknet53</td><td>yolov3_darknet53_416x416_nv12.bin</td></tr><tr><td>yolov5s</td><td>yolov5s_672x672_nv12.bin</td></tr><tr><td>yolov5x</td><td>yolov5x_672x672_nv12.bin</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="公共数据集-2">公共数据集<a href="#公共数据集-2" class="hash-link" aria-label="公共数据集的直接链接" title="公共数据集的直接链接">​</a></h5>
<p>测评示例中用到的数据集主要有VOC数据集、COCO数据集、ImageNet、Cityscapes数据集、FlyingChairs数据集、KITTI数据集、Culane数据集、Nuscenes数据集和Mot17数据集。</p>
<p>请在linux环境下进行下载，获取方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  VOC：http://host.robots.ox.ac.uk/pascal/VOC/  （使用VOC2012版本）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  COCO：https://cocodataset.org/#download</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ImageNet：https://www.image-net.org/download.php</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cityscapes：https://github.com/mcordts/cityscapesScripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FlyingChairs：https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  KITTI3D：https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  CULane ：https://xingangpan.github.io/projects/CULane.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  nuScenes：https://www.nuscenes.org/nuscenes#download</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  mot17：https://opendatalab.com/MOT17</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="环境构建-5">环境构建<a href="#环境构建-5" class="hash-link" aria-label="环境构建的直接链接" title="环境构建的直接链接">​</a></h5>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="开发板准备-5">开发板准备<a href="#开发板准备-5" class="hash-link" aria-label="开发板准备的直接链接" title="开发板准备的直接链接">​</a></h5>
<ol>
<li>
<p>拿到开发板后，请将开发版镜像更新到最新版本，升级方法请参考<a href="/rdk_doc/Quick_start/install_os/rdk_ultra"><strong>安装系统</strong></a> 章节内容。</p>
</li>
<li>
<p>确保本地开发机和开发板可以远程连接。</p>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="编译环境准备-2">编译环境准备<a href="#编译环境准备-2" class="hash-link" aria-label="编译环境准备的直接链接" title="编译环境准备的直接链接">​</a></h5>
<p>编译需要当前环境安装好交叉编译工具 <code>gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu</code>。请使用D-Robotics 提供的开发机Docker镜像，直接进行编译使用。开发机Docker环境的获取及使用方法，请阅读<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/environment_config"><strong>环境安装</strong></a> 章节内容；
请使用code目录下的 <code>build_ptq_xj3.sh</code> 或 <code>build_ptq_ultra.sh</code> 脚本，即可一键编译开发板环境下的可执行程序，可执行程序和对应依赖会自动复制到 <code>xj3/ptq/script</code> 目录下的 <code>aarch64</code> 目录下 或 <code>ultra/ptq/script</code> 目录下的 <code>aarch64</code> 目录下。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>需要注意 <code>build_ptq_xj3.sh</code> 和 <code>build_ptq_ultra.sh</code> 脚本里指定的交叉编译工具链的位置是 <code>/opt</code> 目录下，用户如果安装在其他位置，可以手动修改下脚本。</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  export CC=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export CXX=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-g++</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="测评示例使用说明-2">测评示例使用说明<a href="#测评示例使用说明-2" class="hash-link" aria-label="测评示例使用说明的直接链接" title="测评示例使用说明的直接链接">​</a></h5>
<p>评测示例脚本主要在 <code>script</code> 和 <code>tools</code> 目录下。 script是开发板上运行的评测脚本，包括常见分类，检测和分割模型。每个模型下面有三个脚本，分别表示：</p>
<ul>
<li>fps.sh：利用多线程调度实现fps统计，用户可以根据需求自由设置线程数。</li>
<li>latency.sh：实现单帧延迟统计（一个线程，单帧）。</li>
<li>accuracy.sh：用于精度评测。</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  script:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── aarch64             # 编译产生的可执行文件及依赖库</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── lib</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── base_config.sh      # 基础配置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── config              # image_name配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── data_name_list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   ├── coco_detlist.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   |   ├── imagenet.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   |   └── voc_detlist.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── classification      # 分类模型评测</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── efficientnet_lite0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── fps.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── latency.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_accuracy.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_fps.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── workflow_latency.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── .....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── resnet18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── detection           # 检测模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   ├── centernet_resnet50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── fps.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── latency.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_accuracy.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   ├── workflow_fps.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   │   └── workflow_latency.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── yolov2_darknet19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── yolov3_darknet53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   ├── ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── efficientdetd0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── segmentation       # 分割模型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── fps.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── latency.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── workflow_accuracy.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   ├── workflow_fps.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      │   └── workflow_latency.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ├── fastscnn_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── unet_mobilenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>tools目录下是精度评测需要的脚本。主要包括 <code>python_tools</code> 下的精度计算脚本。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  tools:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── accuracy_tools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cityscapes_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── cls_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── coco_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── coco_det_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── config.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── parsing_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── voc_det_eval.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── voc_metric.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>评测前需要执行以下命令，将 <code>ptq</code> 目录拷贝到开发板上，然后将 <code>model_zoo/runtime</code> 拷贝到 <code>ptq/model</code> 目录下。</p></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  scp -r ai_toolchain_package/Ai_Toolchain_Package-release-vX.X.X-OE-vX.X.X/ai_benchmark/xj3/ptq root@192.168.1.10:/userdata/ptq/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  scp -r model_zoo/runtime root@192.168.1.10:/userdata/ptq/model/</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="性能评测-2">性能评测<a href="#性能评测-2" class="hash-link" aria-label="性能评测的直接链接" title="性能评测的直接链接">​</a></h5>
<p>性能评测分为latency和fps两方面。</p>
<ul>
<li>测评脚本使用说明</li>
</ul>
<p>进入到需要评测的模型目录下，执行 <code>sh latency.sh</code> 即可测试出单帧延迟。如下图所示：</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 02:35:07.041095 39124 output_plugin.cc:80]  Infer latency:  [avg:  13.124ms,  max:  13.946ms,  min:  13.048ms], Post process latency: [avg:  3.584ms,  max:  3.650ms,  min:  3.498ms].</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>infer</code> 表示模型推理耗时。</li>
<li><code>Post process</code> 表示后处理耗时。</li>
</ul></div></div>
<p>进入到需要评测的模型目录下执行 <code>sh fps.sh</code> 即可测试出帧率。如下图所示：</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 02:35:00.044417 39094 output_plugin.cc:109]  Throughput: 176.39fps      # 模型帧率</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>该功能采用多线程并发方式，旨在让模型可以在BPU上达到极致的性能。由于多线程并发及数据采样的原因，在程序启动阶段帧率值会较低，之后帧率会上升并逐渐趋于稳定，帧率的浮动范围控制在0.5%之内。</p></div></div>
<ul>
<li>命令行参数说明</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<p><code>fps.sh</code> 脚本内容如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source ../../base_config.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export SHOW_FPS_LOG=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export STAT_CYCLE=10                             # 设置环境变量，FPS 统计周期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${app} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --config_file=workflow_fps.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log_level=1</span><br></span></code></pre></div></div>
<p><code>latency.sh</code> 脚本内容如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  source ../../base_config.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export SHOW_LATENCY_LOG=1                            # 设置环境变量，打印 LATENCY 级别log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  export STAT_CYCLE=5                                  # 设置环境变量，LATENCY 统计周期</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${app} \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --config_file=workflow_latency.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --log_level=1</span><br></span></code></pre></div></div>
<ul>
<li>配置文件说明</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>注意：max_cache参数生效时会预处理图片并读取到内存中，为保障您的程序稳定运行，请不要设置过大的值，建议您的数值设置不超过30。</p></div></div>
<p>以fcos_efficientnetb0模型为例，workflow_fps.json 配置文件内容如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;input_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;input_type&quot;: &quot;image&quot;,                                    # 输入数据格式，支持图像或者bin文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;height&quot;: 512,                                            # 输入数据高度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;width&quot;: 512,                                             # 输入数据宽度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;data_type&quot;: 1,                                           # 输入数据类型：HB_DNN_IMG_TYPE_NV12</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;image_list_file&quot;: &quot;../../../mini_data/coco/coco.lst&quot;,    # 预处理数据集lst文件所在路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;need_pre_load&quot;: true,                                    # 是否使用预加载方式读取数据集</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;limit&quot;: 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;need_loop&quot;: true,                                        # 是否循环读取数据进行评测</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;max_cache&quot;: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;output_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_type&quot;: &quot;image&quot;,                                   # 可视化输出数据类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;image_list_enable&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;in_order&quot;: false                                         # 是否按顺序输出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;workflow&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_type&quot;: &quot;InferMethod&quot;,                           # Infer推理方式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unique_name&quot;: &quot;InferMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;core&quot;: 0,                                            # 推理core id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;model_file&quot;: &quot;../../../model/runtime/fcos_efficientnetb0/fcos_efficientnetb0_512x512_nv12.bin&quot; # 模型文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;thread_count&quot;: 4,                                      # 后处理线程数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_type&quot;: &quot;PTQFcosPostProcessMethod&quot;,              # 后处理方法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unique_name&quot;: &quot;PTQFcosPostProcessMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_config&quot;: {                                      # 后处理参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;strides&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            32,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;class_num&quot;: 80,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;score_threshold&quot;: 0.5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;topk&quot;: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;det_name_list&quot;: &quot;../../config/data_name_list/coco_detlist.list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre></div></div>
<p>workflow_latency.json 如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;input_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;input_type&quot;: &quot;image&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;height&quot;: 512,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;width&quot;: 512,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;data_type&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;image_list_file&quot;: &quot;../../../mini_data/coco/coco.lst&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;need_pre_load&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;limit&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;need_loop&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;max_cache&quot;: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;output_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;output_type&quot;: &quot;image&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;image_list_enable&quot;: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;workflow&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_type&quot;: &quot;InferMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unique_name&quot;: &quot;InferMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;core&quot;: 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;model_file&quot;: &quot;../../../model/runtime/fcos_efficientnetb0/fcos_efficientnetb0_512x512_nv12.bin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;thread_count&quot;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_type&quot;: &quot;PTQFcosPostProcessMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;unique_name&quot;: &quot;PTQFcosPostProcessMethod&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;method_config&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;strides&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            8,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            32,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            64,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;class_num&quot;: 80,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;score_threshold&quot;: 0.5,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;topk&quot;: 1000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;det_name_list&quot;: &quot;../../config/data_name_list/coco_detlist.list&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="精度评测-2">精度评测<a href="#精度评测-2" class="hash-link" aria-label="精度评测的直接链接" title="精度评测的直接链接">​</a></h5>
<p>模型精度评测分为四步：</p>
<ol>
<li>数据预处理。</li>
<li>数据挂载。</li>
<li>模型推理。</li>
<li>精度计算。</li>
</ol>
<ul>
<li>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="数据预处理-2">数据预处理<a href="#数据预处理-2" class="hash-link" aria-label="数据预处理的直接链接" title="数据预处理的直接链接">​</a></h5>
</li>
</ul>
<p>对于PTQ模型：数据预处理需要在x86开发机环境下运行 <code>hb_eval_preprocess</code> 工具，对数据集进行预处理。
所谓预处理是指图片数据在送入模型之前的特定处理操作，例如：图片resize、crop和padding等。
该工具集成于开发机模型转换编译的环境中，原始数据集经过工具预处理之后，会生成模型对应的前处理二进制文件.bin文件集.
直接运行 <code>hb_eval_preprocess --help</code> 可查看工具使用规则。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><ol>
<li>关于 <code>hb_eval_preprocess</code> 工具命令行参数，可键入 <code>hb_eval_preprocess -h</code>， 或查看 PTQ量化原理及步骤说明的
<a href="/rdk_doc/Advanced_development/toolchain_development/intermediate/ptq_process#hb_eval_preprocess.md"><strong>hb_eval_preprocess工具</strong></a> 一节内容。</li>
</ol></div></div>
<p>下面将详细介绍示例包中每一个模型对应的数据集，以及对应数据集的预处理操作：</p>
<ul>
<li><code>VOC数据集</code> ：该数据集主要用于ssd_mobilenetv1模型的评测，
其目录结构如下，示例中主要用到 <code>Main</code> 文件下的val.txt文件， <code>JPEGImages</code> 中的源图片和 <code>Annotations</code> 中的标注数据：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── VOCdevkit                  # 根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── VOC2012                # 不同年份的数据集，这里只下载了2012的，还有2007等其它年份的</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── Annotations        # 存放xml文件，与JPEGImages中的图片一一对应，解释图片的内容等等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── ImageSets          # 该目录下存放的都是txt文件，txt文件中每一行包含一个图片的名称，末尾会加上±1表示正负样本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Action</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Layout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   ├── Main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          │   └── Segmentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── JPEGImages         # 存放源图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── SegmentationClass  # 存放的是图片，语义分割相关</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── SegmentationObject # 存放的是图片，实例分割相关</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m ssd_mobilenetv1 -i VOCdevkit/VOC2012/JPEGImages -v VOCdevkit/VOC2012/ImageSets/Main/val.txt -o ./pre_ssd_mobilenetv1</span><br></span></code></pre></div></div>
<ul>
<li><code>COCO数据集</code> ：该数据集主要用于yolov2_darknet19、yolov3_darknet53、yolov5s、efficientdetd0、fcos_efficientnetb0和centernet_resnet50等检测模型的评测，
其目录如下，示例中主要用到 <code>annotations</code> 文件夹下的instances_val2017.json标注文件和 <code>images</code> 中的图片：</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── annotations    # 存放标注数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── images         # 存放源图片</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m model_name -i coco/coco_val2017/images -o ./pre_model_name</span><br></span></code></pre></div></div>
<ul>
<li><code>ImageNet数据集</code> ：该数据集主要用于EfficientNet_lite0、EfficientNet_Lite1、EfficientNet_Lite2、EfficientNet_Lite3、EfficientNet_Lite4、MobileNet、GoogleNet、ResNet等分类模型的评测，
示例中主要用到了标注文件val.txt 和 <code>val</code> 目录中的源图片:</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── val.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── val</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m model_name -i imagenet/val -o ./pre_model_name</span><br></span></code></pre></div></div>
<ul>
<li><code>Cityscapes数据集</code> ：该数据集用于deeplabv3plus_efficientnetb0、deeplabv3plus_efficientnetm1、deeplabv3plus_efficientnetm2和fastscnn_efficientnetb0等分割模型的评测。
示例中主要用到了 <code>./gtFine/val</code> 中的标注文件和 <code>./leftImg8bit/val</code> 中的源图片。</li>
</ul>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ├── gtFine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │   └── val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── frankfurt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       ├── lindau</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  │       └── munster</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  └── leftImg8bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      └── val</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── frankfurt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ├── lindau</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          └── munster</span><br></span></code></pre></div></div>
<p>对数据集进行预处理：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hb_eval_preprocess -m unet_mobilenet -i cityscapes/leftImg8bit/val -o ./pre_unet_mobilenet</span><br></span></code></pre></div></div>
<p>示例中精度计算脚本的运行流程是：</p>
<p>1、根据 <code>workflow_accurary.json</code> 中的 <code>image_list_file</code> 参数值，去寻找对应数据集的 <code>lst</code> 文件；</p>
<p>2、根据 <code>lst</code> 文件存储的前处理文件路径信息，去加载每一个前处理文件，然后进行推理</p>
<p>所以，生成预处理文件之后，需要生成对应的lst文件，将每一张前处理文件的路径写入到lst文件中，而这个路径与数据集在开发板端的存放位置有关。
这里我们推荐其存放位置与 <code>script</code> 文件夹同级目录，如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK X3 使用如下格式：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-- ptq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- xxxx.bin             # 前处理好的二进制文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- cityscapes.lst       # lst文件：记录每一个前处理文 件的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- coco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- coco.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- imagenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- imagenet.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   `-- voc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   -- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |       `-- voc.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK Ultra 使用如下格式：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |-- ptq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- cityscapes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- xxxx.bin                            # 前处理好的二进制文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetb0.lst    # lst文件：记录每一个前处理文件的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetm1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetm1.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetm2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_deeplabv3plus_efficientnetm2.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_fastscnn_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_fastscnn_efficientnetb0.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- coco</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_centernet_resnet101</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_centernet_resnet101.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov3_darknet53</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov3_darknet53.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov3_vargdarknet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov3_vargdarknet.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov5x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_yolov5x.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb0.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb2.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_preq_qat_fcos_efficientnetb3.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- imagenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnasnet_m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnasnet_m.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnasnet_s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnasnet_s.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnet_lite4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_efficientnet_lite4.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_googlenet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_googlenet.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_mobilenetv1.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_mobilenetv2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_mobilenetv2.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_resnet18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_resnet18.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_vargconvnet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_vargconvnet.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- voc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_ssd_mobilenetv1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- xxxx.bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |   |-- ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |   |-- pre_ssd_mobilenetv1.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |-- script</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |   |   |-- ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>与之对应的lst文件，参考生成方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK X3 请使用如下命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/coco/fcos -name &quot;*bin*&quot; &gt; ../../../data/coco/coco.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # RDK Ultra 请使用如下命令：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find ../../../data/coco/pre_centernet_resnet101 -name &quot;*bin*&quot; &gt; ../../../data/coco/pre_centernet_resnet101.lst</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>这样生成的lst文件中存储的路径为一个相对路径： <code>../../../data/</code> 或 <code>../../../data/coco/pre_centernet_resnet101/</code> ，可以与 <code>workflow_accuracy.json</code> 默认的配置路径吻合。
如果需要更改前处理数据集的存放位置，则需要确保对应的 <code>lst</code> 文件可以被 <code>workflow_accuracy.json</code> 读取到；其次需要确保程序根据 <code>lst</code> 中的路径信息，能读取到对应的前处理文件。</p>
<ul>
<li>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="数据挂载-2">数据挂载<a href="#数据挂载-2" class="hash-link" aria-label="数据挂载的直接链接" title="数据挂载的直接链接">​</a></h5>
</li>
</ul>
<p>由于数据集相对较大，不适合直接放在开发板上，可以采用nfs挂载的方式供开发板读取。</p>
<p>开发机PC端（需要root权限）：</p>
<ol>
<li>编辑 /etc/exports, 增加一行：
<code>/nfs *(insecure,rw,sync,all_squash,anonuid=1000,anongid=1000,no_subtree_check)</code>。
<code>/nfs</code> 表示本机挂载路径，可替换为用户指定目录</li>
<li>执行命令 <code>exportfs -a -r</code>，使/etc/exports 生效。</li>
</ol>
<p>开发板端：</p>
<ol>
<li>创建需要挂载的目录：<code>mkdir -p /mnt</code>。</li>
<li><code>mount -t nfs {PC端IP}:/nfs /mnt -o nolock</code>。</li>
</ol>
<p>完成将PC端的/nfs文件夹挂载至板端/mnt文件夹。按照此方式，将包含预处理数据的文件夹挂载至板端，并将/data目录软链接至板端/ptq目录下，与/script同级目录。</p>
<ul>
<li>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理-2">模型推理<a href="#模型推理-2" class="hash-link" aria-label="模型推理的直接链接" title="模型推理的直接链接">​</a></h5>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板的实测结果，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体实测为准！</p></div></div>
<p>挂载完数据后，请登录开发板，开发板登录方法，请阅读<a href="/rdk_doc/Quick_start/remote_login"><strong>开发板登录</strong></a> 章节内容，登录成功后，执行 <code>fcos_efficientnetb0/</code> 目录下的accuracy.sh脚本，如下所示：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  /userdata/ptq/script/detection/fcos# sh accuracy.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ../../aarch64/bin/example --config_file=workflow_accuracy.json --log_level=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 03:14:51.158655 39555 infer_method.cc:107] Predict DoProcess finished.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0419 03:14:51.187361 39556 ptq_fcos_post_process_method.cc:123] PTQFcosPostProcessMethod DoProcess finished, predict result: [{&quot;bbox&quot;:[-1.518860,71.691170,574.934631,638.294922],&quot;prob&quot;:0.750647,&quot;label&quot;:21,&quot;class_name&quot;:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  I0118 14:02:43.636204 24782 ptq_fcos_post_process_method.cc:123] PTQFcosPostProcessMethod DoProcess finished, predict result: [{&quot;bbox&quot;:[3.432283,164.936249,157.480042,264.276825],&quot;prob&quot;:0.544454,&quot;label&quot;:62,&quot;class_name&quot;:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre></div></div>
<p>开发板端程序会在当前目录生成 <code>eval.log</code> 文件，该文件就是预测结果文件。</p>
<ul>
<li>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="精度计算-2">精度计算<a href="#精度计算-2" class="hash-link" aria-label="精度计算的直接链接" title="精度计算的直接链接">​</a></h5>
</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>精度计算部分请在 <code>开发机</code> 模型转换的环境下操作</p></div></div>
<p>精度计算的脚本在 <code>python_tools</code> 目录下，其中 <code>accuracy_tools</code> 中的：
cls_eval.py是用来计算分类模型的精度；
coco_det_eval.py是用来计算使用COCO数据集评测的检测模型的精度；
parsing_eval.py是用来计算使用Cityscapes数据集评测的分割模型的精度。
voc_det_eval.py是用来计算使用VOC数据集评测的检测模型的精度。</p>
<ul>
<li>分类模型</li>
</ul>
<p>使用CIFAR-10数据集和ImageNet数据集的分类模型计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 cls_eval.py --log_file=eval.log --gt_file=val.txt</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>log_file</code>：分类模型的预测结果文件。</li>
<li><code>gt_file</code>：CIFAR-10和ImageNet数据集的标注文件。</li>
</ul></div></div>
<ul>
<li>检测模型</li>
</ul>
<p>使用COCO数据集的检测模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 coco_det_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>eval_result_path</code>：检测模型的预测结果文件。</li>
<li><code>annotation_path</code>：COCO数据集的标注文件。</li>
</ul></div></div>
<p>使用VOC数据集的检测模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 voc_det_eval.py --eval_result_path=eval.log --annotation_path=../Annotations --val_txt_path=../val.txt</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>eval_result_path</code>：检测模型的预测结果文件。</li>
<li><code>annotation_path</code>：VOC数据集的标注文件。</li>
<li><code>val_txt_path</code>：VOC数据集中ImageSets/Main文件夹下的val.txt文件。</li>
</ul></div></div>
<ul>
<li>分割模型</li>
</ul>
<p>使用Cityscapes数据集的分割模型精度计算方式如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  :linenos:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python3 parsing_eval.py --width=output_width --height=output_height --log_file=eval.log --gt_path=cityscapes/gtFine/val</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><ul>
<li><code>width</code>: 分割模型的输出宽度</li>
<li><code>height</code>: 分割模型的输出高度</li>
<li><code>log_file</code>：分割模型的预测结果文件。</li>
<li><code>gt_path</code>：Cityscapes数据集的标注文件。</li>
</ul></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="模型集成-2">模型集成<a href="#模型集成-2" class="hash-link" aria-label="模型集成的直接链接" title="模型集成的直接链接">​</a></h5>
<p>模型后处理集成主要有2个步骤，以centernet_resnet50模型集成为例：</p>
<ol>
<li>增加后处理文件 <code>ptq_centernet_post_process_method.cc</code>，以及头文件 <code>ptq_centernet_post_process_method.h</code>。</li>
<li>增加模型运行脚本及配置文件。</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="后处理文件添加-1">后处理文件添加<a href="#后处理文件添加-1" class="hash-link" aria-label="后处理文件添加的直接链接" title="后处理文件添加的直接链接">​</a></h5>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板举例，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体为准！</p></div></div>
<p>后处理代码文件可直接复用src/method目录下任意后处理文件，主要修改 <code>InitFromJsonString</code> 函数，以及 <code>PostProcess</code> 函数即可。</p>
<p><code>InitFromJsonString</code> 函数主要是读取workflow.json中的后处理相关的参数配置，用户可自定义设置相应的输入参数。
<code>PostProcess</code> 函数主要完成后处理的逻辑。</p>
<p>后处理.cc文件放置于 <code>ai_benchmark/code/src/method/</code> 路径下，
.h头文件放置于 <code>ai_benchmark/code/include/method/</code> 路径下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  |--ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |--code                                                 # 示例源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |--include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |--method                                         # 在此文件夹中添加头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--ptq_centernet_post_process_method.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--ptq_yolo5_post_process_method.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |--src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |--method                                         # 在此文件夹中添加后处理.cc文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--ptq_centernet_post_process_method.cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--ptq_yolo5_post_process_method.cc</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="增加模型运行脚本及配置文件-2">增加模型运行脚本及配置文件<a href="#增加模型运行脚本及配置文件-2" class="hash-link" aria-label="增加模型运行脚本及配置文件的直接链接" title="增加模型运行脚本及配置文件的直接链接">​</a></h5>
<p>脚本目录结构如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  |--ai_benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |--xj3/ptq/script                                      # 示例脚本文件夹</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |--detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |--centernet_resnet50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--accuracy.sh                                # 精度测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--fps.sh                                     # 性能测试脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--latency.sh                                 # 单帧延时示例脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--workflow_accuracy.json                     # 精度配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--workflow_fps.json                          # 性能配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  |  |  |  |  |--workflow_latency.json                      # 单帧延时配置文件</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="辅助工具和常用操作-5">辅助工具和常用操作<a href="#辅助工具和常用操作-5" class="hash-link" aria-label="辅助工具和常用操作的直接链接" title="辅助工具和常用操作的直接链接">​</a></h5>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="日志系统使用说明-2">日志系统使用说明<a href="#日志系统使用说明-2" class="hash-link" aria-label="日志系统使用说明的直接链接" title="日志系统使用说明的直接链接">​</a></h5>
<p>日志系统主要包括 <code>示例日志</code> 和 <code>模型推理API DNN日志</code> 两部分。
其中示例日志是指交付包示例代码中的应用日志；DNN日志是指lib dnn库中的日志。
用户根据不同的需求可以获取不同的日志。</p>
<ul>
<li>示例日志</li>
</ul>
<ol>
<li>日志等级。示例日志主要采用glog中的vlog，主要分为四个自定义等级：</li>
</ol>
<ul>
<li><code>0</code> (SYSTEM)，该等级主要用来输出报错信息；</li>
<li><code>1</code> (REPORT)，该等级在示例代码中主要用来输出性能数据；</li>
<li><code>2</code> (DETAIL)，该等级在示例代码中主要用来输出系统当前状态信息；</li>
<li><code>3</code> (DEBUG)，该等级在示例代码中主要用来输出调试信息。
日志等级设置规则：假设设置了级别为 <code>P</code>，如果发生了一个级别 <code>Q</code> 比 <code>P</code> 低，
则可以启动，否则屏蔽掉；默认DEBUG&gt;DETAIL&gt;REPORT&gt;SYSTEM。</li>
</ul>
<ol start="2">
<li>日志等级设置。通过 <code>log_level</code> 参数来设置日志等级，在运行示例的时候，指定 <code>log_level</code> 参数来设置等级，
比如指定 <code>log_level=0</code>，即输出SYSTEM日志；如果指定 <code>log_level=3</code>，
则输出DEBUG、DETAIL、REPORT和SYSTEM日志。</li>
</ol>
<ul>
<li>模型推理API DNN日志</li>
</ul>
<p>关于模型推理 DNN API日志的配置，请阅读<a href="/rdk_doc/clang_development/cdev_dnn_api/model_debug#configuration_information">《模型推理DNN API使用说明》</a>文档中的 <code>配置信息</code> 一节内容</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="算子耗时说明-2">算子耗时说明<a href="#算子耗时说明-2" class="hash-link" aria-label="算子耗时说明的直接链接" title="算子耗时说明的直接链接">​</a></h5>
<p>对模型算子(OP)性能的统计是通过设置 <code>HB_DNN_PROFILER_LOG_PATH</code> 环境变量实现的，本节介绍模型的推理性能分析，有助于开发者了解模型的真实推理性能情况。
对该变量的类型和取值说明如下：</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p><code>export HB_DNN_PROFILER_LOG_PATH=${path}</code>：表示OP节点dump的输出路径，程序正常运行完退出后，产生profiler.log文件。</p></div></div>
<ul>
<li>示例说明</li>
</ul>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>以下示例是使用 <strong>RDK X3</strong> 开发板举例，若使用 <strong>RDK Ultra</strong> 开发板信息会有所差异，以具体为准！</p></div></div>
<p>以下代码块以mobilenetv1模型为例，开启单个线程同时RunModel，设置 <code>export HB_DNN_PROFILER_LOG_PATH=./</code>，则统计输出的信息如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;perf_result&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;FPS&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">677.6192525182025</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;average_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.506142616271973</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;running_condition&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;core_id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;frame_count&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">200</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;model_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mobilenetv1_224x224_nv12&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;run_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">295.151</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;thread_num&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;chip_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;BPU_inference_time_cost&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.09122</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.54</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.439</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;CPU_inference_time_cost&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.18836999999999998</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.4630000000000001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.127</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;model_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;BPU_MOBILENET_subgraph_0&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.09122</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.54</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3.439</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Dequantize_fc7_1_HzDequantize&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.07884999999999999</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.158</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.068</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;MOBILENET_subgraph_0_output_layout_convert&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.018765</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.08</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Preprocess&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.0065</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.058</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.003</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;Softmax_prob&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.084255</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.167</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.046</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;task_latency&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;TaskPendingTime&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.029375</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.059</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.009</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;TaskRunningTime&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;avg_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.40324</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;max_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">11.801</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;min_time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4.008</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>以上输出了 <code>model_latency</code> 和 <code>task_latency</code>。其中model_latency中输出了模型每个OP运行所需要的耗时情况，task_latency中输出了模型运行中各个task模块的耗时情况。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>程序只有正常退出才会输出profiler.log文件。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="dump工具-2">dump工具<a href="#dump工具-2" class="hash-link" aria-label="dump工具的直接链接" title="dump工具的直接链接">​</a></h5>
<p>本节主要介绍dump工具的开启方法，一般不需要关注，只有在模型精度异常情况时开启使用。
​通过设置 <code>export HB_DNN_DUMP_PATH=${path}</code> 这个环境变量，可以dump出模型推理过程中每个节点的输入和输出, 根据dump的输出结果，可以排查模型推理在开发机模拟器和开发板是否存在一致性问题：即相同模型，相同输入，开发板和开发机模拟器的输出结果是否完全相同。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="模型上板分析工具说明-2">模型上板分析工具说明<a href="#模型上板分析工具说明-2" class="hash-link" aria-label="模型上板分析工具说明的直接链接" title="模型上板分析工具说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="概述-5">概述<a href="#概述-5" class="hash-link" aria-label="概述的直接链接" title="概述的直接链接">​</a></h4>
<p>本章节介绍D-Robotics 算法工具链中模型上板推理的快速验证工具，方便开发者可以快速获取到 <code>***.bin</code> 模型的信息、模型推理的性能、模型debug等内容。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hrt_model_exec-工具使用说明-2">hrt_model_exec 工具使用说明<a href="#hrt_model_exec-工具使用说明-2" class="hash-link" aria-label="hrt_model_exec 工具使用说明的直接链接" title="hrt_model_exec 工具使用说明的直接链接">​</a></h4>
<p><code>hrt_model_exec</code> 工具，可以快速在开发板上评测模型的推理性能、获取模型信息等。</p>
<p>目前工具提供了三类功能，如下表所示：</p>
<table><thead><tr><th><strong>编号</strong></th><th><strong>子命令</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>1</td><td><code>model_info</code></td><td>获取模型信息，如：模型的输入输出信息等。</td></tr><tr><td>2</td><td><code>infer</code></td><td>执行模型推理，获取模型推理结果。</td></tr><tr><td>3</td><td><code>perf</code></td><td>执行模型性能分析，获取性能分析结果。</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>工具也可以通过 <code>-v</code> 或者 <code>--version</code> 命令，查看工具的 <code>dnn</code> 预测库版本号。</p><p>例如： hrt_model_exec -v 或 hrt_model_exec --version</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数描述-4">输入参数描述<a href="#输入参数描述-4" class="hash-link" aria-label="输入参数描述的直接链接" title="输入参数描述的直接链接">​</a></h5>
<p>在开发板上运行 <code>hrt_model_exec</code> 、 <code>hrt_model_exec -h</code> 或 <code>hrt_model_exec --help</code> 获取工具的使用参数详情。
如下图中所示：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/hrt_model_exec_help.png" alt="hrt_model_exec_help" class="img_ev3q"></p>
<table><thead><tr><th><strong>编号</strong></th><th><strong>参数</strong></th><th><strong>类型</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>1</td><td><code>model_file</code></td><td>string</td><td>模型文件路径，多个路径可通过逗号分隔。</td></tr><tr><td>2</td><td><code>model_name</code></td><td>string</td><td>指定模型中某个模型的名称。</td></tr><tr><td>3</td><td><code>core_id</code></td><td>int</td><td>指定运行核。</td></tr><tr><td>4</td><td><code>input_file</code></td><td>string</td><td>模型输入信息，多个可通过逗号分隔。</td></tr><tr><td>5</td><td><code>roi_infer</code></td><td>bool</td><td>使能resizer模型推理。</td></tr><tr><td>6</td><td><code>roi</code></td><td>string</td><td>指定推理resizer模型时所需的roi区域。</td></tr><tr><td>7</td><td><code>frame_count</code></td><td>int</td><td>执行模型运行帧数。</td></tr><tr><td>8</td><td><code>dump_intermediate</code></td><td>string</td><td>dump模型每一层输入和输出。</td></tr><tr><td>9</td><td><code>enable_dump</code></td><td>bool</td><td>使能dump模型输入和输出。</td></tr><tr><td>10</td><td><code>dump_precision</code></td><td>int</td><td>控制txt格式输出float型数据的小数点位数。</td></tr><tr><td>11</td><td><code>hybrid_dequantize_process</code></td><td>bool</td><td>控制txt格式输出float类型数据。</td></tr><tr><td>12</td><td><code>dump_format</code></td><td>string</td><td>dump模型输入和输出的格式。</td></tr><tr><td>13</td><td><code>dump_txt_axis</code></td><td>int</td><td>控制txt格式输入输出的换行规则。</td></tr><tr><td>14</td><td><code>enable_cls_post_process</code></td><td>bool</td><td>使能分类后处理。</td></tr><tr><td>15</td><td><code>perf_time</code></td><td>int</td><td>执行模型运行时间。</td></tr><tr><td>16</td><td><code>thread_num</code></td><td>int</td><td>指定程序运行线程数。</td></tr><tr><td>17</td><td><code>profile_path</code></td><td>string</td><td>模型性能/调度性能统计数据的保存路径。</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-4">使用说明<a href="#使用说明-4" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h5>
<p>本节介绍 <code>hrt_model_exec</code> 工具的三个子功能的具体使用方法</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="model_info-2"><code>model_info</code><a href="#model_info-2" class="hash-link" aria-label="model_info-2的直接链接" title="model_info-2的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于获取模型信息，模型支持范围：QAT模型，PTQ模型。
该参数与 <code>model_file</code> 一起使用，用于获取模型的详细信息；
模型 的信息包括：模型输入输出信息 <code>hbDNNTensorProperties</code> 和模型的分段信息 <code>stage</code> ；模型的分段信息是：一张图片可以分多个阶段进行推理，stage信息为[x1, y1, x2, y2]，分别为图片推理的左上角和右下角坐标，目前D-Robotics RDK Ultra的bayes架构支持这类分段模型的推理，RDK X3上模型均为1个stage。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>不指定 <code>model_name</code> ，则会输出模型中所有模型信息，指定 <code>model_name</code> ，则只输出对应模型的信息。</p></div></div>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型（输出所有模型信息）</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin,xxx.bin</span><br></span></code></pre></div></div>
<ol start="3">
<li>多模型--pack模型（输出指定模型信息）</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin --model_name=xx</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/model_info.png" alt="model_info" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明-6"><code>输入参数补充说明</code><a href="#输入参数补充说明-6" class="hash-link" aria-label="输入参数补充说明-6的直接链接" title="输入参数补充说明-6的直接链接">​</a></h5>
<ul>
<li>重复输入</li>
</ul>
<p>若重复指定参数输入，则会发生参数覆盖的情况，例如：获取模型信息时重复指定了两个模型文件，则会取后面指定的参数输入 <code>yyy.bin</code>：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin --model_file=yyy.bin</span><br></span></code></pre></div></div>
<p>若重复指定输入时，未加命令行参--model_file，则会取命令行参数后面的值，未加参数的不识别，
例如：下例会忽略 <code>yyy.bin</code>，参数值为 <code>xxx.bin</code>：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec model_info --model_file=xxx.bin yyy.bin</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="infer-2"><code>infer</code><a href="#infer-2" class="hash-link" aria-label="infer-2的直接链接" title="infer-2的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于输入自定义图片后，模型推理一帧，并给出模型推理结果。
该参数需要与 <code>input_file</code> 一起使用，指定输入图片路径，工具根据模型信息resize图片，整理模型输入信息。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>程序单线程运行单帧数据，输出模型运行的时间。</p></div></div>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=xxx.jpg</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin,xxx.bin --model_name=xx --input_file=xxx.jpg</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/infer.png" alt="infer" class="img_ev3q"></p>
<ul>
<li>
<p>可选参数</p>
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>core_id</code></td><td>指定模型推理的核id，0：任意核，1：core0，2：core1；默认为 <code>0</code>。</td></tr><tr><td><code>roi_infer</code></td><td>使能resizer模型推理；若模型输入包含resizer源，设置为 <code>true</code>，默认为 <code>false</code>。</td></tr><tr><td><code>roi</code></td><td><code>roi_infer</code> 为 <code>true</code> 时生效，设置推理resizer模型时所需的 <code>roi</code> 区域以分号间隔。</td></tr><tr><td><code>frame_count</code></td><td>设置 <code>infer</code> 运行帧数，单帧重复推理，可与 <code>enable_dump</code> 并用，验证输出一致性，默认为 <code>1</code>。</td></tr><tr><td><code>dump_intermediate</code></td><td>dump模型每一层输入数据和输出数据，默认值 <code>0</code>，不dump数据。 <code>1</code>：输出文件类型为 <code>bin</code>；<code>2</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为aligned数据； <code>3</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为valid数据。</td></tr><tr><td><code>enable_dump</code></td><td>dump模型输出数据，默认为 <code>false</code>。</td></tr><tr><td><code>dump_precision</code></td><td>控制txt格式输出float型数据的小数点位数，默认为 <code>9</code>。</td></tr><tr><td><code>hybrid_dequantize_process</code></td><td>控制txt格式输出float类型数据，若输出为定点数据将其进行反量化处理，目前只支持四维模型。</td></tr><tr><td><code>dump_format</code></td><td>dump模型输出文件的类型，可选参数为 <code>bin</code> 或 <code>txt</code>，默认为 <code>bin</code>。</td></tr><tr><td><code>dump_txt_axis</code></td><td>dump模型txt格式输出的换行规则；若输出维度为n，则参数范围为[0, n], 默认为 <code>4</code>。</td></tr><tr><td><code>enable_cls_post_process</code></td><td>使能分类后处理，目前只支持ptq分类模型，默认 <code>false</code>。</td></tr></tbody></table>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="多输入模型说明-2"><code>多输入模型说明</code><a href="#多输入模型说明-2" class="hash-link" aria-label="多输入模型说明-2的直接链接" title="多输入模型说明-2的直接链接">​</a></h5>
<p>工具 <code>infer</code> 推理功能支持多输入模型的推理，支持图片输入、二进制文件输入以及文本文件 输入，输入数据用逗号隔开。
模型的输入信息可以通过 <code>model_info</code> 进行查看。</p>
<ul>
<li>示例说明</li>
</ul>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=xxx.jpg,input.txt</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明-7"><code>输入参数补充说明</code><a href="#输入参数补充说明-7" class="hash-link" aria-label="输入参数补充说明-7的直接链接" title="输入参数补充说明-7的直接链接">​</a></h5>
<ul>
<li><code>input_file</code></li>
</ul>
<p>图片类型的输入，其文件名后缀必须为 <code>bin</code> / <code>JPG</code> / <code>JPEG</code> / <code>jpg</code> / <code>jpeg</code> 中的一种，feature输入后缀名必须为 <code>bin</code> / <code>txt</code> 中的一种。
每个输入之间需要用英文字符的逗号隔开 <code>,</code>，例如： <code>xxx.jpg,input.txt</code>。</p>
<ul>
<li><code>enable_cls_post_process</code></li>
</ul>
<p>使能分类后处理。子命令为 <code>infer</code> 时配合使用，目前只支持在PTQ分类模型的后处理时使用，变量为 <code>true</code> 时打印分类结果。
参见下图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/enable_cls_post_process.png" alt="enable_cls_post_process" class="img_ev3q"></p>
<ul>
<li><code>roi_infer</code></li>
</ul>
<p>若模型包含resizer输入源， <code>infer</code> 和 <code>perf</code> 功能都需要设置 <code>roi_infer</code>   为true，并且配置与输入源一一对应的 <code>input_file</code> 和 <code>roi</code> 参数。
如：模型有三个输入，输入源顺序分别为[<code>ddr</code>, <code>resizer</code>, <code>resizer</code>]，则推理两组输入数据的命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // infer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx0.bin,xx1.jpg,xx2.jpg,xx3.bin,xx4.jpg,xx5.jpg&quot;  --roi=&quot;2,4,123,125;6,8,111,113;27,46,143,195;16,28,131,183&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // perf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin --input_file=&quot;xx0.bin,xx1.jpg,xx2.jpg,xx3.bin,xx4.jpg,xx5.jpg&quot;   --roi=&quot;2,4,123,125;6,8,111,113;27,46,143,195;16,28,131,183&quot;</span><br></span></code></pre></div></div>
<p>每个 <code>roi</code> 输入之间需要用英文字符的分号隔开。</p>
<ul>
<li><code>dump_intermediate</code></li>
</ul>
<p>dump模型每一层节点的输入数据和输出数据。 <code>dump_intermediate=0</code> 时，默认dump功能关闭；
<code>dump_intermediate=1</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 方式保存，其中 <code>BPU</code> 节点输出为 <code>aligned</code> 数据；
<code>dump_intermediate=2</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 和 <code>txt</code> 两种方式保存，其中 <code>BPU</code> 节点输出为 <code>aligned</code> 数据；
<code>dump_intermediate=3</code> 时，模型中每一层节点输入数据和输出数据以 <code>bin</code> 和 <code>txt</code> 两种方式保存，其中 <code>BPU</code> 节点输出为 <code>valid</code> 数据。
如： 模型有两个输入，输入源顺序分别为[<code>pyramid</code>， <code>ddr</code>]，将模型每一层节点的输入和输出保存为 <code>bin</code> 文件，其中 <code>BPU</code> 节点输出按 <code>aligned</code> 类型保存，则推理命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx0.jpg,xx1.bin&quot;  --dump_intermediate=1</span><br></span></code></pre></div></div>
<p><code>dump_intermediate</code> 参数支持 <code>infer</code> 和 <code>perf</code> 两种模式。</p>
<ul>
<li><code>hybrid_dequantize_process</code></li>
</ul>
<p>控制txt格式输出float类型数据。 <code>hybrid_dequantize_process</code> 参数在 <code>enable_dump=true</code> 时生效。
当 <code>enable_dump=true</code> 时，若设置 <code>hybrid_dequantize_process=true</code> ，反量化整型输出数据，将所有输出按float类型保存为 <code>txt</code> 文件，其中模型输出为 <code>valid</code> 数据，支持配置 <code>dump_txt_axis</code> 和 <code>dump_precision</code>；
若设置 <code>hybrid_dequantize_process=false</code> ，直接保存模型输出的 <code>aligned</code> 数据，不做任何处理。
如： 模型有3个输出，输出Tensor数据类型顺序分别为[float，int32，int16]， 输出txt格式float类型的 <code>valid</code> 数据， 则推理命令行如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // 输出float类型数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec infer --model_file=xxx.bin --input_file=&quot;xx.bin&quot;  --enable_dump=true --hybrid_dequantize_process=true</span><br></span></code></pre></div></div>
<p><code>hybrid_dequantize_process</code> 参数目前只支持四维模型。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="perf-2"><code>perf</code><a href="#perf-2" class="hash-link" aria-label="perf-2的直接链接" title="perf-2的直接链接">​</a></h5>
<ul>
<li>概述</li>
</ul>
<p>该参数用于测试模型的推理性能。
使用此工具命令，用户无需输入数据，程序会根据模型信息自动构造模型的输入tensor，tensor数据为随机数。
程序默认单线程运行200帧数据，当指定perf_time参数时，frame_count参数失效，程序会执行指定时间后退出。
程序运行完成后，会输出模型运行的程序线程数、帧数、模型推理总时间，模型推理平均latency，帧率信息等。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>程序每200帧打印一次性能信息：latnecy的最大、最小、平均值，不足200帧程序运行结束打印一次。</p></div></div>
<ul>
<li>示例说明</li>
</ul>
<ol>
<li>单模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin</span><br></span></code></pre></div></div>
<ol start="2">
<li>多模型</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file=xxx.bin,xxx.bin --model_name=xx</span><br></span></code></pre></div></div>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/perf.png" alt="perf" class="img_ev3q"></p>
<ul>
<li>
<p>可选参数</p>
<table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>core_id</code></td><td>指定模型推理的核id，0：任意核，1：core0，2：core1；默认为 <code>0</code>。</td></tr><tr><td><code>input_file</code></td><td>模型输入信息，多个可通过逗号分隔。</td></tr><tr><td><code>roi_infer</code></td><td>使能resizer模型推理；若模型输入包含resizer源，设置  为 <code>true</code>，默认为 <code>false</code>。</td></tr><tr><td><code>roi</code></td><td><code>roi_infer</code> 为 <code>true</code> 时生效，设置推理resizer模型时所需的 <code>roi</code> 区域以分号间隔。</td></tr><tr><td><code>frame_count</code></td><td>设置 <code>perf</code> 运行帧数，当perf_time为0时生效，默认为 <code>200</code>。</td></tr><tr><td><code>dump_intermediate</code></td><td>dump模型每一层输入数据和输出数据，默认值 <code>0</code>，不dump数据。 <code>1</code>：输出文件类型为 <code>bin</code>；</td></tr><tr><td></td><td><code>2</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为aligned数据； <code>3</code>：输出类型为 <code>bin</code> 和 <code>txt</code>，其中BPU节点输出为valid数据。</td></tr><tr><td><code>perf_time</code></td><td>设置 <code>perf</code> 运行时间，单位：分钟，默认为 <code>0</code>。</td></tr><tr><td><code>thread_num</code></td><td>设置程序运行线程数，范围[1, 8], 默认为 <code>1</code>, 设置大于8时按照8个线程处理。</td></tr><tr><td><code>profile_path</code></td><td>统计工具日志产生路径，运行产生profiler.log和profiler.csv，分析op耗时和调度耗时。时。</td></tr></tbody></table>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="多线程latency数据说明-2"><code>多线程Latency数据说明</code><a href="#多线程latency数据说明-2" class="hash-link" aria-label="多线程latency数据说明-2的直接链接" title="多线程latency数据说明-2的直接链接">​</a></h5>
<p>多线程的目的是为了充分利用BPU资源，多线程共同处理 <code>frame_count</code> 帧数据或执行perf_time时间，直至数据处理完成/执行时间结束程序结束。
在多线程 <code>perf</code> 过程中可以执行以下命令，实时获取BPU资源占用率情况。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  hrut_somstatus -n 10000 –d 1</span><br></span></code></pre></div></div>
<p>输出内容如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  =====================1=====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  temperature--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          CPU      : 37.5 (C)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  cpu frequency--&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                min       cur     max</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu0: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu1: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu2: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cpu3: 240000    1200000 1200000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bpu status information----&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              min        cur             max             ratio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bpu0: 400000000 1000000000      1000000000      0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          bpu1: 400000000 1000000000      1000000000      0</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>备注</div><div class="admonitionContent_BuS1"><p>以上示例展示的为 <strong>RDK X3</strong> 开发板的输出日志， 若使用 <strong>RDK Ultra</strong> 开发板，直接使用上述命令获取即可。
在 <code>perf</code> 模式下，单线程的latency时间表示模型的实测上板性能，
而多线程的latency数据表示的是每个线程的模型单帧处理时间，其相对于单线程的时间要长，但是多线程的总体处理时间减少，其帧率是提升的。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数补充说明-8"><code>输入参数补充说明</code><a href="#输入参数补充说明-8" class="hash-link" aria-label="输入参数补充说明-8的直接链接" title="输入参数补充说明-8的直接链接">​</a></h5>
<ul>
<li><code>profile_path</code></li>
</ul>
<p>profile日志文件产生目录。
该参数通过设置环境变量 <code>export HB_DNN_PROFILER_LOG_PATH=${path}</code> 查看模型运行过程中OP以及任务调度耗时。
一般设置 <code>--profile_path=&quot;.&quot;</code> 即可，代表在当前目录下生成日志文件，日志文件为profiler.log。</p>
<ul>
<li><code>thread_num</code></li>
</ul>
<p>线程数(并行度)，数值表示最多有多少个任务在并行处理。
测试延时时，数值需要设置为1，没有资源抢占发生，延时测试更准确。
测试吞吐时，建议设置&gt;2 (BPU核心个数)，调整线程数使BPU利用率尽量高，吞吐测试更准确。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // 双核FPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file xxx.bin --thread_num 8 --core_id 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Latency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hrt_model_exec perf --model_file xxx.bin --thread_num 1 --core_id 1</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="hrt_bin_dump-工具使用说明-2">hrt_bin_dump 工具使用说明<a href="#hrt_bin_dump-工具使用说明-2" class="hash-link" aria-label="hrt_bin_dump 工具使用说明的直接链接" title="hrt_bin_dump 工具使用说明的直接链接">​</a></h4>
<p><code>hrt_bin_dump</code> 是 PTQ debug模型的layer dump工具，工具的输出文件为二进制文件。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="输入参数描述-5">输入参数描述<a href="#输入参数描述-5" class="hash-link" aria-label="输入参数描述的直接链接" title="输入参数描述的直接链接">​</a></h5>
<table><thead><tr><th>编号</th><th>参数</th><th>类型</th><th>描述</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td><code>model_file</code></td><td>string</td><td>模型文件路径。</td><td>必须为debug model。即模型的编译参数 <code>layer_out_dump</code> 需要设置为 <code>True</code>，指定模型转换过程中输出各层的中间结果。</td></tr><tr><td>2</td><td><code>input_file</code></td><td>string</td><td>输入文件路径。</td><td>模型的输入文件，支持 <code>hbDNNDataType</code> 所有类型的输入； IMG类型文件需为二进制文件（后缀必须为.bin），二进制文件的大小应与模型的输入信息相匹配，如：YUV444文件大小为 :math:<code>height * width * 3</code>； TENSOR类型文件需为二进制文件或文本文件（后缀必须为.bin/.txt），二进制文件的大小应与模型的输入信息相匹配，文本文件的读入数据个数必须大于等于模型要求的输入数据个数，多余的数据会被丢弃；每个输入之间通过逗号分隔，如：模型有两个输入，则： <code>--input_file=kite.bin,input.txt</code>。</td></tr><tr><td>3</td><td><code>conv_mapping_file</code></td><td>string</td><td>模型卷积层配置文件。</td><td>模型layer配置文件，配置文件中标明了模型各层信息，在模型编译过程中生成。文件名称一般为： <code>model_name_quantized_model_conv_output_map.json</code>。</td></tr><tr><td>4</td><td><code>conv_dump_path</code></td><td>string</td><td>工具输出路径。</td><td>工具的输出路径，该路径应为合法路径。</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用说明-5">使用说明<a href="#使用说明-5" class="hash-link" aria-label="使用说明的直接链接" title="使用说明的直接链接">​</a></h5>
<p>工具提供dump卷积层输出功能，输出文件为二进制文件。
直接运行 <code>hrt_bin_dump</code> 获取工具使用详情。
参见下图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/hrt_bin_dump_help.png" alt="hrt_bin_dump_help" class="img_ev3q"></p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>小技巧</div><div class="admonitionContent_BuS1"><p>工具也可以通过 <code>-v</code> 或者 <code>--version</code> 命令，查看工具的 <code>dnn</code> 预测库版本号。</p><p>例如： hrt_bin_dump -v 或 hrt_bin_dump --version</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="示例说明-2">示例说明<a href="#示例说明-2" class="hash-link" aria-label="示例说明的直接链接" title="示例说明的直接链接">​</a></h5>
<p>以mobilenetv1的debug模型为例，创建outputs文件夹，执行以下命令：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ./hrt_bin_dump --model_file=./mobilenetv1_hybrid_horizonrt.bin --conv_mapping_file=./mobilenetv1_quantized_model_conv_output_map.json --conv_dump_path=./outputs --input_file=./zebra_cls.bin</span><br></span></code></pre></div></div>
<p>运行日志参见以下截图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/run_log.png" alt="run_log" class="img_ev3q"></p>
<p>在路径 <strong>outputs/</strong> 文件夹下可以查看输出，参见以下截图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/intermediate/output.png" alt="output" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2025-08-15T05:00:28.000Z" itemprop="dateModified">2025年8月15日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/Advanced_development/toolchain_development/intermediate/supported_op_list"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">模型算子支持列表</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/Advanced_development/toolchain_development/expert/"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">7.4.4 高阶指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rdk-x3" class="table-of-contents__link toc-highlight">RDK X3</a><ul><li><a href="#模型推理dnn-api使用示例说明" class="table-of-contents__link toc-highlight">模型推理DNN API使用示例说明</a><ul><li><a href="#概述" class="table-of-contents__link toc-highlight">概述</a><ul><li><a href="#示例代码包结构介绍" class="table-of-contents__link toc-highlight">示例代码包结构介绍</a></li></ul></li><li><a href="#环境 构建" class="table-of-contents__link toc-highlight">环境构建</a><ul><li><a href="#开发板准备" class="table-of-contents__link toc-highlight">开发板准备</a></li><li><a href="#编译" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#示例使用" class="table-of-contents__link toc-highlight">示例使用</a><ul><li><a href="#basic_samples-示例" class="table-of-contents__link toc-highlight">basic_samples 示例</a></li><li><a href="#quick_start" class="table-of-contents__link toc-highlight">quick_start</a></li><li><a href="#api_tutorial" class="table-of-contents__link toc-highlight">api_tutorial</a></li><li><a href="#advanced_samples" class="table-of-contents__link toc-highlight">advanced_samples</a></li><li><a href="#misc" class="table-of-contents__link toc-highlight">misc</a></li></ul></li><li><a href="#辅助工具和常用操作" class="table-of-contents__link toc-highlight">辅助工具和常用操作</a><ul><li><a href="#日志" class="table-of-contents__link toc-highlight">日志</a></li><li><a href="#示例日志" class="table-of-contents__link toc-highlight">示例日志</a></li><li><a href="#模型推理-dnn-api日志" class="table-of-contents__link toc-highlight">模型推理 DNN API日志</a></li></ul></li></ul></li><li><a href="#公版模型性能精度测评说明" class="table-of-contents__link toc-highlight">公版模型性能精度测评说明</a><ul><li><a href="#公版模型性能精度指标" class="table-of-contents__link toc-highlight">公版模型性能精度指标</a></li><li><a href="#评测方法说明" class="table-of-contents__link toc-highlight">评测方法说明</a><ul><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#示例代码包结构" class="table-of-contents__link toc-highlight">示例代码包结构</a></li><li><a href="#示例模型" class="table-of-contents__link toc-highlight">示例模型</a></li><li><a href="#公共数据集" class="table-of-contents__link toc-highlight">公共数据集</a></li><li><a href="#环境构建-1" class="table-of-contents__link toc-highlight">环境构建</a></li><li><a href="#开发板准备-1" class="table-of-contents__link toc-highlight">开发板准备</a></li><li><a href="#编译环境准备" class="table-of-contents__link toc-highlight">编译环境准备</a></li><li><a href="#测评示例使用说明" class="table-of-contents__link toc-highlight">测评示例使用说明</a></li><li><a href="#性能评测" class="table-of-contents__link toc-highlight">性能评测</a></li><li><a href="#精度评测" class="table-of-contents__link toc-highlight">精度评测</a></li><li><a href="#数据预处理" class="table-of-contents__link toc-highlight">数据预处理</a></li><li><a href="#数据挂载" class="table-of-contents__link toc-highlight">数据挂载</a></li><li><a href="#模型推理" class="table-of-contents__link toc-highlight">模型推理</a></li><li><a href="#精度计算" class="table-of-contents__link toc-highlight">精度计算</a></li><li><a href="#模型集成" class="table-of-contents__link toc-highlight">模型集成</a></li><li><a href="#后处理文件添加" class="table-of-contents__link toc-highlight">后处理文件添加</a></li><li><a href="#增加模型运行脚本及配置文件" class="table-of-contents__link toc-highlight">增加模型运行脚本及配置文件</a></li><li><a href="#辅助工具和常用操作-1" class="table-of-contents__link toc-highlight">辅助工具和常用操作</a></li><li><a href="#日志系统使用说明" class="table-of-contents__link toc-highlight">日志系统使用说明</a></li><li><a href="#算子耗时说明" class="table-of-contents__link toc-highlight">算子耗时说明</a></li><li><a href="#dump工具" class="table-of-contents__link toc-highlight">dump工具</a></li></ul></li></ul></li><li><a href="#模型上板分析工具说明" class="table-of-contents__link toc-highlight">模型上板分析工具说明</a><ul><li><a href="#概述-1" class="table-of-contents__link toc-highlight">概 述</a></li><li><a href="#hrt_model_exec-工具使用说明" class="table-of-contents__link toc-highlight">hrt_model_exec 工具使用说明</a><ul><li><a href="#输入参数描述" class="table-of-contents__link toc-highlight">输入参数描述</a></li><li><a href="#使用说明" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#model_info" class="table-of-contents__link toc-highlight"><code>model_info</code></a></li><li><a href="#输入参数补充说明" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li><li><a href="#infer" class="table-of-contents__link toc-highlight"><code>infer</code></a></li><li><a href="#多输入模型说明" class="table-of-contents__link toc-highlight"><code>多输入模型说明</code></a></li><li><a href="#输入参数补充说明-1" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li><li><a href="#perf" class="table-of-contents__link toc-highlight"><code>perf</code></a></li><li><a href="#多线程latency数据说明" class="table-of-contents__link toc-highlight"><code>多线程Latency数据说明</code></a></li><li><a href="#输入参数补充说明-2" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li></ul></li><li><a href="#hrt_bin_dump-工具使用说明" class="table-of-contents__link toc-highlight">hrt_bin_dump 工具使用说明</a><ul><li><a href="#输入参数描述-1" class="table-of-contents__link toc-highlight">输入参数描述</a></li><li><a href="#使用说明-1" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#示例说明" class="table-of-contents__link toc-highlight">示例说明</a></li></ul></li></ul></li></ul></li><li><a href="#rdk-x5" class="table-of-contents__link toc-highlight">RDK X5</a><ul><li><a href="#模型推理dnn-api使用示例说明-1" class="table-of-contents__link toc-highlight"><span></span>模型推理DNN API使用示例说明</a><ul><li><a href="#概述-2" class="table-of-contents__link toc-highlight">概述</a><ul><li><a href="#示例代码包结构介绍-1" class="table-of-contents__link toc-highlight">示例代码包结构介绍</a></li></ul></li><li><a href="#环境构建-2" class="table-of-contents__link toc-highlight">环境构建</a><ul><li><a href="#开发板准备-2" class="table-of-contents__link toc-highlight">开发板准备</a></li><li><a href="#编译-1" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#示例使用-1" class="table-of-contents__link toc-highlight">示例使用</a><ul><li><a href="#basic_samples-示例-1" class="table-of-contents__link toc-highlight">basic_samples 示例</a></li><li><a href="#quick_start-1" class="table-of-contents__link toc-highlight">quick_start</a></li><li><a href="#api_tutorial-1" class="table-of-contents__link toc-highlight">api_tutorial</a></li><li><a href="#advanced_samples-1" class="table-of-contents__link toc-highlight">advanced_samples</a></li><li><a href="#misc-1" class="table-of-contents__link toc-highlight">misc</a></li></ul></li><li><a href="#辅助工具和常用操作-2" class="table-of-contents__link toc-highlight">辅助工具和常用操作</a><ul><li><a href="#日志-1" class="table-of-contents__link toc-highlight">日志</a></li><li><a href="#示例日志-1" class="table-of-contents__link toc-highlight">示例日志</a></li><li><a href="#模型推理-dnn-api日志-1" class="table-of-contents__link toc-highlight">模型推理 DNN API日志</a></li></ul></li></ul></li><li><a href="#公版模型性能精度测评说明-1" class="table-of-contents__link toc-highlight">公版模型性能精度测评说明</a><ul><li><a href="#发布物说明" class="table-of-contents__link toc-highlight">发布物说明</a><ul><li><a href="#示例代码包结构-1" class="table-of-contents__link toc-highlight">示例代码包结构</a></li><li><a href="#示例模型-1" class="table-of-contents__link toc-highlight">示例模型</a></li><li><a href="#公共数据集-1" class="table-of-contents__link toc-highlight">公共数据集</a></li></ul></li><li><a href="#环境构建-3" class="table-of-contents__link toc-highlight">环境构建</a><ul><li><a href="#开发板准备-3" class="table-of-contents__link toc-highlight">开发板准备</a></li><li><a href="#编译环境准备-1" class="table-of-contents__link toc-highlight">编译环境准备</a></li></ul></li><li><a href="#测评示例使用说明-1" class="table-of-contents__link toc-highlight">测评示例使用说明</a><ul><li><a href="#json配置文件参数信息" class="table-of-contents__link toc-highlight">json配置文件参数信息</a></li><li><a href="#性能评测-1" class="table-of-contents__link toc-highlight">性能评测</a></li><li><a href="#精度评测-1" class="table-of-contents__link toc-highlight">精度评测</a></li></ul></li><li><a href="#模型集成-1" class="table-of-contents__link toc-highlight">模型集成</a><ul><li><a href="#前处理" class="table-of-contents__link toc-highlight">前处理</a></li><li><a href="#后处理" class="table-of-contents__link toc-highlight">后处理</a></li></ul></li><li><a href="#辅助工具和常用操作-3" class="table-of-contents__link toc-highlight">辅助工具和常用操作</a><ul><li><a href="#日志系统使用说明-1" class="table-of-contents__link toc-highlight">日志系统使用说明</a></li><li><a href="#算子耗时说明-1" class="table-of-contents__link toc-highlight">算子耗时说明</a></li><li><a href="#dump工具-1" class="table-of-contents__link toc-highlight">dump工具</a></li></ul></li></ul></li><li><a href="#模型上板分析工具说明-1" class="table-of-contents__link toc-highlight">模型上板分析工具说明</a><ul><li><a href="#概述-3" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#hrt_model_exec-工具使用说明-1" class="table-of-contents__link toc-highlight">hrt_model_exec 工具使用说明</a><ul><li><a href="#输入参数描述-2" class="table-of-contents__link toc-highlight">输入参数描述</a></li><li><a href="#使用说明-2" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#model_info-1" class="table-of-contents__link toc-highlight"><code>model_info</code></a></li><li><a href="#输入参数补充说明-3" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li><li><a href="#infer-1" class="table-of-contents__link toc-highlight"><code>infer</code></a></li><li><a href="#多输入模型说明-1" class="table-of-contents__link toc-highlight"><code>多输入模型说明</code></a></li><li><a href="#输入参数补充说明-4" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li><li><a href="#perf-1" class="table-of-contents__link toc-highlight"><code>perf</code></a></li><li><a href="#多线程latency数据说明-1" class="table-of-contents__link toc-highlight"><code>多线程Latency数据说明</code></a></li><li><a href="#输入参数补充说明-5" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li><li><a href="#常见问题" class="table-of-contents__link toc-highlight">常见问题</a></li></ul></li><li><a href="#hrt_bin_dump-工具使用说明-1" class="table-of-contents__link toc-highlight">hrt_bin_dump 工具使用说明</a><ul><li><a href="#输入参数描述-3" class="table-of-contents__link toc-highlight">输入参数描述</a></li><li><a href="#使用说明-3" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#示例说明-1" class="table-of-contents__link toc-highlight">示例说明</a></li></ul></li></ul></li></ul></li><li><a href="#rdk-ultra" class="table-of-contents__link toc-highlight">RDK Ultra</a><ul><li><a href="#模型推理dnn-api使用示例说明-2" class="table-of-contents__link toc-highlight">模型推理DNN API使用示例说明</a><ul><li><a href="#概述-4" class="table-of-contents__link toc-highlight">概述</a><ul><li><a href="#示例代码包结构介绍-2" class="table-of-contents__link toc-highlight">示例代码包结构介绍</a></li></ul></li><li><a href="#环境构建-4" class="table-of-contents__link toc-highlight">环境构建</a><ul><li><a href="#开发板准备-4" class="table-of-contents__link toc-highlight">开发板准备</a></li><li><a href="#编译-2" class="table-of-contents__link toc-highlight">编译</a></li></ul></li><li><a href="#示例使用-2" class="table-of-contents__link toc-highlight">示例使用</a><ul><li><a href="#basic_samples-示例-2" class="table-of-contents__link toc-highlight">basic_samples 示例</a></li><li><a href="#quick_start-2" class="table-of-contents__link toc-highlight">quick_start</a></li><li><a href="#api_tutorial-2" class="table-of-contents__link toc-highlight">api_tutorial</a></li><li><a href="#advanced_samples-2" class="table-of-contents__link toc-highlight">advanced_samples</a></li><li><a href="#misc-2" class="table-of-contents__link toc-highlight">misc</a></li></ul></li><li><a href="#辅助工具和常用操作-4" class="table-of-contents__link toc-highlight">辅助工具和常用操作</a><ul><li><a href="#日志-2" class="table-of-contents__link toc-highlight">日志</a></li><li><a href="#示例日志-3" class="table-of-contents__link toc-highlight">示例日志</a></li><li><a href="#模型推理-dnn-api日志-2" class="table-of-contents__link toc-highlight">模型推理 DNN API日志</a></li></ul></li></ul></li><li><a href="#公版模型性能精度测评说明-2" class="table-of-contents__link toc-highlight">公版模型性能精度测评说明</a><ul><li><a href="#评测方法说明-1" class="table-of-contents__link toc-highlight">评测方法说明</a><ul><li><a href="#简介-1" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#示例代码包结构-2" class="table-of-contents__link toc-highlight">示例代码包结构</a></li><li><a href="#示例模型-2" class="table-of-contents__link toc-highlight">示例模型</a></li><li><a href="#公共数据集-2" class="table-of-contents__link toc-highlight">公共数据集</a></li><li><a href="#环境构建-5" class="table-of-contents__link toc-highlight">环境构建</a></li><li><a href="#开发板准备-5" class="table-of-contents__link toc-highlight">开发板准备</a></li><li><a href="#编译环境准备-2" class="table-of-contents__link toc-highlight">编译环境准备</a></li><li><a href="#测评示例使用说明-2" class="table-of-contents__link toc-highlight">测评示例使用说明</a></li><li><a href="#性能评测-2" class="table-of-contents__link toc-highlight">性能评测</a></li><li><a href="#精度评测-2" class="table-of-contents__link toc-highlight">精度评测</a></li><li><a href="#数据预处理-2" class="table-of-contents__link toc-highlight">数据预处理</a></li><li><a href="#数据挂载-2" class="table-of-contents__link toc-highlight">数据挂载</a></li><li><a href="#模型推理-2" class="table-of-contents__link toc-highlight">模型推理</a></li><li><a href="#精度计算-2" class="table-of-contents__link toc-highlight">精度计算</a></li><li><a href="#模型集成-2" class="table-of-contents__link toc-highlight">模型集成</a></li><li><a href="#后处理文件添加-1" class="table-of-contents__link toc-highlight">后处理文件添加</a></li><li><a href="#增加模型运行脚本及配置文件-2" class="table-of-contents__link toc-highlight">增加模型运行脚本及配置文件</a></li><li><a href="#辅助工具和常用操作-5" class="table-of-contents__link toc-highlight">辅助工具和常用操作</a></li><li><a href="#日志系统使用说明-2" class="table-of-contents__link toc-highlight">日志系统使用说明</a></li><li><a href="#算子耗时说明-2" class="table-of-contents__link toc-highlight">算子耗时说明</a></li><li><a href="#dump工具-2" class="table-of-contents__link toc-highlight">dump工具</a></li></ul></li></ul></li><li><a href="#模型上板分析工具说明-2" class="table-of-contents__link toc-highlight">模型上板分析工具说明</a><ul><li><a href="#概述-5" class="table-of-contents__link toc-highlight">概述</a></li><li><a href="#hrt_model_exec-工具使用说明-2" class="table-of-contents__link toc-highlight">hrt_model_exec 工具使用说明</a><ul><li><a href="#输入参数描述-4" class="table-of-contents__link toc-highlight">输入参数描述</a></li><li><a href="#使用说明-4" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#model_info-2" class="table-of-contents__link toc-highlight"><code>model_info</code></a></li><li><a href="#输入参数补充说明-6" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li><li><a href="#infer-2" class="table-of-contents__link toc-highlight"><code>infer</code></a></li><li><a href="#多输入模型说明-2" class="table-of-contents__link toc-highlight"><code>多输入模型说明</code></a></li><li><a href="#输入参数补充说明-7" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li><li><a href="#perf-2" class="table-of-contents__link toc-highlight"><code>perf</code></a></li><li><a href="#多线程latency数据说明-2" class="table-of-contents__link toc-highlight"><code>多线程Latency数据说明</code></a></li><li><a href="#输入参数补充说明-8" class="table-of-contents__link toc-highlight"><code>输入参数补充说明</code></a></li></ul></li><li><a href="#hrt_bin_dump-工具使用说明-2" class="table-of-contents__link toc-highlight">hrt_bin_dump 工具使用说明</a><ul><li><a href="#输入参数描述-5" class="table-of-contents__link toc-highlight">输入参数描述</a></li><li><a href="#使用说明-5" class="table-of-contents__link toc-highlight">使用说明</a></li><li><a href="#示例说明-2" class="table-of-contents__link toc-highlight">示例说明</a></li></ul></li></ul></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">古月居<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">联系我们</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/437998606" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiLiBiLi<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 D-Robotics.</div></div></div></footer></div>
</body>
</html>