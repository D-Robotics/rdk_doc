name: Sync gh-pages to OSS

on:
  workflow_run:
    workflows: ["Deploy Docusaurus site to GitHub Pages"]  # deploy.yml workflow 名称
    types:
      - completed

jobs:
  sync-gh-pages:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout gh-pages branch
        uses: actions/checkout@v3
        with:
          ref: gh-pages
          fetch-depth: 0   # 拉取完整历史，保证可以 push

      - name: Upload to Alibaba Cloud OSS
        run: |
          # 1. 下载 ossutil 工具
          curl -L -o ossutil64 https://gosspublic.alicdn.com/ossutil/1.7.19/ossutil64
          chmod +x ossutil64

          # 2. 使用 GitHub Secrets 中的密钥配置 ossutil
          ./ossutil64 config -e ${{ secrets.OSS_ENDPOINT }} \
            -i ${{ secrets.OSS_ACCESS_KEY_ID }} \
            -k ${{ secrets.OSS_ACCESS_KEY_SECRET }}

          # 3. 同步当前目录（即 gh-pages 分支内容）到 OSS Bucket
          ./ossutil64 cp -r . oss://cn-rdk-front-prod/rdk_doc/ --update
