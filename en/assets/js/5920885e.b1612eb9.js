"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[57321],{28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var o=i(96540);const d={},r=o.createContext(d);function s(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),o.createElement(r.Provider,{value:n},e.children)}},52356:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>_,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"Advanced_development/linux_development/driver_development_s100/driver_pcie/s100x_pcie_sw_setup","title":"Configuration of S100X PCIe Module Functionality under the Kernel","description":"In the kernel, PCIe configuration consists of two parts: defconfig and DTS.","source":"@site/i18n/en/docusaurus-plugin-content-docs-docs_s/current/07_Advanced_development/02_linux_development/04_driver_development_s100/13_driver_pcie/03_s100x_pcie_sw_setup.md","sourceDirName":"07_Advanced_development/02_linux_development/04_driver_development_s100/13_driver_pcie","slug":"/Advanced_development/linux_development/driver_development_s100/driver_pcie/s100x_pcie_sw_setup","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_pcie/s100x_pcie_sw_setup","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1769771560000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"S100X PCIe Software Architecture and Module Partitioning","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_pcie/s100x_pcie_sw_arch"},"next":{"title":"PCIe User-space High Level API Introduction","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_pcie/s100x_pcie_libhbpciehal"}}');var d=i(74848),r=i(28453);const s={sidebar_position:3},l="Configuration of S100X PCIe Module Functionality under the Kernel",t={},c=[{value:"defconfig",id:"defconfig",level:2},{value:"DTS",id:"dts",level:2},{value:"RC Mode",id:"rc-mode",level:3},{value:"EP Mode",id:"ep-mode",level:3},{value:"PCIe Link Configuration",id:"pcie-link-configuration",level:3}];function a(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"configuration-of-s100x-pcie-module-functionality-under-the-kernel",children:"Configuration of S100X PCIe Module Functionality under the Kernel"})}),"\n",(0,d.jsx)(n.p,{children:"In the kernel, PCIe configuration consists of two parts: defconfig and DTS."}),"\n",(0,d.jsx)(n.h2,{id:"defconfig",children:"defconfig"}),"\n",(0,d.jsx)(n.p,{children:"The following basic configurations must be included in the kernel's defconfig file:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"CONFIG_PCI=y\nCONFIG_PCI_DOMAINS=y\nCONFIG_PCI_DOMAINS_GENERIC=y\nCONFIG_PCI_SYSCALL=y\nCONFIG_PCIEAER=y\nCONFIG_PCIE_PTM=y\nCONFIG_PCI_MSI=y\nCONFIG_PCI_MSI_IRQ_DOMAIN=y\nCONFIG_PCI_QUIRKS=y\nCONFIG_PCI_DEBUG=y\nCONFIG_PCI_REALLOC_ENABLE_AUTO=y\nCONFIG_PCI_IOV=y\nCONFIG_PCIE_BUS_DEFAULT=y\nCONFIG_PCIEPORTBUS=y\n"})}),"\n",(0,d.jsx)(n.p,{children:"Configurations required to enable RC mode are as follows:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"CONFIG_PCIE_HOBOT=m\nCONFIG_PCIE_HOBOT_RC=m\nCONFIG_PCIE_HOBOT_EP_DEV=m\nCONFIG_PCIE_HOBOT_EP_DEV_MAN=m\n"})}),"\n",(0,d.jsx)(n.p,{children:"Configurations required for RC mode to support NVMe are as follows:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"CONFIG_BLK_DEV_NVME=m\n"})}),"\n",(0,d.jsx)(n.p,{children:"Configurations required to enable EP mode are as follows:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"CONFIG_PCIE_HOBOT=m\nCONFIG_PCIE_HOBOT_EP=m\nCONFIG_PCIE_HOBOT_EP_FUN=m\n"})}),"\n",(0,d.jsx)(n.p,{children:"Among these, hybrid functionality must be enabled and is already included in the above configurations. Other features can be configured as needed."}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-shell",children:"CONFIG_PCIE_HOBOT_DEBUG=y\n"})}),"\n",(0,d.jsx)(n.h2,{id:"dts",children:"DTS"}),"\n",(0,d.jsx)(n.p,{children:"Note that the same controller can only be configured as either RC or EP mode, not both."}),"\n",(0,d.jsx)(n.h3,{id:"rc-mode",children:"RC Mode"}),"\n",(0,d.jsxs)(n.p,{children:["The configuration nodes for the controllers are: ",(0,d.jsx)(n.code,{children:"hobot_pcie_rc0"})," and ",(0,d.jsx)(n.code,{children:"hobot_pcie_rc1"}),"."]}),"\n",(0,d.jsxs)(n.p,{children:["Typically, you only need to change the ",(0,d.jsx)(n.code,{children:"status"})," field from ",(0,d.jsx)(n.code,{children:"disable"})," to ",(0,d.jsx)(n.code,{children:"okay"})," to enable RC mode for the corresponding controller, and vice versa to disable it."]}),"\n",(0,d.jsx)(n.h3,{id:"ep-mode",children:"EP Mode"}),"\n",(0,d.jsxs)(n.p,{children:["The configuration nodes for the controllers are: ",(0,d.jsx)(n.code,{children:"hobot_pcie_ep0"})," and ",(0,d.jsx)(n.code,{children:"hobot_pcie_ep1"}),"."]}),"\n",(0,d.jsxs)(n.p,{children:["In addition to configuring the controller itself, its child nodes ",(0,d.jsx)(n.code,{children:"funX"})," also need to be configured.",(0,d.jsx)(n.br,{}),"\n",(0,d.jsx)(n.code,{children:"fun0"})," must be enabled."]}),"\n",(0,d.jsx)(n.h3,{id:"pcie-link-configuration",children:"PCIe Link Configuration"}),"\n",(0,d.jsx)(n.p,{children:"PCIe links support three modes:"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"PCIe0 x4 Lane;"}),"\n",(0,d.jsx)(n.li,{children:"PCIe0 x2 Lane + GMAC0 + GMAC1;"}),"\n",(0,d.jsx)(n.li,{children:"PCIe0 x1 Lane + PCIe1 x1 Lane + GMAC0 + GMAC1;"}),"\n"]}),"\n",(0,d.jsx)(n.p,{children:"Link configuration in the DTS is as follows:"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-dts",children:"/* rdk-v0p5.dtsi */\n...\n\n    &hsis0 {\n        hsi-mode = <0x4>;  /* 0x1: pcie x4, 0x4: pcie x2 + gmac0 + gmac1, 0x8: pcie0 x1 + pcie1 x1 + gmac0 + gmac1 */\n    };\n\n...\n"})})]})}function _(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(a,{...e})}):a(e)}}}]);