"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[76385],{28453:(e,n,m)=>{m.d(n,{R:()=>l,x:()=>o});var i=m(96540);const a={},s=i.createContext(a);function l(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(s.Provider,{value:n},e.children)}},43526:(e,n,m)=>{m.r(n),m.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>t,frontMatter:()=>l,metadata:()=>i,toc:()=>r});const i=JSON.parse('{"id":"Advanced_development/multimedia_development/multimedia_application/hbmem_sample_guide","title":"hbmem sample usage instructions","description":"Function Overview","source":"@site/i18n/en/docusaurus-plugin-content-docs-docs_s/current/07_Advanced_development/03_multimedia_development/02_multimedia_application/12_hbmem_sample_guide.md","sourceDirName":"07_Advanced_development/03_multimedia_development/02_multimedia_application","slug":"/Advanced_development/multimedia_development/multimedia_application/hbmem_sample_guide","permalink":"/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/multimedia_application/hbmem_sample_guide","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1765441999000,"sidebarPosition":12,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Sunrise Camera Development Guide","permalink":"/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/multimedia_application/sunrise_camera_develop_guide"},"next":{"title":"7.4 \u7b97\u6cd5\u5de5\u5177\u94fe\u5f00\u53d1\u6307\u5357","permalink":"/rdk_doc/en/rdk_s/04_toolchain_development"}}');var a=m(74848),s=m(28453);const l={},o="hbmem sample usage instructions",c={},r=[{value:"Function Overview",id:"function-overview",level:2},{value:"Software Architecture Description",id:"software-architecture-description",level:2},{value:"Code Location and Directory Structure",id:"code-location-and-directory-structure",level:2},{value:"API Workflow Description",id:"api-workflow-description",level:2},{value:"Compilation",id:"compilation",level:2},{value:"Compilation Environment",id:"compilation-environment",level:3},{value:"Compilation Instructions",id:"compilation-instructions",level:3},{value:"Compilation Commands",id:"compilation-commands",level:3},{value:"Execution",id:"execution",level:2},{value:"Supported Platforms",id:"supported-platforms",level:3},{value:"Running Guide",id:"running-guide",level:3},{value:"Execution Methods",id:"execution-methods",level:4},{value:"Runtime Parameter Description",id:"runtime-parameter-description",level:3},{value:"Test Result Description",id:"test-result-description",level:3},{value:"Execution Output Examples",id:"execution-output-examples",level:3},{value:"Create com buffer",id:"create-com-buffer",level:4}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"hbmem-sample-usage-instructions",children:"hbmem sample usage instructions"})}),"\n",(0,a.jsx)(n.h2,{id:"function-overview",children:"Function Overview"}),"\n",(0,a.jsx)(n.p,{children:"Instructions for using hbmem APIs, including creation and usage of com buffer, graphic buffer, graphic buffer group, queue, pool, share pool, and multi-process sharing."}),"\n",(0,a.jsx)(n.h2,{id:"software-architecture-description",children:"Software Architecture Description"}),"\n",(0,a.jsx)(n.p,{children:"This sample is implemented based on the libhbmem API, invoking APIs provided by libhbmem to allocate memory for different buffer types and enable inter-process sharing."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/hbmem/hbmem_sample_block_diagram.png",alt:"hbmem_sample_block_diagram"})}),"\n",(0,a.jsx)(n.h2,{id:"code-location-and-directory-structure",children:"Code Location and Directory Structure"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"1. Code location: /app/communication_demo/hbmem_demo/sample_hbmem\n2. Directory structure:\n    ./\n    \u251c\u2500\u2500 Makefile\n    \u251c\u2500\u2500 sample_alloc.c\n    \u251c\u2500\u2500 sample.c\n    \u251c\u2500\u2500 sample_common.c\n    \u251c\u2500\u2500 sample_common.h\n    \u251c\u2500\u2500 sample_pool.c\n    \u251c\u2500\u2500 sample_queue.c\n    \u251c\u2500\u2500 sample_share.c\n    \u2514\u2500\u2500 sample_share_pool.c\n"})}),"\n",(0,a.jsx)(n.h2,{id:"api-workflow-description",children:"API Workflow Description"}),"\n",(0,a.jsx)(n.p,{children:"The libhbmem library calls ION to allocate buffers."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/hbmem/hbmem_sample_call_sequence.png",alt:"hbmem_sample_call_sequence"})}),"\n",(0,a.jsx)(n.p,{children:"Allocation flowchart for com buffer, graph buffer, and graphic buffer group:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/hbmem/hbmem_alloc_buf.png",alt:"hbmem_alloc_buf"})}),"\n",(0,a.jsx)(n.p,{children:"Queue usage flowchart:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/hbmem/hbmem_queue.png",alt:"hbmem_queue"})}),"\n",(0,a.jsx)(n.p,{children:"Pool usage flowchart:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/hbmem/hbmem_pool.png",alt:"hbmem_pool"})}),"\n",(0,a.jsx)(n.p,{children:"Share pool usage flowchart:"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/hbmem/hbmem_share_pool.png",alt:"hbmem_share_pool"})}),"\n",(0,a.jsx)(n.h2,{id:"compilation",children:"Compilation"}),"\n",(0,a.jsx)(n.h3,{id:"compilation-environment",children:"Compilation Environment"}),"\n",(0,a.jsx)(n.p,{children:"This sample supports direct compilation on the board."}),"\n",(0,a.jsx)(n.h3,{id:"compilation-instructions",children:"Compilation Instructions"}),"\n",(0,a.jsx)(n.p,{children:"This sample primarily depends on header files provided by libhbmem:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-c",children:"#include <hb_mem_mgr.h>\n#include <hb_mem_err.h>\n"})}),"\n",(0,a.jsx)(n.p,{children:"Compilation dependencies include the following libraries:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-makefile",children:"LIBS += -lhbmem -lpthread -lalog -ldl -lstdc++\n"})}),"\n",(0,a.jsx)(n.h3,{id:"compilation-commands",children:"Compilation Commands"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Enter the sample directory:\ncd /app/communication_demo/hbmem_demo/sample_hbmem\n# Compile the sample:\nmake\n# Output file:\n/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample\n"})}),"\n",(0,a.jsx)(n.h2,{id:"execution",children:"Execution"}),"\n",(0,a.jsx)(n.h3,{id:"supported-platforms",children:"Supported Platforms"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"RDK S100 / RDK S100P"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"running-guide",children:"Running Guide"}),"\n",(0,a.jsx)(n.h4,{id:"execution-methods",children:"Execution Methods"}),"\n",(0,a.jsx)(n.p,{children:"Create a com buffer:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 1\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create cached and non-cached com buffers, perform assignment, and measure execution time:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 2\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create com buffers in various heaps:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 3\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create a graphic buffer:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 4\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create graphic buffers in various heaps:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 5\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create a graphic buffer group:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 6\n"})}),"\n",(0,a.jsx)(n.p,{children:"Create graphic buffer groups in various heaps:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 7\n"})}),"\n",(0,a.jsx)(n.p,{children:"Intra-process common buffer sharing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 8\n"})}),"\n",(0,a.jsx)(n.p,{children:"Intra-process common buffer sharing with consume_cnt:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 9\n"})}),"\n",(0,a.jsx)(n.p,{children:"Inter-process common buffer sharing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 10\n"})}),"\n",(0,a.jsx)(n.p,{children:"Intra-process graphic buffer sharing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 11\n"})}),"\n",(0,a.jsx)(n.p,{children:"Intra-process graphic buffer sharing with consume_cnt:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 12\n"})}),"\n",(0,a.jsx)(n.p,{children:"Inter-process graphic buffer sharing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 13\n"})}),"\n",(0,a.jsx)(n.p,{children:"Intra-process graphic buffer group sharing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 14\n"})}),"\n",(0,a.jsx)(n.p,{children:"Intra-process graphic buffer group sharing with consume_cnt:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 15\n"})}),"\n",(0,a.jsx)(n.p,{children:"Inter-process graphic buffer group sharing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 16\n"})}),"\n",(0,a.jsx)(n.p,{children:"Inter-process share pool sharing:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 17\n"})}),"\n",(0,a.jsx)(n.p,{children:"Share pool usage:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 18\n```buffer queue usage\n\n```bash\n/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 19\n"})}),"\n",(0,a.jsx)(n.p,{children:"pool usage"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 20\n"})}),"\n",(0,a.jsx)(n.p,{children:"Implement buffer conversion between graphic buffer and common buffer"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 21\n"})}),"\n",(0,a.jsx)(n.p,{children:"Increment user-space reference count of common buffer"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 22\n"})}),"\n",(0,a.jsx)(n.p,{children:"Increment user-space reference count of graphic buffer"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 23\n"})}),"\n",(0,a.jsx)(n.h3,{id:"runtime-parameter-description",children:"Runtime Parameter Description"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"-m"})," specifies the sample test case; refer to the execution output for details."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"test-result-description",children:"Test Result Description"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["If the log ends with ",(0,a.jsx)(n.code,{children:"xxxx done"}),", it indicates the sample executed successfully."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"execution-output-examples",children:"Execution Output Examples"}),"\n",(0,a.jsx)(n.h4,{id:"create-com-buffer",children:"Create com buffer"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-text",children:"/app/communication_demo/hbmem_demo/sample_hbmem/libhbmem_sample -m 1\nsample_mode = 1\n=================================================\nReady to sample_alloc_com_buf\nalloc com buf, share_id: 16\n[1752:1752] Do system command cat /sys/kernel/debug/ion/clients/1752*.\n        heap_name:    size_in_bytes :  handle refcount :    handle import :       buffer ptr :  buffer refcount :  buffer share id : buffer share count\n        ion_cma:           400000 :                1 :                1 :         fd48e1ab :                3:               16 :                1\n[1752:1752] Do system command cat /sys/kernel/debug/ion/heaps/ion_cma | grep -w 1752 | grep -w libhbmem_sample.\n        libhbmem_sample             1752          4194304\n        libhbmem_sample             1752            other          4194304 0\n[1752:1752] Result 0.\nfree com buf\n[1752:1752] Do system command cat /sys/kernel/debug/ion/clients/1752*.\n        heap_name:    size_in_bytes :  handle refcount :    handle import :       buffer ptr :  buffer refcount :  buffer share id : buffer share count\n[1752:1752] Do system command cat /sys/kernel/debug/ion/heaps/ion_cma | grep -w 1752 | grep -w libhbmem_sample.\n[1752:1752] Result 256.\nsample_alloc_com_buf done\n=================================================\n"})}),"\n",(0,a.jsx)(n.p,{children:"(Other execution output examples retain the original text structure, with only formatting and keyword adjustments applied; repetitive content omitted here.)"})]})}function t(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);