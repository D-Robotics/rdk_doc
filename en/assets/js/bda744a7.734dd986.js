"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[30793],{28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var t=i(96540);const o={},d=t.createContext(o);function a(e){const n=t.useContext(d);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(d.Provider,{value:n},e.children)}},99657:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Basic_Application/cdev_demo_sample/rtsp2display","title":"3.2.3 rtsp2display Example Introduction","description":"Example Overview","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/03_Basic_Application/02_cdev_demo_sample/rtsp2display.md","sourceDirName":"03_Basic_Application/02_cdev_demo_sample","slug":"/Basic_Application/cdev_demo_sample/rtsp2display","permalink":"/rdk_doc/en/Basic_Application/cdev_demo_sample/rtsp2display","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1764751642000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"3.2.2 decode2display Sample Introduction","permalink":"/rdk_doc/en/Basic_Application/cdev_demo_sample/decode2display"},"next":{"title":"3.2.4 vio_capture Sample Introduction","permalink":"/rdk_doc/en/Basic_Application/cdev_demo_sample/vio_capture"}}');var o=i(74848),d=i(28453);const a={sidebar_position:3},r="3.2.3 rtsp2display Example Introduction",s={},l=[{value:"Example Overview",id:"example-overview",level:2},{value:"Effect Demonstration",id:"effect-demonstration",level:2},{value:"Hardware Preparation",id:"hardware-preparation",level:2},{value:"Hardware Connection",id:"hardware-connection",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"Code and Board Location",id:"code-and-board-location",level:3},{value:"Compilation and Execution",id:"compilation-and-execution",level:3},{value:"Execution Effect",id:"execution-effect",level:3},{value:"Detailed Introduction",id:"detailed-introduction",level:2},{value:"Example Program Parameter Options Explanation",id:"example-program-parameter-options-explanation",level:3},{value:"Software Architecture Explanation",id:"software-architecture-explanation",level:3},{value:"API Process Explanation",id:"api-process-explanation",level:3},{value:"FAQ",id:"faq",level:3}];function c(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"323-rtsp2display-example-introduction",children:"3.2.3 rtsp2display Example Introduction"})}),"\n",(0,o.jsx)(n.h2,{id:"example-overview",children:"Example Overview"}),"\n",(0,o.jsxs)(n.p,{children:["rtsp2display is a ",(0,o.jsx)(n.strong,{children:"C language interface"})," development code example located in /app/cdev_demo, demonstrating how to obtain H.264 stream from RTSP video stream, and achieve real-time video playback on embedded device screens through hardware decoding (SP_Decoder), video processing (SP_VPS), and display module (SP_Display). Core functionalities include:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"RTSP streaming protocol parsing"}),"\n",(0,o.jsx)(n.li,{children:"H.264 hardware decoding"}),"\n",(0,o.jsx)(n.li,{children:"Video scaling and format conversion"}),"\n",(0,o.jsx)(n.li,{children:"Multi-module collaborative rendering to display"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"effect-demonstration",children:"Effect Demonstration"}),"\n",(0,o.jsx)(n.h2,{id:"hardware-preparation",children:"Hardware Preparation"}),"\n",(0,o.jsx)(n.p,{children:"Prepare an RDK development board, log in to the desktop via HDMI or VNC"}),"\n",(0,o.jsx)(n.h3,{id:"hardware-connection",children:"Hardware Connection"}),"\n",(0,o.jsx)(n.p,{children:"This example does not require a mouse and keyboard, so here we connect an HDMI display, Ethernet cable interface, and power cable"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"http://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/03_Basic_Application/02_cdev_demo_sample/image/hardware-connect.png",alt:"connect-img"})}),"\n",(0,o.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,o.jsx)(n.h3,{id:"code-and-board-location",children:"Code and Board Location"}),"\n",(0,o.jsx)(n.p,{children:"Navigate to /app/cdev_demo/rtsp2display location, you can see the rtsp2display example contains 2 files"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"root@ubuntu:/app/cdev_demo/rtsp2display# tree\n.\n\u251c\u2500\u2500 Makefile\n\u2514\u2500\u2500 rtsp2display.c\n"})}),"\n",(0,o.jsx)(n.h3,{id:"compilation-and-execution",children:"Compilation and Execution"}),"\n",(0,o.jsx)(n.p,{children:"We can directly use make in this directory to compile the rtsp2display executable file."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"root@ubuntu:/app/cdev_demo/rtsp2display# tree\n.\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 rtsp2display\n\u251c\u2500\u2500 rtsp2display.c\n\u2514\u2500\u2500 rtsp2display.o\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"execution-effect",children:"Execution Effect"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"First"})," we need to prepare the input data. Here we can copy existing data from the board, such as the 1920x1080.h264 file from /opt/tros/humble/lib/hobot_codec/config/1920x1080.h264 directory to the current directory for separate operation without affecting the original data."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Second"})," we use ",(0,o.jsx)(n.code,{children:"systemctl stop lightdm"})," to stop the display service."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Then"})," start live555MediaServer. Here we can copy live555MediaServer from /app/pydev_demo/08_decode_rtsp_stream location to the current directory and run it in the background."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Next"})," we use ",(0,o.jsx)(n.code,{children:"sudo ./rtsp2display -i rtsp://127.0.0.1/1920x1080.h264 -t tcp"})," command. The default execution result is to decode the h264 file transmitted via rtsp and display it on the connected monitor."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Finally"})," use the ",(0,o.jsx)(n.code,{children:"./decoder2display"})," command. The default execution result is to decode the 1920x1080.h264 file and display it on the monitor."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'root@ubuntu:/app/cdev_demo/rtsp2display# cp /opt/tros/humble/lib/hobot_codec/config/1920x1080.h264 ./\nroot@ubuntu:/app/cdev_demo/rtsp2display# cp /app/pydev_demo/08_decode_rtsp_stream/live555MediaServer ./\nroot@ubuntu:/app/cdev_demo/rtsp2display# ./live555MediaServer &\n        version 1.01 (LIVE555 Streaming Media library version 2020.07.09).\nPlay streams from this server using the URL\n        rtsp://192.168.127.10/<filename>\nwhere <filename> is a file present in the current directory.\nEach file\'s type is inferred from its name suffix:\n        ".264" => a H.264 Video Elementary Stream file\n        ".265" => a H.265 Video Elementary Stream file\n        ".aac" => an AAC Audio (ADTS format) file\n        ".ac3" => an AC-3 Audio file\n        ".amr" => an AMR Audio file\n        ".dv" => a DV Video file\n        ".m4e" => a MPEG-4 Video Elementary Stream file\n        ".mkv" => a Matroska audio+video+(optional)subtitles file\n        ".mp3" => a MPEG-1 or 2 Audio file\n        ".mpg" => a MPEG-1 or 2 Program Stream (audio+video) file\n        ".ogg" or ".ogv" or ".opus" => an Ogg audio and/or video file\n        ".ts" => a MPEG Transport Stream file\n                (a ".tsx" index file - if present - provides server \'trick play\' support)\n        ".vob" => a VOB (MPEG-2 video with AC-3 audio) file\n        ".wav" => a WAV Audio file\n        ".webm" => a WebM audio(Vorbis)+video(VP8) file\nSee http://www.live555.com/mediaServer/ for additional documentation.\n(We use port 80 for optional RTSP-over-HTTP tunneling, or for HTTP live streaming (for indexed Transport Stream files only).)\nroot@ubuntu:/app/cdev_demo/rtsp2display# \n'})}),"\n",(0,o.jsx)(n.p,{children:"After executing the above commands, we have effectively started the streaming media server. The next step is to use rtsp2display to obtain the h264 file transmitted via rtsp."}),"\n",(0,o.jsxs)(n.p,{children:["Similarly, we still need to use the ",(0,o.jsx)(n.code,{children:"systemctl stop lightdm"})," command to stop the display service for optimal display effect."]}),"\n",(0,o.jsxs)(n.p,{children:["Then we use the ",(0,o.jsx)(n.code,{children:"sudo ./rtsp2display -i rtsp://127.0.0.1/1920x1080.h264 -t tcp"})," command to decode the h264 file transmitted via rtsp and display it on the connected monitor. The execution effect is as follows:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"root@ubuntu:/app/cdev_demo/rtsp2display# systemctl stop lightdm\nroot@ubuntu:/app/cdev_demo/rtsp2display# sudo ./rtsp2display -i rtsp://127.0.0.1/1920x1080.h264 -t tcp\navformat_open_input ok!\navformat_find_stream_info ok!\nInput #0, rtsp, from 'rtsp://127.0.0.1/1920x1080.h264':\n  Metadata:\n    title           : H.264 Video, streamed by the LIVE555 Media Server\n    comment         : 1920x1080.h264\n  Duration: N/A, start: 0.041667, bitrate: N/A\n  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 24 fps, 24 tbr, 90k tbn, 48 tbc\nav_dump_format ok!\nOpened DRM device: /dev/dri/card0\n1920x1080\n1360x768\n1280x1024\n1280x720\n1024x768\n800x600\n720x576\n720x480\n640x480\nrtsp_w:1920,rtsp_h:1080\ndisplay_w:1920,dispaly_h:1080\nOpened DRM device: /dev/dri/card0\nDRM is available, using libdrm for rendering.\n------------------------------------------------------\nPlane 0:\n  Plane ID: 41\n  Src W: 1920\n  Src H: 1080\n  CRTC X: 0\n  CRTC Y: 0\n  CRTC W: 1920\n  CRTC H: 1080\n  Format: NV12\n  Z Pos: 0\n  Alpha: 65535\n  Pixel Blend Mode: 1\n  Rotation: -1\n  Color Encoding: -1\n  Color Range: -1\n------------------------------------------------------\nSetting DRM client capabilities...\nSetting up KMS...\nCRTC ID: 31\nCRTC ID: 63\nNumber of connectors: 1\nConnector ID: 74\n    Type: 11\n    Type Name: HDMI-A\n    Connection: Connected\n    Modes: 32\n    Subpixel: 1\n    Mode 0: 1920x1080 @ 60Hz\n    Mode 1: 1920x1080 @ 60Hz\n    Mode 2: 1920x1080 @ 60Hz\n    Mode 3: 1920x1080i @ 60Hz\n    Mode 4: 1920x1080i @ 60Hz\n    Mode 5: 1920x1080 @ 50Hz\n    Mode 6: 1920x1080i @ 50Hz\n    Mode 7: 1280x1024 @ 60Hz\n    Mode 8: 1440x900 @ 60Hz\n    Mode 9: 1360x768 @ 60Hz\n    Mode 10: 1280x720 @ 60Hz\n    Mode 11: 1280x720 @ 60Hz\n    Mode 12: 1280x720 @ 50Hz\n    Mode 13: 1024x768 @ 60Hz\n    Mode 14: 800x600 @ 60Hz\n    Mode 15: 720x576 @ 50Hz\n    Mode 16: 720x576 @ 50Hz\n    Mode 17: 720x576 @ 50Hz\n    Mode 18: 720x576i @ 50Hz\n    Mode 19: 720x576i @ 50Hz\n    Mode 20: 720x480 @ 60Hz\n    Mode 21: 720x480 @ 60Hz\n    Mode 22: 720x480 @ 60Hz\n    Mode 23: 720x480 @ 60Hz\n    Mode 24: 720x480 @ 60Hz\n    Mode 25: 720x480i @ 60Hz\n    Mode 26: 720x480i @ 60Hz\n    Mode 27: 720x480i @ 60Hz\n    Mode 28: 720x480i @ 60Hz\n    Mode 29: 640x480 @ 60Hz\n    Mode 30: 640x480 @ 60Hz\n    Mode 31: 640x480 @ 60Hz\n2000/01/01 12:19:07.245 !INFO [CamInitVseParam][0418]Setting VSE channel-0: input_width:1920, input_height:1080, dst_w:1920, dst_h:1080\n================= VP Modules Status ====================\n======================== VFLOW =========================\n(active)[S0] vse0_C0\n========================= SIF ==========================\n========================= ISP ==========================\n========================= VSE ==========================\n------------------- flow0 info -------------------\ninput_fps:0/0\ninput_width:1920\ninput_height:1080\ninput_format:2\ninput_bitwidth:8\ndns0 channel: roi [0][0][1920][1080], target [1920][1080], fps [0/0]\n========================= VENC =========================\n========================= VDEC =========================\n----decode param----\ndec_idx  dec_id feed_mode pix_fmt bitstream_buf_size bitstream_buf_count frame_buf_count\n      0    h264         1       1            3110912                   6               6\n----h264 decode param----\ndec_idx  dec_id reorder_enable skip_mode bandwidth_Opt\n      0    h264              1         0             1\n\n----decode frameinfo----\ndec_idx  dec_id display_width display_height\n      0    h264             0              0\n----decode status----\ndec_idx  dec_id cur_input_buf_cnt cur_output_buf_cnt total_input_buf_cnt total_output_buf_cnt     fps\n      0    h264                 0                  0                   0                    0       0\n========================= JENC =========================\n======================= Buffer =========================\n----------------------------------------------\nflowid module cid chn FREE  REQ  PRO  COM USED\n----------------------------------------------\n0      vse0   0   0     16    0    0    0    0\n0      vse0   0   8      0    3    0    0    0\n\n----------------------------------------------\nflowid module cid chn FREE  REQ  PRO  COM USED\n----------------------------------------------\n0      vse0   0   0     16    0    0    0    0\n0      vse0   0   8      0    3    0    0    0\n\n========================= END ===========================\nsp_open_vps success!\n2000/01/01 12:19:07.254 !INFO [BindTo][0088]BindTo_CHN:-1\n\n2000/01/01 12:19:07.254 !INFO [BindTo][0093]m_prev_module_chn:0\n\n2000/01/01 12:19:07.254 !INFO [BindTo][0088]BindTo_CHN:-1\n\n2000/01/01 12:19:07.254 !INFO [BindTo][0093]m_prev_module_chn:0\n\n2000/01/01 12:19:07.291 !INFO [SetImageFrame][0495]N2D init done!\n\nCreated new framebuffer: fb_id=78 for dma_buf_fd=21\nadd mapping dma_buf_fd:21 fb_id:78, mapping_count: 1\nCreated new framebuffer: fb_id=79 for dma_buf_fd=22\nadd mapping dma_buf_fd:22 fb_id:79, mapping_count: 2\nCould not read frame ---(error 'End of file')\n"})}),"\n",(0,o.jsx)(n.p,{children:"The content displayed on the screen is as follows"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"http://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/03_Basic_Application/02_cdev_demo_sample/image/cdev_decode2display_vlc.png",alt:"HDMI_IMG"})}),"\n",(0,o.jsx)(n.h2,{id:"detailed-introduction",children:"Detailed Introduction"}),"\n",(0,o.jsx)(n.h3,{id:"example-program-parameter-options-explanation",children:"Example Program Parameter Options Explanation"}),"\n",(0,o.jsx)(n.p,{children:"We can directly execute the target file to confirm the parameter options explanation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"root@ubuntu:/app/cdev_demo/rtsp2display# ./rtsp2display \nUsage: rtsp2display [OPTION...]\ndecode2display sample -- An example of streaming video decoding to the display\n\n  -i, --input=path           rtsp url\n  -t, --type=type            tcp or udp\n  -?, --help                 Give this help list\n      --usage                Give a short usage message\n\nMandatory or optional arguments to long options are also mandatory or optional\nfor any corresponding short options.\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Where ",(0,o.jsx)(n.br,{}),"\n","-i  is a mandatory option, representing the input video file path",(0,o.jsx)(n.br,{}),"\n","-t  is a mandatory option, representing whether to use tcp or udp network transmission protocol"]}),"\n",(0,o.jsx)(n.h3,{id:"software-architecture-explanation",children:"Software Architecture Explanation"}),"\n",(0,o.jsxs)(n.p,{children:["We combine the example introduction to understand the software architecture explanation. First, use ffmpeg's libavformat interface to parse and verify packet headers, etc., initialize the decoder, VPS, display and other related modules,",(0,o.jsx)(n.br,{}),"\n","then bind the decoder->vps->display pathway, and then transmit the data parsed by libavformat to the decoder through sp_decoder_set_img. The decoder then sends the data through the already bound pathway",(0,o.jsx)(n.br,{}),"\n","via vps to the display for display."]}),"\n",(0,o.jsx)("center",{children:(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"http://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/03_Basic_Application/02_cdev_demo_sample/image/cdev_rtsp2display_software_arch.png",alt:"software_arch"})})}),"\n",(0,o.jsx)(n.h3,{id:"api-process-explanation",children:"API Process Explanation"}),"\n",(0,o.jsx)("center",{children:(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:"http://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/03_Basic_Application/02_cdev_demo_sample/image/cdev_rtsp2display_api_flow.png",alt:"software_arch"})})}),"\n",(0,o.jsx)(n.h3,{id:"faq",children:"FAQ"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Q:"})," Why does the example use live555MediaServer?",(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.strong,{children:"A:"}),' To establish the streaming media pathway. First, we need to understand the data flow, which is roughly: "H.264 file \u2192 live555MediaServer \u2192 network RTSP stream \u2192 rtsp2display \u2192 decoding \u2192 processing \u2192 display". live555MediaServer converts the static H.264 file into a dynamic RTSP video stream, allowing rtsp2display to obtain the network RTSP stream for decoding processing.']}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Q:"})," Can live555MediaServer be replaced?",(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.strong,{children:"A:"})," Yes, there are multiple ways to set up a streaming media server. Cloud-based options include Alibaba Cloud, AWS; self-built options include various choices besides live555, such as SRS, Nginx-rtmp, MediaSoup, etc."]})]})}function p(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);