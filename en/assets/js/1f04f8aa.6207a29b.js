"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[16238],{28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var o=i(96540);const t={},r=o.createContext(t);function s(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),o.createElement(r.Provider,{value:n},e.children)}},31057:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"System_configuration/config_txt","title":"2.3 config.txt File Configuration","description":"- All settings in configuration files can be manually overridden within Uboot. Manually configured settings in Uboot (using setenv in the Uboot command line) take precedence over those in configuration files. The full environment variable priority order is: setenv > config file > last boot\'s saveenv;","source":"@site/i18n/en/docusaurus-plugin-content-docs-docs_s/current/02_System_configuration/03_config_txt.md","sourceDirName":"02_System_configuration","slug":"/System_configuration/config_txt","permalink":"/rdk_doc/en/rdk_s/System_configuration/config_txt","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1769771560000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"2.2 srpi-config Tool Configuration","permalink":"/rdk_doc/en/rdk_s/System_configuration/srpi-config"},"next":{"title":"2.4 Thermal and CPU Frequency Management","permalink":"/rdk_doc/en/rdk_s/System_configuration/frequency_management"}}');var t=i(74848),r=i(28453);const s={sidebar_position:3},d="2.3 config.txt File Configuration",l={},a=[{value:"Usage Guide",id:"usage-guide",level:2},{value:"Configure kernel bootargs (kernel cmdline)",id:"configure-kernel-bootargs-kernel-cmdline",level:3},{value:"Modify kernel boot log level",id:"modify-kernel-boot-log-level",level:3},{value:"Temporarily modify the device tree (DTS)",id:"temporarily-modify-the-device-tree-dts",level:3},{value:"Enable or disable specific nodes",id:"enable-or-disable-specific-nodes",level:4},{value:"Configure DTB Overlay Files",id:"configure-dtb-overlay-files",level:4},{value:"Custom config.txt Guide",id:"custom-configtxt-guide",level:2},{value:"config.txt Parsing Development Guide",id:"configtxt-parsing-development-guide",level:2}];function c(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"23-configtxt-file-configuration",children:"2.3 config.txt File Configuration"})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["All settings in configuration files can be manually overridden within Uboot. Manually configured settings in Uboot (using ",(0,t.jsx)(n.code,{children:"setenv"})," in the Uboot command line) take ",(0,t.jsx)(n.strong,{children:"precedence over"})," those in configuration files. The full environment variable priority order is: ",(0,t.jsx)(n.code,{children:"setenv > config file > last boot's saveenv"}),";"]}),"\n",(0,t.jsxs)(n.li,{children:['Throughout this chapter, the term "configuration file" refers to the file located at the ',(0,t.jsx)(n.strong,{children:"default path"})," ",(0,t.jsx)(n.code,{children:"/boot/config.txt"}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["Using a configuration file requires modifying the contents of the boot partition, which conflicts with the requirements of ",(0,t.jsx)(n.a,{href:"https://source.android.com/docs/security/features/verifiedboot",children:"AVB"}),". Therefore, this feature is unavailable when AVB is enabled (AVB is ",(0,t.jsx)(n.strong,{children:"disabled by default"}),");"]}),"\n"]})}),"\n",(0,t.jsx)(n.h2,{id:"usage-guide",children:"Usage Guide"}),"\n",(0,t.jsx)(n.admonition,{title:"Note",type:"info",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The default format of the configuration file is ",(0,t.jsx)(n.code,{children:"<key>=<value>"}),". Everything after the first ",(0,t.jsx)(n.code,{children:"="})," constitutes the value for the ",(0,t.jsx)(n.code,{children:"<key>"})," preceding it;"]}),"\n",(0,t.jsx)(n.li,{children:"Each line in the configuration file must not exceed 1024 characters;"}),"\n",(0,t.jsx)(n.li,{children:"Settings in the configuration file are not saved as Uboot's default environment by default;"}),"\n"]})}),"\n",(0,t.jsx)(n.h3,{id:"configure-kernel-bootargs-kernel-cmdline",children:"Configure kernel bootargs (kernel cmdline)"}),"\n",(0,t.jsxs)(n.p,{children:["Edit the configuration file and add: ",(0,t.jsx)(n.code,{children:"bootargs=<custom bootargs>"}),", for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Add cpu isolation configuration\nbootargs=isolcpus=1-2\n"})}),"\n",(0,t.jsx)(n.h3,{id:"modify-kernel-boot-log-level",children:"Modify kernel boot log level"}),"\n",(0,t.jsxs)(n.p,{children:["Edit the configuration file and add: ",(0,t.jsx)(n.code,{children:"loglevel=<custom log level>"}),", for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Add kernel loglevel configuration\nloglevel=8\n"})}),"\n",(0,t.jsx)(n.h3,{id:"temporarily-modify-the-device-tree-dts",children:"Temporarily modify the device tree (DTS)"}),"\n",(0,t.jsx)(n.h4,{id:"enable-or-disable-specific-nodes",children:"Enable or disable specific nodes"}),"\n",(0,t.jsxs)(n.p,{children:["Edit the configuration file and add:",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.code,{children:"fdt-enable=<full path of DTS node 1>;<full path of DTS node 2>;"}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.code,{children:"fdt-disable=<full path of DTS node 1>;<full path of DTS node 2>;"}),(0,t.jsx)(n.br,{}),"\n","For example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Enable kernel dts node\nfdt-enable=/soc/uart@394C0000;\n\n# Disable kernel dts node\nfdt-disable=/soc/uart@394C0000;\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"Note",type:"info",children:(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The trailing semicolon (",(0,t.jsx)(n.code,{children:";"}),") in the example lines ",(0,t.jsx)(n.strong,{children:"must not be omitted"}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["The full path of a DTS node can be obtained from ",(0,t.jsx)(n.code,{children:"/proc/device-tree"})," on the target board. For example:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"  root@ubuntu:~# realpath --relative-to=/proc/device-tree/ /proc/device-tree/soc/uart@394C0000\n  soc/uart@394C0000\n"})}),"\n","Note that a leading ",(0,t.jsx)(n.code,{children:"/"})," must be prepended to the path obtained from this command;"]}),"\n"]})}),"\n",(0,t.jsx)(n.h4,{id:"configure-dtb-overlay-files",children:"Configure DTB Overlay Files"}),"\n",(0,t.jsx)(n.p,{children:"References for DTB Overlay:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Kernel v6.1 official documentation: ",(0,t.jsx)(n.a,{href:"https://kernel.org/doc/html/v6.1/devicetree/overlay-notes.html",children:"Devicetree Overlay Notes"}),";"]}),"\n",(0,t.jsxs)(n.li,{children:["Uboot v2022.10 official documentation: ",(0,t.jsx)(n.a,{href:"https://docs.u-boot.org/en/v2022.10/usage/fdt_overlays.html",children:"Device Tree Overlays"}),";"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Brief introduction: A DTB Overlay file allows ",(0,t.jsx)(n.strong,{children:"adding or modifying"})," (but not removing) nodes in the currently used DTB without altering the original DTS file used for booting."]}),"\n",(0,t.jsx)(n.p,{children:"Example DTB Overlay source file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dts",children:'/*\n * Sample dtb overlay source file\n * spi0_cs1_dev.dtso\n*/\n/dts-v1/;\n/plugin/;\n\n&spi0 {\n\tslave@1 {\n\t\tcompatible = "sample-compatible-str";\n\t\tspi-max-frequency = <32000000>;\n\t\treg = <1>;\n\t};\n};\n\n'})}),"\n",(0,t.jsxs)(n.admonition,{title:"Note",type:"info",children:[(0,t.jsx)(n.p,{children:"The following fields must be adjusted according to your actual peripheral device:"}),(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"compatible"})," field: must match the actual driver's ",(0,t.jsx)(n.code,{children:"compatible"})," string of the peripheral;"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"spi-max-frequency"})," field: must be set to the maximum SPI frequency actually supported by the peripheral;"]}),"\n"]})]}),"\n",(0,t.jsxs)(n.p,{children:["DTB Overlay compilation example (runnable on either host or RDK board). Assuming the ",(0,t.jsx)(n.code,{children:"spi0_cs1_dev.dtso"})," file is located at ",(0,t.jsx)(n.code,{children:"~/rdk_dtbo/spi0_cs1_dev.dtso"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Install device-tree-compiler\nsudo apt install device-tree-compiler -y\n\n# Compile dtbo files\ndtc -I dts -O dtb -o ~/rdk_dtbo/spi0_cs1_dev.dtbo ~/rdk_dtbo/spi0_cs1_dev.dtso\n\n# Copy generated dtbo file to /boot for further usage\nsudo cp ~/rdk_dtbo/spi0_cs1_dev.dtbo /boot\n"})}),"\n",(0,t.jsx)(n.p,{children:"Example compilation output:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"sunrise@ubuntu:~/rdk_dtbo$ dtc -I dts -O dtb -o ~/rdk_dtbo/spi0_cs1_dev.dtbo ~/rdk_dtbo/spi0_cs1_dev.dtso\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtso:12.3-13: Warning (reg_format): /fragment@0/__overlay__/slave@1:reg: property has invalid length (4 bytes) (#address-cells == 2, #size-cells == 1)\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtbo: Warning (pci_device_reg): Failed prerequisite 'reg_format'\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtbo: Warning (pci_device_bus_num): Failed prerequisite 'reg_format'\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtbo: Warning (simple_bus_reg): Failed prerequisite 'reg_format'\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtbo: Warning (i2c_bus_reg): Failed prerequisite 'reg_format'\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtbo: Warning (spi_bus_reg): Failed prerequisite 'reg_format'\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtso:9.10-13.4: Warning (avoid_default_addr_size): /fragment@0/__overlay__/slave@1: Relying on default #address-cells value\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtso:9.10-13.4: Warning (avoid_default_addr_size): /fragment@0/__overlay__/slave@1: Relying on default #size-cells value\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtbo: Warning (avoid_unnecessary_addr_size): Failed prerequisite 'avoid_default_addr_size'\n/home/sunrise/rdk_dtbo/spi0_cs1_dev.dtbo: Warning (unique_unit_address): Failed prerequisite 'avoid_default_addr_size'\nsunrise@ubuntu:~/rdk_dtbo$ ls\nspi0_cs1_dev.dtbo  spi0_cs1_dev.dtso\n"})}),"\n",(0,t.jsx)(n.admonition,{title:"Note",type:"info",children:(0,t.jsxs)(n.p,{children:["Generally, ",(0,t.jsx)(n.code,{children:"Warning"}),"-level messages during compilation can be safely ignored."]})}),"\n",(0,t.jsxs)(n.p,{children:["Edit the configuration file and add: ",(0,t.jsx)(n.code,{children:"dtbo_file_path=<relative path under /boot partition>"}),", for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Set dtbo file path relative to /boot partition\ndtbo_file_path=/spi0_cs1_dev.dtbo\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After rebooting, you can verify that the new slave device node appears under the SPI0 (",(0,t.jsx)(n.code,{children:"spi@39800000"}),") node in the device tree:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"sunrise@ubuntu:~$ ls /proc/device-tree/soc/spi@39800000/slave@1/\ncompatible  name  reg  spi-max-frequency\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To specify a custom partition for the DTBO file, add: ",(0,t.jsx)(n.code,{children:"dtbo_dev_part=<device number>:<hex partition number>"}),'. On RDK S100, the default device number is "0". The partition number can be obtained from the ',(0,t.jsx)(n.code,{children:"/dev/block/platform/by-name/"})," path. For example, using the ",(0,t.jsx)(n.code,{children:"userdata"})," partition:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Set dtbo file device number and partition number:\ndtbo_dev_part=0:0x10\n"})}),"\n",(0,t.jsxs)(n.p,{children:["How to obtain the partition number: ",(0,t.jsx)(n.code,{children:"ls -l /dev/block/platform/by-name/<partition name>"}),", for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# ls -l /dev/block/platform/by-name/userdata\nlrwxrwxrwx 1 root root 15 Jun  4 22:17 /dev/block/platform/by-name/userdata -> /dev/mmcblk0p16\n"})}),"\n",(0,t.jsx)(n.h2,{id:"custom-configtxt-guide",children:"Custom config.txt Guide"}),"\n",(0,t.jsx)(n.p,{children:"D-Robotics Uboot automatically determines the default partition containing the configuration file based on the current boot storage medium and partition."}),"\n",(0,t.jsx)(n.p,{children:"Users can customize the storage medium and partition for the configuration file used on the next boot via Uboot environment variables, as follows:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Halt the boot process and enter the Uboot command line;"}),"\n",(0,t.jsxs)(n.li,{children:["The following environment variables can be used to customize the configuration file location (each can be used independently):","\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"boot_config_f"}),": changes the default configuration filename. For example, ",(0,t.jsx)(n.code,{children:"setenv boot_config_f test.txt"})," will cause the next boot to look for a file named ",(0,t.jsx)(n.code,{children:"test.txt"})," instead of ",(0,t.jsx)(n.code,{children:"config.txt"}),";"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"boot_config_dev_part"}),": changes the default partition where the configuration file is searched. For example, ",(0,t.jsx)(n.code,{children:"setenv boot_config_dev_part 0:0xd"})," will cause the next boot to look for the configuration file in partition 13 (0xd) of the current boot medium;"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"boot_config_intf"}),": changes the default storage interface. For example, ",(0,t.jsx)(n.code,{children:"setenv boot_config_intf scsi"}),";"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Save the environment variables: ",(0,t.jsx)(n.code,{children:"saveenv"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"configtxt-parsing-development-guide",children:"config.txt Parsing Development Guide"}),"\n",(0,t.jsxs)(n.p,{children:["The source code implementing configuration file parsing is located in the Uboot directory at: ",(0,t.jsx)(n.code,{children:"board/hobot/common/drobot_boot_config.c"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);