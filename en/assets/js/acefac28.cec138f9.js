"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[1732],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>d});var s=t(96540);const r={},i=s.createContext(r);function l(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:n},e.children)}},83808:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"Advanced_development/multimedia_development/multimedia_application/sunrise_camera_develop_guide","title":"Sunrise camera \u5f00\u53d1\u8bf4\u660e","description":"Sunrise camera \u7cfb\u7edf\u8bbe\u8ba1","source":"@site/docs_s/07_Advanced_development/03_multimedia_development/02_multimedia_application/11_sunrise_camera_develop_guide.md","sourceDirName":"07_Advanced_development/03_multimedia_development/02_multimedia_application","slug":"/Advanced_development/multimedia_development/multimedia_application/sunrise_camera_develop_guide","permalink":"/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/multimedia_application/sunrise_camera_develop_guide","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1750509720000,"sidebarPosition":11,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"sunrise camera \u7528\u6237\u4f7f\u7528\u8bf4\u660e","permalink":"/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/multimedia_application/sunrise_camera_user_guide"},"next":{"title":"hbmem sample","permalink":"/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/multimedia_application/hbmem_sample_guide"}}');var r=t(74848),i=t(28453);const l={},d="Sunrise camera \u5f00\u53d1\u8bf4\u660e",c={},a=[{value:"Sunrise camera \u7cfb\u7edf\u8bbe\u8ba1",id:"sunrise-camera-\u7cfb\u7edf\u8bbe\u8ba1",level:2},{value:"\u7cfb\u7edf\u6846\u56fe",id:"\u7cfb\u7edf\u6846\u56fe",level:3},{value:"\u5fae\u6838\u8bbe\u8ba1",id:"\u5fae\u6838\u8bbe\u8ba1",level:3},{value:"\u67b6\u6784\u4f18\u7f3a\u70b9",id:"\u67b6\u6784\u4f18\u7f3a\u70b9",level:3},{value:"Sunrise camera \u67b6\u6784\u89c6\u56fe",id:"sunrise-camera-\u67b6\u6784\u89c6\u56fe",level:2},{value:"\u6a21\u5757\u5212\u5206",id:"\u6a21\u5757\u5212\u5206",level:3},{value:"\u4e8b\u4ef6\u603b\u7ebf\u6a21\u5757\uff08 communicate \uff09",id:"\u4e8b\u4ef6\u603b\u7ebf\u6a21\u5757-communicate-",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:4},{value:"\u529f\u80fd\u63cf\u8ff0",id:"\u529f\u80fd\u63cf\u8ff0",level:4},{value:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784",id:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784",level:4},{value:"\u63a5\u53e3\u63cf\u8ff0",id:"\u63a5\u53e3\u63cf\u8ff0",level:4},{value:"\u516c\u5171\u5e93\u6a21\u5757\uff08 common \uff09",id:"\u516c\u5171\u5e93\u6a21\u5757-common-",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-1",level:4},{value:"\u529f\u80fd\u63cf\u8ff0",id:"\u529f\u80fd\u63cf\u8ff0-1",level:4},{value:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784",id:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784-1",level:4},{value:"Platform \u6a21\u5757",id:"platform-\u6a21\u5757",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-2",level:4},{value:"\u529f\u80fd\u63cf\u8ff0",id:"\u529f\u80fd\u63cf\u8ff0-2",level:4},{value:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784",id:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784-2",level:4},{value:"\u5bf9\u5916\u4ea4\u4e92\u6a21\u5757\uff08 Transport \uff09",id:"\u5bf9\u5916\u4ea4\u4e92\u6a21\u5757-transport-",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-3",level:4},{value:"Meida Server \u6a21\u5757",id:"meida-server-\u6a21\u5757",level:4},{value:"Wesocket Server \u6a21\u5757",id:"wesocket-server-\u6a21\u5757",level:4},{value:"\u4e3b\u7a0b\u5e8f\u5165\u53e3\uff08 main \uff09",id:"\u4e3b\u7a0b\u5e8f\u5165\u53e3-main-",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-4",level:4},{value:"\u6267\u884c\u6d41\u7a0b",id:"\u6267\u884c\u6d41\u7a0b",level:4},{value:"WebServer",id:"webserver",level:3},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-5",level:4},{value:"\u529f\u80fd\u63cf\u8ff0",id:"\u529f\u80fd\u63cf\u8ff0-3",level:4},{value:"\u4f7f\u7528 BPU \u8fdb\u884c\u7b97\u6cd5\u63a8\u7406",id:"\u4f7f\u7528-bpu-\u8fdb\u884c\u7b97\u6cd5\u63a8\u7406",level:2},{value:"\u6982\u8ff0",id:"\u6982\u8ff0-6",level:3},{value:"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u6a21\u578b\u6d41\u7a0b",id:"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u6a21\u578b\u6d41\u7a0b",level:3},{value:"\u51c6\u5907\u7b97\u6cd5\u6a21\u578b",id:"\u51c6\u5907\u7b97\u6cd5\u6a21\u578b",level:4},{value:"\u6dfb\u52a0\u521d\u59cb\u5316\u8fc7\u7a0b",id:"\u6dfb\u52a0\u521d\u59cb\u5316\u8fc7\u7a0b",level:4},{value:"\u63a8\u7406\u7ebf\u7a0b\u5904\u7406\u51fd\u6570",id:"\u63a8\u7406\u7ebf\u7a0b\u5904\u7406\u51fd\u6570",level:4},{value:"\u540e\u5904\u7406\u7ebf\u7a0b\u51fd\u6570",id:"\u540e\u5904\u7406\u7ebf\u7a0b\u51fd\u6570",level:4},{value:"\u540e\u5904\u7406\u4ee3\u7801",id:"\u540e\u5904\u7406\u4ee3\u7801",level:4},{value:"Web \u9875\u9762\u4e0a\u589e\u52a0\u6e32\u67d3\u5904\u7406",id:"web-\u9875\u9762\u4e0a\u589e\u52a0\u6e32\u67d3\u5904\u7406",level:4}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"sunrise-camera-\u5f00\u53d1\u8bf4\u660e",children:"Sunrise camera \u5f00\u53d1\u8bf4\u660e"})}),"\n",(0,r.jsx)(n.h2,{id:"sunrise-camera-\u7cfb\u7edf\u8bbe\u8ba1",children:"Sunrise camera \u7cfb\u7edf\u8bbe\u8ba1"}),"\n",(0,r.jsx)(n.h3,{id:"\u7cfb\u7edf\u6846\u56fe",children:"\u7cfb\u7edf\u6846\u56fe"}),"\n",(0,r.jsx)(n.p,{children:"Sunrise camera \u5b9e\u73b0\u4e86\u667a\u80fd\u6444\u50cf\u673a\u3001\u667a\u80fd\u5206\u6790\u76d2\u7b49\u591a\u79cd\u5e94\u7528\u65b9\u6848\u3002"}),"\n",(0,r.jsx)(n.p,{children:"Sunrise camera \u6e90\u7801\u5305\u62ec\u7528\u6237\u64cd\u4f5c\u5c42\u7684 WebPages\u3001\u901a\u4fe1\u6a21\u5757\u5c42\u3001\u529f\u80fd\u6a21\u5757\u5c42\uff1b\u672c\u6587\u6863\u4e3b\u8981\u4ecb\u7ecd\u8fd9\u4e09\u4e2a\u6a21\u5757\u7684\u8bbe\u8ba1\u3002"}),"\n",(0,r.jsx)(n.p,{children:"Hal \u5c42\u6a21\u5757\u5305\u62ec\u591a\u5a92\u4f53\u76f8\u5173\u6a21\u5757\u8c03\u7528\u63a5\u53e3\u5e93\uff0c BPU \u6a21\u5757\u63a8\u7406\u5e93\u7b49\uff1b"}),"\n",(0,r.jsx)(n.p,{children:"Kernel \u7248\u672c\u5305\u542b\u6807\u51c6\u9a71\u52a8\u5e93\u7684\u57fa\u7840\u4e0a\uff0c\u7cfb\u7edf BSP\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u8f6f\u4ef6\u6846\u56fe\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/software_framework.png",alt:"software_framwork"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5fae\u6838\u8bbe\u8ba1",children:"\u5fae\u6838\u8bbe\u8ba1"}),"\n",(0,r.jsx)(n.p,{children:"\u5fae\u6838\u67b6\u6784\uff08 microkernel architecture \uff09\u53c8\u79f0\u4e3a\u201c\u63d2\u4ef6\u67b6\u6784\u201d\uff08 plug-in architecture \uff09\uff0c\u6307\u7684\u662f\u8f6f\u4ef6\u7684\u5185\u6838\u76f8\u5bf9\u8f83\u5c0f\uff0c\u4e3b\u8981\u529f\u80fd\u548c\u4e1a\u52a1\u903b\u8f91\u90fd\u901a\u8fc7\u63d2\u4ef6\u5b9e\u73b0\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5185\u6838\uff08 core \uff09\u901a\u5e38\u53ea\u5305\u542b\u7cfb\u7edf\u8fd0\u884c\u7684\u6700\u5c0f\u529f\u80fd\u3002\u63d2\u4ef6\u5219\u662f\u4e92\u76f8\u72ec\u7acb\u7684\uff0c\u63d2\u4ef6\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u5e94\u8be5\u51cf\u5c11\u5230\u6700\u4f4e\uff0c\u907f\u514d\u51fa\u73b0\u4e92\u76f8\u4f9d\u8d56\u7684\u95ee\u9898\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u67b6\u6784\u4f18\u7f3a\u70b9",children:"\u67b6\u6784\u4f18\u7f3a\u70b9"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4f18\u70b9"})}),"\n",(0,r.jsx)(n.p,{children:"\u826f\u597d\u7684\u529f\u80fd\u5ef6\u4f38\u6027\uff0c\u9700\u8981\u4ec0\u4e48\u529f\u80fd\uff0c\u5f00\u53d1\u63d2\u4ef6\u5373\u53ef\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u529f\u80fd\u4e4b\u95f4\u662f\u9694\u79bb\u7684\uff0c\u63d2\u4ef6\u53ef\u4ee5\u72ec\u7acb\u7684\u52a0\u8f7d\u548c\u5378\u8f7d\uff0c\u5bb9\u6613\u90e8\u7f72\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u5b9a\u5236\u6027\u9ad8\uff0c\u9002\u5e94\u4e0d\u540c\u7684\u5f00\u53d1\u9700\u8981\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u6e10\u8fdb\u5f0f\u5f00\u53d1\uff0c\u9010\u6b65\u6dfb\u52a0\u529f\u80fd\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u7f3a\u70b9"})}),"\n",(0,r.jsx)(n.p,{children:"\u6269\u5c55\u6027\u5dee\uff0c\u5185\u6838\u901a\u5e38\u662f\u4e00\u4e2a\u72ec\u7acb\u5355\u5143\uff0c\u4e0d\u5bb9\u6613\u505a\u6210\u5206\u5e03\u5f0f\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5f00\u53d1\u96be\u5ea6\u76f8\u5bf9\u8f83\u9ad8\uff0c\u56e0\u4e3a\u6d89\u53ca\u5230\u63d2\u4ef6\u4e0e\u5185\u6838\u7684\u901a\u4fe1\uff0c\u4ee5\u53ca\u63d2\u4ef6\u767b\u8bb0\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"sunrise-camera-\u67b6\u6784\u89c6\u56fe",children:"Sunrise camera \u67b6\u6784\u89c6\u56fe"}),"\n",(0,r.jsx)(n.h3,{id:"\u6a21\u5757\u5212\u5206",children:"\u6a21\u5757\u5212\u5206"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u6a21\u5757"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u76ee\u5f55"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u63cf\u8ff0"})})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u4e8b\u4ef6\u603b\u7ebf\u6a21\u5757"}),(0,r.jsx)(n.td,{children:"communicate"}),(0,r.jsx)(n.td,{children:"\u5b9e\u73b0\u6a21\u5757\u7684\u4e8b\u4ef6\u6ce8\u518c\u3001\u4e8b\u4ef6\u63a5\u6536\u3001\u4e8b\u4ef6\u5206\u53d1"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u516c\u5171\u5e93\u6a21\u5757"}),(0,r.jsx)(n.td,{children:"common"}),(0,r.jsx)(n.td,{children:"\u516c\u5171\u64cd\u4f5c\u51fd\u6570\uff0c log/lock\uff0c\u7ebf\u7a0b\u64cd\u4f5c\uff0c\u961f\u5217\u64cd\u4f5c\u7b49"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Camera \u6a21\u5757"}),(0,r.jsx)(n.td,{children:"Platform"}),(0,r.jsx)(n.td,{children:"\u82af\u7247\u5e73\u53f0\u76f8\u5173\u4ee3\u7801\uff0c\u5b9e\u73b0\u786c\u4ef6\u5dee\u5f02\u90e8\u5206\u7684\u5c01\u88c5"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u5bf9\u5916\u4ea4\u4e92\u6a21\u5757"}),(0,r.jsx)(n.td,{children:"Transport"}),(0,r.jsx)(n.td,{children:"\u8bbe\u5907\u548c\u5916\u63a5\u4ea4\u4e92\u90e8\u5206\uff0c rtspserver\u3001 websocket \u7b49"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u4e3b\u7a0b\u5e8f\u5165\u53e3"}),(0,r.jsx)(n.td,{children:"Main"}),(0,r.jsx)(n.td,{children:"Main \u51fd\u6570\u5165\u53e3"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u9876\u5c42\u4ee3\u7801\u7ed3\u6784"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:".\n\u251c\u2500\u2500 common\t\t\t\t\t\t# \u516c\u5171\u5e93\u6a21\u5757\u4ee3\u7801\n\u251c\u2500\u2500 communicate\t\t\t\t\t# \u4e8b\u4ef6\u603b\u7ebf\u6a21\u5757\n\u251c\u2500\u2500 config\t\t\t\t\t\t# \u7f16\u8bd1\u914d\u7f6e\u76ee\u5f55\n\u251c\u2500\u2500 main\t\t\t\t\t\t# \u4e3b\u5165\u53e3\u7a0b\u5e8f\n\u251c\u2500\u2500 Makefile\t\t\t\t\t# \u7f16\u8bd1\u811a\u672c\n\u251c\u2500\u2500 makefile.param\t\t\t\t# \u7f16\u8bd1\u914d\u7f6e\n\u251c\u2500\u2500 Platform\t\t\t\t\t# Camera \u6a21\u5757\uff0c\u5e73\u53f0\u3001\u5e94\u7528\u573a\u666f\u4ee3\u7801\uff0c\u82af\u7247 IP \u76f8\u5173\u4ee3\u7801\u90fd\u5728\u672c\u76ee\u5f55\u4e0b\u5b9e\u73b0\n\u251c\u2500\u2500 start_app.sh\t\t\t\t# \u542f\u52a8\u811a\u672c\n\u251c\u2500\u2500 sunrise_camera.service \t\t# \u5f00\u542f\u81ea\u542f\u52a8\u914d\u7f6e\u6587\u4ef6\n\u251c\u2500\u2500 third_party\t\t\t\t\t# \u4f9d\u8d56\u7684\u7b2c\u4e09\u65b9\u5e93\n\u251c\u2500\u2500 Transport\t\t\t\t\t# rtspserver \u548c websocket \u6a21\u5757\u4ee3\u7801\u5b9e\u73b0\n\u251c\u2500\u2500 VERSION\t\t\t\t\t\t# \u7248\u672c\u4fe1\u606f\n\u2514\u2500\u2500 WebServer\t\t\t\t\t# web \u9875\u9762\u7684\u7a0b\u5e8f\u548c\u8d44\u6e90\u6587\u4ef6\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u7f16\u8bd1"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u767b\u5f55\u8bbe\u5907\uff0c\u8fdb\u5165\u76ee\u5f55\uff1a",(0,r.jsx)(n.code,{children:"/app/multimedia_samples/sunrise_camera"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u6267\u884c\u547d\u4ee4: ",(0,r.jsx)(n.code,{children:"make"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u751f\u6210\u7684\u76ee\u6807\u6587\u4ef6\uff1a",(0,r.jsx)(n.code,{children:"sunrise_camera"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"root@ubuntu:/app/multimedia_samples/sunrise_camera# ls sunrise_camera/bin/\nlog  sunrise_camera  www\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u4e8b\u4ef6\u603b\u7ebf\u6a21\u5757-communicate-",children:"\u4e8b\u4ef6\u603b\u7ebf\u6a21\u5757\uff08 communicate \uff09"}),"\n",(0,r.jsx)(n.h4,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u4e8b\u4ef6\u603b\u7ebf\u6a21\u5757\uff0c\u6700\u5c0f\u8fd0\u884c\u5355\u4f4d\uff1b\u6839\u636e\u7f16\u8bd1\u9009\u9879\u8c03\u7528\u4e0d\u540c\u6a21\u5757\u7684\u6ce8\u518c\u63a5\u53e3\u51fd\u6570\uff0c\u5e76\u4e14\u5b8c\u6210\u4e0d\u540c\u6a21\u5757 CMD \u7684\u63a5\u6536\u548c\u5206\u53d1\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u6a21\u5757\u95f4\u4ea4\u4e92\u65f6\uff0c\u63a5\u6536\u5230\u7684 CMD \u5982\u679c\u5df2\u7ecf\u6ce8\u518c\u548c\u4f7f\u80fd\uff0c\u5219\u4e2d\u8f6c\u5230\u53d7\u7406\u5b50\u6a21\u5757\u5904\u7406\uff0c\u5904\u7406\u5b8c\u6210\u540e\u5411\u8bf7\u6c42\u6a21\u5757\u8fd4\u56de\u5904\u7406\u7ed3\u679c\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u6a21\u5757\u95f4\u4ea4\u4e92\u65f6\uff0c\u63a5\u6536\u5230\u7684 CMD \u6ca1\u6709\u6ce8\u518c\u6216\u8005\u672a\u4f7f\u80fd\uff0c\u5219 CMD \u8c03\u7528\u5931\u8d25\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u529f\u80fd\u63cf\u8ff0",children:"\u529f\u80fd\u63cf\u8ff0"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u6a21\u5757\u63d2\u4ef6\u9759\u6001\u63d2\u62d4\u63a7\u5236"}),"\n",(0,r.jsx)(n.li,{children:"\u6a21\u5757 CMD \u6307\u4ee4\u4e2d\u8f6c"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/event_bus.png",alt:"event_bus"})}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"camera \u5b50\u6a21\u5757\u4e2d\u5b9a\u4e49\u4e86 SDK_CMD_CAMERA_GET_CHIP_TYPE \u547d\u4ee4\uff0c\u8c03\u7528 camera_cmd_register \u51fd\u6570\u6ce8\u518c\u8be5 CMD \u540e\uff0c\u5f53 websocket \u5b50\u6a21\u5757\u6536\u5230 web \u9875\u9762\u8bf7\u6c42\u83b7\u53d6\u82af\u7247\u7c7b\u578b\u65f6\uff0c websocket \u6a21\u5757\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u4ee3\u7801\u8c03\u7528 camera \u5b50\u6a21\u5757\u4e2d\u7684\u63a5\u53e3\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6574\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/event_bus_flow.png",alt:"event_bus_flow"})}),"\n",(0,r.jsx)(n.h4,{id:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784",children:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:".\n\u251c\u2500\u2500 include\n\u2502   \u251c\u2500\u2500 sdk_common_cmd.h\t\t\t# \u5b9a\u4e49\u7cfb\u7edf\u4e2d\u6240\u6709\u5b50\u6a21\u5757\u7684 CMD\n\u2502   \u251c\u2500\u2500 sdk_common_struct.h\t\t    # \u5b9a\u4e49\u6bcf\u4e2a CMD \u5bf9\u5e94\u4f7f\u7528\u5230\u7684\u6570\u636e\u7ed3\u6784\n\u2502   \u2514\u2500\u2500 sdk_communicate.h\t\t\t# \u5b9a\u4e49\u672c\u6a21\u5757\u63a5\u53e3\u51fd\u6570\n\u251c\u2500\u2500 Makefile\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 sdk_communicate.c\t\t\t# \u63a5\u53e3\u4ee3\u7801\u5b9e\u73b0\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u63a5\u53e3\u63cf\u8ff0",children:"\u63a5\u53e3\u63cf\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"sdk_globle_prerare"})}),"\n",(0,r.jsx)(n.p,{children:"\u5404\u5b50\u6a21\u5757\u7684 xxx_cmd_register() \u51fd\u6570\u4f1a\u96c6\u4e2d\u653e\u5230\u8fd9\u4e2a\u51fd\u6570\u4e2d\uff0c\u4e3b\u7a0b\u5e8f\u542f\u52a8\u65f6\uff0c\u901a\u8fc7\u8c03\u7528\u672c\u63a5\u53e3\u5c06\u6240\u6709\u5b50\u6a21\u5757\u9700\u8981\u6ce8\u518c\u5e76\u4f7f\u80fd\u7684\u7684 CMD \u6ce8\u518c\u8fdb\u5b50\u7cfb\u7edf\u4e2d\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6bcf\u4e2a\u5b50\u6a21\u5757\u90fd\u8981\u5b9e\u73b0 xxx_cmd_register()\uff0c\u5728\u8be5\u51fd\u6570\u4e2d\u5b9e\u73b0\u5b50\u6a21\u5757 CMD \u6ce8\u518c\u3002\u8fd9\u662f\u6574\u4e2a\u7cfb\u7edf\u80fd\u591f\u6b63\u5e38\u8fd0\u884c\u7684\u57fa\u672c\u524d\u63d0\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/cmd_register.png",alt:"cmd_register"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"sdk_cmd_register"})}),"\n",(0,r.jsx)(n.p,{children:"CMD \u6ce8\u518c\u63a5\u53e3\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"sdk_cmd_unregister"})}),"\n",(0,r.jsx)(n.p,{children:"CMD \u6ce8\u9500\u63a5\u53e3\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"sdk_cmd_impl"})}),"\n",(0,r.jsx)(n.p,{children:"\u5b50\u6a21\u5757\u901a\u8fc7\u8c03\u7528\u672c\u63a5\u53e3\u5b9e\u73b0\u8c03\u7528\u5176\u4ed6\u5b50\u6a21\u5757\u5b9e\u73b0\u7684\u63a5\u53e3\u529f\u80fd\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u516c\u5171\u5e93\u6a21\u5757-common-",children:"\u516c\u5171\u5e93\u6a21\u5757\uff08 common \uff09"}),"\n",(0,r.jsx)(n.h4,{id:"\u6982\u8ff0-1",children:"\u6982\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u7a0b\u5e8f\u516c\u5171\u5e93\u7c7b\uff0c\u5305\u542b\u4f46\u4e0d\u9650\u4e8e\u65e5\u5fd7\u64cd\u4f5c\u3001\u9501\u64cd\u4f5c\u3001\u7ebf\u7a0b\u5c01\u88c5\u3001base64 \uff1b"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6a21\u5757\u4e3b\u8981\u628a\u7f16\u7a0b\u4e2d\u4f1a\u4f7f\u7528\u5230\u7684\u516c\u5171\u7c7b\u3001\u516c\u5171\u51fd\u6570\u8fdb\u884c\u5c01\u88c5\uff1b\u907f\u514d\u76f8\u540c\u64cd\u4f5c\u7684\u51fd\u6570\u5b9e\u73b0\u5728\u591a\u5904\u51fa\u73b0\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6a21\u5757\u7684\u66f4\u65b0\u5f71\u54cd\u6240\u6709\u6a21\u5757\uff0c\u9700\u8981\u8c28\u614e\u64cd\u4f5c\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u529f\u80fd\u63cf\u8ff0-1",children:"\u529f\u80fd\u63cf\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u65e0"}),"\n",(0,r.jsx)(n.h4,{id:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784-1",children:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:".\n\u251c\u2500\u2500 Makefile\t\t\t\t\t# \u7f16\u8bd1\u811a\u672c\n\u251c\u2500\u2500 makefile.param\n\u2514\u2500\u2500 utils\n    \u251c\u2500\u2500 include\t\t\t\t    # \u5934\u6587\u4ef6\n    \u2502   \u251c\u2500\u2500 aes256.h\n    \u2502   \u251c\u2500\u2500 base64.h\n    \u2502   \u251c\u2500\u2500 cJSON_Direct.h\n    \u2502   \u251c\u2500\u2500 cmap.h\n    \u2502   \u251c\u2500\u2500 common_utils.h\n    \u2502   \u251c\u2500\u2500 cqueue.h\n    \u2502   \u251c\u2500\u2500 gen_rand.h\n    \u2502   \u251c\u2500\u2500 lock_utils.h\n    \u2502   \u251c\u2500\u2500 mqueue.h\n    \u2502   \u251c\u2500\u2500 mthread.h\n    \u2502   \u251c\u2500\u2500 nalu_utils.h\n    \u2502   \u251c\u2500\u2500 sha256.h\n    \u2502   \u251c\u2500\u2500 stream_define.h\n    \u2502   \u251c\u2500\u2500 stream_manager.h\n    \u2502   \u2514\u2500\u2500 utils_log.h\n    \u251c\u2500\u2500 Makefile\n    \u2514\u2500\u2500 src                      # \u5b9e\u73b0\u6e90\u7801\n        \u251c\u2500\u2500 aes256.c\n        \u251c\u2500\u2500 base64.c\n        \u251c\u2500\u2500 cJSON_Direct.c\n        \u251c\u2500\u2500 cmap.c\n        \u251c\u2500\u2500 common_utils.c\n        \u251c\u2500\u2500 cqueue.c\n        \u251c\u2500\u2500 gen_rand.c\n        \u251c\u2500\u2500 lock_utils.c\n        \u251c\u2500\u2500 mqueue.c\n        \u251c\u2500\u2500 mthread.c\n        \u251c\u2500\u2500 nalu_utils.c\n        \u251c\u2500\u2500 sha256.c\n        \u251c\u2500\u2500 stream_manager.c\n        \u2514\u2500\u2500 utils_log.c\n"})}),"\n",(0,r.jsx)(n.h3,{id:"platform-\u6a21\u5757",children:"Platform \u6a21\u5757"}),"\n",(0,r.jsx)(n.h4,{id:"\u6982\u8ff0-2",children:"\u6982\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u6a21\u5757\u4e3b\u8981\u5305\u62ec\uff1a\u89c6\u9891\u7f16\u7801\u3001 ISP \u63a7\u5236\u3001\u56fe\u50cf\u63a7\u5236\u3001\u6293\u62cd\u3001\u89c6\u9891\u8f93\u51fa\u3001\u7b97\u6cd5\u8fd0\u7b97\u7b49\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6a21\u5757\u5185\u90e8\u7ed3\u6784\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"api_vpp \u4f5c\u4e3a\u672c\u6a21\u5757\u5165\u53e3\uff0c\u5b9a\u4e49\u652f\u6301\u7684 CMD \u547d\u4ee4\u96c6\uff1b"}),"\n",(0,r.jsx)(n.p,{children:"solution_handle \u5b8c\u6210\u5e94\u7528\u914d\u7f6e\u8bfb\u5199\u3001\u573a\u666f\u63a5\u53e3\u8d4b\u503c\uff1b"}),"\n",(0,r.jsx)(n.p,{children:"vpp_camera_impl\u3001 vpp_box_impl \u5b9e\u73b0\u5e94\u7528\u573a\u666f\u529f\u80fd\uff1b"}),"\n",(0,r.jsx)(n.p,{children:"vp_wrap \u5b9e\u73b0\u591a\u5a92\u4f53\u6a21\u5757\u7684\u63a5\u53e3\u5c01\u88c5\uff1b"}),"\n",(0,r.jsx)(n.p,{children:"bpu_wrap \u6a21\u5757\u5b9e\u73b0\u7b97\u6cd5\u63a8\u7406\u63a5\u53e3\u548c\u540e\u5904\u7406\u65b9\u6cd5\u7684\u5c01\u88c5\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/platform_module.png",alt:"platform_module"})}),"\n",(0,r.jsx)(n.h4,{id:"\u529f\u80fd\u63cf\u8ff0-2",children:"\u529f\u80fd\u63cf\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u65b0\u589e\u4e00\u4e2a\u5e94\u7528\u573a\u666f\u7684\u5b9e\u73b0\uff0c\u53ea\u8981\u5b9e\u73b0 vpp_ops_t \u7ed3\u6784\u4f53\u5b9a\u4e49\u7684\u63a5\u53e3\u5373\u53ef\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"typedef struct vpp_ops {\n\tint (*init_param)(void); // \u521d\u59cb\u5316 VIN\u3001 VSE\u3001 VENC\u3001 BPU \u7b49\u6a21\u5757\u7684\u914d\u7f6e\u53c2\u6570\n\tint (*init)(void); // sdk \u521d\u59cb\u5316\uff0c\u6839\u636e\u914d\u7f6e\u521d\u59cb\u5316\n\tint (*uninit)(void); // \u53cd\u521d\u59cb\u5316\n\tint (*start)(void); // \u542f\u52a8\u5a92\u4f53\u76f8\u5173\u7684\u5404\u4e2a\u6a21\u5757\n\tint (*stop)(void); // \u505c\u6b62\n\t// \u672c\u6a21\u5757\u652f\u6301\u7684 CMD \u90fd\u901a\u8fc7\u4ee5\u4e0b\u4e24\u4e2a\u63a5\u53e3\u7b80\u76f4\u5b9e\u73b0\n\tint (*param_set)(SOLUTION_PARAM_E type, char* val, unsigned int length);\n\tint (*param_get)(SOLUTION_PARAM_E type, char* val, unsigned int* length);\n} vpp_ops_t;\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u542f\u52a8\u4e00\u4e2a\u5e94\u7528\u65b9\u6848\uff08\u4ee5\u542f\u52a8 vpp_camera \u4e3a\u4f8b\uff09\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/vpp_camera_flow.png",alt:"vpp_camera_flow"})}),"\n",(0,r.jsx)(n.p,{children:"\u5176\u4ed6\u5b50\u6a21\u5757\u7684\u521d\u59cb\u5316\u3001\u542f\u52a8\u6d41\u7a0b\u90fd\u53ef\u4ee5\u53c2\u8003\u672c\u6d41\u7a0b\u56fe\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784-2",children:"\u6a21\u5757\u4ee3\u7801\u7ed3\u6784"}),"\n",(0,r.jsx)(n.p,{children:"\u4ee3\u7801\u8def\u5f84\uff1a Platform/S100"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:".\n\u251c\u2500\u2500 api                                   # CMD \u6ce8\u518c\n\u251c\u2500\u2500 bpu_wrap                              # bpu \u7b97\u6cd5\u63a5\u53e3\u4f7f\u7528\u5c01\u88c5\n\u251c\u2500\u2500 main                                  # CMD \u6ce8\u518c\u7684\u5b9e\u9645\u529f\u80fd\u63a5\u53e3\u5b9e\u73b0\n\u251c\u2500\u2500 Makefile                              # \u7f16\u8bd1\u811a\u672c\n\u251c\u2500\u2500 makefile.param                        # \u7f16\u8bd1\u914d\u7f6e\n\u251c\u2500\u2500 model_zoom                            # \u7b97\u6cd5\u6a21\u578b\u4ed3\u5e93\n\u251c\u2500\u2500 test_data                             # \u5b58\u653e\u6d4b\u8bd5\u7528\u7684\u89c6\u9891\u7801\u6d41\u6587\u4ef6\u548c\u7a0b\u5e8f\u914d\u7f6e\u6587\u4ef6\n\u251c\u2500\u2500 vpp_impl                              # \u5e94\u7528\u65b9\u6848\u7684\u529f\u80fd\u5b9e\u73b0\n\u251c\u2500\u2500 vp_sensors -> ../../../vp_sensors/    # Camera Sensor \u914d\u7f6e\u4ee3\u7801\uff0c\u672c\u76ee\u5f55\u4e0b\u7684\u4ee3\u7801\u4e0e\u5176\u4ed6 sample \u6a21\u5757\u5171\u7528\n\u2514\u2500\u2500 vp_wrap                               # \u591a\u5a92\u4f53\u63a5\u53e3\u7684\u5c01\u88c5\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u5bf9\u5916\u4ea4\u4e92\u6a21\u5757-transport-",children:"\u5bf9\u5916\u4ea4\u4e92\u6a21\u5757\uff08 Transport \uff09"}),"\n",(0,r.jsx)(n.h4,{id:"\u6982\u8ff0-3",children:"\u6982\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u9075\u5faa\u4f20\u8f93\u534f\u8bae\u4e0e\u7ec8\u7aef\u6216\u5e73\u53f0\u4ea4\u4e92\u7684\u5177\u4f53\u5b50\u6a21\u5757\uff1b\u5305\u542b\u901a\u8fc7\u7f51\u7edc\u3001 rtspserver \u548c websocket \u901a\u4fe1\u6a21\u5757\uff1b"}),"\n",(0,r.jsx)(n.p,{children:"\u4ea4\u4e92\u6a21\u5757\u662f\u6a21\u5757\u95f4\u4ea4\u4e92\u6700\u591a\u7684\u90e8\u5206\uff0c\u9700\u8981\u4e25\u683c\u9075\u5b88\u8bbe\u8ba1\u7ea6\u5b9a\u3002\u5728\u5411\u5176\u4ed6\u6a21\u5757\u8bf7\u6c42\u6570\u636e\u65f6\u90fd\u8981\u901a\u8fc7\u5b9a\u4e49\u7684\u6a21\u5757 CMD \u8fdb\u884c\u5904\u7406\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"meida-server-\u6a21\u5757",children:"Meida Server \u6a21\u5757"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6a21\u5757\u662f\u5bf9 ZLMediakit \u7684\u5c01\u88c5\u5b9e\u73b0\uff0c\u628a ZLMediakit \u5c01\u88c5\u6210 init\u3001 create_media\u3001push_video \u7b49\u51e0\u4e2a\u7b80\u5355\u63a5\u53e3\u3002\u76ee\u524d\u652f\u6301 H264\u548cH265 \u7801\u6d41\u7684\u63a8\u6d41\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6a21\u5757\u7684\u542f\u52a8\u548c\u4f7f\u7528\u53ef\u4ee5\u53c2\u8003 \u4e3b\u7a0b\u5e8f\u5165\u53e3 \u7ae0\u8282\u7684\u6d41\u7a0b\u4ecb\u7ecd\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"wesocket-server-\u6a21\u5757",children:"Wesocket Server \u6a21\u5757"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6a21\u5757\u5b8c\u6210\u4e0e web \u4e0a\u7684\u64cd\u4f5c\u4ea4\u4e92\uff0c\u5728 web \u4e0a\u8fdb\u884c\u76f8\u5e94\u64cd\u4f5c\u540e\uff0c websocket server \u63a5\u6536\u5230\u76f8\u5e94 kind \u7684\u547d\u4ee4\u548c\u53c2\u6570\uff0c\u5728\u4ee3\u7801 handle_user_massage.c \u7684 handle_user_msg \u51fd\u6570\u4e2d\u5904\u7406\u8fdb\u884c\u76f8\u5e94\u7684\u529f\u80fd\u5904\u7406\uff0c\u5982\u679c\u8981\u6dfb\u52a0\u65b0\u7684\u4ea4\u4e92\u547d\u4ee4\uff0c\u8bf7\u5728\u8be5\u51fd\u6570\u4e2d\u589e\u52a0\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u76ee\u524d\u652f\u6301\u7684\u4ea4\u4e92\u547d\u4ee4\uff1a\u573a\u666f\u5207\u6362\u3001\u573a\u666f\u53c2\u6570\u83b7\u53d6\u548c\u8bbe\u7f6e\u3001\u83b7\u53d6\u82af\u7247\u7c7b\u578b\u3001 h264 \u7801\u7387\u8bbe\u7f6e\u3001\u7cfb\u7edf\u65f6\u95f4\u540c\u6b65\u3001 websocket \u7801\u6d41\u62c9\u6d41\u548c\u505c\u6b62\u7b49\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u4e3b\u7a0b\u5e8f\u5165\u53e3-main-",children:"\u4e3b\u7a0b\u5e8f\u5165\u53e3\uff08 main \uff09"}),"\n",(0,r.jsx)(n.h4,{id:"\u6982\u8ff0-4",children:"\u6982\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u4e3b\u7a0b\u5e8f\u5165\u53e3\uff0c\u6a21\u5757\u542f\u52a8\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u524d\u57fa\u672c\u7684\u5b50\u6a21\u5757\u542f\u52a8\u987a\u5e8f\u5982\u4e0b\uff0c\u9700\u8981\u6ce8\u610f\u5404\u6a21\u5757\u542f\u52a8\u987a\u5e8f\u9700\u8981\u6839\u636e\u5b50\u6a21\u5757\u95f4\u7684\u4f9d\u8d56\u5173\u7cfb\u987a\u5e8f\u542f\u52a8\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u6267\u884c\u6d41\u7a0b",children:"\u6267\u884c\u6d41\u7a0b"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/main_flow.png",alt:"main_flow"})}),"\n",(0,r.jsx)(n.h3,{id:"webserver",children:"WebServer"}),"\n",(0,r.jsx)(n.h4,{id:"\u6982\u8ff0-5",children:"\u6982\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6a21\u5757\u901a\u8fc7 ZLMediakit \u5b9e\u73b0 HTTP\u534f\u8bae\u7684 web \u670d\u52a1\uff0c\u8ba9\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u6d4f\u89c8\u5668\u9884\u89c8\u89c6\u9891\u548c\u914d\u7f6e\u5e94\u7528\u573a\u666f\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u529f\u80fd\u63cf\u8ff0-3",children:"\u529f\u80fd\u63cf\u8ff0"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"WebServer/www"}),"\u76ee\u5f55\u4e0b\u63d0\u4f9b\u4e86\uff1a \u8d44\u6e90\u6587\u4ef6\u3001web \u9875\u9762\u3001 css\u3001 js \u7a0b\u5e8f\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u4f7f\u7528-bpu-\u8fdb\u884c\u7b97\u6cd5\u63a8\u7406",children:"\u4f7f\u7528 BPU \u8fdb\u884c\u7b97\u6cd5\u63a8\u7406"}),"\n",(0,r.jsx)(n.h3,{id:"\u6982\u8ff0-6",children:"\u6982\u8ff0"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6a21\u5757\u5b8c\u6210\u7b97\u6cd5\u6a21\u578b\u52a0\u8f7d\u3001\u6570\u636e\u524d\u5904\u7406\u3001\u63a8\u7406\u3001\u7b97\u6cd5\u540e\u5904\u7406\u5e76\u8fd4\u56de json \u683c\u5f0f\u7684\u7ed3\u679c\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u6a21\u5757\u8fd0\u884c\u65f6\u5e8f\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/bpu_flow.png",alt:"bpu_flow"})}),"\n",(0,r.jsx)(n.h3,{id:"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u6a21\u578b\u6d41\u7a0b",children:"\u6dfb\u52a0\u4e00\u4e2a\u65b0\u6a21\u578b\u6d41\u7a0b"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u524d sunrise_camera \u4ec5\u652f\u6301\u5c11\u91cf\u7b97\u6cd5\u6a21\u578b\u7684\u8fd0\u884c\uff0c\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\u4e0d\u53ef\u907f\u514d\u8981\u8dd1\u5176\u4ed6\u7684\u6a21\u578b\u6765\u6d4b\u8bd5\u6548\u679c\uff0c\u672c\u8282\u63cf\u8ff0\u65b0\u589e\u4e00\u4e2a\u7b97\u6cd5\u6a21\u578b\u7684\u57fa\u672c\u6b65\u9aa4\u3002"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u9879\u76ee"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u6e90\u7801\u6587\u4ef6"})}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.strong,{children:"\u8bf4\u660e"})})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u51c6\u5907\u7b97\u6cd5\u6a21\u578b"}),(0,r.jsx)(n.td,{children:"\u653e\u5230 Platform/s100/model_zoom \u76ee\u5f55\u4e0b\uff08*.hbm\uff09"}),(0,r.jsxs)(n.td,{children:["\u5728\u672c\u76ee\u5f55\u6dfb\u52a0\u53ef\u4ee5\u5728\u5f00\u53d1\u677f\u4e0a\u8fd0\u884c\u7684\u5b9a\u70b9\u7b97\u6cd5\u6a21\u578b (\u7cfb\u7edf\u81ea\u5e26\u7684\u6a21\u578b\u6587\u6587\u4ef6\u5b58\u50a8\u5728\uff1a",(0,r.jsx)(n.code,{children:"/opt/hobot/model/s100/basic/"}),")"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u6dfb\u52a0\u6a21\u578b\u914d\u7f6e"}),(0,r.jsx)(n.td,{children:"bpu_wrap.c"}),(0,r.jsx)(n.td,{children:"\u5728 bpu_models \u4e2d\u6dfb\u52a0\u65b0\u6a21\u578b\u7684\u540d\u79f0\u3001\u6307\u5b9a\u7b97\u6cd5\u6a21\u578b\u6587\u4ef6\uff0c\u63a8\u7406\u548c\u540e\u5904\u7406\u51fd\u6570\u63a5\u53e3"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u63a8\u7406\u7ebf\u7a0b\u5904\u7406\u51fd\u6570"}),(0,r.jsx)(n.td,{children:"bpu_wrap.c"}),(0,r.jsxs)(n.td,{children:["\u5728\u5904\u7406\u51fd\u6570\u4e2d\u51c6\u5907\u8f93\u51fa tensor\uff0c\u8c03\u7528 ",(0,r.jsx)(n.strong,{children:"hbDNNInfer"})," \u63a8\u7406\uff0c\u5f97\u5230\u7ed3\u679c\u540e\uff0c\u628a\u7ed3\u679c\u653e\u5165 output \u961f\u5217\u3002\u793a\u4f8b\uff1a",(0,r.jsx)(n.strong,{children:"inference_yolov5s"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u540e\u5904\u7406\u7ebf\u7a0b\u51fd\u6570"}),(0,r.jsx)(n.td,{children:"bpu_wrap.c"}),(0,r.jsxs)(n.td,{children:["\u4ece output \u961f\u5217\u4e2d\u53d6\u51fa\u7b97\u6cd5\u7ed3\u679c\uff0c\u8c03\u7528\u540e\u5904\u7406\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\uff0c\u5f97\u5230 json \u683c\u5f0f\u7684\u7ed3\u679c\u5b57\u7b26\u4e32\u3002\u5982\u679c\u8bbe\u7f6e\u4e86\u56de\u8c03\u51fd\u6570\uff0c\u5219\u8c03\u7528\u56de\u8c03\u3002\u793a\u4f8b\uff1a",(0,r.jsx)(n.strong,{children:"post_process_yolov5s"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u540e\u5904\u7406\u4ee3\u7801"}),(0,r.jsx)(n.td,{children:"yolov5_post_process.cpp"}),(0,r.jsx)(n.td,{children:"\u7b97\u6cd5\u6a21\u578b\u90fd\u8981\u5bf9\u5e94\u540e\u5904\u7406\u65b9\u6cd5\uff0c\u6bd4\u5982\u5206\u7c7b\u6a21\u578b\u8981\u628a\u8fd4\u56de\u7684 id \u548c\u7c7b\u578b\u540d\u5bf9\u5e94\u8d77\u6765\uff0c\u68c0\u6d4b\u6a21\u578b\u8981\u628a\u68c0\u6d4b\u6846\u6620\u5c04\u5230\u539f\u59cb\u56fe\u50cf\u7684\u4f4d\u7f6e\u4e0a\u3002"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Web \u9875\u9762\u4e0a\u589e\u52a0\u6e32\u67d3\u5904\u7406"}),(0,r.jsx)(n.td,{children:"WebServer/www/js/DisplayWindowManager.js"}),(0,r.jsx)(n.td,{children:"\u975e\u5fc5\u987b"})]})]})]}),"\n",(0,r.jsx)(n.h4,{id:"\u51c6\u5907\u7b97\u6cd5\u6a21\u578b",children:"\u51c6\u5907\u7b97\u6cd5\u6a21\u578b"}),"\n",(0,r.jsx)(n.p,{children:"\u5f00\u53d1\u677f\u4e0a\u652f\u6301\u8fd0\u884c\u7684\u7b97\u6cd5\u6a21\u578b\u6709\u4e24\u79cd\u540e\u7f00\u540d\uff0c bin \u6587\u4ef6\u548c hbm \u6587\u4ef6\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"bin \u6a21\u578b\uff1a\u901a\u8fc7\u7b97\u6cd5\u5de5\u5177\u94fe\u8f6c\u6362\uff08 PTQ \uff09\u5f97\u5230\u7684\u6a21\u578b\uff0c\u4ee5 bin \u4f5c\u4e3a\u540e\u7f00"}),"\n",(0,r.jsx)(n.li,{children:"hbm \u6a21\u578b\uff1a\u901a\u8fc7\u5b9a\u70b9\u6a21\u578b\u8bad\u7ec3\u6846\u67b6\uff08 QAT \uff09\u76f4\u63a5\u8bad\u7ec3\u5f97\u5230\u7684\u7b97\u6cd5\u6a21\u578b"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7b97\u6cd5\u6a21\u578b\u7684\u8be6\u7ec6\u5f00\u53d1\u8bf4\u660e\u8bf7\u53c2\u8003\u300a\u91cf\u5316\u5de5\u5177\u94fe\u5f00\u53d1\u6307\u5357\u300b\u6587\u6863\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u6dfb\u52a0\u521d\u59cb\u5316\u8fc7\u7a0b",children:"\u6dfb\u52a0\u521d\u59cb\u5316\u8fc7\u7a0b"}),"\n",(0,r.jsx)(n.p,{children:"\u5728 bpu_wrap.c \u4e2d\u7684 bpu_models \u6570\u7ec4\u4e2d\u5b9a\u4e49\u65b0\u7684\u7b97\u6cd5\u6a21\u578b\uff0c\u6dfb\u52a0\u65b0\u6a21\u578b\u7684\u540d\u79f0\u3001\u6307\u5b9a\u7b97\u6cd5\u6a21\u578b\u6587\u4ef6\uff0c\u63a8\u7406\u548c\u540e\u5904\u7406\u51fd\u6570\u63a5\u53e3\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'bpu_model_descriptor bpu_models[] = {\n\t{\n\t\t.model_name = "yolov5s",                                   // \u7b97\u6cd5\u540d\u79f0\uff0c web \u5ba2\u6237\u7aef\u4e0a\u4f1a\u663e\u793a\u8fd9\u4e2a\u540d\u79f0\u7ed9\u7528\u6237\u9009\u62e9\n\t\t.model_path = "../model_zoom/yolov5s_672x672_nv12.bin",    // \u7b97\u6cd5\u6a21\u578b\u6587\u4ef6\n\t\t.inference_func = inference_yolov5s,                       // \u63a8\u7406\u51fd\u6570\n\t\t.post_proc_func = post_process_yolov5s                     // \u540e\u5904\u7406\u51fd\u6570\uff0c\u5982\u679c\u8fd9\u90e8\u5206\u6bd4\u8f83\u7b80\u5355\uff0c\u53ef\u4ee5\u5408\u5e76\u5230\u63a8\u7406\u51fd\u6570\u4e2d\u4e00\u8d77\u5904\u7406\n\t},\n\t... ( \u7701\u7565 ) ...\n};\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u7b97\u6cd5\u4efb\u52a1\u542f\u52a8\u65f6\uff0c\u6839\u636e ",(0,r.jsx)(n.code,{children:"model_name"})," \u542f\u52a8\u76f8\u5e94\u7684\u63a8\u7406\u7ebf\u7a0b\u548c\u7b97\u6cd5\u540e\u5904\u7406\u7ebf\u7a0b\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"\u63a8\u7406\u7ebf\u7a0b\u5904\u7406\u51fd\u6570",children:"\u63a8\u7406\u7ebf\u7a0b\u5904\u7406\u51fd\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u63a8\u7406\u7ebf\u7a0b\u4e2d\u5b9e\u73b0\u8f93\u51fa\u7ed3\u679c tensor \u7684\u51c6\u5907\uff1b\u4ece yuv \u961f\u5217\u4e2d\u53d6\u51fa yuv \u6570\u636e\uff0c\u8c03\u7528 HB_BPU_runModel \u63a8\u7406\u5f97\u5230\u7b97\u6cd5\u7ed3\u679c\uff1b\u518d\u628a\u7b97\u6cd5\u7ed3\u679c\u63a8\u8fdb output Queue\uff0c\u4f9b\u540e\u5904\u7406\u4f7f\u7528\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'static void *inference_yolov5s(void *ptr)\n{\n\t// \u51c6\u5907\u6a21\u578b\u8f93\u51fa\u8282\u70b9 tensor\uff0c 5 \u7ec4\u8f93\u51fa buff \u8f6e\u8f6c\uff0c\u7b80\u5355\u5904\u7406\uff0c\u7406\u8bba\u4e0a\u540e\u5904\u7406\u7684\u901f\u5ea6\u662f\u8981\u6bd4\u7b97\u6cd5\u63a8\u7406\u66f4\u5feb\u7684\n\thbDNNTensor output_tensors[5][3];\n\tint32_t cur_ouput_buf_idx = 0;\n\tfor (i = 0; i < 5; i++) {\n\t\tret = prepare_output_tensor(output_tensors[i], dnn_handle);\n\t\tif (ret) {\n\t\t\tSC_LOGE("prepare model output tensor failed");\n\t\t\treturn NULL;\n\t\t}\n\t}\n\n\twhile (privThread->eState == E_THREAD_RUNNING) {\n\t\t// \u83b7\u53d6\u9700\u8981\u8fdb\u884c\u7b97\u6cd5\u8fd0\u7b97\u7684\u56fe\u50cf\u6570\u636e\uff0c\u683c\u5f0f\u57fa\u672c\u90fd\u662f NV12 \u7684 yuv\n\t\tif (mQueueDequeueTimed(&bpu_handle->m_input_queue, 100, (void**)&input_tensor) != E_QUEUE_OK)\n\t\t\tcontinue;\n\n        // \u6a21\u578b\u63a8\u7406 infer\n\t\thbDNNInferCtrlParam infer_ctrl_param;\n\t\tHB_DNN_INITIALIZE_INFER_CTRL_PARAM(&infer_ctrl_param);\n\t\tret = hbDNNInfer(&task_handle,\n\t\t\t\t&output,\n\t\t\t\t&input_tensor->m_dnn_tensor,\n\t\t\t\tdnn_handle,\n\t\t\t\t&infer_ctrl_param);\n\n\t\t// \u540e\u5904\u7406\u6570\u636e\u5165\u961f\n\t\tYolo5PostProcessInfo_t *post_info;\n\t\tpost_info = (Yolo5PostProcessInfo_t *)malloc(sizeof(Yolo5PostProcessInfo_t));\n\t\t\u2026 \u2026\n\t\tmQueueEnqueue(&bpu_handle->m_output_queue, post_info);\n\t\tcur_ouput_buf_idx++;\n\t\tcur_ouput_buf_idx %= 5;\n}\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u540e\u5904\u7406\u7ebf\u7a0b\u51fd\u6570",children:"\u540e\u5904\u7406\u7ebf\u7a0b\u51fd\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u540e\u5904\u7406\u7ebf\u7a0b\u4e2d\u5b9e\u73b0\u4ece output queue \u4e2d\u83b7\u53d6\u7b97\u6cd5\u7ed3\u679c\uff1b\u8c03\u7528\u540e\u5904\u7406\u51fd\u6570\uff1b\u8c03\u7528\u7b97\u6cd5\u4efb\u52a1\u56de\u8c03\u51fd\u6570\u5904\u7406\u7b97\u6cd5\u7ed3\u679c\uff08\u5f53\u524d\u7684\u56de\u8c03\u6709\u4f5c\u7528\u7684\u90fd\u662f\u76f4\u63a5\u53d1\u9001\u7ed9 web\uff0c\u5728 web \u4e0a\u6e32\u67d3\u7b97\u6cd5\u7ed3\u679c\uff09\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'\nstatic void *post_process_yolov5s(void *ptr)\n{\n\ttsThread *privThread = (tsThread*)ptr;\n\tYolov5PostProcessInfo_t *post_info;\n\n\tmThreadSetName(privThread, __func__);\n\n\tbpu_handle_t *bpu_handle = (bpu_handle_t *)privThread->pvThreadData;\n\twhile (privThread->eState == E_THREAD_RUNNING) {\n\t\t// \u4ece\u540e\u5904\u7406\u6570\u636e\u961f\u5217\u4e2d\u83b7\u53d6\u6570\u636e\n\t\tif (mQueueDequeueTimed(&bpu_handle->m_output_queue, 100, (void**)&post_info) != E_QUEUE_OK)\n\t\t\tcontinue;\n\n\t\tchar *results = Yolov5PostProcess(post_info); // \u8fdb\u884c\u540e\u5904\u7406\uff0c\u6bd4\u5982\u5f97\u5230\u68c0\u6d4b\u6846\u3001\u8fc7\u6ee4\u4f4e\u7f6e\u4fe1\u5ea6\u7684\u7ed3\u679c\u3001\u628a\u68c0\u6d4b\u6846\u7684\u5bbd\u9ad8\u7f29\u653e\u4e3a\u663e\u793a\u89c6\u9891\u7684\u5bbd\u9ad8\u7b49\n\n\t\tif (results) {\n\t\t\tif (NULL != bpu_handle->callback) {\n\t\t\t\t// \u7b97\u6cd5\u4efb\u52a1\u7ed3\u679c\u56de\u8c03\uff0c\u5f53\u524d\u7684\u5e94\u7528\u573a\u666f\u662f\u628a\u7b97\u6cd5\u7ed3\u679c\u901a\u8fc7 websocket \u53d1\u9001\u7ed9\u6d4f\u89c8\u5668\n\t\t\t\tbpu_handle->callback(results, bpu_handle->m_userdata);\n\t\t\t} else {\n\t\t\t\tSC_LOGI("%s", results);\n\t\t\t}\n\t\t\tfree(results);\n\t\t}\n\t\tif (post_info) {\n\t\t\tfree(post_info);\n\t\t\tpost_info = NULL;\n\t\t}\n\t}\n\tmThreadFinish(privThread);\n\treturn NULL;\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u540e\u5904\u7406\u4ee3\u7801",children:"\u540e\u5904\u7406\u4ee3\u7801"}),"\n",(0,r.jsx)(n.p,{children:"\u6bcf\u4e2a\u7b97\u6cd5\u6a21\u578b\u5efa\u8bae\u90fd\u6dfb\u52a0\u4e00\u4e2a\u540e\u5904\u7406\u65b9\u6cd5\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"yolov5 \uff1a yolo5_post_process.cpp"}),"\n",(0,r.jsx)(n.li,{children:"mobilenet_v2 \uff1a\u5206\u7c7b\u6a21\u578b\u7684\u5904\u7406\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u628a id \u548c\u7c7b\u578b\u540d\u8fdb\u884c\u5bf9\u5e94"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u540e\u5904\u7406\u65b9\u6cd5\u4e2d\u8981\u5b8c\u6210\u4ee5\u4e0b\u51e0\u4ef6\u4e8b\u60c5\uff1a"}),"\n",(0,r.jsx)(n.p,{children:"\u5206\u6790\u8f93\u51fa\u7ed3\u679c\uff0c\u5206\u7c7b\u6a21\u578b\u8981\u5b8c\u6210\u7c7b\u578b\u540d\u7684\u5339\u914d\uff0c\u68c0\u6d4b\u6a21\u578b\u8981\u5b8c\u6210\u7b97\u6cd5\u7ed3\u679c\u6846\u5230\u539f\u59cb\u56fe\u50cf\u5750\u6807\u7684\u6620\u5c04\u7b49\uff1b"}),"\n",(0,r.jsx)(n.p,{children:"\u7b97\u6cd5\u7ed3\u679c\u5904\u7406\u6210 json \u683c\u5f0f\u3002\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528\uff0c\u5728\u51fd\u6570\u4e2d\u8fdb\u884c json \u683c\u5f0f\u5316\uff0c\u6bd4\u5982\u4f20\u5bfc\u7ed9 web\uff0c\u8fd9\u91cc\u8f93\u51fa\u7684\u7ed3\u679c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'// Yolov5 \u8f93\u51fa tensor \u683c\u5f0f\n// 3 \u6b21\u4e0b\u91c7\u6837\u5f97\u5230\u4e09\u7ec4\u7f29\u5c0f\u540e\u7684 gred\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a gred \u8fdb\u884c\u4e09\u6b21\u9884\u6d4b\uff0c\u6700\u540e\u8f93\u51fa\u7ed3\u679c\nchar* Yolov5PostProcess(Yolov5PostProcessInfo_t *post_info) {\n\thbDNNTensor *tensor = post_info->output_tensor;\n\n\tstd::vector<Detection> dets;\n\tstd::vector<Detection> det_restuls;\n\tuint32_t i = 0;\n\tchar *str_dets;\n\n\t// \u6839\u636e\u7f6e\u4fe1\u5ea6\u8fc7\u6ee4\u68c0\u6d4b\u6846\n\tfor (i = 0; i < default_yolov5_config.strides.size(); i++) {\n\t\t_postProcess(&tensor[i], post_info, i, dets);\n\t}\n\t// \u8ba1\u7b97\u4ea4\u5e76\u6bd4\u6765\u5408\u5e76\u68c0\u6d4b\u6846\uff0c\u4f20\u5165\u4ea4\u5e76\u6bd4\u9608\u503c (0.65) \u548c\u8fd4\u56de box \u6570\u91cf (5000)\n\tyolov5_nms(dets, post_info->nms_threshold, post_info->nms_top_k, det_restuls, false);\n\tstd::stringstream out_string;\n\n\t// \u7b97\u6cd5\u7ed3\u679c\u8f6c\u6362\u6210 json \u683c\u5f0f\n\tout_string << "\\"timestamp\\": ";\n\tunsigned long timestamp = post_info->tv.tv_sec * 1000000 + post_info->tv.tv_usec;\n\tout_string << timestamp;\n\tout_string << ",\\"detection_result\\": [";\n\tfor (i = 0; i < det_restuls.size(); i++) {\n\t\tauto det_ret = det_restuls[i];\n\t\tout_string << det_ret;\n\t\tif (i < det_restuls.size() - 1)\n\t\tout_string << ",";\n\t}\n\tout_string << "]" << std::endl;\n\n\tstr_dets = (char *)malloc(out_string.str().length() + 1);\n\tstr_dets[out_string.str().length()] = \'\\0\';\n\tsnprintf(str_dets, out_string.str().length(), "%s", out_string.str().c_str());\n\treturn str_dets;\n}\n'})}),"\n",(0,r.jsx)(n.h4,{id:"web-\u9875\u9762\u4e0a\u589e\u52a0\u6e32\u67d3\u5904\u7406",children:"Web \u9875\u9762\u4e0a\u589e\u52a0\u6e32\u67d3\u5904\u7406"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u90e8\u5206\u975e\u5fc5\u987b\u5b9e\u73b0\u90e8\u5206\uff0c\u5728\u5f53\u524d\u7684\u5b9e\u73b0\u4e2d\uff0c\u6240\u6709\u7b97\u6cd5\u7ed3\u679c\u4f1a\u6e32\u67d3\u5230 web \u9875\u9762\u4e0a\uff0c\u6570\u636e\u6d41\u7a0b\u662f\u5728\u7b97\u6cd5\u540e\u5904\u7406\u8fd4\u56de json \u683c\u5f0f\u7684\u7ed3\u679c\u540e\uff0c\u901a\u8fc7 websocket \u53d1\u9001\u7ed3\u679c\u4fe1\u606f\u7ed9\u5230 web \u9875\u9762\uff0c\u5728 web \u5b9e\u73b0\u4e86\u4e00\u4e2a\u753b\u5e03\uff0c\u5728\u753b\u5e03\u4e0a\u6e32\u67d3\u7b97\u6cd5\u7ed3\u679c\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'// \u901a\u7528\u7684\u7b97\u6cd5\u56de\u8c03\u51fd\u6570\uff0c\u76ee\u524d\u90fd\u662f\u901a\u8fc7 websocket \u60f3 web \u4e0a\u53d1\u9001\nint32_t bpu_wrap_general_result_handle(char *result, void *userdata)\n{\n\tint32_t ret = 0;\n\tint32_t pipeline_id = 0;\n\tchar *ws_msg = NULL;\n\n\tif (userdata)\n\t\tpipeline_id = *(int*)userdata;\n\n\t// json \u7b97\u6cd5\u7ed3\u679c\u6dfb\u52a0\u6807\u5fd7\u4fe1\u606f\n\t// \u5206\u914d\u5185\u5b58\n\tws_msg = malloc(strlen(result) + 32);\n\tif (NULL == ws_msg) {\n\t\tSC_LOGE("Failed to allocate memory for ws_msg");\n\t\treturn -1;\n\t}\n\tsprintf(ws_msg, "{\\"kind\\":10, \\"pipeline\\":%d,", pipeline_id + 1);\n\tstrcat(ws_msg, result);\n\tstrcat(ws_msg, "}");\n\n\tret = SDK_Cmd_Impl(SDK_CMD_WEBSOCKET_SEND_MSG, (void*)ws_msg);\n\tfree(ws_msg);\n\treturn ret;\n}\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 ",(0,r.jsx)(n.code,{children:"WebServer/www/js/WebSocketProtocolHandler.js"})," \u6587\u4ef6\u4e2d\u5df2\u7ecf\u652f\u6301\u4e86\u901a\u7528\u7684\u5206\u7c7b\u548c\u76ee\u6807\u68c0\u6d4b\u7684\u7b97\u6cd5\u5904\u7406\u903b\u8f91\uff0c\u5982\u679c\u9700\u8981\u6e32\u67d3\u65b0\u7c7b\u578b\u7b97\u6cd5\u6a21\u578b\u7684\u7ed3\u679c\uff0c\u9700\u8981\u4fee\u6539 ",(0,r.jsx)(n.code,{children:"js"})," \u4ee3\u7801\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'// web \u9875\u9762\u4e0a websocket \u63a5\u6536\u6570\u636e\u7684\u5904\u7406\u51fd\u6570\nhandleMessage(event) {\n\t{\n\t... ( \u7701\u7565 ) ...\n\ttry {\n            const message = JSON.parse(event.data);\n            if (message && message.kind) {\n                // \u89e3\u6790\u547d\u4ee4\u7c7b\u578b\u5e76\u8c03\u7528\u5bf9\u5e94\u7684\u56de\u8c03\u51fd\u6570\n                switch (message.kind) {\n\t\t\t\t\t... ( \u7701\u7565 ) ...\n                    case this.REQUEST_TYPES.ALOG_RESULT:\n                        if (this.userCallbacks.onAlogResult) {\n                            this.userCallbacks.onAlogResult(message);\n                        }\n                        break;\n\t\t\t\t\t... ( \u7701\u7565 ) ...\n                    default:\n                        console.warn(`\u672a\u77e5\u7684\u547d\u4ee4\u7c7b\u578b: kind=${message.kind}`);\n                }\n            }\n        } catch (error) {\n            console.error("\u6d88\u606f\u89e3\u6790\u5931\u8d25:", error);\n        }\n    }\n\t... ( \u7701\u7565 ) ...\n}\n\n'})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);