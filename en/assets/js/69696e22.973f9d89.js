"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[30548],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>s});var o=i(96540);const r={},t=o.createContext(r);function c(e){const n=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),o.createElement(t.Provider,{value:n},e.children)}},44321:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>f,frontMatter:()=>c,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"Advanced_development/linux_development/driver_development_s100/uboot_kernel_config","title":"Configure U-Boot and Kernel Option Parameters","description":"In system software development, it is often necessary to configure feature options for U-Boot and the kernel. This chapter introduces several commonly used configuration methods for user reference.","source":"@site/i18n/en/docusaurus-plugin-content-docs-docs_s/current/07_Advanced_development/02_linux_development/04_driver_development_s100/01_uboot_kernel_config.md","sourceDirName":"07_Advanced_development/02_linux_development/04_driver_development_s100","slug":"/Advanced_development/linux_development/driver_development_s100/uboot_kernel_config","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/uboot_kernel_config","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1764569079000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"7.2.4 RDK S100\u9a71\u52a8\u5f00\u53d1\u6307\u5357","permalink":"/rdk_doc/en/rdk_s/driver_development_s100"},"next":{"title":"UART Driver Debugging Guide","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_uart_dev"}}');var r=i(74848),t=i(28453);const c={sidebar_position:1},s="Configure U-Boot and Kernel Option Parameters",d={},l=[{value:"Configure U-Boot Option Parameters",id:"configure-u-boot-option-parameters",level:2},{value:"Configure via the xbuild Command",id:"configure-via-the-xbuild-command",level:3},{value:"Manual Configuration",id:"manual-configuration",level:3},{value:"Configure Kernel Option Parameters",id:"configure-kernel-option-parameters",level:2},{value:"Configure via the mk_kernel Command",id:"configure-via-the-mk_kernel-command",level:3},{value:"Manual Configuration",id:"manual-configuration-1",level:3}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"configure-u-boot-and-kernel-option-parameters",children:"Configure U-Boot and Kernel Option Parameters"})}),"\n",(0,r.jsx)(n.p,{children:"In system software development, it is often necessary to configure feature options for U-Boot and the kernel. This chapter introduces several commonly used configuration methods for user reference."}),"\n",(0,r.jsx)(n.h2,{id:"configure-u-boot-option-parameters",children:"Configure U-Boot Option Parameters"}),"\n",(0,r.jsxs)(n.admonition,{title:"Note",type:"info",children:[(0,r.jsxs)(n.p,{children:["The following instructions use modifying the ",(0,r.jsx)(n.code,{children:"hobot_s100_defconfig"})," configuration file as an example."]}),(0,r.jsxs)(n.p,{children:["The specific U-Boot configuration file in use can be found by checking the value of the ",(0,r.jsx)(n.code,{children:"HR_UBOOT_CONFIG_FILE"})," variable in the board-level configuration file ",(0,r.jsx)(n.code,{children:"bootloader/device/.board_config.mk"})," after running ",(0,r.jsx)(n.code,{children:"./xbuild.sh lunch"}),"."]})]}),"\n",(0,r.jsx)(n.h3,{id:"configure-via-the-xbuild-command",children:"Configure via the xbuild Command"}),"\n",(0,r.jsxs)(n.p,{children:["First, navigate to the ",(0,r.jsx)(n.code,{children:"source/bootloader"})," directory. The directory structure is as follows:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u251c\u2500\u2500 build # Build system code directory, providing shell scripts for compiling various functional modules and required tools\n\u251c\u2500\u2500 device # Board-level configuration directory; each hardware platform has its own configuration file for setting compilation options, partition tables, etc.\n\u251c\u2500\u2500 miniboot  # Generates an integrated minimal boot firmware containing GPT, MBR, BL2, DDR, and BL3x\n\u251c\u2500\u2500 out # Build output directory\n\u2514\u2500\u2500 uboot # U-Boot source code\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The main build script is ",(0,r.jsx)(n.code,{children:"build/xbuild.sh"}),", which provides the following command to assist users in configuring U-Boot options. This command automatically uses the U-Boot configuration file specified in the board-level configuration file and, upon completion, automatically performs ",(0,r.jsx)(n.code,{children:"savedefconfig"})," and saves the changes:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"./xbuild.sh uboot menuconfig\n"})}),"\n",(0,r.jsx)(n.p,{children:"Upon successful execution, a graphical U-Boot configuration interface will open. In this interactive interface, you can configure options, such as disabling unnecessary features and enabling required ones."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_x5/screenshot-20241120-201418.png",alt:"image-20220518111319607"})}),"\n",(0,r.jsxs)(n.p,{children:["After completing your configuration in the menuconfig interface, select ",(0,r.jsx)(n.code,{children:"Exit"})," to quit. Follow the prompt to choose ",(0,r.jsx)(n.code,{children:"Yes"})," or ",(0,r.jsx)(n.code,{children:"No"})," to save your modifications to the ",(0,r.jsx)(n.code,{children:".config"})," file."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development/image-20220518111506018.png",alt:"image-20220518111506018"})}),"\n",(0,r.jsx)(n.p,{children:"After exiting the configuration, the system will automatically save the configuration file. The automated steps include:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Call savedefconfig to clean up the configuration file: retain essential items and remove dependent items, generating a defconfig file\nmake savedefconfig\n# Overwrite the U-Boot configuration file specified in the board-level configuration with the generated defconfig file\ncp -f defconfig <U-Boot configuration file specified in the board-level configuration>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"manual-configuration",children:"Manual Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["First, navigate to the ",(0,r.jsx)(n.code,{children:"source/bootloader/uboot"})," directory and run ",(0,r.jsx)(n.code,{children:"make ARCH=arm64 hobot_s100_defconfig"}),". The ",(0,r.jsx)(n.code,{children:"make"}),' command first executes the top-level Makefile. Targets ending with "config" share a common entry point:']}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-makefile",children:"%config: scripts_basic outputmakefile FORCE\n        $(Q)$(MAKE) $(build)=scripts/kconfig $@\n"})}),"\n",(0,r.jsx)(n.p,{children:"The expanded command becomes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"make -f ./scripts/Makefile.build obj=scripts/kconfig hobot_s100_defconfig\n"})}),"\n",(0,r.jsxs)(n.p,{children:["After executing this command, a ",(0,r.jsx)(n.code,{children:".config"})," file will be generated in the root directory of the U-Boot source code."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make ARCH=arm64 hobot_s100_defconfig\n\n  HOSTCC  scripts/basic/fixdep\n  HOSTCC  scripts/kconfig/conf.o\n  YACC    scripts/kconfig/zconf.tab.c\n  LEX     scripts/kconfig/zconf.lex.c\n  HOSTCC  scripts/kconfig/zconf.tab.o\n  HOSTLD  scripts/kconfig/conf\n#\n# configuration written to .config\n#\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can then run ",(0,r.jsx)(n.code,{children:"make ARCH=arm64 menuconfig"})," to open the graphical configuration interface for configuring U-Boot options."]}),"\n",(0,r.jsxs)(n.p,{children:["After completing your configuration in the menuconfig interface, select ",(0,r.jsx)(n.code,{children:"Exit"})," to quit. Follow the prompt to choose ",(0,r.jsx)(n.code,{children:"Yes"})," or ",(0,r.jsx)(n.code,{children:"No"})," to save your modifications to the ",(0,r.jsx)(n.code,{children:".config"})," file."]}),"\n",(0,r.jsxs)(n.p,{children:["After saving the configuration, you can run ",(0,r.jsx)(n.code,{children:"diff .config configs/hobot_s100_defconfig"})," to compare differences and verify that your changes meet expectations."]}),"\n",(0,r.jsxs)(n.p,{children:["If the modifications are correct, run ",(0,r.jsx)(n.code,{children:"cp .config configs/hobot_s100_defconfig"})," to replace the default configuration file."]}),"\n",(0,r.jsxs)(n.p,{children:["Clean up files such as ",(0,r.jsx)(n.code,{children:".config"})," in the source directory; otherwise, during a full system rebuild, you may see a warning like xxx is not clean, please run 'make mrproper'."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make distclean\n# or\nmake mrproper\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configure-kernel-option-parameters",children:"Configure Kernel Option Parameters"}),"\n",(0,r.jsxs)(n.admonition,{title:"Note",type:"info",children:[(0,r.jsxs)(n.p,{children:["The following instructions use modifying the ",(0,r.jsx)(n.code,{children:"drobot_s100_defconfig"})," configuration file as an example."]}),(0,r.jsxs)(n.p,{children:["The specific kernel configuration file in use can be found by checking the value of the ",(0,r.jsx)(n.code,{children:"kernel_config_file"})," variable in the ",(0,r.jsx)(n.code,{children:"mk_kernel.sh"})," script."]})]}),"\n",(0,r.jsx)(n.h3,{id:"configure-via-the-mk_kernel-command",children:"Configure via the mk_kernel Command"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"mk_kernel.sh"})," script provides the following command to assist users in configuring kernel options. This command automatically uses the kernel configuration file specified in the board-level configuration and, upon completion, automatically performs ",(0,r.jsx)(n.code,{children:"savedefconfig"})," and saves the changes:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"./mk_kernel.sh menuconfig\n"})}),"\n",(0,r.jsx)(n.p,{children:"Upon successful execution, a graphical kernel configuration interface will open. In this interactive interface, you can configure options, such as disabling unnecessary features and enabling required ones."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_s100/image-s100-kernel.png",alt:"image-20220518111319607"})}),"\n",(0,r.jsxs)(n.p,{children:["After completing your configuration in the menuconfig interface, select ",(0,r.jsx)(n.code,{children:"Exit"})," to quit. Follow the prompt to choose ",(0,r.jsx)(n.code,{children:"Yes"})," or ",(0,r.jsx)(n.code,{children:"No"})," to save your modifications to the ",(0,r.jsx)(n.code,{children:".config"})," file."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development/image-20220518111506018.png",alt:"image-20220518111506018"})}),"\n",(0,r.jsx)(n.p,{children:"After exiting the configuration, the system will automatically save the configuration file. The automated steps include:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# Call savedefconfig to clean up the configuration file: retain essential items and remove dependent items, generating a defconfig file\nmake savedefconfig\n# Overwrite the kernel configuration file specified in the board-level configuration with the generated defconfig file\ncp defconfig <kernel configuration file specified in the board-level configuration>\n"})}),"\n",(0,r.jsx)(n.h3,{id:"manual-configuration-1",children:"Manual Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Configuring the kernel via ",(0,r.jsx)(n.code,{children:"menuconfig"})," follows the same process as configuring U-Boot. The command execution steps are as follows:"]}),"\n",(0,r.jsxs)(n.p,{children:["First, navigate to the ",(0,r.jsx)(n.code,{children:"source/kernel"})," directory, then configure kernel options using the steps below:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"drobot_s100_defconfig"})," to generate ",(0,r.jsx)(n.code,{children:".config"}),". If a full build has already been performed, the ",(0,r.jsx)(n.code,{children:".config"})," file will already be set up."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"make ARCH=arm64 drobot_s100_defconfig\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Run the following command to modify the configuration:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"make ARCH=arm64 menuconfig\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"After modification, you can check the differences between the new and original configurations:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"diff .config hobot-drivers/configs/drobot_s100_defconfig\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Overwrite ",(0,r.jsx)(n.code,{children:"drobot_s100_defconfig"})," with the new configuration:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cp .config hobot-drivers/configs/drobot_s100_defconfig\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Clean up files such as ",(0,r.jsx)(n.code,{children:".config"})," in the source directory; otherwise, during a full system rebuild, you may see a warning like \"xxx is not clean, please run 'make mrproper'\"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"make distclean\n# or\nmake mrproper\n"})})]})}function f(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}}}]);