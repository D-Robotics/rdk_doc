"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[46125],{11470:(e,n,t)=>{t.d(n,{A:()=>w});var r=t(96540),s=t(34164),l=t(23104),o=t(56347),a=t(205),i=t(57485),c=t(31682),d=t(70679);function u(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,r.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r}))}(t);return function(e){const n=(0,c.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,i.aZ)(s),(0,r.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})},[s,t])]}function b(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,l=h(e),[o,i]=(0,r.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:l})),[c,u]=m({queryString:t,groupId:s}),[b,x]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,s]=(0,d.Dv)(n);return[t,(0,r.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),v=(()=>{const e=c??b;return p({value:e,tabValues:l})?e:null})();(0,a.A)(()=>{v&&i(v)},[v]);return{selectedValue:o,selectValue:(0,r.useCallback)(e=>{if(!p({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);i(e),u(e),x(e)},[u,x,l]),tabValues:l}}var x=t(92303);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(74848);function g({className:e,block:n,selectedValue:t,selectValue:r,tabValues:o}){const a=[],{blockElementScrollPositionUntilNextRender:i}=(0,l.a_)(),c=e=>{const n=e.currentTarget,s=a.indexOf(n),l=o[s].value;l!==t&&(i(n),r(l))},d=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{const t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:o.map(({value:e,label:n,attributes:r})=>(0,f.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:c,...r,className:(0,s.A)("tabs__item",v.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function j({lazy:e,children:n,selectedValue:t}){const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=l.find(e=>e.props.value===t);return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:l.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function _(e){const n=b(e);return(0,f.jsxs)("div",{className:(0,s.A)("tabs-container",v.tabList),children:[(0,f.jsx)(g,{...n,...e}),(0,f.jsx)(j,{...n,...e})]})}function w(e){const n=(0,x.A)();return(0,f.jsx)(_,{...e,children:u(e.children)},String(n))}},13196:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"Robot_development/apps/hobot_llamacpp","title":"5.4.10 Vision & Speech Box","description":"Overview","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/05_Robot_development/04_apps/hobot_llamacpp.md","sourceDirName":"05_Robot_development/04_apps","slug":"/Robot_development/apps/hobot_llamacpp","permalink":"/rdk_doc/en/Robot_development/apps/hobot_llamacpp","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1761287360000,"sidebarPosition":10,"frontMatter":{"sidebar_position":10},"sidebar":"tutorialSidebar","previous":{"title":"5.4.9 Video Boxs","permalink":"/rdk_doc/en/Robot_development/apps/video_boxs"},"next":{"title":"5.5.1 Using \\"zero-copy\\"","permalink":"/rdk_doc/en/Robot_development/tros_dev/zero_copy"}}');var s=t(74848),l=t(28453);t(11470),t(19365);const o={sidebar_position:10},a="5.4.10 Vision & Speech Box",i={},c=[{value:"Overview",id:"overview",level:2},{value:"Supported Platforms",id:"supported-platforms",level:2},{value:"Preparation",id:"preparation",level:2},{value:"RDK Platform",id:"rdk-platform",level:3},{value:"Usage",id:"usage",level:2},{value:"On RDK Platform",id:"on-rdk-platform",level:3},{value:"Instructions",id:"instructions",level:3},{value:"Advanced Features",id:"advanced-features",level:2},{value:"Notes",id:"notes",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"5410-vision--speech-box",children:"5.4.10 Vision & Speech Box"})}),"\n","\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"This section introduces how to experience the full pipeline of ASR + VLM/LLM + TTS on the RDK platform."}),"\n",(0,s.jsxs)(n.p,{children:["Code repository: (",(0,s.jsx)(n.a,{href:"https://github.com/D-Robotics/hobot_llamacpp.git",children:"https://github.com/D-Robotics/hobot_llamacpp.git"}),")"]}),"\n",(0,s.jsx)(n.h2,{id:"supported-platforms",children:"Supported Platforms"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Platform"}),(0,s.jsx)(n.th,{children:"OS/Environment"}),(0,s.jsx)(n.th,{children:"Example Feature"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"RDK X5 (4GB RAM)"}),(0,s.jsx)(n.td,{children:"Ubuntu 22.04 (Humble)"}),(0,s.jsx)(n.td,{children:"Vision & Speech Box"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Note: Only supported on RDK X5 with 4GB RAM."})}),"\n",(0,s.jsx)(n.h2,{id:"preparation",children:"Preparation"}),"\n",(0,s.jsx)(n.h3,{id:"rdk-platform",children:"RDK Platform"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"RDK must be the 4GB RAM version."}),"\n",(0,s.jsx)(n.li,{children:"RDK should be flashed with Ubuntu 22.04 system image."}),"\n",(0,s.jsx)(n.li,{children:"TogetheROS.Bot should be successfully installed on RDK."}),"\n",(0,s.jsxs)(n.li,{children:["Install the ASR module for speech input with ",(0,s.jsx)(n.code,{children:"apt install tros-humble-sensevoice-ros2"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.h3,{id:"on-rdk-platform",children:"On RDK Platform"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You can use the Vision Language Model ",(0,s.jsx)(n.a,{href:"../03_box/generate/hobot_llamacpp.md",children:"Vision Language Model"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You can use the TTS tool ",(0,s.jsx)(n.a,{href:"/rdk_doc/en/Robot_development/quick_demo/hobot_tts",children:"Text-to-Speech"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"ASR tool should be installed"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"The RDK device has a 3.5mm headphone jack, and a wired headset should be plugged in. After plugging in, check if the audio device is detected:"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"root@ubuntu:~# ls /dev/snd/\n\nby-path  controlC1  pcmC1D0c  pcmC1D0p  timer\n"})}),"\n",(0,s.jsx)(n.p,{children:'The audio device name should be "hw:1,0" as shown.'}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/04_apps/image/vlm_boxs/headset.jpg",alt:"headset"})}),"\n",(0,s.jsx)(n.h3,{id:"instructions",children:"Instructions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Configure tros.b environment\nsource /opt/tros/humble/setup.bash\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using MIPI Camera for Image Publishing"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"cp -r /opt/tros/${TROS_DISTRO}/lib/hobot_llamacpp/config/ .\n# Set up MIPI camera\nexport CAM_TYPE=mipi\nros2 launch hobot_llamacpp llama_vlm.launch.py audio_device:=hw:1,0\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using USB Camera for Image Publishing"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"cp -r /opt/tros/${TROS_DISTRO}/lib/hobot_llamacpp/config/ .\n# Set up USB camera\nexport CAM_TYPE=usb\nros2 launch hobot_llamacpp llama_vlm.launch.py audio_device:=hw:1,0\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using Local Images for Playback"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"cp -r /opt/tros/${TROS_DISTRO}/lib/hobot_llamacpp/config/ .\n# Set up local image playback\nexport CAM_TYPE=fb\nros2 launch hobot_llamacpp llama_vlm.launch.py audio_device:=hw:1,0\n"})}),"\n",(0,s.jsx)(n.p,{children:'After starting the program, you can interact with the device via voice prompts. Usage: Wake up the device by saying "Hello", then give it a task, such as "Please describe this image". After receiving the task, the device will reply "Okay", then wait for the device to finish inference and start outputting text.'}),"\n",(0,s.jsx)(n.p,{children:"Example flow:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'User: "Hello, describe this image."'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'Device: "Okay, let me take a look."'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'Device: "This image shows xxx."'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"advanced-features",children:"Advanced Features"}),"\n",(0,s.jsx)(n.p,{children:"Besides supporting vision-language large models, this package also supports using pure language models for conversation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Configure tros.b environment\nsource /opt/tros/humble/setup.bash\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"cp -r /opt/tros/${TROS_DISTRO}/lib/hobot_llamacpp/config/ .\n\nros2 launch hobot_llamacpp llama_llm.launch.py llamacpp_gguf_model_file_name:=Qwen2.5-0.5B-Instruct-Q4_0.gguf audio_device:=hw:1,0 \n"})}),"\n",(0,s.jsx)(n.p,{children:'After starting the program, you can interact with the device via voice prompts. Usage: After device initialization, it will say "I\'m here"; wake up the device by saying "Hello", then give it a task, such as "How should I relax on weekends?". The device will start inference and output the response.'}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'Device: "I\'m here"'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'User: "Hello, how should I relax on weekends?"'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'Device: "Rest is important. You can read, listen to music, paint, or exercise."'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["About the ASR module: After ASR starts, even if the wake word is not detected, logs will be output to the serial port. You can speak to check if detection works. If not, check device status and number with ",(0,s.jsx)(n.code,{children:"ls /dev/snd/"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:['About wake word: Sometimes the "Hello" wake word may not be recognized, causing no output. If abnormal, check the logs for ',(0,s.jsx)(n.code,{children:"[llama_cpp_node]: Recved string data: xxx"})," to see if text is recognized."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["About audio devices: It is recommended to use the same device for recording and playback to avoid echo. If not, you can modify the device name by searching for ",(0,s.jsx)(n.code,{children:"audio_device"})," in ",(0,s.jsx)(n.code,{children:"/opt/tros/${TROS_DISTRO}/share/hobot_llamacpp/launch/llama_vlm.launch.py"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["About model selection: Currently, the VLM model only supports the large model provided in this example. The LLM model supports inference using GGUF-converted models from ",(0,s.jsx)(n.a,{href:"https://huggingface.co/models?search=GGUF",children:"https://huggingface.co/models?search=GGUF"}),"."]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var r=t(34164);const s={tabItem:"tabItem_Ymn6"};var l=t(74848);function o({children:e,hidden:n,className:t}){return(0,l.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,t),hidden:n,children:e})}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var r=t(96540);const s={},l=r.createContext(s);function o(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);