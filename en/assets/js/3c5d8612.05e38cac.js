"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[61441],{28453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>c});var l=s(96540);const i={},r=l.createContext(i);function d(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),l.createElement(r.Provider,{value:n},e.children)}},41876:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"Advanced_development/linux_development/kernel_headers","title":"7.2.2 \u5185\u6838\u5934\u6587\u4ef6","description":"\u5982\u679c\u4f60\u9700\u8981\u5728\u5f00\u53d1\u677f\u4e0a\u7f16\u8bd1\u5185\u6838\u6a21\u5757\u6216\u7c7b\u4f3c\u7684\u4ee3\u7801\uff0c\u4f60\u9700\u8981\u5b89\u88c5 Linux \u5185\u6838\u5934\u6587\u4ef6\u3002\u8fd9\u4e9b\u5934\u6587\u4ef6\u5305\u542bLinux\u5185\u6838\u7684\u5404\u79cd\u5e38\u91cf\u5b9a\u4e49\u3001\u5b8f\u5b9a\u4e49\u3001\u51fd\u6570\u63a5\u53e3\u5b9a\u4e49\u548c\u6570\u636e\u7ed3\u6784\u5b9a\u4e49\uff0c\u662f\u5b8c\u6210\u5185\u6838\u6a21\u5757\u4ee3\u7801\u7f16\u8bd1\u6240\u5fc5\u987b\u7684\u4f9d\u8d56\u4ee3\u7801\u3002","source":"@site/docs_s/07_Advanced_development/02_linux_development/02_kernel_headers.md","sourceDirName":"07_Advanced_development/02_linux_development","slug":"/Advanced_development/linux_development/kernel_headers","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/kernel_headers","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1761534853000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"7.2.1 \u5f00\u53d1\u73af\u5883\u642d\u5efa\u53ca\u7f16\u8bd1\u8bf4\u660e","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/environment_build"},"next":{"title":"7.2.3 \u5e94\u7528\u5b9e\u65f6\u5185\u6838","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/realtime_kernel"}}');var i=s(74848),r=s(28453);const d={sidebar_position:2},c="7.2.2 \u5185\u6838\u5934\u6587\u4ef6",o={},t=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:2},{value:"Hello World\u5185\u6838\u6a21\u5757",id:"hello-world\u5185\u6838\u6a21\u5757",level:3},{value:"\u7f16\u5199Hello World\u5185\u6838\u6a21\u5757",id:"\u7f16\u5199hello-world\u5185\u6838\u6a21\u5757",level:4},{value:"\u7f16\u5199Makefile",id:"\u7f16\u5199makefile",level:4},{value:"\u6a21\u5757\u7b7e\u540d",id:"\u6a21\u5757\u7b7e\u540d",level:4},{value:"\u52a0\u8f7d\u6a21\u5757",id:"\u52a0\u8f7d\u6a21\u5757",level:4},{value:"\u914d\u7f6e\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d",id:"\u914d\u7f6e\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d",level:4},{value:"\u7b2c\u4e09\u65b9\u5185\u6838\u9a71\u52a8\u6a21\u5757\u7f16\u8bd1\u793a\u4f8b",id:"\u7b2c\u4e09\u65b9\u5185\u6838\u9a71\u52a8\u6a21\u5757\u7f16\u8bd1\u793a\u4f8b",level:3},{value:"PCAN",id:"pcan",level:4}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"722-\u5185\u6838\u5934\u6587\u4ef6",children:"7.2.2 \u5185\u6838\u5934\u6587\u4ef6"})}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u4f60\u9700\u8981\u5728\u5f00\u53d1\u677f\u4e0a\u7f16\u8bd1\u5185\u6838\u6a21\u5757\u6216\u7c7b\u4f3c\u7684\u4ee3\u7801\uff0c\u4f60\u9700\u8981\u5b89\u88c5 Linux \u5185\u6838\u5934\u6587\u4ef6\u3002\u8fd9\u4e9b\u5934\u6587\u4ef6\u5305\u542bLinux\u5185\u6838\u7684\u5404\u79cd\u5e38\u91cf\u5b9a\u4e49\u3001\u5b8f\u5b9a\u4e49\u3001\u51fd\u6570\u63a5\u53e3\u5b9a\u4e49\u548c\u6570\u636e\u7ed3\u6784\u5b9a\u4e49\uff0c\u662f\u5b8c\u6210\u5185\u6838\u6a21\u5757\u4ee3\u7801\u7f16\u8bd1\u6240\u5fc5\u987b\u7684\u4f9d\u8d56\u4ee3\u7801\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,i.jsx)(n.p,{children:"\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5\u5185\u6838\u5934\u6587\u4ef6\u53ca\u5185\u6838\u7f16\u8bd1\u4f9d\u8d56\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install linux-headers-6.1.112-rt43\nsudo apt install bison flex\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u547d\u4ee4\u8fd0\u884c\u6210\u529f\u540e\uff0c\u5185\u6838\u5934\u6587\u4ef6\u4f1a\u88ab\u5b89\u88c5\u5230",(0,i.jsx)(n.code,{children:"/usr/src"}),"\u76ee\u5f55\u4e0b"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sunrise@ubuntu:~$ ls /usr/src/linux-headers-$(uname -r)\nDocumentation  Makefile        arch   crypto   include   ipc     mm    samples   sound  virt\nKbuild         Module.symvers  block  drivers  init      kernel  net   scripts   tools\nKconfig        System.map      certs  fs       io_uring  lib     rust  security  usr\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["\u8bf7",(0,i.jsx)(n.strong,{children:"\u4e0d\u8981"}),"\u5728",(0,i.jsx)(n.code,{children:"/usr/src/linux-headers-$(uname -r)"}),"\u76ee\u5f55\u4e0b\u6267\u884c",(0,i.jsx)(n.code,{children:"make clean"}),"\u547d\u4ee4\uff0c\u8fd9\u4f1a\u5c06\u677f\u7aef\u5185\u6838\u6a21\u5757\u7684\u7f16\u8bd1\u73af\u5883\u7834\u574f\uff1b\n\u5982\u679c\u6267\u884c\u4e86",(0,i.jsx)(n.code,{children:"make clean"}),"\u52a8\u4f5c\uff0c\u8bf7\u91cd\u65b0\u5b89\u88c5",(0,i.jsx)(n.code,{children:"linux-headers-6.1.112-rt43"}),"\u5305\u8fdb\u884c\u73af\u5883\u6062\u590d\u3002"]})}),"\n",(0,i.jsx)(n.h2,{id:"\u4f7f\u7528\u793a\u4f8b",children:"\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,i.jsx)(n.h3,{id:"hello-world\u5185\u6838\u6a21\u5757",children:"Hello World\u5185\u6838\u6a21\u5757"}),"\n",(0,i.jsxs)(n.p,{children:["\u6211\u4eec\u7528\u4e00\u4e2a\u7b80\u5355\u7684 ",(0,i.jsx)(n.code,{children:"Hello World"})," \u5185\u6838\u6a21\u5757\u7684\u5f00\u53d1\u4ecb\u7ecd\u5982\u679c\u4f7f\u7528\u5185\u6838\u5934\u6587\u4ef6\u3002\u6b65\u9aa4\u6982\u8981\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u51c6\u5907\u7a0b\u5e8f\u4ee3\u7801\uff0c\u4ee5\u7f16\u8bd1\u8def\u5f84\u4e3a",(0,i.jsx)(n.code,{children:"sunrise"}),"\u7528\u6237\u7684",(0,i.jsx)(n.code,{children:"${HOME}/test_ko"}),"\u4e3a\u4f8b"]}),"\n",(0,i.jsx)(n.li,{children:"\u7f16\u5199Makefile\uff0c\u5b8c\u6210\u9a71\u52a8\u6a21\u5757\u7684\u7f16\u8bd1"}),"\n",(0,i.jsx)(n.li,{children:"\u5bf9\u9a71\u52a8\u6a21\u5757\u8fdb\u884c\u7b7e\u540d"}),"\n",(0,i.jsx)(n.li,{children:"\u6d4b\u8bd5\u52a0\u8f7d\u3001\u5378\u8f7d\u6a21\u5757"}),"\n",(0,i.jsx)(n.li,{children:"\uff08\u53ef\u9009\uff09\u914d\u7f6e\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"\u7f16\u5199hello-world\u5185\u6838\u6a21\u5757",children:"\u7f16\u5199Hello World\u5185\u6838\u6a21\u5757"}),"\n",(0,i.jsxs)(n.p,{children:["\u6253\u5f00\u4f60\u719f\u6089\u7684\u7f16\u8f91\u5668\uff08\u6bd4\u5982VIM\uff09\uff0c\u521b\u5efa\u6587\u4ef6 ",(0,i.jsx)(n.code,{children:"hello.c"}),"\uff0c\u8f93\u5165\u4e0b\u9762\u7684\u5185\u5bb9\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c",children:'#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\nMODULE_LICENSE("GPL");\nMODULE_AUTHOR("Your Name");\nMODULE_DESCRIPTION("Simple Hello World kernel module");\n\nstatic int __init hello_init(void)\n{\n\tprintk(KERN_INFO "Hello, World! Kernel module loaded.\\n");\n\treturn 0;\n}\n\nstatic void __exit hello_exit(void)\n{\n\tprintk(KERN_INFO "Goodbye, World! Kernel module unloaded.\\n");\n}\n\nmodule_init(hello_init);\nmodule_exit(hello_exit);\n\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u6a21\u5757\u52a0\u8f7d\u65f6\u6253\u5370",(0,i.jsx)(n.code,{children:"Hello, World!"}),", \u6a21\u5757\u5378\u8f7d\u65f6\u6253\u5370",(0,i.jsx)(n.code,{children:"Goodbye, World!"}),"\u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"\u7f16\u5199makefile",children:"\u7f16\u5199Makefile"}),"\n",(0,i.jsxs)(n.p,{children:["\u6253\u5f00\u4f60\u719f\u6089\u7684\u7f16\u8f91\u5668\uff08\u6bd4\u5982VIM\uff09\uff0c\u521b\u5efa\u6587\u4ef6 ",(0,i.jsx)(n.code,{children:"Makefile"}),"\uff0c\u8f93\u5165\u4e0b\u9762\u7684\u5185\u5bb9\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-makefile",children:"ifneq ($(KERNELRELEASE),)\nobj-m := hello.o\nelse\nKERN_VER ?= $(shell uname -r)\n\nKERN_DIR ?= /lib/modules/$(KERN_VER)/build\n\nPWD := $(shell pwd)\n\n.PHONY := all prepare clean\n\nall: prepare\n$(MAKE) -C $(KERN_DIR) M=$(PWD) modules\n\t$(MAKE) -C $(KERN_DIR) KERNELRELEASE=$(KERN_VER) M=$(PWD) modules_install\n\nprepare:\n\t$(MAKE) -C $(KERN_DIR) prepare\n\nclean:\n\t$(MAKE) -C $(KERN_DIR) M=$(PWD) clean\n\nendif\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PWD"}),"\u6307\u5b9a\u6e90\u7801\u8def\u5f84\uff0c\u5373hello.c\u7684\u8def\u5f84\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"KERN_DIR"}),"\u6307\u5b9a\u5185\u6838\u6e90\u7801\u8def\u5f84\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"KERNELRELEASE"}),"\u662f\u5728\u5185\u6838\u6e90\u7801\u7684\u9876\u5c42Makefile\u91cc\u5b9a\u4e49\u7684\u53d8\u91cf\uff0c\u4e00\u822c\u7528\u4e8e\u5224\u65ad\u5f53\u524d\u7f16\u8bd1\u662f\u5426\u662f\u5728",(0,i.jsx)(n.code,{children:"Kbuild"}),"\u6846\u67b6\u4e0b\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8c03\u7528\u5185\u6838\u539f\u751f\u7684",(0,i.jsx)(n.code,{children:"prepare"}),"\u76ee\u6807\uff0c\u6765\u5c06\u5185\u6838\u6a21\u5757\u7f16\u8bd1\u548c\u5b89\u88c5\u6240\u9700\u7684\u5de5\u5177\u51c6\u5907\u597d\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8c03\u7528\u5185\u6838\u539f\u751f\u7684",(0,i.jsx)(n.code,{children:"modules"}),"\u76ee\u6807\uff0c\u6765\u5c06\u5185\u6838\u6a21\u5757\u7f16\u8bd1\u51fa\u6765\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:["\u8c03\u7528\u5185\u6838\u539f\u751f\u7684",(0,i.jsx)(n.code,{children:"modules_install"}),"\u76ee\u6807\uff0c\u6765\u5c06\u7f16\u8bd1\u597d\u7684\u5185\u6838\u6a21\u5757\u7b7e\u540d\u5e76\u5b89\u88c5\u5230\u7cfb\u7edf\u6a21\u5757\u76ee\u5f55\u3002"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u4fdd\u5b58",(0,i.jsx)(n.code,{children:"Makefile"}),"\u540e\uff0c\u6267\u884c",(0,i.jsx)(n.code,{children:"make"}),"\u547d\u4ee4\u5b8c\u6210\u6a21\u5757\u7684\u7f16\u8bd1\uff0c\u751f\u6210",(0,i.jsx)(n.code,{children:"hello.ko"}),"\u6587\u4ef6\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sunrise@ubuntu:~/test_ko$ sudo make\nmake -C /lib/modules/6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8/build prepare\nmake[1]: Entering directory '/usr/src/linux-headers-6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8'\n  SYNC    include/config/auto.conf.cmd\n  HOSTCC  scripts/basic/fixdep\n  HOSTCC  scripts/kconfig/conf.o\n  HOSTCC  scripts/kconfig/confdata.o\n  HOSTCC  scripts/kconfig/expr.o\n  LEX     scripts/kconfig/lexer.lex.c\n  YACC    scripts/kconfig/parser.tab.[ch]\n  HOSTCC  scripts/kconfig/lexer.lex.o\n  HOSTCC  scripts/kconfig/menu.o\n  HOSTCC  scripts/kconfig/parser.tab.o\n  HOSTCC  scripts/kconfig/preprocess.o\n  HOSTCC  scripts/kconfig/symbol.o\n  HOSTCC  scripts/kconfig/util.o\n  HOSTLD  scripts/kconfig/conf\n  HOSTCC  scripts/dtc/dtc.o\n  HOSTCC  scripts/dtc/flattree.o\n  HOSTCC  scripts/dtc/fstree.o\n  HOSTCC  scripts/dtc/data.o\n  HOSTCC  scripts/dtc/livetree.o\n  HOSTCC  scripts/dtc/treesource.o\n  HOSTCC  scripts/dtc/srcpos.o\n  HOSTCC  scripts/dtc/checks.o\n  HOSTCC  scripts/dtc/util.o\n  LEX     scripts/dtc/dtc-lexer.lex.c\n  YACC    scripts/dtc/dtc-parser.tab.[ch]\n  HOSTCC  scripts/dtc/dtc-lexer.lex.o\n  HOSTCC  scripts/dtc/dtc-parser.tab.o\n  HOSTLD  scripts/dtc/dtc\n  HOSTCC  scripts/dtc/libfdt/fdt.o\n  HOSTCC  scripts/dtc/libfdt/fdt_ro.o\n  HOSTCC  scripts/dtc/libfdt/fdt_wip.o\n  HOSTCC  scripts/dtc/libfdt/fdt_sw.o\n  HOSTCC  scripts/dtc/libfdt/fdt_rw.o\n  HOSTCC  scripts/dtc/libfdt/fdt_strerror.o\n  HOSTCC  scripts/dtc/libfdt/fdt_empty_tree.o\n  HOSTCC  scripts/dtc/libfdt/fdt_addresses.o\n  HOSTCC  scripts/dtc/libfdt/fdt_overlay.o\n  HOSTCC  scripts/dtc/fdtoverlay.o\n  HOSTLD  scripts/dtc/fdtoverlay\n  HOSTCC  scripts/kallsyms\n  HOSTCC  scripts/sorttable\n  HOSTCC  scripts/asn1_compiler\n  HOSTCC  scripts/sign-file\n  UPD     include/config/kernel.release\n  UPD     include/generated/utsrelease.h\n  UPD     include/generated/compile.h\n  GEN     arch/arm64/include/generated/asm/cpucaps.h\n  GEN     arch/arm64/include/generated/asm/sysreg-defs.h\n  CC      scripts/mod/empty.o\n  HOSTCC  scripts/mod/mk_elfconfig\n  MKELF   scripts/mod/elfconfig.h\n  HOSTCC  scripts/mod/modpost.o\n  CC      scripts/mod/devicetable-offsets.s\n  UPD     scripts/mod/devicetable-offsets.h\n  HOSTCC  scripts/mod/file2alias.o\n  HOSTCC  scripts/mod/sumversion.o\n  HOSTLD  scripts/mod/modpost\n  CALL    scripts/checksyscalls.sh\n  CHKSHA1 include/linux/atomic/atomic-arch-fallback.h\n  CHKSHA1 include/linux/atomic/atomic-instrumented.h\n  CHKSHA1 include/linux/atomic/atomic-long.h\n  LD      arch/arm64/kernel/vdso/vdso.so.dbg\n  VDSOSYM include/generated/vdso-offsets.h\n  OBJCOPY arch/arm64/kernel/vdso/vdso.so\nmake[1]: Leaving directory '/usr/src/linux-headers-6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8'\nmake -C /lib/modules/6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8/build M=/home/sunrise/test_ko modules\nmake[1]: Entering directory '/usr/src/linux-headers-6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8'\n  CC [M]  /home/sunrise/test_ko/hello.o\n  MODPOST /home/sunrise/test_ko/Module.symvers\n  CC [M]  /home/sunrise/test_ko/hello.mod.o\n  LD [M]  /home/sunrise/test_ko/hello.ko\nmake[1]: Leaving directory '/usr/src/linux-headers-6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8'\nmake -C /lib/modules/6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8/build KERNELRELEASE=6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8 M=/home/sunrise/test_ko modules_install\nmake[1]: Entering directory '/usr/src/linux-headers-6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8'\n  INSTALL /lib/modules/6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8/extra/hello.ko\n  SIGN    /lib/modules/6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8/extra/hello.ko\n  DEPMOD  /lib/modules/6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8\nmake[1]: Leaving directory '/usr/src/linux-headers-6.1.112-rt43-DR-4.0.2-2507191817-g7253c2-g30e6e8'\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4e0a\u65b9\u6253\u5370\u4e2d\u7684\u5185\u6838\u7248\u672c\u4f1a\u968f\u7248\u672c\u53d8\u5316\u800c\u53d8\u5316\uff1b"}),"\n",(0,i.jsxs)(n.li,{children:["\u66f4\u591a\u5173\u4e8e\u5185\u6838\u6a21\u5757\u7f16\u8bd1\u7684\u8bf4\u660e\uff0c\u8bf7\u53c2\u8003\uff1a",(0,i.jsx)(n.a,{href:"https://kernel.org/doc/html/v6.1/kbuild/modules.html",children:"Linux Kernel Doc | Building External Modules"}),"\u3002"]}),"\n"]})}),"\n",(0,i.jsx)(n.h4,{id:"\u6a21\u5757\u7b7e\u540d",children:"\u6a21\u5757\u7b7e\u540d"}),"\n",(0,i.jsx)(n.p,{children:"\u7f16\u8bd1\u597d\u7684\u9a71\u52a8\u6a21\u5757\u6587\u4ef6\uff0c\u5df2\u7ecf\u901a\u8fc7modules_install\u81ea\u52a8\u7b7e\u540d\uff0c\u5982\u679c\u60f3\u8981\u624b\u52a8\u7b7e\u540d\uff0c\u8bf7\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Create a singining script.\nsunrise@ubuntu:~/test_ko#\ncat << EOF > drobot-sign-file.sh\n#!/bin/bash\n\nsigning_ko=\\$1\noutput_f=\\$2\n\nif [ ! -f "\\${signing_ko}" ];then\n\techo "\\${signing_ko} not found!"\n\texit 1\nfi\n\nmodule_build_dir=/lib/modules/\\$(uname -r)/build\n\nsigning_algo=\\$(cat \\${module_build_dir}/.config | grep -w CONFIG_MODULE_SIG_HASH | awk -F \'=\' \'{print \\$2}\' | tr -d \'"\')\nsigning_key_name=\\$(cat \\${module_build_dir}/.config | grep -w CONFIG_MODULE_SIG_KEY | awk -F \'=\' \'{print \\$2}\' | tr -d \'"\')\n\nsigning_key_f=\\${module_build_dir}/\\${signing_key_name}\nsigning_key_x509_f=\\${module_build_dir}/certs/signing_key.x509\n\nif [ -z "\\${output_f}" ];then\n\techo -n "Saving signed module to \\${signing_ko} ..."\nelse\n\techo -n "Saving signed module to \\${output_f} ..."\nfi\n\n\\${module_build_dir}/scripts/sign-file \\${signing_algo} \\${signing_key_f} \\${signing_key_x509_f} \\${signing_ko} \\${output_f}\n\necho "Done!"\nEOF\n\nsunrise@ubuntu:~/test_ko# chmod +x ./drobot-sign-file.sh\nsunrise@ubuntu:~/test_ko# ./drobot-sign-file.sh hello.ko\nSaving signed module to hello.ko ...Done!\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u5982\u679c\u4e0d\u5bf9\u9a71\u52a8\u6a21\u5757\u6587\u4ef6\u7b7e\u540d\u800c\u76f4\u63a5\u52a0\u8f7d\uff0c\u5219\u4f1a\u62a5\u4ee5\u4e0b\u9519\u8bef:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"ERROR: could not insert module hello.ko: Required key not available\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u52a0\u8f7d\u6a21\u5757",children:"\u52a0\u8f7d\u6a21\u5757"}),"\n",(0,i.jsxs)(n.p,{children:["\u52a0\u8f7dko\uff1a",(0,i.jsx)(n.code,{children:"modprobe hello"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sunrise@ubuntu:~/test_ko# sudo modprobe hello\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u67e5\u770bko\u662f\u5426\u52a0\u8f7d\uff1a",(0,i.jsx)(n.code,{children:"lsmod | grep hello"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sunrise@ubuntu:~/test_ko# lsmod | grep hello\nhello                  262144  0\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u5378\u8f7dko\uff1a",(0,i.jsx)(n.code,{children:"modprobe -r hello"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sunrise@ubuntu:~/test_ko# sudo modprobe -r  hello\n[ 3136.909409] Goodbye, World!\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6267\u884c\u547d\u4ee4",(0,i.jsx)(n.code,{children:"dmesg"}),"\u67e5\u770b\u5185\u6838\u6253\u5370\u4fe1\u606f\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sunrise@ubuntu:~/test_ko$ dmesg | tail -n 2\n[  525.710661] Hello, World! Kernel module loaded.\n[  612.716435] Goodbye, World! Kernel module unloaded.\n"})}),"\n",(0,i.jsx)(n.h4,{id:"\u914d\u7f6e\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d",children:"\u914d\u7f6e\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728 ",(0,i.jsx)(n.code,{children:"/lib/modules-load.d"})," \u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a",(0,i.jsx)(n.code,{children:"conf"}),"\u6269\u5c55\u540d\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4f8b\u5982 ",(0,i.jsx)(n.code,{children:"hello.conf"}),",\u5728\u914d\u7f6e\u6587\u4ef6\u91cc\u6dfb\u52a0\u9700\u8981\u81ea\u52a8\u52a0\u8f7d\u7684\u6a21\u5757\u540d\uff08\u6a21\u5757\u540d\u4e0d\u9700\u8981",(0,i.jsx)(n.code,{children:".ko"})," \u6269\u5c55\u540d\uff09\uff0c\u4f8b\u5982\u9700\u8981\u81ea\u52a8\u52a0\u8f7d",(0,i.jsx)(n.code,{children:"hello.ko"}),",\u5c31\u5199\u4e00\u884c",(0,i.jsx)(n.code,{children:"hello"}),"\uff0c\u5982\u679c\u6709\u591a\u4e2a\u6a21\u5757\u9700\u8981\u52a0\u8f7d\uff0c\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\u53ef\u4ee5\u6dfb\u52a0\u591a\u4e2a\u81ea\u52a0\u8f7d\u6a21\u5757\uff0c\u4e00\u884c\u4e00\u4e2a\u6a21\u5757\u540d\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u7b80\u4fbf\u7684\u5b8c\u6210\u914d\u7f6e\u6587\u4ef6\u7684\u65b0\u5efa\u548c\u914d\u7f6e\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo echo hello > /lib/modules-load.d/hello.conf\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u7b2c\u4e09\u65b9\u5185\u6838\u9a71\u52a8\u6a21\u5757\u7f16\u8bd1\u793a\u4f8b",children:"\u7b2c\u4e09\u65b9\u5185\u6838\u9a71\u52a8\u6a21\u5757\u7f16\u8bd1\u793a\u4f8b"}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u514d\u8d23\u58f0\u660e"}),"\uff1a"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u5730\u74dc\u4e0d\u5bf9\u4efb\u4f55\u7b2c\u4e09\u65b9\u9a71\u52a8\u6a21\u5757\u627f\u62c5\u4efb\u4f55\u5f62\u5f0f\u7684\u5f00\u53d1/\u7ef4\u62a4\u8d23\u4efb\u3002"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u5730\u74dc\u4e0d\u5bf9\u4efb\u4f55\u7531\u4e8e\u7b2c\u4e09\u65b9\u6e90\u7801\u5728\u5730\u74dc\u5e73\u53f0\u8fd0\u884c\u6240\u5bfc\u81f4\u7684\u95ee\u9898\u8d1f\u8d23\u3002"}),"\n"]}),"\n"]})]}),"\n",(0,i.jsx)(n.h4,{id:"pcan",children:"PCAN"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u8bf7\u786e\u8ba4\u60a8\u7684RDK\u5f00\u53d1\u677f\u5df2\u6b63\u786e\u8fde\u5165\u4e92\u8054\u7f51\uff0c\u80fd\u591f\u8bbf\u95eePCAN\u5b98\u7f51\uff0c\u4f8b\u5982\u4f7f\u7528",(0,i.jsx)(n.code,{children:"ping peak-system.com"}),"\u547d\u4ee4\uff0c\u793a\u4f8b\u8f93\u5165\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"sunrise@ubuntu:~$ ping peak-system.com -c 5\nPING peak-system.com (37.202.3.222) 56(84) bytes of data.\n64 bytes from r2096.agenturserver.it (37.202.3.222): icmp_seq=1 ttl=45 time=280 ms\n64 bytes from r2096.agenturserver.it (37.202.3.222): icmp_seq=3 ttl=45 time=279 ms\n64 bytes from r2096.agenturserver.it (37.202.3.222): icmp_seq=4 ttl=45 time=278 ms\n64 bytes from r2096.agenturserver.it (37.202.3.222): icmp_seq=5 ttl=45 time=277 ms\n\n--- peak-system.com ping statistics ---\n5 packets transmitted, 4 received, 20% packet loss, time 4024ms\nrtt min/avg/max/mdev = 277.180/278.460/280.280/1.152 ms\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u6839\u636e",(0,i.jsx)(n.code,{children:"peak-system"}),"\u5b98\u65b9\u8bf4\u660e\uff0c\u4e0b\u8f7d",(0,i.jsx)(n.code,{children:"pcan-kernel-version.sh"}),"\u811a\u672c\uff0c\u5e76\u786e\u8ba4\u9700\u8981\u4e0b\u8f7d\u7684\u9a71\u52a8\u7248\u672c\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# Download pcan-kernel-version.sh\nwget https://www.peak-system.com/fileadmin/media/linux/files/pcan-kernel-version.sh.tar.gz\n# Extract script\ntar -xzf pcan-kernel-version.sh.tar.gz\n# Run the script\n./pcan-kernel-version.sh\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"\u5730\u74dcRDK Super\u7cfb\u5217\u4ec5\u652f\u6301Linux6.1\u7248\u672c\u5185\u6838\u3002"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u4e0b\u8f7dPCAN\u9a71\u52a8"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# Depending on the actual internet environment, the download may take minutes to hours\nwget --content-disposition https://www.peak-system.com/quick/PCAN-Linux-Driver\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--content-disposition"}),"\u9009\u9879\uff1a\u5c06\u4fdd\u5b58\u5230\u672c\u5730\u7684\u6587\u4ef6\u540d\u6539\u4e3a\u4e0e\u94fe\u63a5\u6307\u5411\u7684\u670d\u52a1\u5668\u4e00\u81f4\uff1b"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u89e3\u538bPCAN\u9a71\u52a8\u538b\u7f29\u5305\uff0c\u8fd9\u91cc\u6211\u4eec\u4ee52025-08-16\u7684PCAN\u9a71\u52a8\u7248\u672c\u201c8.20.0\u201d\u4e3a\u4f8b\uff0c\u8bf7\u7528\u6237\u6839\u636e\u4e0b\u8f7d\u7684\u5b9e\u9645\u6587\u4ef6\u4fee\u6539\u547d\u4ee4"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"tar -xzf peak-linux-driver-8.20.0.tar.gz\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"\u6267\u884c\u7f16\u8bd1\uff1a"}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"\u8bf7\u786e\u4fdd\u60a8\u677f\u7aef\u7684linux-headers-6.1.112-rt43\u7248\u672c\u4e3a4.0.3\u6216\u4ee5\u4e0a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# Install local module build prerequisites\nsudo apt install flex bison -y\n\n# Install PCAN driver prerequisites\nsudo apt install libpopt.h -y\n\n# Setup local module build environment\nsudo make -C /usr/src/linux-headers-$(uname -r) prepare\n\n# Build PCAN Driver modules\ncd peak-linux-driver-8.20.0\nmake\n\n# Install PCAN drivers and libraries\nsudo make install\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["\u5bf9PCAN\u9a71\u52a8\u8fdb\u884c\u7b7e\u540d\u5e76\u4f7f\u7528\uff0c\u4ee5\u4e0b\u793a\u4f8b\u4ee58.20.0\u7248\u672c\u7684PCAN\u9a71\u52a8\u4e3a\u4f8b\uff0c\u8be5\u7248\u672c\u4e0b\uff0cPCAN\u9a71\u52a8\u6a21\u5757\u88ab\u9ed8\u8ba4\u5b89\u88c5\u5230\u4e86\u8def\u5f84",(0,i.jsx)(n.code,{children:"/lib/modules/6.1.112/misc/"}),"\u5185\uff1a"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u53c2\u8003",(0,i.jsx)(n.a,{href:"#%E6%A8%A1%E5%9D%97%E7%AD%BE%E5%90%8D",children:"\u6a21\u5757\u7b7e\u540d"}),"\u7ae0\u8282\uff0c\u521b\u5efa\u811a\u672c\uff1b"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6267\u884c\u7b7e\u540d\u547d\u4ee4\uff1a","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# Sign file\nsudo bash drobot-sign-file.sh /lib/modules/6.1.112/misc/pcan.ko\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4f7f\u7528PCAN\u9a71\u52a8\uff1a","\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# Insert PCAN driver\nsudo insmod /lib/modules/6.1.112/misc/pcan.ko\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);