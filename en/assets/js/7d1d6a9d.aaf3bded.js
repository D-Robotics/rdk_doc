"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[84661],{12475:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"Advanced_development/linux_development/driver_development_s100/driver_wifi","title":"WiFi Driver Debugging Guide","description":"The WiFi module on RDKS100 is connected to an M.2 interface extended via PCIe. This section introduces some user-space commands and kernel DTS configuration items.","source":"@site/i18n/en/docusaurus-plugin-content-docs-docs_s/current/07_Advanced_development/02_linux_development/04_driver_development_s100/14_driver_wifi.md","sourceDirName":"07_Advanced_development/02_linux_development/04_driver_development_s100","slug":"/Advanced_development/linux_development/driver_development_s100/driver_wifi","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_wifi","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1769771781000,"sidebarPosition":14,"frontMatter":{"sidebar_position":14},"sidebar":"tutorialSidebar","previous":{"title":"PCIe User-space High Level API Introduction","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_pcie/s100x_pcie_libhbpciehal"},"next":{"title":"HBMEM\u4f7f\u7528\u6307\u5357","permalink":"/rdk_doc/en/rdk_s/15_driver_hbmem"}}');var t=i(74848),o=i(28453);const d={sidebar_position:14},s="WiFi Driver Debugging Guide",c={},l=[{value:"User-Space Debugging",id:"user-space-debugging",level:2},{value:"Verify PCIe Endpoint Device",id:"verify-pcie-endpoint-device",level:3},{value:"Module Driver Code",id:"module-driver-code",level:2},{value:"Kernel Configuration for the Module",id:"kernel-configuration-for-the-module",level:2},{value:"Kernel DTS Configuration",id:"kernel-dts-configuration",level:2}];function a(e){const n={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"wifi-driver-debugging-guide",children:"WiFi Driver Debugging Guide"})}),"\n",(0,t.jsx)(n.p,{children:"The WiFi module on RDKS100 is connected to an M.2 interface extended via PCIe. This section introduces some user-space commands and kernel DTS configuration items."}),"\n",(0,t.jsx)(n.p,{children:"The examples in the following sections use the AW-XM612 module as a reference. Users should modify the configurations accordingly based on their specific module."}),"\n",(0,t.jsx)(n.h2,{id:"user-space-debugging",children:"User-Space Debugging"}),"\n",(0,t.jsx)(n.h3,{id:"verify-pcie-endpoint-device",children:"Verify PCIe Endpoint Device"}),"\n",(0,t.jsxs)(n.p,{children:["You can use the user-space command ",(0,t.jsx)(n.code,{children:"lspci"})," to confirm whether the WiFi module is properly recognized."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check current endpoint nodes\nroot@ubuntu:~# lspci -vt\n-+-[0000:01]---00.0-[02-07]----00.0-[03-07]--+-00.0-[04]----00.0  Anchor Chips Inc. Device bd31\n |                                           +-02.0-[05]----00.0  Realtek Semiconductor Co., Ltd. Device 5765\n |                                           +-06.0-[06]----00.0  ASMedia Technology Inc. Device 3042\n |                                           \\-0e.0-[07]----00.0  ASMedia Technology Inc. Device 3042\n \\-[0000:00]-\n\n# Check specific node details:\nroot@ubuntu:~# lspci -v -s 04:00.0\n04:00.0 Network controller: Anchor Chips Inc. Device bd31 (rev 02)\n        Subsystem: Anchor Chips Inc. Device 0000\n        Flags: bus master, fast devsel, latency 0, IRQ 181, IOMMU group 18\n        Memory at 8000400000 (64-bit, non-prefetchable) [size=64K]\n        Memory at 8000800000 (64-bit, non-prefetchable) [size=8M]\n        Capabilities: [48] Power Management version 3\n        Capabilities: [58] MSI: Enable+ Count=1/32 Maskable- 64bit+\n        Capabilities: [68] Vendor Specific Information: Len=38 <?>\n        Capabilities: [a0] MSI-X: Enable- Count=64 Masked-\n        Capabilities: [ac] Express Endpoint, MSI 00\n        Capabilities: [100] Advanced Error Reporting\n        Capabilities: [13c] Device Serial Number 00-00-00-ff-ff-00-00-00\n        Capabilities: [150] Power Budgeting <?>\n        Capabilities: [160] Virtual Channel\n        Capabilities: [1b0] Latency Tolerance Reporting\n        Capabilities: [220] Physical Resizable BAR\n        Capabilities: [240] L1 PM Substates\n        Capabilities: [200] Precision Time Measurement\n        Kernel driver in use: brcmfmac\n        Kernel modules: brcmfmac\n"})}),"\n",(0,t.jsx)(n.h2,{id:"module-driver-code",children:"Module Driver Code"}),"\n",(0,t.jsxs)(n.p,{children:["The driver code for the AW-XM612 module is provided by the module vendor and integrated by D-Robotics. The integrated code resides in the following directory:",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.code,{children:"source/kernel/drivers/net/wireless/broadcom/brcm80211/"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"kernel-configuration-for-the-module",children:"Kernel Configuration for the Module"}),"\n",(0,t.jsx)(n.p,{children:"The driver for the AW-XM612 module requires enabling the following configurations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-defconfig",children:"CONFIG_CFG80211=m\nCONFIG_BRCMFMAC=m\nCONFIG_BRCMFMAC_PCIE=y\n"})}),"\n",(0,t.jsx)(n.h2,{id:"kernel-dts-configuration",children:"Kernel DTS Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Generally, a PCIe-based WiFi module requires the host side to control signals such as reset and ",(0,t.jsx)(n.code,{children:"reg_on"}),". On the S100, these configurations are defined in:",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.code,{children:"source/hobot-drivers/kernel-dts/rdk-v0p5.dtsi"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dts",children:"&hobot_pcie_rc0 {\n\trefclk-mode = <2>; /* 0:internal; 1:CC; 2:SRNS; 3:SRIS; */\n\tnum-lanes = <2>;\n\n\tswitch-perst-gpios = <&gpio_exp_27 14 GPIO_ACTIVE_LOW>;\t/* SWITCH_PERSTB */\n\n\tep-ponrst-gpios = <&gpio_exp_24 3 GPIO_ACTIVE_LOW>,\t/* WIFI_REG_ON */\n\t\t\t<&gpio_exp_20 0 GPIO_ACTIVE_LOW>,\t/* USBHUB1_PWRON */\n\t\t\t<&gpio_exp_20 7 GPIO_ACTIVE_LOW>;\t/* USBHUB2_PWRON */\n\n\tep-perst-gpios = <&gpio_exp_20 3 GPIO_ACTIVE_LOW>,\t/* NVME_PERSTB */\n\t\t\t<&gpio_exp_24 2 GPIO_ACTIVE_LOW>,\t/* WIFI_PERSTB */\n\t\t\t<&gpio_exp_27 15 GPIO_ACTIVE_LOW>,\t/* USBHUB1_PERSTB */\n\t\t\t<&gpio_exp_20 5 GPIO_ACTIVE_LOW>;\t/* USBHUB2_PERSTB */\n};\n"})}),"\n",(0,t.jsx)(n.p,{children:"During initialization, the PCIe driver on the S100 will request these GPIOs and perform operations such as deasserting reset."})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>s});var r=i(96540);const t={},o=r.createContext(t);function d(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);