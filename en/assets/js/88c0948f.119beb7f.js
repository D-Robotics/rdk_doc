"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[69823],{28453:(e,n,i)=>{i.d(n,{R:()=>c,x:()=>d});var o=i(96540);const t={},r=o.createContext(t);function c(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),o.createElement(r.Provider,{value:n},e.children)}},78813:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>s,contentTitle:()=>d,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"Advanced_development/linux_development/driver_development_x5/uboot_kernel_config","title":"Configure U-Boot and Kernel Option Parameters","description":"In system software development, it is often necessary to configure U-Boot and Kernel option parameters. This chapter introduces some common configuration methods for user reference.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/07_Advanced_development/02_linux_development/driver_development_x5/uboot_kernel_config.md","sourceDirName":"07_Advanced_development/02_linux_development/driver_development_x5","slug":"/Advanced_development/linux_development/driver_development_x5/uboot_kernel_config","permalink":"/rdk_doc/en/Advanced_development/linux_development/driver_development_x5/uboot_kernel_config","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1752557711000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"7.2.3 RDK X5 Driver Development Guide","permalink":"/rdk_doc/en/Advanced_development/linux_development/driver_development_x5/"},"next":{"title":"PWM Driver Debugging Guide","permalink":"/rdk_doc/en/Advanced_development/linux_development/driver_development_x5/driver_pwm"}}');var t=i(74848),r=i(28453);const c={sidebar_position:1},d="Configure U-Boot and Kernel Option Parameters",s={},l=[{value:"Configure U-Boot Option Parameters",id:"configure-u-boot-option-parameters",level:2},{value:"Configuring via the xbuild Command",id:"configuring-via-the-xbuild-command",level:3},{value:"Manual Configuration",id:"manual-configuration",level:3},{value:"Configuring Kernel Option Parameters",id:"configuring-kernel-option-parameters",level:2},{value:"Configuring via <code>mk_kernel</code> Command",id:"configuring-via-mk_kernel-command",level:3},{value:"Manual Configuration",id:"manual-configuration-1",level:3}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"configure-u-boot-and-kernel-option-parameters",children:"Configure U-Boot and Kernel Option Parameters"})}),"\n",(0,t.jsx)(n.p,{children:"In system software development, it is often necessary to configure U-Boot and Kernel option parameters. This chapter introduces some common configuration methods for user reference."}),"\n",(0,t.jsx)(n.h2,{id:"configure-u-boot-option-parameters",children:"Configure U-Boot Option Parameters"}),"\n",(0,t.jsxs)(n.admonition,{title:"Note",type:"info",children:[(0,t.jsxs)(n.p,{children:["The following instructions take modifying the ",(0,t.jsx)(n.code,{children:"board_x5_rdk_ubuntu_nand_sdcard_debug_config"})," configuration file as an example."]}),(0,t.jsxs)(n.p,{children:["The specific U-Boot configuration file used can be checked in the ",(0,t.jsx)(n.code,{children:"bootloader/device/.board_config.mk"})," board-level configuration file under the ",(0,t.jsx)(n.code,{children:"HR_UBOOT_CONFIG_FILE"})," variable value after running ",(0,t.jsx)(n.code,{children:"./xbuild.sh lunch"}),"."]})]}),"\n",(0,t.jsx)(n.h3,{id:"configuring-via-the-xbuild-command",children:"Configuring via the xbuild Command"}),"\n",(0,t.jsxs)(n.p,{children:["First, enter the ",(0,t.jsx)(n.code,{children:"source/bootloader"})," directory. The directory structure is as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u251c\u2500\u2500 build           # System code compilation directory, provides shell scripts for compiling various functional modules, and tools used in compilation\n\u251c\u2500\u2500 device          # Board-level configuration directory, each hardware platform has its corresponding configuration file where you can set compilation options and partition tables\n\u251c\u2500\u2500 miniboot        # Generates the minimal boot firmware containing GPT, MBR, BL2, DDR, and BL3x\n\u251c\u2500\u2500 out             # Compilation output directory\n\u2514\u2500\u2500 uboot           # U-Boot source code\n\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"build/xbuild.sh"})," is the main build script that provides the following commands to help users configure U-Boot options. This command will automatically use the U-Boot configuration file set in the board-level configuration file. After the configuration is completed, it will automatically save the ",(0,t.jsx)(n.code,{children:"savedefconfig"})," and other relevant files."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"./xbuild.sh uboot menuconfig\n"})}),"\n",(0,t.jsx)(n.p,{children:"After the command is successfully executed, the U-Boot graphical configuration interface will open. You can complete the option configurations in this interactive interface, including removing unnecessary features and enabling the required ones."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_x5/screenshot-20241120-201418.png",alt:"U-Boot Graphical Configuration"})}),"\n",(0,t.jsxs)(n.p,{children:["After completing the configuration in the ",(0,t.jsx)(n.code,{children:"menuconfig"})," interface, select ",(0,t.jsx)(n.code,{children:"Exit"})," to exit. Follow the prompts to choose either ",(0,t.jsx)(n.code,{children:"Yes"})," or ",(0,t.jsx)(n.code,{children:"No"})," to save the changes to the ",(0,t.jsx)(n.code,{children:".config"})," file."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development/image-20220518111506018.png",alt:"Save Configuration"})}),"\n",(0,t.jsx)(n.p,{children:"After exiting the configuration, the configuration file will be automatically saved. The automatic tasks include:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Call `savedefconfig` to clean the configuration file, keep the necessary items, remove dependencies, and generate the `defconfig` file\nmake savedefconfig\n\n# Use the `defconfig` file to overwrite the U-Boot configuration file set in the board-level configuration file\ncp -f defconfig <U-Boot configuration file set in the board-level configuration file>\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"manual-configuration",children:"Manual Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["First, navigate to the ",(0,t.jsx)(n.code,{children:"source/bootloader/uboot"})," directory and execute the command ",(0,t.jsx)(n.code,{children:"make ARCH=arm64 hobot_x5_rdk_nand_defconfig"}),". The ",(0,t.jsx)(n.code,{children:"make"})," command will first execute the Makefile in the top-level directory. For targets ending with ",(0,t.jsx)(n.code,{children:"config"}),", there is a common entry point:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-makefile",children:"%config: scripts_basic outputmakefile FORCE\n        $(Q)$(MAKE) $(build)=scripts/kconfig $@\n"})}),"\n",(0,t.jsx)(n.p,{children:"The expanded command to be executed is:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"make -f ./scripts/Makefile.build obj=scripts/kconfig hobot_x5_rdk_nand_defconfig\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After executing this command, a ",(0,t.jsx)(n.code,{children:".config"})," file will be generated in the root directory of the ",(0,t.jsx)(n.code,{children:"uboot"})," source code."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"make ARCH=arm64 hobot_x5_rdk_nand_defconfig\n\n  HOSTCC  scripts/basic/fixdep\n  HOSTCC  scripts/kconfig/conf.o\n  YACC    scripts/kconfig/zconf.tab.c\n  LEX     scripts/kconfig/zconf.lex.c\n  HOSTCC  scripts/kconfig/zconf.tab.o\n  HOSTLD  scripts/kconfig/conf\n#\n# configuration written to .config\n#\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then, you can execute ",(0,t.jsx)(n.code,{children:"make ARCH=arm64 menuconfig"})," to open the graphical configuration interface for configuring U-Boot options."]}),"\n",(0,t.jsxs)(n.p,{children:["After completing the configuration in the ",(0,t.jsx)(n.code,{children:"menuconfig"})," interface, select ",(0,t.jsx)(n.code,{children:"Exit"})," to exit. Follow the prompts to choose either ",(0,t.jsx)(n.code,{children:"Yes"})," or ",(0,t.jsx)(n.code,{children:"No"})," to save the changes to the ",(0,t.jsx)(n.code,{children:".config"})," file."]}),"\n",(0,t.jsxs)(n.p,{children:["Once the configuration is saved, you can run the command ",(0,t.jsx)(n.code,{children:"diff .config configs/hobot_x5_rdk_nand_defconfig"})," to compare the differences and verify that the changes are as expected."]}),"\n",(0,t.jsxs)(n.p,{children:["If the modifications are correct, execute ",(0,t.jsx)(n.code,{children:"cp .config configs/hobot_x5_rdk_nand_defconfig"})," to replace the default configuration file."]}),"\n",(0,t.jsxs)(n.p,{children:["To clean up the ",(0,t.jsx)(n.code,{children:".config"})," and other files in the source directory, otherwise, when recompiling the system, you may encounter a warning saying ",(0,t.jsx)(n.code,{children:"xxx is not clean, please run 'make mrproper'"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"make distclean\n# or\nmake mrproper\n\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuring-kernel-option-parameters",children:"Configuring Kernel Option Parameters"}),"\n",(0,t.jsxs)(n.admonition,{title:"Note",type:"info",children:[(0,t.jsxs)(n.p,{children:["The following instructions use the ",(0,t.jsx)(n.code,{children:"hobot_x5_rdk_ubuntu_defconfig"})," configuration file as an example."]}),(0,t.jsxs)(n.p,{children:["The specific configuration file used by the kernel can be found in the ",(0,t.jsx)(n.code,{children:"kernel_config_file"})," variable in the ",(0,t.jsx)(n.code,{children:"mk_kernel.sh"})," script."]})]}),"\n",(0,t.jsxs)(n.h3,{id:"configuring-via-mk_kernel-command",children:["Configuring via ",(0,t.jsx)(n.code,{children:"mk_kernel"})," Command"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"mk_kernel.sh"})," script provides the following commands to help users configure Kernel options. This command will automatically use the Kernel configuration file set in the board-level configuration file. After the configuration is complete, it will automatically perform ",(0,t.jsx)(n.code,{children:"savedefconfig"})," and save the changes."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"./mk_kernel.sh menuconfig\n"})}),"\n",(0,t.jsx)(n.p,{children:"After executing the command successfully, the Kernel graphical configuration interface will open. You can complete the configuration options in this interactive interface, including removing unnecessary features and enabling the required ones."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_x5/screenshot-20241120-195703.png",alt:"Kernel Configuration Interface"})}),"\n",(0,t.jsxs)(n.p,{children:["After completing the configuration in the ",(0,t.jsx)(n.code,{children:"menuconfig"})," interface, select ",(0,t.jsx)(n.code,{children:"Exit"})," to exit. Follow the prompts to choose either ",(0,t.jsx)(n.code,{children:"Yes"})," or ",(0,t.jsx)(n.code,{children:"No"})," to save the changes to the ",(0,t.jsx)(n.code,{children:".config"})," file."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development/image-20220518111506018.png",alt:"Save Configuration"})}),"\n",(0,t.jsx)(n.p,{children:"After exiting the configuration, the configuration file will be automatically saved. The automatic tasks include:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"# Call `savedefconfig` to clean the configuration file, keep the necessary items, remove dependencies, and generate the `defconfig` file\nmake savedefconfig\n\n# Use the `defconfig` file to overwrite the Kernel configuration file set in the board-level configuration file\ncp defconfig <Kernel configuration file set in the board-level configuration file>\n\n"})}),"\n",(0,t.jsx)(n.h3,{id:"manual-configuration-1",children:"Manual Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["The process of configuring the ",(0,t.jsx)(n.code,{children:"kernel"})," via ",(0,t.jsx)(n.code,{children:"menuconfig"})," is the same as configuring ",(0,t.jsx)(n.code,{children:"uboot"}),". The execution steps are as follows:"]}),"\n",(0,t.jsxs)(n.p,{children:["First, navigate to the ",(0,t.jsx)(n.code,{children:"boot/kernel"})," directory and then follow these steps to configure the ",(0,t.jsx)(n.code,{children:"kernel"})," options."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"hobot_x5_rdk_ubuntu_defconfig"})," to generate the ",(0,t.jsx)(n.code,{children:".config"})," file. If a full build has been performed on the source code, the ",(0,t.jsx)(n.code,{children:".config"})," file will already be configured."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"make ARCH=arm64 hobot_x5_rdk_ubuntu_defconfig\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Execute the following command to modify the configuration"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"make ARCH=arm64 menuconfig\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"After making the changes, you can first check the differences between the modified and the original configuration."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"diff .config arch/arm64/configs/hobot_x5_rdk_ubuntu_defconfig\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Overwrite the ",(0,t.jsx)(n.code,{children:"hobot_x5_rdk_ubuntu_defconfig"})," with the new configuration."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"cp .config arch/arm64/configs/hobot_x5_rdk_ubuntu_defconfig\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Clean up the ",(0,t.jsx)(n.code,{children:".config"})," and other files in the source directory; otherwise, when recompiling the system, you may encounter a message saying ",(0,t.jsx)(n.code,{children:"xxx is not clean, please run 'make mrproper'"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"make distclean\n# or\nmake mrproper\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}}}]);