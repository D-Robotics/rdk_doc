"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[35714],{28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var r=s(96540);const t={},i=r.createContext(t);function c(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(i.Provider,{value:n},e.children)}},34820:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"System_configuration/frequency_management","title":"2.4 Thermal and CPU Frequency Management","description":"RDK S100","source":"@site/i18n/en/docusaurus-plugin-content-docs-docs_s/current/02_System_configuration/04_frequency_management.md","sourceDirName":"02_System_configuration","slug":"/System_configuration/frequency_management","permalink":"/rdk_doc/en/rdk_s/System_configuration/frequency_management","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1765989934000,"sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"2.3 config.txt File Configuration","permalink":"/rdk_doc/en/rdk_s/System_configuration/config_txt"},"next":{"title":"2.5 Boot Auto-Start Configuration","permalink":"/rdk_doc/en/rdk_s/System_configuration/self_start"}}');var t=s(74848),i=s(28453);const c={sidebar_position:4},o="2.4 Thermal and CPU Frequency Management",l={},a=[{value:"RDK S100",id:"rdk-s100",level:2},{value:"Temperature Sensors",id:"temperature-sensors",level:3},{value:"Thermal Mechanism",id:"thermal-mechanism",level:3},{value:"Introduction to Thermal Zones",id:"introduction-to-thermal-zones",level:4},{value:"Introduction to thermal_zone0",id:"introduction-to-thermal_zone0",level:5},{value:"Introduction to thermal_zone1/2/3",id:"introduction-to-thermal_zone123",level:5},{value:"Cooling Devices",id:"cooling-devices",level:4},{value:"Fan Control",id:"fan-control",level:5},{value:"CPU Frequency Management",id:"cpu-frequency-management",level:3}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"24-thermal-and-cpu-frequency-management",children:"2.4 Thermal and CPU Frequency Management"})}),"\n",(0,t.jsx)(n.h2,{id:"rdk-s100",children:"RDK S100"}),"\n",(0,t.jsx)(n.h3,{id:"temperature-sensors",children:"Temperature Sensors"}),"\n",(0,t.jsx)(n.p,{children:"The RDK S100 chip contains five temperature sensors to monitor temperatures of the MCU domain, BPU, and MAIN domain. Specifically, both the MAIN domain and the MCU domain each have two temperature sensors, while the BPU has one."}),"\n",(0,t.jsxs)(n.p,{children:["Under ",(0,t.jsx)(n.code,{children:"/sys/class/hwmon/"}),", the ",(0,t.jsx)(n.code,{children:"hwmon0"})," directory contains parameters related to these temperature sensors:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"temp1_input"})," corresponds to the first temperature sensor in the MAIN domain, and ",(0,t.jsx)(n.code,{children:"temp2_input"})," corresponds to the second temperature sensor in the MAIN domain."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"temp3_input"})," corresponds to the first temperature sensor in the MCU domain, and ",(0,t.jsx)(n.code,{children:"temp4_input"})," corresponds to the second temperature sensor in the MCU domain."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"temp5_input"})," corresponds to the BPU temperature sensor."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Temperature readings have a precision of 0.001 degrees Celsius."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"root@ubuntu:~# cat /sys/class/hwmon/hwmon0/temp1_input\n46837\nroot@ubuntu:~#\n"})}),"\n",(0,t.jsx)(n.h3,{id:"thermal-mechanism",children:"Thermal Mechanism"}),"\n",(0,t.jsx)(n.p,{children:"Linux Thermal is a kernel module responsible for temperature control in Linux systems. Its primary purpose is to manage heat generated by the chip during system operation, keeping both chip and device casing temperatures within a safe and comfortable range."}),"\n",(0,t.jsx)(n.p,{children:"To achieve effective thermal management, we need to understand the following three components:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Temperature-sensing devices"}),": Abstracted in the Thermal framework as ",(0,t.jsx)(n.em,{children:"Thermal Zone Devices"}),". The RDK S100 has five thermal zones (",(0,t.jsx)(n.code,{children:"thermal_zone0"})," to ",(0,t.jsx)(n.code,{children:"thermal_zone4"}),"), each associated with one of the five temperature sensors."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cooling devices"}),": Abstracted in the Thermal framework as ",(0,t.jsx)(n.em,{children:"Thermal Cooling Devices"}),", which include the CPU, BPU, and fan:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Devices like the CPU and BPU reduce temperature by adjusting their operating frequencies."}),"\n",(0,t.jsx)(n.li,{children:"The fan reduces temperature by controlling its rotational speed."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Thermal control policies"}),": Abstracted in the Thermal framework as ",(0,t.jsx)(n.em,{children:"Thermal Governors"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Information and controls for all these components are accessible under the ",(0,t.jsx)(n.code,{children:"/sys/class/thermal"})," directory."]}),"\n",(0,t.jsx)(n.h4,{id:"introduction-to-thermal-zones",children:"Introduction to Thermal Zones"}),"\n",(0,t.jsxs)(n.p,{children:["To retrieve information about a specific thermal zone (e.g., ",(0,t.jsx)(n.code,{children:"thermal_zone0"}),"), use the following command:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# cat /sys/class/thermal/thermal_zone0/type\npvt_cmn_pvtc1_t1\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To check the current policy of a thermal zone (e.g., ",(0,t.jsx)(n.code,{children:"thermal_zone0"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# cat /sys/class/thermal/thermal_zone0/policy\nstep_wise\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To view the policies supported by a thermal zone (e.g., ",(0,t.jsx)(n.code,{children:"thermal_zone0"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# cat /sys/class/thermal/thermal_zone0/available_policies\nuser_space step_wise\n"})}),"\n",(0,t.jsx)(n.p,{children:"The supported policies are:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"user_space"}),": Reports the current zone temperature and trip point information to userspace via uevent, allowing userspace software to implement its own thermal policy."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"step_wise"}),": Gradually increases cooling levels each polling cycle, providing a relatively gentle thermal control strategy."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Customers can choose the appropriate policy based on their product requirements. Policies can be specified at compile time or dynamically switched via sysfs.",(0,t.jsx)(n.br,{}),"\n","For example, to dynamically switch ",(0,t.jsx)(n.code,{children:"thermal_zone0"})," to ",(0,t.jsx)(n.code,{children:"user_space"})," mode:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"echo user_space > /sys/class/thermal/thermal_zone0/policy\n"})}),"\n",(0,t.jsx)(n.h5,{id:"introduction-to-thermal_zone0",children:"Introduction to thermal_zone0"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"thermal_zone0"})," contains four trip points:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trip_point_0_temp"}),": Shutdown temperature, defaulting to 120\xb0C."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trip_point_1_temp"}),": Controls fan speed, defaulting to 43\xb0C. Fan levels range from 2 to 5\u2014exceeding 43\xb0C causes the fan to switch from off to level 2, with a maximum of level 5."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trip_point_2_temp"}),": Controls fan speed, defaulting to 65\xb0C. Fan levels range from 6 to 10\u2014exceeding 65\xb0C sets the fan to level 6, with a maximum of level 10 (lower speed)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trip_point_3_temp"}),": Controls CPU A-core frequency, defaulting to 95\xb0C\u2014exceeding this temperature triggers CPU frequency scaling."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"You can view these temperature settings via sysfs:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# cat /sys/devices/virtual/thermal/thermal_zone0/trip_point_0_temp\n120000\n"})}),"\n",(0,t.jsx)(n.p,{children:"To adjust, for example, the CPU frequency scaling threshold to 85\xb0C:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"echo 85000 > /sys/devices/virtual/thermal/thermal_zone0/trip_point_3_temp\n"})}),"\n",(0,t.jsx)(n.h5,{id:"introduction-to-thermal_zone123",children:"Introduction to thermal_zone1/2/3"}),"\n",(0,t.jsxs)(n.p,{children:["Each of ",(0,t.jsx)(n.code,{children:"thermal_zone1"}),", ",(0,t.jsx)(n.code,{children:"thermal_zone2"}),", and ",(0,t.jsx)(n.code,{children:"thermal_zone3"})," has one trip point, all representing the shutdown temperature (default: 120\xb0C)."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"thermal_zone4"})," has two trip points:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trip_point_0_temp"}),": Shutdown temperature, defaulting to 120\xb0C."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"trip_point_1_temp"}),": BPU frequency scaling temperature, defaulting to 95\xb0C."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For example, to start BPU frequency scaling at a junction temperature of 85\xb0C:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"echo 85000 > /sys/devices/virtual/thermal/thermal_zone4/trip_point_1_temp\n"})}),"\n",(0,t.jsxs)(n.p,{children:["To change the shutdown temperature to 105\xb0C, update ",(0,t.jsx)(n.code,{children:"trip_point_0_temp"})," for all thermal zones:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"echo 105000 > /sys/devices/virtual/thermal/thermal_zone0/trip_point_0_temp\necho 105000 > /sys/devices/virtual/thermal/thermal_zone1/trip_point_0_temp\necho 105000 > /sys/devices/virtual/thermal/thermal_zone2/trip_point_0_temp\necho 105000 > /sys/devices/virtual/thermal/thermal_zone3/trip_point_0_temp\necho 105000 > /sys/devices/virtual/thermal/thermal_zone4/trip_point_0_temp\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": The above settings are only effective for the current boot session. They must be ",(0,t.jsx)(n.strong,{children:"reapplied after reboot"}),"."]})}),"\n",(0,t.jsx)(n.h4,{id:"cooling-devices",children:"Cooling Devices"}),"\n",(0,t.jsx)(n.p,{children:"The RDK S100 includes four cooling devices:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cooling_device0"}),": CPU cluster 0, cools by adjusting frequency."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cooling_device1"}),": CPU cluster 1, cools by adjusting frequency."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cooling_device2"}),": emc2305 fan, cools by adjusting fan speed levels (0\u201310; 0 = off, 10 = full speed)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"cooling_device3"}),": BPU, cools by adjusting frequency."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The CPU and fan cooling devices are associated with ",(0,t.jsx)(n.code,{children:"thermal_zone0"}),", while the BPU cooling device is associated with ",(0,t.jsx)(n.code,{children:"thermal_zone4"}),". ",(0,t.jsx)(n.code,{children:"thermal_zone1/2/3"})," are not bound to any cooling devices."]}),"\n",(0,t.jsxs)(n.p,{children:["The default policy currently in use is ",(0,t.jsx)(n.code,{children:"step_wise"}),"."]}),"\n",(0,t.jsx)(n.h5,{id:"fan-control",children:"Fan Control"}),"\n",(0,t.jsx)(n.p,{children:"The emc2305 fan controller on the RDK S100 development board allows retrieval of device information and speed control via device nodes:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Get cooling device type:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# cat /sys/class/thermal/cooling_device2/type\nemc2305_fan\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Check configurable fan levels:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# cat /sys/class/thermal/cooling_device2/max_state\n10\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Check current fan level:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# cat /sys/class/thermal/cooling_device2/cur_state\n5\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Set ",(0,t.jsx)(n.code,{children:"thermal_zone0"})," policy to ",(0,t.jsx)(n.code,{children:"user_space"}),":","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"echo user_space > /sys/class/thermal/thermal_zone0/policy\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Set current fan level to 10:","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"root@ubuntu:~# echo 10 > /sys/class/thermal/cooling_device2/cur_state\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": When ",(0,t.jsx)(n.code,{children:"thermal_zone0"})," uses the ",(0,t.jsx)(n.code,{children:"step_wise"})," policy, the system automatically adjusts the fan level based on temperature. If you need to fix the fan at a specific level, refer to the ",(0,t.jsx)(n.a,{href:"#introduction-to-thermal-zones",children:"Thermal Zone"})," section and switch the policy to ",(0,t.jsx)(n.code,{children:"user_space"}),"."]})}),"\n",(0,t.jsx)(n.h3,{id:"cpu-frequency-management",children:"CPU Frequency Management"}),"\n",(0,t.jsxs)(n.p,{children:["The Linux kernel includes the ",(0,t.jsx)(n.code,{children:"cpufreq"})," subsystem to manage CPU frequency and frequency scaling policies."]}),"\n",(0,t.jsxs)(n.p,{children:["Navigate to ",(0,t.jsx)(n.code,{children:"/sys/devices/system/cpu/cpufreq/policy0"})," and list its contents to see the following files:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"affected_cpus\t\t\t\t\t\t// CPU cores affected by current policy (excludes offline CPUs)\ncpuinfo_cur_freq\t\t\t\t\t// Current CPU frequency (unit: kHz)\ncpuinfo_max_freq\t\t\t\t\t// Maximum CPU frequency available under current policy (unit: kHz)\ncpuinfo_min_freq\t\t\t\t\t// Minimum CPU frequency available under current policy (unit: kHz)\ncpuinfo_transition_latency\t\t\t// Time required for the processor to switch frequencies (unit: ns)\nrelated_cpus\t\t\t\t\t\t// All CPU cores affected by this policy (including both online and offline CPUs)\nscaling_available_frequencies\t\t// List of CPU-supported frequencies (unit: kHz)\nscaling_available_governors\t\t\t// All frequency scaling governors supported by the current kernel\nscaling_cur_freq\t\t\t\t\t// Current CPU frequency cached by the cpufreq module (does not read hardware registers)\nscaling_driver\t\t\t\t\t\t// Current frequency scaling driver in use\nscaling_governor\t\t\t\t\t// Current frequency scaling governor (policy)\nscaling_max_freq\t\t\t\t\t// Maximum CPU frequency under current policy (read from cpufreq module cache)\nscaling_min_freq\t\t\t\t\t// Minimum CPU frequency under current policy (read from cpufreq module cache)\nscaling_setspeed\t\t\t\t\t// Only usable when governor is set to 'userspace'; writing a value here sets the CPU frequency\n"})}),"\n",(0,t.jsx)(n.p,{children:"Currently supported frequencies include:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"cat /sys/devices/system/cpu/cpufreq/policy0/scaling_available_frequencies\n1500000 2000000\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Note"}),": Supported frequency points may vary across different chip types.\nThe Linux kernel used in the RDK S100 system supports the following CPU frequency scaling governors:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"performance"}),": Always runs the CPU at the highest supported frequency (maximum performance and power consumption)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"ondemand"}),": Dynamically adjusts frequency based on system load."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"userspace"}),": Allows users to manually set the CPU frequency."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"powersave"}),": Runs the CPU at the lowest supported frequency."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"schedutil"}),": Adjusts frequency based on load, tightly integrated with the CPU scheduler."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"conservative"}),": Similar to ondemand, but changes frequency more gradually to avoid abrupt jumps between min and max frequencies."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Users can control CPU frequency scaling by modifying settings under ",(0,t.jsx)(n.code,{children:"/sys/devices/system/cpu/cpu0/cpufreq/"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"For example, to run the CPU in performance mode:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"echo performance >/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or to lock the CPU to a fixed frequency (e.g., 1.5 GHz):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"echo userspace >/sys/devices/system/cpu/cpu0/cpufreq/scaling_governor\necho 1500000 >/sys/devices/system/cpu/cpufreq/policy0/scaling_setspeed\n"})}),"\n",(0,t.jsxs)(n.p,{children:["You can use the ",(0,t.jsx)(n.code,{children:"sudo hrut_somstatus"})," command to check the current chip's operating frequency, temperature, and other status information:"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);