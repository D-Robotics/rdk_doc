"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[26763],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(96540);const r={},a=i.createContext(r);function s(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(a.Provider,{value:n},e.children)}},40888:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"Basic_Application/vision/usb_camera","title":"3.4.2 Using USB Camera","description":"Video//www.youtube.com/watch?v=7xNgU1i2xsk&list=PLSxjn4YS2IuFUWcLGj2_uuCfLYnNYw6Ld&index=2","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/03_Basic_Application/04_vision/usb_camera.md","sourceDirName":"03_Basic_Application/04_vision","slug":"/Basic_Application/vision/usb_camera","permalink":"/rdk_doc/en/Basic_Application/vision/usb_camera","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1768581652000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"3.4.1 Using MIPI Camera","permalink":"/rdk_doc/en/Basic_Application/vision/mipi_camera"},"next":{"title":"3.5 \u58f0\u89c9\u65b9\u6848","permalink":"/rdk_doc/en/03_Basic_Application/02_audio"}}');var r=t(74848),a=t(28453);const s={sidebar_position:2},o="3.4.2 Using USB Camera",c={},d=[{value:"Environment Preparation",id:"environment-preparation",level:2},{value:"Execution Method",id:"execution-method",level:2},{value:"Expected Result",id:"expected-result",level:2},{value:"Multi-Camera Support",id:"multi-camera-support",level:2}];function l(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"342-using-usb-camera",children:"3.4.2 Using USB Camera"})}),"\n",(0,r.jsxs)(n.p,{children:["Video: ",(0,r.jsx)(n.a,{href:"https://www.youtube.com/watch?v=7xNgU1i2xsk&list=PLSxjn4YS2IuFUWcLGj2_uuCfLYnNYw6Ld&index=2",children:"https://www.youtube.com/watch?v=7xNgU1i2xsk&list=PLSxjn4YS2IuFUWcLGj2_uuCfLYnNYw6Ld&index=2"})]}),"\n",(0,r.jsxs)(n.p,{children:["The development board is equipped with the ",(0,r.jsx)(n.code,{children:"usb_camera_fcos.py"})," program to test the data path of the USB camera. This example will capture the image data from the USB camera in real time, then run the object detection algorithm, and finally output the merged image data and detection results through the HDMI interface."]}),"\n",(0,r.jsx)(n.h2,{id:"environment-preparation",children:"Environment Preparation"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Connect the USB camera to the development board and confirm the generation of the ",(0,r.jsx)(n.code,{children:"/dev/videoX"})," device node, where ",(0,r.jsx)(n.code,{children:"X"})," represents a number, such as ",(0,r.jsx)(n.code,{children:"/dev/video0"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Connect the development board to the monitor using an HDMI cable."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"execution-method",children:"Execution Method"}),"\n",(0,r.jsx)(n.p,{children:"Execute the program with the following command."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"sunrise@ubuntu:~$ cd /app/pydev_demo/02_usb_camera_sample/\nsunrise@ubuntu:/app/pydev_demo/02_usb_camera_sample$ sudo python3 ./usb_camera_fcos.py\n"})}),"\n",(0,r.jsx)(n.h2,{id:"expected-result",children:"Expected Result"}),"\n",(0,r.jsxs)(n.p,{children:["After running the program, the monitor will display the camera image and the results of the object detection algorithm (object type, confidence), as shown below:",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/03_Basic_Application/01_Image/image/usb_camera/image-20220612110739490.png",alt:"image-20220612110739490"})]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["For detailed code implementation instructions, please refer to the ",(0,r.jsx)(n.a,{href:"../../04_Algorithm_Application/01_pydev_dnn_demo/usb_camera.md",children:"USB Camera Inference"})," chapter.",(0,r.jsx)(n.br,{}),"\n","Before connecting two USB cameras, it is necessary to limit the bandwidth usage of uvcvideo by executing ",(0,r.jsx)(n.code,{children:"rmmod uvcvideo; modprobe uvcvideo quirks=128"}),"."]})}),"\n",(0,r.jsx)(n.h2,{id:"multi-camera-support",children:"Multi-Camera Support"}),"\n",(0,r.jsx)(n.p,{children:"RDK series boards only have one USB controller, and multiple USB devices are expanded via a USB hub. Essentially, all peripherals still share the total bandwidth of this single USB controller."}),"\n",(0,r.jsx)(n.p,{children:"For USB 2.0, all devices together can only share 480 Mbps (approximately 500 Mbit/s) of total bandwidth."}),"\n",(0,r.jsx)(n.p,{children:"There is no situation where USB 2.0 devices share the bandwidth of USB 3.0."}),"\n",(0,r.jsx)(n.p,{children:"Therefore, by default, if you connect a USB 2.0 camera, it will usually \u201cgreedily\u201d request almost the entire bandwidth, making it impossible to use a second camera simultaneously."}),"\n",(0,r.jsxs)(n.p,{children:["RDK\u2019s special UVC driver (uvcvideo) can use the ",(0,r.jsx)(n.code,{children:"limitsize"})," parameter to limit the camera\u2019s bandwidth usage within a certain range, allowing two cameras to stream at the same time."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"rmmod uvcvideo.ko\nmodprobe uvcvideo limitsize=2\n"})}),"\n",(0,r.jsxs)(n.p,{children:["However, the core parameter for USB bandwidth budgeting is ",(0,r.jsx)(n.code,{children:"wMaxPacketSize"}),", which is defined in the endpoint descriptor of the device firmware."]}),"\n",(0,r.jsxs)(n.p,{children:["If the firmware provides multiple ",(0,r.jsx)(n.code,{children:"Video Streaming"})," configurations, ",(0,r.jsx)(n.code,{children:"wMaxPacketSize"})," can range from ",(0,r.jsx)(n.code,{children:"1 x 192 bytes"}),", ",(0,r.jsx)(n.code,{children:"1 x 384 bytes"}),", up to ",(0,r.jsx)(n.code,{children:"3 x 1020 bytes"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["In practice, when enabling MJPEG video streaming, the device does not necessarily use the maximum packet size. Instead, it selects a suitable ",(0,r.jsx)(n.code,{children:"wMaxPacketSize"})," based on resolution and frame rate."]}),"\n",(0,r.jsxs)(n.p,{children:["Therefore, bandwidth allocation is more flexible, and with ",(0,r.jsx)(n.code,{children:"uvcvideo limitsize=2"}),", two cameras can stream simultaneously."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"  Interface Descriptor:\n    bLength                 9\n    bDescriptorType         4\n    bInterfaceNumber        1\n    bAlternateSetting       1\n    bNumEndpoints           1\n    bInterfaceClass        14 Video\n    bInterfaceSubClass      2 Video Streaming\n    bInterfaceProtocol      0 \n    iInterface              0 \n    Endpoint Descriptor:\n      bLength                 7\n      bDescriptorType         5\n      bEndpointAddress     0x81  EP 1 IN\n      bmAttributes            5\n        Transfer Type            Isochronous\n        Synch Type               Asynchronous\n        Usage Type               Data\n      wMaxPacketSize     0x00c0  1x 192 bytes\n      bInterval               1\n \n ......\n\n  Interface Descriptor:\n    bLength                 9\n    bDescriptorType         4\n    bInterfaceNumber        1\n    bAlternateSetting      11\n    bNumEndpoints           1\n    bInterfaceClass        14 Video\n    bInterfaceSubClass      2 Video Streaming\n    bInterfaceProtocol      0 \n    iInterface              0 \n    Endpoint Descriptor:\n      bLength                 7\n      bDescriptorType         5\n      bEndpointAddress     0x81  EP 1 IN\n      bmAttributes            5\n        Transfer Type            Isochronous\n        Synch Type               Asynchronous\n        Usage Type               Data\n      wMaxPacketSize     0x13fc  3x 1020 bytes\n      bInterval \n"})}),"\n",(0,r.jsxs)(n.p,{children:["If the firmware provides only one ",(0,r.jsx)(n.code,{children:"Video Streaming"})," configuration with ",(0,r.jsx)(n.code,{children:"wMaxPacketSize = 3 x 1024 bytes"}),","]}),"\n",(0,r.jsx)(n.p,{children:"this means the device always requests the maximum bandwidth."}),"\n",(0,r.jsx)(n.p,{children:"No matter how the driver tries to limit it, it will be impossible for two cameras to stream simultaneously and stably."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"  Interface Descriptor:\n    bLength                 9\n    bDescriptorType         4\n    bInterfaceNumber        1\n    bAlternateSetting       1\n    bNumEndpoints           1\n    bInterfaceClass        14 Video\n    bInterfaceSubClass      2 Video Streaming\n    bInterfaceProtocol      0 \n    iInterface              0 \n    Endpoint Descriptor:\n      bLength                 7\n      bDescriptorType         5\n      bEndpointAddress     0x88  EP 8 IN\n      bmAttributes            5\n        Transfer Type            Isochronous\n        Synch Type               Asynchronous\n        Usage Type               Data\n      wMaxPacketSize     0x1400  3x 1024 bytes\n      bInterval  \n"})}),"\n",(0,r.jsx)(n.p,{children:"get wMaxPacketSize"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"lsusb -v -d <vid>:<pid>\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);