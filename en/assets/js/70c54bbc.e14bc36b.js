"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[25437],{11470:(e,t,n)=>{n.d(t,{A:()=>y});var r=n(96540),s=n(34164),i=n(23104),o=n(56347),a=n(205),c=n(57485),l=n(31682),d=n(70679);function h(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:t,children:n}=e;return(0,r.useMemo)(()=>{const e=t??function(e){return h(e).map(({props:{value:e,label:t,attributes:n,default:r}})=>({value:e,label:t,attributes:n,default:r}))}(n);return function(e){const t=(0,l.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,n])}function m({value:e,tabValues:t}){return t.some(t=>t.value===e)}function p({queryString:e=!1,groupId:t}){const n=(0,o.W6)(),s=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(s),(0,r.useCallback)(e=>{if(!s)return;const t=new URLSearchParams(n.location.search);t.set(s,e),n.replace({...n.location,search:t.toString()})},[s,n])]}function x(e){const{defaultValue:t,queryString:n=!1,groupId:s}=e,i=u(e),[o,c]=(0,r.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find(e=>e.default)??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:i})),[l,h]=p({queryString:n,groupId:s}),[x,f]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,s]=(0,d.Dv)(t);return[n,(0,r.useCallback)(e=>{t&&s.set(e)},[t,s])]}({groupId:s}),b=(()=>{const e=l??x;return m({value:e,tabValues:i})?e:null})();(0,a.A)(()=>{b&&c(b)},[b]);return{selectedValue:o,selectValue:(0,r.useCallback)(e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),h(e),f(e)},[h,f,i]),tabValues:i}}var f=n(92303);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=n(74848);function j({className:e,block:t,selectedValue:n,selectValue:r,tabValues:o}){const a=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),l=e=>{const t=e.currentTarget,s=a.indexOf(t),i=o[s].value;i!==n&&(c(t),r(i))},d=e=>{let t=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const n=a.indexOf(e.currentTarget)+1;t=a[n]??a[0];break}case"ArrowLeft":{const n=a.indexOf(e.currentTarget)-1;t=a[n]??a[a.length-1];break}}t?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},e),children:o.map(({value:e,label:t,attributes:r})=>(0,g.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:l,...r,className:(0,s.A)("tabs__item",b.tabItem,r?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function v({lazy:e,children:t,selectedValue:n}){const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===n);return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:i.map((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function _(e){const t=x(e);return(0,g.jsxs)("div",{className:(0,s.A)("tabs-container",b.tabList),children:[(0,g.jsx)(j,{...t,...e}),(0,g.jsx)(v,{...t,...e})]})}function y(e){const t=(0,f.A)();return(0,g.jsx)(_,{...e,children:h(e.children)},String(t))}},19365:(e,t,n)=>{n.d(t,{A:()=>o});n(96540);var r=n(34164);const s={tabItem:"tabItem_Ymn6"};var i=n(74848);function o({children:e,hidden:t,className:n}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,n),hidden:t,children:e})}},28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var r=n(96540);const s={},i=r.createContext(s);function o(e){const t=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:t},e.children)}},68293:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"Robot_development/boxs/function/dstereo_occupancy","title":"Stereo OCC Algorithm","description":"Function Introduction","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/05_Robot_development/03_boxs/function/dstereo_occupancy.md","sourceDirName":"05_Robot_development/03_boxs/function","slug":"/Robot_development/boxs/function/dstereo_occupancy","permalink":"/rdk_doc/en/Robot_development/boxs/function/dstereo_occupancy","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1755083189000,"sidebarPosition":23,"frontMatter":{"sidebar_position":23},"sidebar":"tutorialSidebar","previous":{"title":"Segment Anything","permalink":"/rdk_doc/en/Robot_development/boxs/function/reid"},"next":{"title":"Monocular Elevation Network","permalink":"/rdk_doc/en/Robot_development/boxs/function/elevation_net"}}');var s=n(74848),i=n(28453);n(11470),n(19365);const o={sidebar_position:23},a="Stereo OCC Algorithm",c={},l=[{value:"Function Introduction",id:"function-introduction",level:2},{value:"Supported Platforms",id:"supported-platforms",level:2},{value:"Preparation",id:"preparation",level:2},{value:"RDK Platform",id:"rdk-platform",level:3},{value:"Version Requirements",id:"version-requirements",level:3},{value:"Usage Instructions",id:"usage-instructions",level:2},{value:"1. Using with ZED-2i Camera",id:"1-using-with-zed-2i-camera",level:3},{value:"2. Using Custom Data for Offline Inference",id:"2-using-custom-data-for-offline-inference",level:3},{value:"Package Description",id:"package-description",level:2},{value:"Parameters",id:"parameters",level:3},{value:"Subscribed Topics",id:"subscribed-topics",level:3},{value:"Published Topics",id:"published-topics",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"stereo-occ-algorithm",children:"Stereo OCC Algorithm"})}),"\n","\n",(0,s.jsx)(t.h2,{id:"function-introduction",children:"Function Introduction"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.strong,{children:"Stereo OCC Algorithm"})," subscribes to stereo images, uses the BPU for algorithm inference, and publishes occupancy grid information."]}),"\n",(0,s.jsxs)(t.p,{children:["Code Repository: (",(0,s.jsx)(t.a,{href:"https://github.com/D-Robotics/dstereo_occnet",children:"https://github.com/D-Robotics/dstereo_occnet"}),")"]}),"\n",(0,s.jsx)(t.h2,{id:"supported-platforms",children:"Supported Platforms"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Platform"}),(0,s.jsx)(t.th,{children:"Runtime Environment"}),(0,s.jsx)(t.th,{children:"Example Function"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"RDK X5, RDK X5 Module"}),(0,s.jsx)(t.td,{children:"Ubuntu 22.04 (Humble)"}),(0,s.jsx)(t.td,{children:"Launch stereo camera, display stereo images via Web, show occupancy grid results in rviz2"})]})})]}),"\n",(0,s.jsx)(t.h2,{id:"preparation",children:"Preparation"}),"\n",(0,s.jsx)(t.h3,{id:"rdk-platform",children:"RDK Platform"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"RDK has been flashed with Ubuntu 22.04 system image."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"RDK has successfully installed TogetheROS.Bot."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"For real-time online inference, currently only supports ZED-2i camera; for offline inference, please prepare stereo images."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Confirm that the PC can access the RDK through the network."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"version-requirements",children:"Version Requirements"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{}),(0,s.jsx)(t.th,{children:"Version"}),(0,s.jsx)(t.th,{children:"Query Method"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"System Version"}),(0,s.jsx)(t.td,{children:"3.2.3"}),(0,s.jsxs)(t.td,{children:["Execute on RDK X5 board: ",(0,s.jsx)(t.code,{children:"cat /etc/version"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsxs)(t.td,{children:[(0,s.jsx)(t.a,{href:"https://github.com/D-Robotics/dstereo_occnet",children:"dstereo_occnet"})," package version"]}),(0,s.jsx)(t.td,{children:"1.0.0"}),(0,s.jsxs)(t.td,{children:["Execute on RDK X5 board: ",(0,s.jsx)(t.code,{children:"apt list | grep tros-humble-dstereo-occnet/"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsxs)(t.td,{children:[(0,s.jsx)(t.a,{href:"https://github.com/D-Robotics/hobot_zed_cam",children:"hobot_zed_cam"})," package version"]}),(0,s.jsx)(t.td,{children:"2.3.3"}),(0,s.jsxs)(t.td,{children:["Execute on RDK X5 board: ",(0,s.jsx)(t.code,{children:"apt list | grep tros-humble-hobot-zed-cam/"})]})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"usage-instructions",children:"Usage Instructions"}),"\n",(0,s.jsx)(t.h3,{id:"1-using-with-zed-2i-camera",children:"1. Using with ZED-2i Camera"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Need to use together with the ",(0,s.jsx)(t.a,{href:"https://github.com/D-Robotics/hobot_zed_cam.git",children:(0,s.jsx)(t.code,{children:"hobot_zed_cam"})})," package"]}),"\n",(0,s.jsx)(t.li,{children:"Execute the following commands on RDK X5:"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# Configure tros.b humble environment\nsource /opt/tros/humble/setup.bash\n\n# Launch ZED-2i camera and occupancy network inference program\nros2 launch dstereo_occnet zed2i_occ_node.launch.py\n"})}),"\n",(0,s.jsx)(t.p,{children:"After the program starts, you can view the stereo images published by ZED-2i through the web page and view the occupancy grid through rviz2."}),"\n",(0,s.jsxs)(t.p,{children:["To view stereo images through web, enter ",(0,s.jsx)(t.a,{href:"http://ip:8000",children:"http://ip:8000"})," in the PC browser to view the stereo images. The ip is the ip of the RDK X5 board, which is ",(0,s.jsx)(t.code,{children:"192.168.128.10"})," in the example. Make sure the PC and RDK X5 can communicate through the network.\n",(0,s.jsx)(t.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/03_boxs/function/image/box_adv/ZED-2i-stereo-img.png",alt:"ZED-2i-stereo-img"})]}),"\n",(0,s.jsxs)(t.p,{children:["You can view the occupancy grid through rviz2. You need to set up an Ubuntu22.04 + ROS2 Humble host computer, and the host computer and RDK X5 board can communicate through ROS2, then start rviz2. The specific settings are as follows:\n",(0,s.jsx)(t.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/03_boxs/function/image/box_adv/rviz2-occ.png",alt:"rviz2-occ"})]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"To save results, please add the following parameters:"}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# Configure tros.b humble environment\nsource /opt/tros/humble/setup.bash\n\n# Launch ZED-2i camera and occupancy network inference program\nros2 launch dstereo_occnet zed2i_occ_node.launch.py \\\nsave_occ_flag:=True save_occ_dir:=./occ_result save_freq:=4 save_total:=10\n"})}),"\n",(0,s.jsx)(t.h3,{id:"2-using-custom-data-for-offline-inference",children:"2. Using Custom Data for Offline Inference"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Need to prepare offline data and upload it to the RDK X5 board. The format of offline data is as follows:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["The offline directory needs to contain left and right images. The program will make judgments. The left image needs to contain the ",(0,s.jsx)(t.code,{children:"left"})," field, in png or jpg format. The right image needs to contain the ",(0,s.jsx)(t.code,{children:"right"})," field, and other aspects should be consistent with the left image"]}),"\n",(0,s.jsxs)(t.li,{children:["Image resolution is ",(0,s.jsx)(t.code,{children:"640*352"}),", other resolutions are not supported"]}),"\n",(0,s.jsx)(t.li,{children:"Left and right images need to be corrected to achieve epipolar alignment"}),"\n",(0,s.jsxs)(t.li,{children:["Since the model is currently trained with ZED-2i data, try to make the intrinsic parameters of offline images close to ZED-2i. ZED-2i camera parameters are: ",(0,s.jsx)(t.code,{children:"fx=354.9999, fy=354.9999, cx=322.9469, cy=176.2076, baseline=0.12"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Execute the following commands on RDK X5:"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"ros2 launch dstereo_occnet offline_infer_web_visual.launch.py \\\nlocal_image_dir:=./offline_images save_occ_flag:=True save_occ_dir:=./offline_result\n"})}),"\n",(0,s.jsx)(t.p,{children:"After the program starts, you can also view the stereo images published by ZED-2i through the web page and view the occupancy grid through rviz2"}),"\n",(0,s.jsx)(t.h2,{id:"package-description",children:"Package Description"}),"\n",(0,s.jsx)(t.h3,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Value"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"stereo_msg_topic"}),(0,s.jsx)(t.td,{children:"Default /image_combine_raw"}),(0,s.jsx)(t.td,{children:"Name of the subscribed stereo image topic"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"camera_info_topic"}),(0,s.jsx)(t.td,{children:"Default /image_combine_raw/camera_info"}),(0,s.jsx)(t.td,{children:"Name of the subscribed camera intrinsic parameters topic"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"occ_model_file_path"}),(0,s.jsx)(t.td,{children:"Default X5-OCC-32x64x96x2_constinput_modified.bin"}),(0,s.jsx)(t.td,{children:"Path of the stereo occupancy network model"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"use_local_image"}),(0,s.jsx)(t.td,{children:"Default False"}),(0,s.jsx)(t.td,{children:"Whether to use offline inference"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"local_image_dir"}),(0,s.jsx)(t.td,{children:"Default config"}),(0,s.jsx)(t.td,{children:"Directory for storing images in offline inference"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"save_occ_flag"}),(0,s.jsx)(t.td,{children:"Default False"}),(0,s.jsx)(t.td,{children:"Whether to save inference results"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"save_occ_dir"}),(0,s.jsx)(t.td,{children:"Default ./occ_results"}),(0,s.jsx)(t.td,{children:"Directory for saving inference results"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"save_freq"}),(0,s.jsx)(t.td,{children:"Default 1"}),(0,s.jsx)(t.td,{children:"Save frequency, e.g., setting to 4 means saving once every 4 frames, default saves every frame inference result"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"save_total"}),(0,s.jsx)(t.td,{children:"Default -1"}),(0,s.jsx)(t.td,{children:"Total number of saves, e.g., setting to 10 means saving 10 frame results in total, -1 means save continuously"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"voxel_size"}),(0,s.jsx)(t.td,{children:"Default 0.02"}),(0,s.jsx)(t.td,{children:"Size of each occupancy grid, unit m, 0.02 means each occupancy grid is 2*2*2cm"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"log_level"}),(0,s.jsx)(t.td,{children:"Default INFO"}),(0,s.jsx)(t.td,{children:"Log level, default INFO"})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"subscribed-topics",children:"Subscribed Topics"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Topic Name"}),(0,s.jsx)(t.th,{children:"Message Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"/image_combine_raw"}),(0,s.jsx)(t.td,{children:"sensor_msgs::msg::Image"}),(0,s.jsx)(t.td,{children:"Subscribe to stereo images, image format is NV12, images are required to be arranged vertically with left image on top and right image at bottom, can be modified through stereo_msg_topic parameter"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"/image_combine_raw/camera_info"}),(0,s.jsx)(t.td,{children:"sensor_msgs::msg::CameraInfo"}),(0,s.jsx)(t.td,{children:"Subscribe to camera intrinsic parameters, optional, this topic may not exist, if it exists, camera parameters can be saved together when saving results"})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"published-topics",children:"Published Topics"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Name"}),(0,s.jsx)(t.th,{children:"Message Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"/dstereo_occnet_node/voxel"}),(0,s.jsx)(t.td,{children:"sensor_msgs::msg::PointCloud2"}),(0,s.jsx)(t.td,{children:"Published occupancy grid data, can be displayed using rviz2"})]})})]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);