"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[48688],{28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>o});var s=t(96540);const i={},r=s.createContext(i);function l(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(r.Provider,{value:n},e.children)}},62276:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Advanced_development/linux_development/realtime_kernel","title":"7.2.6 Applying Real-Time Kernel","description":"This chapter aims to describe how to enable real-time kernel (Preempt-RT kernel) on RDK X3 and RDK X3 Module, and provide the corresponding commands for users to use. Real-time kernel is an operating system kernel that can provide more precise and reliable response time, and is commonly used in applications with high time sensitivity requirements, such as robot control and industrial automation. The following are the related commands for enabling and disabling real-time kernel, as well as some common use cases and testing methods.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/07_Advanced_development/02_linux_development/realtime_kernel.md","sourceDirName":"07_Advanced_development/02_linux_development","slug":"/Advanced_development/linux_development/realtime_kernel","permalink":"/rdk_doc/en/Advanced_development/linux_development/realtime_kernel","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1750478598000,"sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"7.2.5 Kernel Header Files","permalink":"/rdk_doc/en/Advanced_development/linux_development/kernel_headers"},"next":{"title":"7.3 \u591a\u5a92\u4f53\u5f00\u53d1\u6307\u5357","permalink":"/rdk_doc/en/03_multimedia_development"}}');var i=t(74848),r=t(28453);const l={sidebar_position:6},o="7.2.6 Applying Real-Time Kernel",a={},c=[{value:"Command to Enable Real-Time Kernel",id:"command-to-enable-real-time-kernel",level:2},{value:"Command to Restore to Standard Kernel",id:"command-to-restore-to-standard-kernel",level:2},{value:"Real-Time Performance Testing",id:"real-time-performance-testing",level:2},{value:"Installing the rt-tests Tool",id:"installing-the-rt-tests-tool",level:3},{value:"Running the cyclictest Test",id:"running-the-cyclictest-test",level:3},{value:"Analyzing Test Results",id:"analyzing-test-results",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"726-applying-real-time-kernel",children:"7.2.6 Applying Real-Time Kernel"})}),"\n",(0,i.jsxs)(n.p,{children:["This chapter aims to describe how to enable real-time kernel (Preempt-RT kernel) on ",(0,i.jsx)(n.code,{children:"RDK X3"})," and ",(0,i.jsx)(n.code,{children:"RDK X3 Module"}),", and provide the corresponding commands for users to use. Real-time kernel is an operating system kernel that can provide more precise and reliable response time, and is commonly used in applications with high time sensitivity requirements, such as robot control and industrial automation. The following are the related commands for enabling and disabling real-time kernel, as well as some common use cases and testing methods."]}),"\n",(0,i.jsx)(n.h2,{id:"command-to-enable-real-time-kernel",children:"Command to Enable Real-Time Kernel"}),"\n",(0,i.jsx)(n.p,{children:"To enable real-time kernel on RDK X3, please execute the following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install hobot-kernel-headers=2.0.0-01~rt hobot-boot=2.0.2-01~rt hobot-bpu-drivers=2.0.0-01~rt\nsudo reboot\n"})}),"\n",(0,i.jsxs)(n.p,{children:["These commands will install kernel headers, kernel files, drivers, and BPU drivers that are compatible with real-time kernel. After completion, restart the system to make the changes effective. You can use the ",(0,i.jsx)(n.code,{children:"uname -a"})," command to see the kernel version information with ",(0,i.jsx)(n.code,{children:"PREEMPT RT"})," indication."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/image/realtime_kernel/image-20230914142401210.png",alt:"image-20230914142401210"})}),"\n",(0,i.jsx)(n.h2,{id:"command-to-restore-to-standard-kernel",children:"Command to Restore to Standard Kernel"}),"\n",(0,i.jsx)(n.p,{children:"If you need to restore to the standard kernel, you can execute the following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt install hobot-kernel-headers hobot-boot hobot-bpu-drivers\nsudo reboot\n"})}),"\n",(0,i.jsx)(n.p,{children:"These commands will uninstall the components related to the real-time kernel and install the components corresponding to the standard kernel. After completion, restart the system to switch back to the standard kernel."}),"\n",(0,i.jsx)(n.h2,{id:"real-time-performance-testing",children:"Real-Time Performance Testing"}),"\n",(0,i.jsxs)(n.p,{children:["When you need to test the performance of the real-time kernel, a commonly used performance testing tool is ",(0,i.jsx)(n.code,{children:"rt-tests"}),", which includes multiple test programs that can be used to test the performance of the real-time kernel. Here is an example of performing performance testing with ",(0,i.jsx)(n.code,{children:"rt-tests"}),":"]}),"\n",(0,i.jsx)(n.h3,{id:"installing-the-rt-tests-tool",children:"Installing the rt-tests Tool"}),"\n",(0,i.jsxs)(n.p,{children:["If the ",(0,i.jsx)(n.code,{children:"rt-tests"})," tool has not been installed yet, you can use the following command to install it:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo apt install rt-tests\n"})}),"\n",(0,i.jsx)(n.h3,{id:"running-the-cyclictest-test",children:"Running the cyclictest Test"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"cyclictest"})," test is a commonly used test in ",(0,i.jsx)(n.code,{children:"rt-tests"}),", which is used to evaluate the timing behavior and response time of the system. Execute the following command to run the ",(0,i.jsx)(n.code,{children:"cyclictest"})," test:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"sudo cyclictest -l50000000 -m -S -p90 -i200 -h400\n"})}),"\n",(0,i.jsx)(n.p,{children:"This command will run a real-time performance test with the following options:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-l50000000"}),": Sets the number of iterations for the test to run."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-m"}),": Specifies that ",(0,i.jsx)(n.code,{children:"cyclictest"})," will lock the current and upcoming memory through mlock during the test to prevent swap interference."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-S"}),": Specifies the standard SMP architecture test, where all threads will use the same -a -t -n and priorities."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-p90"}),": Specifies the priority of the real-time thread. ",(0,i.jsx)(n.code,{children:"-p90"})," means the test will run in the real-time scheduling class with a priority of 90."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-i200"}),": Sets the sleep time for the test threads."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"-h400"}),": After the test is completed, output a histogram and the count of times the latency was less than the specified value (400) in microseconds."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The test results will display the minimum, maximum, and average latency of the system, as well as some other performance statistics."}),"\n",(0,i.jsx)(n.h3,{id:"analyzing-test-results",children:"Analyzing Test Results"}),"\n",(0,i.jsxs)(n.p,{children:["Analyze the ",(0,i.jsx)(n.code,{children:"cyclictest"})," test results to assess the performance of the real-time kernel. Pay attention to the minimum and maximum latencies to ensure they are within an acceptable range. Smaller maximum latency and more consistent latency indicate better performance of the real-time kernel. The following graphs show the results of the test when using a real-time kernel and running the ",(0,i.jsx)(n.code,{children:"/app/pydev_demo/03_mipi_camera_sample"})," example."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/image/realtime_kernel/image-20230914145619064.png",alt:"image-20230914145619064"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/image/realtime_kernel/image-20230914145234528.png",alt:"image-20230914145234528"})}),"\n",(0,i.jsxs)(n.p,{children:["The meaning of each field in the ",(0,i.jsx)(n.code,{children:"cyclictest"})," output is as follows:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"T"}),": Thread identifier and thread number for the test run."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"P"}),": Priority used during the test run. In your output, it has a value of 90, indicating the test ran in the real-time scheduling class with a priority of 90."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"I"}),": Expected wake-up period for the latency measurement thread in microseconds."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"C"}),": Number of measurements taken for the latency, i.e., the loop count."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Min"}),": Minimum latency for the current test cycle in microseconds."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Act"}),": Actual latency for the current test cycle in microseconds."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Avg"}),": Average latency for the current test cycle in microseconds."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Max"}),": Maximum latency for the current test cycle in microseconds."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);