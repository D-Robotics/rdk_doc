"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[43865],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var s=i(96540);const l={},r=s.createContext(l);function t(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(r.Provider,{value:n},e.children)}},32793:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"Advanced_development/linux_development/driver_development_s100/driver_timesync","title":"\u65f6\u95f4\u540c\u6b65\u65b9\u6848","description":"\u540d\u8bcd\u7f29\u5199\u53ca\u89e3\u91ca","source":"@site/docs_s/07_Advanced_development/02_linux_development/04_driver_development_s100/12_driver_timesync.md","sourceDirName":"07_Advanced_development/02_linux_development/04_driver_development_s100","slug":"/Advanced_development/linux_development/driver_development_s100/driver_timesync","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1757501941000,"sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"tutorialSidebar","previous":{"title":"\u97f3\u9891\u8c03\u8bd5\u6307\u5357","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_audio"},"next":{"title":"PCIe\u4f7f\u7528\u6307\u5357","permalink":"/rdk_doc/en/rdk_s/13_driver_pcie"}}');var l=i(74848),r=i(28453);const t={sidebar_position:12},c="\u65f6\u95f4\u540c\u6b65\u65b9\u6848",d={},o=[{value:"\u540d\u8bcd\u7f29\u5199\u53ca\u89e3\u91ca",id:"\u540d\u8bcd\u7f29\u5199\u53ca\u89e3\u91ca",level:2},{value:"ptp\u65f6\u95f4\u540c\u6b65",id:"ptp\u65f6\u95f4\u540c\u6b65",level:2},{value:"\u529f\u80fd",id:"\u529f\u80fd",level:3},{value:"ptp4l\u4f7f\u7528\u65b9\u6cd5",id:"ptp4l\u4f7f\u7528\u65b9\u6cd5",level:3},{value:"\u547d\u4ee4\u884c\u53c2\u6570",id:"\u547d\u4ee4\u884c\u53c2\u6570",level:4},{value:"\u914d\u7f6e\u6587\u4ef6\u7684\u4f7f\u7528",id:"\u914d\u7f6e\u6587\u4ef6\u7684\u4f7f\u7528",level:4},{value:"automotive\u914d\u7f6e\u793a\u4f8b",id:"automotive\u914d\u7f6e\u793a\u4f8b",level:4},{value:"phc2sys\u4f7f\u7528\u65b9\u6cd5",id:"phc2sys\u4f7f\u7528\u65b9\u6cd5",level:3},{value:"\u7efc\u5408\u793a\u4f8b",id:"\u7efc\u5408\u793a\u4f8b",level:3},{value:"\u547d\u4ee4\u884c\u53c2\u6570",id:"\u547d\u4ee4\u884c\u53c2\u6570-1",level:4},{value:"Log\u793a\u4f8b",id:"log\u793a\u4f8b",level:4},{value:"\u5168\u5c40\u65f6\u95f4\u6e90\u914d\u7f6e",id:"\u5168\u5c40\u65f6\u95f4\u6e90\u914d\u7f6e",level:2},{value:"MCU\u65f6\u95f4\u540c\u6b65\u8bf4\u660e",id:"mcu\u65f6\u95f4\u540c\u6b65\u8bf4\u660e",level:2},{value:"MCU\u652f\u6301\u7684\u65f6\u95f4\u7c7b\u578b",id:"mcu\u652f\u6301\u7684\u65f6\u95f4\u7c7b\u578b",level:3},{value:"MCU\u652f\u6301\u7684\u65f6\u95f4\u540c\u6b65\u65b9\u5f0f",id:"mcu\u652f\u6301\u7684\u65f6\u95f4\u540c\u6b65\u65b9\u5f0f",level:3},{value:"\u57fa\u4e8ePPS\u7684Timesync",id:"\u57fa\u4e8epps\u7684timesync",level:3},{value:"\u652f\u6301\u7684\u65f6\u95f4",id:"\u652f\u6301\u7684\u65f6\u95f4",level:4},{value:"\u914d\u7f6e\u65b9\u6cd5",id:"\u914d\u7f6e\u65b9\u6cd5",level:4},{value:"\u914d\u7f6e\u4e3e\u4f8b",id:"\u914d\u7f6e\u4e3e\u4f8b",level:4},{value:"PPS\u8bf4\u660e",id:"PPS",level:2},{value:"S100 PPS \u4ecb\u7ecd",id:"s100-pps-\u4ecb\u7ecd",level:3},{value:"PPS Target",id:"pps-target",level:3},{value:"PPS Source",id:"pps-source",level:3},{value:"PPS\u7684PAD\u914d\u7f6e",id:"pps\u7684pad\u914d\u7f6e",level:3},{value:"Acore Eth PPS\u4ecb\u7ecd",id:"Acore_Eth_PPS",level:3},{value:"Acore Eth PPS\u7684\u8f93\u51fa\u914d\u7f6e\u65b9\u6cd5",id:"acore-eth-pps\u7684\u8f93\u51fa\u914d\u7f6e\u65b9\u6cd5",level:3},{value:"MCU Eth PPS\u7684\u914d\u7f6e\u65b9\u6cd5",id:"mcu-eth-pps\u7684\u914d\u7f6e\u65b9\u6cd5",level:3},{value:"\u65f6\u95f4\u540c\u6b65\u6574\u4f53\u65b9\u6848",id:"\u65f6\u95f4\u540c\u6b65\u6574\u4f53\u65b9\u6848",level:2},{value:"\u529f\u80fd\u6982\u8ff0",id:"\u529f\u80fd\u6982\u8ff0",level:3},{value:"\u8f6f\u4ef6\u67b6\u6784\u8bf4\u660e",id:"\u8f6f\u4ef6\u67b6\u6784\u8bf4\u660e",level:4},{value:"\u65f6\u95f4\u6e90\u63a5\u5165Acore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848",id:"\u65f6\u95f4\u6e90\u63a5\u5165acore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848",level:5},{value:"\u4ee3\u7801\u4f4d\u7f6e\u53ca\u76ee\u5f55\u7ed3\u6784",id:"\u4ee3\u7801\u4f4d\u7f6e\u53ca\u76ee\u5f55\u7ed3\u6784",level:4},{value:"Acore\u7f16\u8bd1",id:"acore\u7f16\u8bd1",level:3},{value:"\u7f16\u8bd1\u73af\u5883",id:"\u7f16\u8bd1\u73af\u5883",level:4},{value:"\u7f16\u8bd1\u8bf4\u660e",id:"\u7f16\u8bd1\u8bf4\u660e",level:4},{value:"MCU\u7f16\u8bd1",id:"mcu\u7f16\u8bd1",level:3},{value:"\u7f16\u8bd1\u73af\u5883",id:"\u7f16\u8bd1\u73af\u5883-1",level:4},{value:"\u8fd0\u884c",id:"\u8fd0\u884c",level:4},{value:"\u652f\u6301\u5e73\u53f0",id:"\u652f\u6301\u5e73\u53f0",level:5},{value:"\u677f\u7aef\u90e8\u7f72\u53ca\u914d\u7f6e",id:"\u677f\u7aef\u90e8\u7f72\u53ca\u914d\u7f6e",level:5},{value:"\u8fd0\u884c\u6307\u5357",id:"\u8fd0\u884c\u6307\u5357",level:5},{value:"\u65f6\u95f4\u6e90\u63a5\u5165Acore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848",id:"\u65f6\u95f4\u6e90\u63a5\u5165acore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848-1",level:6}];function p(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"\u65f6\u95f4\u540c\u6b65\u65b9\u6848",children:"\u65f6\u95f4\u540c\u6b65\u65b9\u6848"})}),"\n",(0,l.jsx)(n.h2,{id:"\u540d\u8bcd\u7f29\u5199\u53ca\u89e3\u91ca",children:"\u540d\u8bcd\u7f29\u5199\u53ca\u89e3\u91ca"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"\u7f29\u5199"})}),(0,l.jsx)(n.th,{children:(0,l.jsx)(n.strong,{children:"\u89e3\u91ca"})})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"GPS"}),(0,l.jsx)(n.td,{children:"Global Positioning System"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"RTC"}),(0,l.jsx)(n.td,{children:"Real_Time Clock"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"PHC"}),(0,l.jsx)(n.td,{children:"PTP hardware clock"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"PTP"}),(0,l.jsx)(n.td,{children:"precision time protocol"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"gPTP"}),(0,l.jsx)(n.td,{children:"precision time protocol, extension of PTP Protocol"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"MCU"}),(0,l.jsx)(n.td,{children:"Microcontroller Unit"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"UART"}),(0,l.jsx)(n.td,{children:"Universal Asynchronous Receiver/Transmitter"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"CAN"}),(0,l.jsx)(n.td,{children:"Controller Area Network"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"PPS"}),(0,l.jsx)(n.td,{children:"Pulse Per Second"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"NMEA"}),(0,l.jsx)(n.td,{children:"National Marine Electronics Association"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"NTP"}),(0,l.jsx)(n.td,{children:"Network Time Protocol"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"NIC"}),(0,l.jsx)(n.td,{children:"Network Interface Card"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"ptp\u65f6\u95f4\u540c\u6b65",children:"ptp\u65f6\u95f4\u540c\u6b65"}),"\n",(0,l.jsx)(n.h3,{id:"\u529f\u80fd",children:"\u529f\u80fd"}),"\n",(0,l.jsx)(n.p,{children:"\u8be5\u8f6f\u4ef6\u5305\u542b\u4e24\u4e2a\u7a0b\u5e8f\uff1aptp4l\u548cphc2sys\u3002\u8fd9\u4e24\u4e2a\u8f6f\u4ef6\u7ed3\u5408\u4f7f\u7528\uff0c\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4ecemaster\u83b7\u53d6\u65f6\u95f4\uff0c\u540c\u6b65S100\u7684PHC\u65f6\u95f4\u548cLinux\u7cfb\u7edf\u65f6\u95f4\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"ptp4l\u4f7f\u7528\u65b9\u6cd5",children:"ptp4l\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.h4,{id:"\u547d\u4ee4\u884c\u53c2\u6570",children:"\u547d\u4ee4\u884c\u53c2\u6570"}),"\n",(0,l.jsx)(n.p,{children:"ptp4l\u652f\u6301gptp\u529f\u80fd\uff0c\u53ef\u4ee5\u4f5c\u4e3amaster\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3aslave\uff1b\u5982\u679c\u4f5c\u4e3aslave\uff0c\u53ef\u4ee5\u4ecemaster\u83b7\u53d6\u65f6\u95f4\uff0c\u540c\u6b65S100\u7684PHC\u65f6\u95f4\u548cRTC\u65f6\u95f4\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7ptp4l -h\u67e5\u770b\u5e2e\u52a9\u4fe1\u606f\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  root@ubuntu:/userdata# ptp4l -h\n\n  usage: ptp4l [options]\n\n  Delay Mechanism\n\n  -A Auto, starting with E2E\n  -E E2E, delay request-response (default)\n  -P P2P, peer delay mechanism\n\n  Network Transport\n\n  -2 IEEE 802.3\n  -4 UDP IPV4 (default)\n  -6 UDP IPV6\n\n  Time Stamping\n\n  -H HARDWARE (default)\n  -S SOFTWARE\n  -L LEGACY HW\n\n  Other Options\n\n  -f [file] read configuration from 'file'\n  -i [dev] interface device to use, for example 'eth0'\n  (may be specified multiple times)\n  -p [dev] Clock device to use, default auto\n  (ignored for SOFTWARE/LEGACY HW time stamping)\n  -s slave only mode (overrides configuration file)\n  -l [num] set the logging level to 'num'\n  -m print messages to stdout\n  -q do not print messages to the syslog\n  -v prints the software version and exits\n  -h prints this message and exits\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u914d\u7f6e\u6587\u4ef6\u7684\u4f7f\u7528",children:"\u914d\u7f6e\u6587\u4ef6\u7684\u4f7f\u7528"}),"\n",(0,l.jsx)(n.p,{children:"ptp4l\u53ef\u4ee5\u901a\u8fc7-f\u53c2\u6570\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u914d\u7f6e\u6587\u4ef6\u6309\u6bb5\u5212\u5206\uff0c\u7a7a\u884c\u548c#\u5f00\u5934\u7684\u884c\u4f1a\u88ab\u5ffd\u7565\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u6709\u4e09\u79cd\u6bb5\u7c7b\u578b\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"[global]\u6bb5\uff0c\u7528\u6765\u914d\u7f6eprogram\u9009\u9879\uff0cclock\u9009\u9879\uff0c\u9ed8\u8ba4port\u9009\u9879\u3002"}),"\n",(0,l.jsx)(n.p,{children:"port\u6bb5\u4f7f\u7528\u88ab\u914d\u7f6e\u7684\u7f51\u53e3\u7684\u540d\u5b57\uff0c\u5982[eth0]\u6bb5\uff0c\u5176\u914d\u7f6e\u7684\u9009\u9879\u4f1a\u8986\u76d6[global]\u6bb5\u4e2d\u9ed8\u8ba4port\u9009\u9879\u3002port\u6bb5\u53ef\u4ee5\u4e3a\u7a7a\u5185\u5bb9\uff0c\u4f5c\u7528\u53ea\u662f\u6307\u5b9a\u7f51\u53e3\uff0c\u8fd9\u6837\u547d\u4ee4\u884c\u4e2d\u4e0d\u5fc5\u4f7f\u7528-i\u9009\u9879\u3002"}),"\n",(0,l.jsx)(n.p,{children:"[unicast_master_table]\u6bb5\uff0c\u914d\u7f6e\u5355\u64adtable\u3002"}),"\n",(0,l.jsxs)(n.p,{children:["\u914d\u7f6e\u6587\u4ef6\u7684\u8be6\u7ec6\u4fe1\u606f\u53ef\u4ee5\u53c2\u8003\uff1a",(0,l.jsx)(n.a,{href:"https://linuxptp.nwtime.org/documentation/ptp4l/",children:"https://linuxptp.nwtime.org/documentation/ptp4l/"})]}),"\n",(0,l.jsx)(n.h4,{id:"automotive\u914d\u7f6e\u793a\u4f8b",children:"automotive\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:"automotive-master.cfg:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"#\n# Automotive Profile example configuration for master containing those\n# attributes which differ from the defaults.  See the file, default.cfg, for\n# the complete list of available options.\n#\n[global]\n# Options carried over from gPTP.\ngmCapable       1\npriority1       248\npriority2       248\nlogSyncInterval     -3\nsyncReceiptTimeout  3\nneighborPropDelayThresh 800\nmin_neighbor_prop_delay -20000000\nassume_two_step     1\npath_trace_enabled  1\nfollow_up_info      1\ntransportSpecific   0x1\nptp_dst_mac     01:80:C2:00:00:0E\nnetwork_transport   L2\ndelay_mechanism     P2P\n#\n# Automotive Profile specific options\n#\nBMCA            noop\nmasterOnly      1\ninhibit_announce    1\nasCapable               true\ninhibit_delay_req       1\n"})}),"\n",(0,l.jsx)(n.p,{children:"automotive-slave.cfg:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"#\n# Automotive Profile example configuration for slaves containing those\n# attributes which differ from the defaults.  See the file, default.cfg, for\n# the complete list of available options.\n#\n[global]\n#\n# Options carried over from gPTP.\n#\ngmCapable       1\npriority1       248\npriority2       248\nlogSyncInterval     -3\nsyncReceiptTimeout  3\nneighborPropDelayThresh 800\nmin_neighbor_prop_delay -20000000\nassume_two_step     1\npath_trace_enabled  1\nfollow_up_info      1\ntransportSpecific   0x1\nptp_dst_mac     01:80:C2:00:00:0E\nnetwork_transport   L2\ndelay_mechanism     P2P\n#\n# Automotive Profile specific options\n#\nBMCA            noop\nslaveOnly       1\ninhibit_announce    1\nasCapable               true\nignore_source_id    1\n# Required to quickly correct Time Jumps in master\nstep_threshold          1\noperLogSyncInterval     0\noperLogPdelayReqInterval 2\nmsg_interval_request     1\nservo_offset_threshold   30\nservo_num_offset_values  10\n"})}),"\n",(0,l.jsx)(n.h3,{id:"phc2sys\u4f7f\u7528\u65b9\u6cd5",children:"phc2sys\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.p,{children:"phc2sys\u7528\u4e8e\u5c06linux\u7cfb\u7edf\u65f6\u95f4\u540c\u6b65\u5230phc\u65f6\u95f4\uff0c\u6216\u8005\u5c06phc\u65f6\u95f4\u540c\u6b65\u5230linux\u7cfb\u7edf\u65f6\u95f4\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7phc2sys --h\u67e5\u770b\u4f7f\u7528\u8bf4\u660e\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  root@ubuntu:/userdata# phc2sys -h\n\n  usage: phc2sys [options]\n\n\n  automatic configuration:\n  -a turn on autoconfiguration\n  -r synchronize system (realtime) clock\n  repeat -r to consider it also as a time source\n  manual configuration:\n  -c [dev|name] slave clock (CLOCK_REALTIME)\n  -d [dev] master PPS device\n  -s [dev|name] master clock\n  -O [offset] slave-master time offset (0)\n  -w wait for ptp4l\n  common options:\n  -f [file] configuration file\n  -E [pi|linreg] clock servo (pi)\n  -P [kp] proportional constant (0.7)\n  -I [ki] integration constant (0.3)\n  -S [step] step threshold (disabled)\n  -F [step] step threshold only on start (0.00002)\n  -R [rate] slave clock update rate in HZ (1.0)\n  -N [num] number of master clock readings per update (5)\n  -L [limit] sanity frequency limit in ppb (200000000)\n  -M [num] NTP SHM segment number (0)\n  -u [num] number of clock updates in summary stats (0)\n  -n [num] domain number (0)\n  -x apply leap seconds by servo instead of kernel\n  -z [path] server address for UDS (/var/run/ptp4l)\n  -l [num] set the logging level to 'num' (6)\n  -t [tag] add tag to log messages\n  -m print messages to stdout\n  -q do not print messages to the syslog\n  -v prints the software version and exits\n  -h prints this message and exits\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u7efc\u5408\u793a\u4f8b",children:"\u7efc\u5408\u793a\u4f8b"}),"\n",(0,l.jsx)(n.h4,{id:"\u547d\u4ee4\u884c\u53c2\u6570-1",children:"\u547d\u4ee4\u884c\u53c2\u6570"}),"\n",(0,l.jsx)(n.p,{children:"\u4e0b\u9762\u793a\u8303\u5982\u4f55\u901a\u8fc7ptp4l\u548cphc2sys\uff0c\u5c06master\u7684\u7f51\u5361\u65f6\u95f4\u540c\u6b65\u5230slave\u7684\u7f51\u5361\u65f6\u95f4\u548c\u7cfb\u7edf\u65f6\u95f4\u3002\u7528\u6237\u9700\u8981\u4fdd\u8bc1master\u8bbe\u5907\u548cslave\u8bbe\u5907\u4e4b\u95f4\u7f51\u7edc\u8054\u901a\u3002"}),"\n",(0,l.jsx)(n.p,{children:"Master\u7aef\u6267\u884c\u5982\u4e0b\u547d\u4ee4:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  ptp4l -i eth0 -f /usr/hobot/lib/pkgconfig/automotive-master.cfg -m -l 7\n"})}),"\n",(0,l.jsx)(n.p,{children:"Slave\u7aef\u6267\u884c\u5982\u4e0b\u547d\u4ee4:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  ptp4l -i eth0 -f /usr/hobot/lib/pkgconfig/automotive-slave.cfg -m -l 7 > ptp4l.log &\n  phc2sys -s eth0 -c CLOCK_REALTIME --transportSpecific=1 -m --step_threshold=1000 -w > phc2sys.log &\n"})}),"\n",(0,l.jsx)(n.h4,{id:"log\u793a\u4f8b",children:"Log\u793a\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:"Slave\u7aeflog:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  ptp4l[8330.884]: PI servo: sync interval 1.000 kp 0.700 ki 0.300000\n  ptp4l[8330.885]: master offset 21 s3 freq -391 path delay 690\n  ptp4l[8330.998]: port 1: delay timeout\n  ptp4l[8330.999]: delay filtered 689 raw 687\n  ptp4l[8331.884]: master offset 35 s3 freq -371 path delay 689\n  ptp4l[8332.885]: master offset 47 s3 freq -349 path delay 689\n  ptp4l[8333.885]: master offset 50 s3 freq -332 path delay 689\n  ptp4l[8334.885]: master offset 22 s3 freq -345 path delay 689\n  Master\u7aeflog:\n  ptp4l[3469.136]: config item /var/run/ptp4l.inhibit_delay_req is 1\n  ptp4l[3469.136]: config item (null).uds_address is '/var/run/ptp4l'\n  ptp4l[3469.136]: port 0: INITIALIZING to LISTENING on INIT_COMPLETE\n  ptp4l[3469.136]: config item (null).slaveOnly is 0\n  ptp4l[3469.136]: port 1: received link status notification\n  ptp4l[3469.136]: interface index 2 is up\n  ptp4l[3469.261]: port 1: master sync timeout\n  ptp4l[3469.386]: port 1: master sync timeout\n  ptp4l[3469.511]: port 1: master sync timeout\n  ptp4l[3469.636]: port 1: master sync timeout\n  ptp4l[3469.761]: port 1: master sync timeout\n  ptp4l[3469.886]: port 1: master sync timeout\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5168\u5c40\u65f6\u95f4\u6e90\u914d\u7f6e",children:"\u5168\u5c40\u65f6\u95f4\u6e90\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"\u7531\u4e8e\u5f53\u524d\u7cfb\u7edf\u4e2d\u5b58\u5728\u591a\u4e2atimeline\uff0c\u6bd4\u5982systime\u3001phc\u3001rtc\u7b49\uff0c\u800c\u5404\u4e2a\u6a21\u5757\u652f\u6301\u9009\u62e9\u4e0d\u540c\u7684timeline\u6765\u6253\u5370\u5404\u81ea\u7684\u65f6\u95f4\u6233\u3002\u4e3a\u4e86\u7edf\u4e00\u5404\u4e2a\u6a21\u5757\u7684\u65e5\u5fd7\u4e2d\u65f6\u95f4\u6233\u7684timeline\uff0c\u6dfb\u52a0\u4e86\u4e00\u4e2ahb_systime\u7684\u6a21\u5757\uff0c\u6765\u7edf\u4e00\u7cfb\u7edf\u5404\u4e2a\u6a21\u5757\u7684timeline\u7684\u9009\u62e9\u3002\u8be5\u6a21\u5757\u5b9e\u73b0\u7684\u5177\u4f53\u529f\u80fd\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"\u89e3\u6790dts\u91cc\u9ed8\u8ba4\u7684timeline\u7684\u914d\u7f6e\uff0c\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'  globaltime: globaltime {\n    compatible = "hobot,globaltime";\n    globaltime = <2>; /* 0-systime, 1-phc, 2-rtc */\n    phc-index = <0>; /* phc index */\n    status = "okay";\n  };\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u5176\u4e2ddts\u4e2d globaltime \u5c5e\u6027\u8868\u793a\u7cfb\u7edf\u9ed8\u8ba4\u7528\u7684\u5168\u5c40timeline\uff0cS100\u9ed8\u8ba4\u4f7f\u7528RTC\u65f6\u95f4\u3002\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  0:systime\n  1:phc\n  2:rtc\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679ctimeline\u9009\u4e2d\u7f51\u5361phc\u65f6\u95f4\uff0c \u5219\u901a\u8fc7phc-index\u5c5e\u6027\u8fdb\u4e00\u6b65\u5224\u65ad\u5f53\u524d\u4f7f\u7528\u54ea\u4e2a\u7f51\u5361phc\u7684\u65f6\u95f4\u3002\u5bf9\u5e94\u5173\u7cfb\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  0:phc0\n  1:phc1\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5411\u5e94\u7528\u5c42\u63d0\u4f9b/sys\u63a5\u53e3\u7528\u6765\u8bbe\u7f6e\u6216\u8005\u83b7\u53d6\u5f53\u524d\u7cfb\u7edf\u5168\u5c40\u7684timeline\u7684\u9009\u62e9\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u5168\u5c40\u7684timeline\u7684\u914d\u7f6e\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  cat /sys/devices/platform/soc/soc:globaltime/globaltime\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8bbe\u7f6e\u7cfb\u7edf\u5168\u5c40timeline\u7684\u9009\u9879\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  echo 0 >/sys/devices/platform/soc/soc:globaltime/globaltime\n  \u6216\n  echo 1 >/sys/devices/platform/soc/soc:globaltime/globaltime\n  \u6216\n  echo 2 >/sys/devices/platform/soc/soc:globaltime/globaltime\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5411\u5e94\u7528\u5c42\u63d0\u4f9b/sys\u63a5\u53e3\u7528\u6765\u8bbe\u7f6e\u6216\u8005\u83b7\u53d6\u5f53\u524d\u9009\u4e2d\u7684phc\u7f16\u53f7"}),"\n",(0,l.jsx)(n.p,{children:"\u67e5\u770b\u5f53\u524d\u9009\u4e2d\u7684phc\u7f16\u53f7\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  cat /sys/devices/platform/soc/soc:globaltime/phcindex\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u8bbe\u7f6ephc\u7f16\u53f7\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  echo 0 >/sys/devices/platform/soc/soc:globaltime/phcindex\n  \u6216\n  echo 1 >/sys/devices/platform/soc/soc:globaltime/phcindex\n"})}),"\n",(0,l.jsx)("div",{style:{borderLeft:"4px solid orange",background:"#fff7f0",padding:"10px",borderRadius:"8px"},children:(0,l.jsxs)(n.p,{children:["\ud83d\udccd ",(0,l.jsx)("strong",{children:"\u6ce8\u610f\uff1a"})," phcindex\u8bbe\u7f6e\u4e0d\u8981\u8d85\u8fc7\u7f51\u5361\u5b9e\u9645\u6570\u91cf\u3002"]})}),"\n",(0,l.jsx)(n.p,{children:"\u5411\u5185\u6838\u5176\u4ed6\u6a21\u5757\u63d0\u4f9b\u63a5\u53e3\uff0c\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u7528\u7684\u54ea\u4e2atimeline\uff0c\u4ee5\u53ca\u4f7f\u7528\u7684\u662f\u54ea\u4e2aphc\uff0c\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  int32_t hobot_get_global_time_type(uint32_t *global_time_type);\n  int32_t hobot_get_phc_index(uint32_t *phc_index);\n"})}),"\n",(0,l.jsx)(n.h2,{id:"mcu\u65f6\u95f4\u540c\u6b65\u8bf4\u660e",children:"MCU\u65f6\u95f4\u540c\u6b65\u8bf4\u660e"}),"\n",(0,l.jsx)(n.h3,{id:"mcu\u652f\u6301\u7684\u65f6\u95f4\u7c7b\u578b",children:"MCU\u652f\u6301\u7684\u65f6\u95f4\u7c7b\u578b"}),"\n",(0,l.jsx)(n.p,{children:"PHC\u65f6\u95f4\uff1a\u8fd9\u4e2a\u662f\u7f51\u5361\u5185\u90e8\u7684\u4e00\u4e2a\u8ba1\u65f6\u5668\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"RTC\u65f6\u95f4\uff1a\u8fd9\u4e2a\u662fS100 MCU\u4fa7\u5e26\u7684\u4e00\u4e2a\u5b9e\u65f6\u65f6\u949f\uff0c\u4e0d\u652f\u6301\u901a\u8fc7\u7ebd\u6263\u7535\u6c60\u4f9b\u7535\uff1b"}),"\n",(0,l.jsx)(n.h3,{id:"mcu\u652f\u6301\u7684\u65f6\u95f4\u540c\u6b65\u65b9\u5f0f",children:"MCU\u652f\u6301\u7684\u65f6\u95f4\u540c\u6b65\u65b9\u5f0f"}),"\n",(0,l.jsx)(n.p,{children:"MCU\u652f\u6301\u4e0b\u9762\u7684\u65f6\u95f4\u540c\u6b65\u65b9\u5f0f:"}),"\n",(0,l.jsx)(n.p,{children:"\u57fa\u4e8ePPS\u7684Timesync\uff1a\u5728\u79d2\u8109\u51b2\u4e0a\u5347\u6cbf\u6355\u6349\u5230\u4e24\u4e2a\u65f6\u95f4\u7684snapshot\uff0c\u6839\u636esnapshot\u8ba1\u7b97\u8bef\u5dee\uff0c\u6839\u636e\u8bef\u5dee\u8fdb\u884c\u65f6\u95f4\u540c\u6b65 \uff1b"}),"\n",(0,l.jsx)(n.h3,{id:"\u57fa\u4e8epps\u7684timesync",children:"\u57fa\u4e8ePPS\u7684Timesync"}),"\n",(0,l.jsx)(n.p,{children:"\u4ee3\u7801\u76ee\u5f55\uff1a mcu/Service/TimeSync/src/"}),"\n",(0,l.jsx)(n.h4,{id:"\u652f\u6301\u7684\u65f6\u95f4",children:"\u652f\u6301\u7684\u65f6\u95f4"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"RTC"}),"\n",(0,l.jsx)(n.li,{children:"PHC"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u914d\u7f6e\u65b9\u6cd5",children:"\u914d\u7f6e\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.p,{children:"\u901a\u8fc7\u4fee\u6539\u914d\u7f6e\u51b3\u5b9a\u4f7f\u7528\u54ea\u79cd\u65f6\u95f4\u540c\u6b65\u65b9\u5f0f\u3002\u914d\u7f6e\u4ee3\u7801\u5728./Service/TimeSync/src/Hobot_TimeSync.c\u6587\u4ef6\u4e2d\u3002\u76ee\u524d\u53ea\u662f\u652f\u6301\u4e0b\u9762\u4e00\u79cd\u65f6\u95f4\u540c\u6b65\u65b9\u5f0f\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"PHC\u540c\u6b65RTC"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  /*TimeSync Config Begin*/\n  uint8 ConfigSource[] = {\n    TIMEKEEPER_NONE, //TimeKeeperRTC Source\n    TIMEKEEPER_NONE, //TimeKeeperGPS Source\n    TIMEKEEPER_NONE, //TimeKeeperStbmPhc Source //Not Used in S100\n    TIMEKEEPER_NONE, //TimeKeeperSpi Source\n    TIMEKEEPER_NONE, //TimeKeeperIPC Source\n    TIMEKEEPER_NONE, //TimeKeeperPHC Source\n    TIMEKEEPER_NONE //TimeKeeperGpt Source //Not Used in S100\n  };\n\n  _Bool EnableTimeKeeper[] = {\n    FALSE,//TimeKeeperRTC\n    FALSE,//TimeKeeperGPS\n    FALSE,//TimeKeeperStbmPhc //Not Used in S100\n    FALSE,//TimeKeeperSpi\n    FALSE,//TimeKeeperIPC\n    FALSE,//TimeKeeperPHC\n    FALSE//TimeKeeperGpt //Not Used in S100\n  };\n\n  _Bool Enable_TimeSync_RTC_Once= FALSE;\n\n  _Bool Enable_HobotTimesync_Debug = FALSE;\n  _Bool EthTsync_Master_Use_Phc = TRUE;\n  uint8 TimeSync_PPS_Index = TIMESYNC_MCU_ETH0_PPS;\n\n  /*TimeSync Config End*/\n"})}),"\n",(0,l.jsx)(n.p,{children:"ConfigSource\uff1a\u914d\u7f6e\u6bcf\u4e2a\u65f6\u95f4\u7684\u65f6\u95f4\u6e90\uff0c\u5982\u679c\u4e00\u4e2a\u65f6\u95f4\u4e0d\u9700\u8981\u548c\u5176\u4ed6\u65f6\u95f4\u540c\u6b65\uff0c\u65f6\u95f4\u6e90\u914d\u7f6e\u6210TIMEKEEPER_NONE\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u53ef\u4ee5\u914d\u7f6e\u7684\u65f6\u95f4\u6e90\u4e3a \uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  typedef enum TimeKeeperIndexEnum {\n    TIMEKEEPER_RTC_INDEX,\n    TIMEKEEPER_GPS_INDEX,\n    TIMEKEEPER_STBMPHC_INDEX, //Not Used in S100\n    TIMEKEEPER_SPI_INDEX,\n    TIMEKEEPER_IPC_INDEX,\n    TIMEKEEPER_PHC_INDEX,\n    TIMEKEEPER_STBMGPT_INDEX, //Not Used in S100\n    TIMEKEEPER_NONE,\n    TIMEKEEPER_NUM_MAX,\n  } TimeKeeperIndex;\n"})}),"\n",(0,l.jsx)(n.p,{children:"EnableTimeKeeper\uff1a \u914d\u7f6e\u65f6\u95f4\u662f\u5426\u6253\u5f00 \uff1b"}),"\n",(0,l.jsx)(n.p,{children:"Enable_HobotTimesync_Debug\uff1a \u914d\u7f6e\u662f\u5426\u5f00\u542f\u6253\u5370 \uff1b"}),"\n",(0,l.jsx)(n.p,{children:"TimeSync_PPS_Index\uff1a \u914d\u7f6e\u4f7f\u7528\u54ea\u4e2aPPS\u8fdb\u884c\u65f6\u95f4\u540c\u6b65\uff0c\u53ef\u4ee5\u4f7f\u7528\u7684PPS\u5982\u4e0b \uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  #define TIMESYNC_AON_RTC_PPS 0\n  #define TIMESYNC_PPS0 2\n  #define TIMESYNC_PPS1 3\n  #define TIMESYNC_PPS2 4\n  #define TIMESYNC_PCIE0_PTM_PPS 6\n  #define TIMESYNC_PCIE1_PTM_PPS 7\n  #define TIMESYNC_ACORE_ETH0_PPS 8\n  #define TIMESYNC_ACORE_ETH1_PPS 9\n  #define TIMESYNC_MCU_ETH0_PPS 10\n  #define TIMESYNC_PPS_DISABLE 11\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u914d\u7f6e\u4e3e\u4f8b",children:"\u914d\u7f6e\u4e3e\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c\u60f3\u914d\u7f6eRTC\u548cGPS\u8fdb\u884c\u65f6\u95f4\u540c\u6b65\uff0c \u914d\u7f6e\u5982\u4e0b:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  /*TimeSync Config Begin*/\n  uint8 ConfigSource[] = {\n    TIMEKEEPER_GPS_INDEX, //TimeKeeperRTC Source\n    TIMEKEEPER_NONE, //TimeKeeperGPS Source\n    TIMEKEEPER_NONE, //TimeKeeperStbmPhc Source //Not Used in S100\n    TIMEKEEPER_NONE, //TimeKeeperSpi Source\n    TIMEKEEPER_NONE, //TimeKeeperIPC Source\n    TIMEKEEPER_NONE, //TimeKeeperPHC Source\n    TIMEKEEPER_NONE //TimeKeeperGpt Source //Not Used in S100\n  };\n\n  _Bool EnableTimeKeeper[] = {\n    TRUE,//TimeKeeperRTC\n    TRUE,//TimeKeeperGPS\n    FALSE,//TimeKeeperStbmPhc //Not Used in S100\n    FALSE,//TimeKeeperSpi\n    FALSE,//TimeKeeperIPC\n    FALSE,//TimeKeeperPHC\n    FALSE//TimeKeeperGpt //Not Used in S100\n  };\n\n  _Bool Enable_TimeSync_RTC_Once= FALSE;\n\n  _Bool Enable_HobotTimesync_Debug = FALSE;\n  /*TimeSync Config End*/\n"})}),"\n",(0,l.jsx)(n.h2,{id:"PPS",children:"PPS\u8bf4\u660e"}),"\n",(0,l.jsx)(n.h3,{id:"s100-pps-\u4ecb\u7ecd",children:"S100 PPS \u4ecb\u7ecd"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_s100/image43.png",alt:""})}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u4e0a\u56fe\u6240\u793a\uff0cS100\u4e0a\u7684PPS\u53ef\u4ee5\u5206\u4e3aPPS Source\u548cPPS Target\u3002PPS Source\u4ea7\u751fPPS\uff0c\u7ecf\u8fc7\u4e2d\u95f4\u7684Trigger Bus\u9001\u5230PPS Target\uff0cPPS Target\u5229\u7528\u9001\u6765\u7684PPS\u4ea7\u751fsnapshot\u6216\u8005LPWM\u6ce2\u5f62\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"pps-target",children:"PPS Target"}),"\n",(0,l.jsx)(n.p,{children:"PPS Target\u8868\u793a\u88abPPS\u89e6\u53d1\u7684\u5bf9\u8c61\uff0c\u7528\u4e8e\u4ea7\u751fsnapshot\u6216\u8005LPWM\u6ce2\u5f62\uff0cS100\u4f7f\u7528PPS\u89e6\u53d1\u7684\u5bf9\u8c61\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"PPS OUT\uff1aPPS2\u7684\u7ba1\u811a\u590d\u7528\u5728\u5f53\u524d\u8f6f\u4ef6\u7248\u672c\u4e0a\u9ed8\u8ba4\u662f\u8bbe\u7f6e\u4e3aPPS OUT\u7684\uff0c\u5373\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2apad\u811a\u5c06\u82af\u7247\u5185\u7684PPS\u5411\u5916\u8f93\u51fa\u5230\u7247\u5916\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"GIC\uff1a\u5f53\u524d\u8f6f\u4ef6\u7248\u672c\u9ed8\u8ba4\u5c06MCU RTC\uff0cPPS0\uff0cPPS1\uff0cPPS2\u548cMCU ETH PPS\u7684\u4e2d\u65ad\u7ed9\u5230\u4e86GIC\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"Acore ETH\uff1aAcore ETH\u53ef\u4ee5\u63a5\u53d7PPS\u6e90\uff0c\u5e76\u901a\u8fc7PPS\u6253\u81ea\u8eab\u786c\u4ef6\u7684snapshot\u65f6\u95f4\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"LPWM\uff1aLPWM\u53ef\u4ee5\u63a5\u53d7PPS\u6e90\u8f93\u5165\uff0c\u5e76\u901a\u8fc7PPS\u4ea7\u751f\u5bf9\u5e94\u7684LPWM\u6ce2\u5f62\uff1b"}),"\n",(0,l.jsx)(n.h3,{id:"pps-source",children:"PPS Source"}),"\n",(0,l.jsx)(n.p,{children:"S100\u7684PPS source\u6709\u591a\u4e2a\u6e90\u53ef\u9009\uff0c\u5176\u4e2d\u5e38\u7528\u7684\u6e90\u6709\u4ee5\u4e0b\u51e0\u4e2a\uff0c\u5176\u5b83\u662freserve\u7684\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u53f70\uff1aMCU RTC PPS\uff0c\u662fMCU\u4fa7RTC\u8f93\u51fa\u7684PPS\uff0c\u5f53\u524d\u8f6f\u4ef6\u7248\u672c\u9ed8\u8ba4\u5df2\u6709\u8f93\u51fa\uff0c\u5468\u671f1\u79d21\u6b21\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u53f72\uff1aPPS0\uff0cPPS\u7684pad\uff0c\u53ef\u7528\u4e8eGPS PPS\u7b49\u5916\u90e8PPS\u6e90\u8f93\u5165\u5230\u82af\u7247\u5185\u90e8\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u53f73\uff1aPPS1\uff0cPPS\u7684pad\uff0c\u53ef\u7528\u4e8eGPS PPS\u7b49\u5916\u90e8PPS\u6e90\u8f93\u5165\u5230\u82af\u7247\u5185\u90e8\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u53f74\uff1aPPS2\uff0cPPS\u7684pad\uff0c\u53ef\u7528\u4e8eGPS PPS\u7b49\u5916\u90e8PPS\u6e90\u8f93\u5165\u5230\u82af\u7247\u5185\u90e8\uff0c\u4e5f\u53ef\u4ee5\u7528\u4e8e\u5c06\u5185\u90e8\u7684PPS\u8f93\u51fa\u5230\u5916\u90e8\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u53f78\uff1aAcore Eth0 PPS\uff0c \u662fAcore Eth0\u4ea7\u751f\u7684PPS\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u7075\u6d3b\u7684\u65f6\u95f4\u5468\u671f\uff0c\u6bd4\u59821\u79d21\u6b21\uff0c400\u6beb\u79d21\u6b21\u7b49\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u53f79\uff1aAcore Eth1 PPS\uff0c \u662fAcore Eth1\u4ea7\u751f\u7684PPS\uff1b\u53ef\u4ee5\u8bbe\u7f6e\u7075\u6d3b\u7684\u65f6\u95f4\u5468\u671f\uff0c\u6bd4\u59821\u79d21\u6b21\uff0c400\u6beb\u79d21\u6b21\u7b49\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u53f710\uff1aMCU Eth PPS\uff0c\u662fMCU\u4fa7Eth\u8f93\u51fa\u7684PPS\uff0c\u5f53\u524d\u8f6f\u4ef6\u7248\u672c\u9ed8\u8ba4\u5df2\u6709\u8f93\u51fa\uff0c\u5468\u671f1\u79d21\u6b21;"}),"\n",(0,l.jsx)(n.h3,{id:"pps\u7684pad\u914d\u7f6e",children:"PPS\u7684PAD\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"\u5f53\u524d\u8f6f\u4ef6\u7248\u672c\u9ed8\u8ba4\u5c06PPS0\u548cPPS1\u8bbe\u7f6e\u4e3a\u4e86PPS\u7684IN\uff0c\u5373\u7528\u4e8e\u63a5\u6536GPS PPS\u7b49\u5916\u90e8PPS\u7684\u8f93\u5165\uff1b\u628aPPS2\u8bbe\u7f6e\u4e3a\u4e86PPS\u7684OUT\uff0c\u5373\u5c06S100\u82af\u7247\u7684PPS\u8f93\u51fa\u5230\u5916\u90e8\uff1b\n\u5b83\u4eec\u7684\u914d\u7f6e\u5747\u7531MCU\u4fa7\u7684Port\u6a21\u5757\u8fdb\u884c\u4e86\u914d\u7f6e\uff0c\u5982\u9700\u8981\u4fee\u6539\uff0c\u5219\u5728Port\u6a21\u5757\u4e2d\u8fdb\u884c\u4fee\u6539\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"Acore_Eth_PPS",children:"Acore Eth PPS\u4ecb\u7ecd"}),"\n",(0,l.jsx)(n.p,{children:"Acore Eth PPS\u6709\u4e24\u79cd\u8f93\u51fa\u65b9\u6cd5\uff0cflex mode\u548cfix mode\u4e24\u79cd\u3002\u4e0a\u7535\u9ed8\u8ba4\u662ffix mode\u3002\u53ef\u4ee5\u901a\u8fc7\u4e0b\u6587\u4e2dethtool\u547d\u4ee4\u8bbe\u7f6e\u4e3aflex mode\u3002\u82e5\u8981\u91cd\u7f6e\u4e3afix mode\uff0c\u53ef\u4ee5\u901a\u8fc7\u91cd\u542f\u7f51\u5361\u6216\u8005\u91cd\u542f\u7cfb\u7edf\u5b8c\u6210\u6062\u590d\u3002"}),"\n",(0,l.jsx)(n.p,{children:"flex mode: \u7075\u6d3b\u7684pps\u6a21\u5f0f\uff0c\u5b83\u7684\u5f00\u59cb/\u7ed3\u675f\u65f6\u95f4\u3001\u5468\u671f\u3001\u5360\u7a7a\u6bd4\u5747\u53ef\u4ee5\u7075\u6d3b\u914d\u7f6e\uff0c\u5176\u4e0a\u5347\u6cbf\u662f\u6574\u79d2\u65f6\u523b\uff0cPPS\u8f93\u51fa\u4e0d\u4f1a\u968f\u7740PHC\u65f6\u95f4\u7684\u53d8\u5316\u800c\u53d8\u5316\uff1b\u5f53\u524d\u8f6f\u4ef6\u7248\u672c\u4e0b\uff0c\u5176\u5360\u7a7a\u6bd4\u662f\u767e\u5206\u4e4b\u4e00\uff0c\u5468\u671f\u53ef\u4ee5\u6839\u636e\u4e0b\u65b9\u914d\u7f6e\u65b9\u6cd5\u7075\u6d3b\u914d\u7f6e\uff0c\u5e38\u7528\u7684\u67091s\uff0c400ms\u3002"}),"\n",(0,l.jsx)(n.p,{children:"fixed mode: \u56fa\u5b9a\u7684pps\u6a21\u5f0f\uff0c\u5b83\u7684\u5468\u671f\u56fa\u5b9a\uff0c\u4e14\u5360\u7a7a\u6bd4\u4e5f\u56fa\u5b9a\u4e3a46.3129%\u3002PPS\u8f93\u51fa\u4f1a\u968f\u7740PHC\u65f6\u95f4\u7684\u53d8\u5316\u800c\u53d8\u5316\u3002\u5f53\u524d\u8f6f\u4ef6\u7248\u672c\u4e0b\uff0c\u5176\u652f\u63011s\u5468\u671f\uff0c\u6ce2\u5f62\u7684\u6574\u79d2\u65f6\u523b\u662f\u4e0b\u964d\u6cbf\uff0c\u7ecf\u8fc7536.871ms\u7684\u4f4e\u7535\u5e73\u540e\uff0c\u518d\u8f93\u51fa463.129ms\u7684\u9ad8\u7535\u5e73\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u6574\u79d2\u8f93\u51fa\u9700\u6c42\u914d\u7f6e\u65b9\u6cd5\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"\u82e5\u5728flex mode\u4e0b\u6709\u6574\u79d2\u65f6\u523b\u8f93\u51faPPS\u7684\u9700\u6c42\uff0c\u9700\u8981\u5728gptp\u65f6\u95f4\u540c\u6b65\u5b8c\u6210\u540e\uff0c\u518d\u914d\u7f6ePPS\u8f93\u51fa\uff1b"}),"\n",(0,l.jsx)(n.p,{children:"\u82e5\u5728fixed mode\u4e0b\u6709\u6574\u79d2\u65f6\u523b\u8f93\u51faPPS\u7684\u9700\u6c42\uff0c\u9700\u8981\u6ce8\u610fETH\u7684\u6574\u79d2\u65f6\u523b\u5728\u4e0b\u964d\u6cbf\u51fa\u73b0\uff0c\u800cLPWM\u88abETH\u4e0a\u5347\u6cbf\u540c\u6b65\u3002\u56e0\u6b64\u9700\u8981\u53c2\u8003\u4e0b\u56fe\uff0c\u8c03\u6574LPWM\u7684offset\u3002\u4ee5camera\u4e00\u79d230\u5e27\u4e3e\u4f8b\uff0cPPS\u4e0a\u5347\u6cbf\u5728536.871ms\uff0c\u4e0b\u964d\u6cbf\u57281s\u6574\u79d2\u5904\uff0c\u8981\u6c42\u5728\u6574\u79d2\u4f4d\u7f6e\u51fa\u56fe\u7684\u8bdd\uff0coffset=463.129\u5bf933.333\u53d6\u4f59\u6570=29.8ms\u3002"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_s100/image44.png",alt:""})}),"\n",(0,l.jsx)(n.h3,{id:"acore-eth-pps\u7684\u8f93\u51fa\u914d\u7f6e\u65b9\u6cd5",children:"Acore Eth PPS\u7684\u8f93\u51fa\u914d\u7f6e\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.p,{children:"Acore Eth PPS\u7684\u8f93\u51fa\uff0c\u53ef\u4ee5\u501f\u52a9ethtool\u5de5\u5177\uff0c\u547d\u4ee4\u683c\u5f0f\u5982\u4e0b :"}),"\n",(0,l.jsx)(n.p,{children:"\u914d\u7f6eEth0\u7684PPS\u8f93\u51fa1\u79d2\u7684\u5468\u671f\uff1aethtool hobot_gmac --set-flex-pps eth0 index 0 fpps on interval 1000000000;"}),"\n",(0,l.jsx)(n.p,{children:"\u914d\u7f6eEth1\u7684PPS\u8f93\u51fa1\u79d2\u7684\u5468\u671f\uff1aethtool hobot_gmac --set-flex-pps eth1 index 0 fpps on interval 1000000000;"}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c\u9700\u8981\u4fee\u6539\u8f93\u51fa\u5468\u671f\u7684\u8bdd\uff0c\u4fee\u6539\u6700\u540e\u4e00\u4e2a\u53c2\u6570<1000000000>\uff0c\u8be5\u53c2\u6570\u7684\u5355\u4f4d\u662fns\uff0c\u5982\u679c\u8981\u4fee\u6539\u4e3a400ms\u7684\u8bdd\uff0c\u5219\u6539\u4e3a<400000000>\u3002"}),"\n",(0,l.jsxs)(n.admonition,{type:"tip",children:[(0,l.jsx)(n.p,{children:"\u914d\u7f6eeth pps\u8f93\u51fa\u9700\u8981\u6ce8\u610f\u7684\u4e24\u70b9\uff0c\u4e0b\u9762\u4ee5\u4fee\u6539eth pps0\u5e76\u8bbe\u7f6ePPS_INOUT\u811a\u4e3aPPS_OUT\u529f\u80fd\u4e3a\u4f8b\u8fdb\u884c\u8bf4\u660e\u3002\u5982\u679c\u6709\u5176\u4ed6\u9700\u6c42\uff0c\u7528\u6237\u8bf7\u6839\u636e\u5b9e\u9645\u4f7f\u7528\u8c03\u6574\u914d\u7f6e\u9879\u3002"}),(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u4fee\u6539Port\u914d\u7f6e\u7684\u9ed8\u8ba4pps_source"}),"\n"]}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:" static const Port_Lld_PpsConfigType PpsConfig =\n {\n     (boolean)TRUE,\n-    PPS_SOURCE_AON_RTC,\n+    PPS_SOURCE_ETH0_PTP,\n };\n"})}),(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"\u5c06pin\u811a\u914d\u7f6e\u6210PPS_OUT func"}),"\n"]}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'-    {(uint8)2, "PPS_OUT", (boolean)TRUE, {(boolean)TRUE, (boolean)FALSE, (boolean)TRUE, (boolean)TRUE, (boolean)TRUE, GPIO, PORT_PIN_CONFIG_TYPE0, PORT_PULL_NONE, PORT_DRIVE_DEFAULT, PORT_PIN_DIR_OUT, PORT_PIN_LEVEL_HIGH}},\n+    {(uint8)2, "PPS_OUT", (boolean)TRUE, {(boolean)TRUE, (boolean)FALSE, (boolean)TRUE, (boolean)TRUE, (boolean)TRUE, PPS_OUT, PORT_PIN_CONFIG_TYPE0, PORT_PULL_NONE, PORT_DRIVE_DEFAULT, PORT_PIN_DIR_OUT, PORT_PIN_LEVEL_HIGH}},\n'})}),(0,l.jsxs)(n.p,{children:["\u4ee5\u4e0a\u901a\u8fc7\u4fee\u6539",(0,l.jsx)(n.code,{children:"McalCdd/gen_s100_sip_B/Port/src/Port_PBcfg.c"}),"\u5b9e\u73b0\uff0c\u4fee\u6539\u5b8c\u6210\u540e\u66f4\u65b0MCU\u56fa\u4ef6\u5373\u53ef\u3002"]})]}),"\n",(0,l.jsx)(n.h3,{id:"mcu-eth-pps\u7684\u914d\u7f6e\u65b9\u6cd5",children:"MCU Eth PPS\u7684\u914d\u7f6e\u65b9\u6cd5"}),"\n",(0,l.jsxs)(n.p,{children:["MCU Eth PPS\u7684\u4fe1\u53f7\u5468\u671f\u548c\u8109\u51b2\u5bbd\u5ea6\u5728",(0,l.jsx)(n.code,{children:"Config/McalCdd/gen_s100_sip_B_mcu1/Ethernet/src/Mac_Ip_PBcfg.c"}),"\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u9ed8\u8ba4\u503c\uff0c\u5176\u4e2dPpsInterval\u7684\u9ed8\u8ba4\u503c\u4e3a1000(ms)\uff0c\u53c2\u6570PpsWidth\u7684\u9ed8\u8ba4\u503c\u4e3a10(ms)\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u9650\u5236\u6761\u4ef6\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u914d\u7f6e\u9879EthGlobalTimeSupport\u9700\u8981\u88ab\u4f7f\u80fd\uff0c\u9ed8\u8ba4\u4f7f\u80fd\uff1b"}),"\n",(0,l.jsx)(n.li,{children:"\u53c2\u6570PpsWidth\u7684\u503c\u5fc5\u987b\u5c0f\u4e8ePpsInterval\uff1b"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u914d\u7f6e\u4f7f\u80fd\u540e\u901a\u8fc7\u67e5\u770bsys\u8282\u70b9assert\u53d8\u5316\u786e\u8ba4PPS\u914d\u7f6e\u662f\u5426\u751f\u6548\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"cat /sys/class/pps/pps[4]/assert\n"})}),"\n",(0,l.jsx)(n.p,{children:"/sys/class/pps\u4e0b\u5305\u542b\u591a\u4e2apps\uff0c\u901a\u8fc7name\u786e\u8ba4\u54ea\u4e2aPPS\u5bf9\u5e94MCU PPS\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"cat /sys/class/pps/pps[*]/name\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u65f6\u95f4\u540c\u6b65\u6574\u4f53\u65b9\u6848",children:"\u65f6\u95f4\u540c\u6b65\u6574\u4f53\u65b9\u6848"}),"\n",(0,l.jsx)(n.h3,{id:"\u529f\u80fd\u6982\u8ff0",children:"\u529f\u80fd\u6982\u8ff0"}),"\n",(0,l.jsx)(n.p,{children:"\u672c\u6587\u4e3b\u8981\u4ee5S100\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u65f6\u95f4\u540c\u6b65\u65b9\u6848\u3002\u76ee\u524dMCU\u4e3b\u7ebf\u9ed8\u8ba4\u652f\u6301\u7684\u662f\u65f6\u95f4\u6e90\u63a5\u5165S100\nAcore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"\u8f6f\u4ef6\u67b6\u6784\u8bf4\u660e",children:"\u8f6f\u4ef6\u67b6\u6784\u8bf4\u660e"}),"\n",(0,l.jsx)(n.h5,{id:"\u65f6\u95f4\u6e90\u63a5\u5165acore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848",children:"\u65f6\u95f4\u6e90\u63a5\u5165Acore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848"}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_s100/image45.png",alt:""})}),"\n",(0,l.jsx)(n.p,{children:"\u4e0a\u56fe\u65f6\u95f4\u540c\u6b65\u6d41\u7a0b\u603b\u7ed3\u5982\u4e0b\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u5916\u90e8gptp master\u8bbe\u5907\u4f5c\u4e3a\u6574\u4e2aS100\u7684\u65f6\u95f4\u6e90\uff1b"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u9996\u5148\u901a\u8fc7ptp4l\u8f6f\u4ef6\u5c06gptp master\u7684\u65f6\u95f4\u540c\u6b65\u7ed9Acore\u4fa7\u7684\u7f51\u5361\uff1b\u7136\u540e\u901a\u8fc7phc2sys\u5c06\u7f51\u5361\u65f6\u95f4\u540c\u6b65\u7ed9Linux\u7cfb\u7edf\u65f6\u95f4\uff0c\u8be5\u8fc7\u7a0b\u6301\u7eed\u8fdb\u884c\uff1b"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\u901a\u8fc7Acore timesync_sample\u8f6f\u4ef6\u5c06\u7f51\u5361\u65f6\u95f4\u540c\u6b65\u7ed9MCU\u4fa7Rtc\uff1b"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u7279\u6027\u8bf4\u660e\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Rtc\u652f\u6301\u7ed9\u56fe\u4e2d\u7684CIM\u548cCAN\u6253\u786c\u4ef6\u65f6\u95f4\u6233\uff1b"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Acore \u7f51\u5361\u53ef\u4ee5\u53d1\u51fapps\uff0c\u89e6\u53d1lpwm\u8fdb\u884c\u66dd\u5149\u540c\u6b65\uff1b"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u4ee3\u7801\u4f4d\u7f6e\u53ca\u76ee\u5f55\u7ed3\u6784",children:"\u4ee3\u7801\u4f4d\u7f6e\u53ca\u76ee\u5f55\u7ed3\u6784"}),"\n",(0,l.jsxs)(n.p,{children:["Acore\u4fa7timesync sample\u4ee3\u7801\u4f4d\u4e8e\u5de5\u7a0b\u76ee\u5f55\uff1a",(0,l.jsx)(n.code,{children:"{sdk_dir}/source/hobot-sp-samples/debian/app/timesync_demo"})]}),"\n",(0,l.jsxs)(n.p,{children:["MCU\u4fa7timesync sample\u4ee3\u7801\u4f4d\u4e8e\u5de5\u7a0b\u76ee\u5f55\uff1a",(0,l.jsx)(n.code,{children:"{mcu_dir}/mcu/Service/TimeSync"})]}),"\n",(0,l.jsx)(n.h3,{id:"acore\u7f16\u8bd1",children:"Acore\u7f16\u8bd1"}),"\n",(0,l.jsx)(n.h4,{id:"\u7f16\u8bd1\u73af\u5883",children:"\u7f16\u8bd1\u73af\u5883"}),"\n",(0,l.jsx)(n.p,{children:"\u677f\u7aef\u5728\u5b89\u88c5hobot-sp-samples_*.deb\u5305\u540e\uff0c\u4f1a\u5305\u542bcodec_demo\u6e90\u7801\u5185\u5bb9\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"\u7f16\u8bd1\u8bf4\u660e",children:"\u7f16\u8bd1\u8bf4\u660e"}),"\n",(0,l.jsx)(n.p,{children:"\u672csample\u4e3b\u8981\u4f9d\u8d56ipcfhal\u548ctimesync\u63d0\u4f9b\u7684API\u5934\u6587\u4ef6"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'#include "hb_ipcf_hal.h"\n#include "hobot_clock_hal.h"\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u8bd1\u4f9d\u8d56\u7684\u5e93\u6709\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  LIBS := -lhbipcfhal -lhbtimesynchal -lpthread -lalog\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u8bd1\u547d\u4ee4\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"\u677f\u7aef\u8fdb\u5165/app/timesync_demo/sample_timesync\u76ee\u5f55\uff0c\u6267\u884c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  make\n"})}),"\n",(0,l.jsx)(n.h3,{id:"mcu\u7f16\u8bd1",children:"MCU\u7f16\u8bd1"}),"\n",(0,l.jsx)(n.h4,{id:"\u7f16\u8bd1\u73af\u5883-1",children:"\u7f16\u8bd1\u73af\u5883"}),"\n",(0,l.jsxs)(n.p,{children:["MCU\u4fa7\u672csample\u7684\u7f16\u8bd1\u73af\u5883\u4f7f\u7528MCU\u4ee3\u7801\u4e2d\u7684build\u5de5\u5177\uff0c\u8bf7\u53c2\u8003\uff1a",(0,l.jsx)(n.a,{href:"/rdk_doc/en/rdk_s/Advanced_development/mcu_development/S100/basic_information#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83",children:"MCU\u7f16\u8bd1"}),"\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u8bd1FreeRtos\u955c\u50cf\u7248\u672c\u3002\u6ce8\u610f"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  # \u8fdb\u5165Build/FreeRtos\u76ee\u5f55\n  python build_freertos.py s100_sip_B debug # \u786c\u4ef6\u677f\u6216\u8005\u9879\u76ee\u540d\n"})}),"\n",(0,l.jsx)(n.h4,{id:"\u8fd0\u884c",children:"\u8fd0\u884c"}),"\n",(0,l.jsx)(n.h5,{id:"\u652f\u6301\u5e73\u53f0",children:"\u652f\u6301\u5e73\u53f0"}),"\n",(0,l.jsx)(n.p,{children:"S100"}),"\n",(0,l.jsx)(n.h5,{id:"\u677f\u7aef\u90e8\u7f72\u53ca\u914d\u7f6e",children:"\u677f\u7aef\u90e8\u7f72\u53ca\u914d\u7f6e"}),"\n",(0,l.jsx)(n.p,{children:"\u9700\u8981\u505a\u597d\u5982\u4e0b\u51c6\u5907\u5de5\u4f5c\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"\u70e7\u5199\u597d\u652f\u6301MCU\u4fa7\u65f6\u95f4\u540c\u6b65\u670d\u52a1\u7684MCU\u56fa\u4ef6\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u82e5\u9700\u8981\u8fd0\u884cgptp\u65f6\u95f4\u540c\u6b65\uff0c\u9700\u8981\u4fdd\u8bc1\u7f51\u7edc\u8fde\u901a\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u4e3a\u4e86\u9632\u6b62Linux\u64cd\u4f5c\u7cfb\u7edf\u81ea\u5e26\u65f6\u95f4\u540c\u6b65\u670d\u52a1\u4ea7\u751f\u5e72\u6270\uff0c\u9700\u8981\u6267\u884c\u5982\u4e0b\u547d\u4ee4\u5173\u95edLinux\u81ea\u5e26\u65f6\u95f4\u540c\u6b65\u670d\u52a1\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  systemctl stop systemd-timesyncd\n"})}),"\n",(0,l.jsx)(n.h5,{id:"\u8fd0\u884c\u6307\u5357",children:"\u8fd0\u884c\u6307\u5357"}),"\n",(0,l.jsx)(n.h6,{id:"\u65f6\u95f4\u6e90\u63a5\u5165acore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848-1",children:"\u65f6\u95f4\u6e90\u63a5\u5165Acore\u7684\u5355\u65f6\u95f4\u57df\u65b9\u6848"}),"\n",(0,l.jsx)(n.p,{children:"MCU\u4fa7\u5728./Service/TimeSync/src/Hobot_TimeSync.c\u4ee3\u7801\u4e2d\u8fdb\u884c\u5982\u4e0b\u914d\u7f6e\u4fee\u6539\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"/* Timesync Config Begin */\nuint8_t ConfigSource[] = {\n    TIMEKEEPER_IPC_INDEX,   // TimeKeeperRTC Source\n    TIMEKEEPER_NONE,        // TimeKeeperGPS Source\n    TIMEKEEPER_IPC_INDEX,   // TimeKeeperStbmPhc Source\n    TIMEKEEPER_NONE,        // TimeKeeperSpi Source\n    TIMEKEEPER_NONE,        // TimeKeeperIPC Source\n    TIMEKEEPER_NONE,        // TimeKeeperPHC Source\n    TIMEKEEPER_NONE         // TimeKeeperGpt Source\n};\n\n_Bool EnableTimeKeeper[] = {\n    TRUE,\n    FALSE,\n    FALSE,\n    FALSE,\n    TRUE,\n    FALSE,\n    FALSE\n};\n\n_Bool Enable_TimeSync_RTC_Once = FALSE;\n\n_Bool Enable_HobotTimesync_Debug = TRUE;\n"})}),"\n",(0,l.jsx)(n.p,{children:"MCU\u4fa7\u7684\u4fee\u6539\u9700\u8981\u6ce8\u610f PRODUCT_IMAGE\u5b8f\u7684\u5f71\u54cd\uff0c\u8be6\u7ec6\u5185\u5bb9\u8bf7\u53c2\u8003\u4e0a\u8ff0\u6ce8\u610f\u4e8b\u9879\u7ae0\u8282\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u5237\u5199\u542f\u52a8\u540e\uff0c\u9ed8\u8ba4MCU\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u7b2c\u4e00\u6761\u547d\u4ee4\u6307\u5b9aPPS\u89e6\u53d1\u6e90\u4e3amcu eth\uff1b\u7b2c\u4e8c\u6761\u547d\u4ee4\u542f\u52a8\u65f6\u95f4\u540c\u6b65\u670d\u52a1"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"  TimeSyncCtrl 4 10\n  TimeSyncCtrl 6\n"})}),"\n",(0,l.jsxs)(n.admonition,{type:"tip",children:[(0,l.jsx)(n.p,{children:"MCU\u9ed8\u8ba4\u4e0d\u542f\u52a8\u65f6\u95f4\u540c\u6b65\u670d\u52a1\u3002\u5982\u679c\u914d\u7f6e\u9ed8\u8ba4\u542f\u52a8\uff0c\u9664\u4e86\u4fee\u6539\u4ee5\u4e0a\u63cf\u8ff0\u7684\u914d\u7f6e\uff0c\u53e6\u5916\u9700\u8981\u589e\u52a0\u521d\u59cb\u5316\u7684\u52a8\u4f5c\uff0c\u53c2\u8003\u5982\u4e0b\uff1a"}),(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"TASK(OsTask_SysCore_Startup)\n{\n  ......\n  Timesync_Init();\n  ......\n}\n"})}),(0,l.jsxs)(n.p,{children:["\u5b8c\u6210\u4ee5\u4e0a\u914d\u7f6e\uff0c\u5728\u52a0\u8f7dMCU1\u56fa\u4ef6\u540e\uff0c\u65f6\u95f4\u540c\u6b65\u670d\u52a1\u9ed8\u8ba4\u542f\u52a8\uff0c\u4e0d\u518d\u9700\u8981\u6267\u884c",(0,l.jsx)(n.code,{children:"TimeSyncCtrl"}),"\u7684\u547d\u4ee4\u3002"]})]}),"\n",(0,l.jsx)(n.p,{children:"Acore\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u7b2c\u4e00\u6761\u547d\u4ee4\u8bbe\u7f6elog\u7b49\u7ea7\uff0c\u5141\u8bb8\u8f93\u51fa\u6253\u5370\u5230\u63a7\u5236\u53f0\uff1b\u7b2c\u4e8c\u6761\u547d\u4ee4\u542f\u52a8ptp\u65f6\u95f4\u540c\u6b65\uff0c\u5c06\u5916\u90e8ptp master\u65f6\u95f4\u540c\u6b65\u5230Acore\u7f51\u5361\uff1b\n\u7b2c\u4e09\u6761\u547d\u4ee4\u5c06\u7f51\u5361\u65f6\u95f4\u540c\u6b65\u5230Linux\u7cfb\u7edf\u65f6\u95f4\uff1b\u7b2c\u4e94\u6761\u547d\u4ee4\u542f\u52a8\u65f6\u95f4\u540c\u6b65\u7a0b\u5e8f\uff0c\u5c06Acore\u7f51\u5361\u65f6\u95f4\u540c\u6b65\u7ed9MCU\u4fa7Rtc\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"ptp4l -i eth0 -f /usr/hobot/lib/pkgconfig/automotive-slave.cfg -m -l 7 > ptp4l.log &\nphc2sys -s eth0 -c CLOCK_REALTIME --transportSpecific=1 -m --step_threshold=1000 -w > phc2sys.log &\ncd /app/timesync_demo/sample_timesync\n./timesync_sample -p 0 -P 4 -r\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u5173\u952e\u53c2\u6570\u8bf4\u660e\uff1a"}),"\n",(0,l.jsx)(n.p,{children:"-p 1: \u540c\u6b65\u7f51\u53611\u7684\u65f6\u95f4\uff1b -p 0: \u540c\u6b65\u7f51\u53610\u7684\u65f6\u95f4(\u9ed8\u8ba4)"}),"\n",(0,l.jsx)(n.p,{children:"-r: \u5c06Acore\u7f51\u5361\u65f6\u95f4\u540c\u6b65\u7ed9MCU Rtc\u65f6\u95f4"}),"\n",(0,l.jsx)(n.p,{children:"Acore\u65f6\u95f4\u540c\u6b65log\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:510] ************************************************\n[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:517] Monotonic_raw time: second = 222, nanosecond = 557846725\n[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:520] PPS fetch infobuf time: second = 1745925136, nanosecond = 454616475\n[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:531] rtc snapshot: sec = 1745925136, nsec = 455389596\n[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:538] ptp0 snapshot: sec = 1745925136, nsec = 455462040\n[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:582] Timesync Info: timesync ipc send data succeed\n[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:510] ************************************************\n"})}),"\n",(0,l.jsx)(n.p,{children:"Acore log\u8bf4\u660e\uff1a"}),"\n",(0,l.jsx)(n.p,{children:'"snapshot"\u5b57\u6bb5\u4e3aMCU\u7f51\u5361\u53d1\u51fapps\u79d2\u8109\u51b2\u65f6\u5404\u4e2aclock\u5bf9\u5e94\u7684\u786c\u4ef6\u65f6\u95f4\u6233\uff1b'}),"\n",(0,l.jsx)(n.p,{children:'"PPS fetch infobuf time"\u5b57\u6bb5\u4e3aAcore pps\u9a71\u52a8\u6355\u83b7\u5230\u7684\u7cfb\u7edf\u65f6\u95f4\uff1b'}),"\n",(0,l.jsx)(n.p,{children:'"timesync ipc send data succeed"\u63d0\u793a\u8bf4\u660eAcore\u7f51\u5361\u65f6\u95f4\u6233\u6210\u529f\u53d1\u9001\u7ed9MCU\uff0c\u7531MCU\u4fa7\u8fdb\u884c\u65f6\u95f4\u540c\u6b65\uff0c\u65f6\u95f4\u540c\u6b65\u8d28\u91cf\u5728MCU\u4fa7\u67e5\u770b\u3002'}),"\n",(0,l.jsx)(n.p,{children:"MCU\u65f6\u95f4\u540c\u6b65log\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"[0162.799758 0]*\n[0162.802970 0]RTC snapshot time:1745925071.455114934\n[0163.000408 0]Timesync_RecvCallback.\n[0163.000661 0]Get Time From Acore success 1745925071 455188935\n[0163.001958 0]TimeKeeperRTC and TimeKeeperIPC Offset : - 0s.74001ns\n[0163.789774 0]*\n"})}),"\n",(0,l.jsx)(n.p,{children:"MCU log\u8bf4\u660e\uff1a"}),"\n",(0,l.jsx)(n.p,{children:'"Get Time From Acore success" \u8868\u660eMCU\u4eceAcore\u62ff\u65f6\u95f4\u6210\u529f\uff1b'}),"\n",(0,l.jsx)(n.p,{children:'"TimeKeeperRTC and TimeKeeperIPC Offset" \uff0c\u8868\u660e\u5728\u540c\u6b65\u65f6\uff0cRtc\u4f7f\u7528IPC\u65f6\u95f4\u540c\u6b65\u65f6\u7684offset\u3002'})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(p,{...e})}):p(e)}}}]);