"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[31900],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>o});var i=t(96540);const a={},r=i.createContext(a);function s(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),i.createElement(r.Provider,{value:n},e.children)}},61511:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>f,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"Advanced_development/linux_development/kernel_debug","title":"7.2.7 Introduction to Linux Debugging Features","description":"Analyzing ramdump with crash","source":"@site/i18n/en/docusaurus-plugin-content-docs-docs_s/current/07_Advanced_development/02_linux_development/07_kernel_debug.md","sourceDirName":"07_Advanced_development/02_linux_development","slug":"/Advanced_development/linux_development/kernel_debug","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/kernel_debug","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1769771560000,"sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"7.2.6 OTA","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/OTA"},"next":{"title":"7.3 \u591a\u5a92\u4f53\u5f00\u53d1\u6307\u5357","permalink":"/rdk_doc/en/rdk_s/03_multimedia_development"}}');var a=t(74848),r=t(28453);const s={sidebar_position:7},o="7.2.7 Introduction to Linux Debugging Features",c={},d=[{value:"Analyzing ramdump with crash",id:"analyzing-ramdump-with-crash",level:2},{value:"Capturing ramdump",id:"capturing-ramdump",level:3},{value:"Automatic Capture",id:"automatic-capture",level:4},{value:"Manual Capture",id:"manual-capture",level:4},{value:"Introduction to crash",id:"introduction-to-crash",level:3},{value:"Using crash",id:"using-crash",level:3},{value:"Obtaining and compiling crash tool source code:",id:"obtaining-and-compiling-crash-tool-source-code",level:4},{value:"Copying ramdump files to the server",id:"copying-ramdump-files-to-the-server",level:4},{value:"Obtaining crash extension files and CPU context parsing scripts",id:"obtaining-crash-extension-files-and-cpu-context-parsing-scripts",level:4},{value:"Parsing CPU register information",id:"parsing-cpu-register-information",level:4},{value:"Launching crash to analyze the crash scene",id:"launching-crash-to-analyze-the-crash-scene",level:4},{value:"Add extension file",id:"add-extension-file",level:4},{value:"Add CPU register information",id:"add-cpu-register-information",level:4},{value:"View stack trace at the time of panic",id:"view-stack-trace-at-the-time-of-panic",level:4}];function l(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"727-introduction-to-linux-debugging-features",children:"7.2.7 Introduction to Linux Debugging Features"})}),"\n",(0,a.jsx)(n.h2,{id:"analyzing-ramdump-with-crash",children:"Analyzing ramdump with crash"}),"\n",(0,a.jsx)(n.h3,{id:"capturing-ramdump",children:"Capturing ramdump"}),"\n",(0,a.jsxs)(n.p,{children:["The ramdump feature is disabled by default. On Linux, you can manually enable it using the tool ",(0,a.jsx)(n.code,{children:"hrut_ddr_misc"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:"root@ubuntu:/userdata# hrut_ddr_misc s bit 0 1\nupdate misc para begin\n------------------------------------\nprint new misc para:\nBit idx  Function name   Status\n0        RAMDUMP         on\n------------------------------------\n"})}),"\n",(0,a.jsx)(n.p,{children:"To check whether the ramdump feature is currently enabled:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:"root@ubuntu:/userdata# hrut_ddr_misc g\nBit idx  Function name   Status\n0        RAMDUMP         on\n"})}),"\n",(0,a.jsx)(n.p,{children:"After capturing the ramdump, you can disable the DDR ramdump feature:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:"root@ubuntu:~# hrut_ddr_misc s bit 0 0\nupdate misc para begin\n------------------------------------\nprint new misc para:\nBit idx  Function name   Status\n0        RAMDUMP         off\n------------------------------------\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Currently, the ramdump feature only supports capturing dumps triggered by Kernel panic."})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Capturing ramdump may corrupt the partition where the dump file is saved. Please ensure that the dump file is saved to a non-root filesystem partition with sufficient capacity (larger than DDR size)."})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsxs)(n.strong,{children:["It is recommended to create a dedicated partition for ramdump. See ",(0,a.jsx)(n.a,{href:"../rdk_gen#Custom-Partition-Instructions",children:"Custom Partition Instructions"}),', for example, name the partition "ramdump".']})}),"\n",(0,a.jsx)(n.h4,{id:"automatic-capture",children:"Automatic Capture"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Set environment variables in Uboot:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:'setenv enable_ramdump 1\nsetenv ramdump_part_name ramdump # "ramdump" here indicates the actual partition where dump files will be saved; replace it according to your board\'s partition layout\nsetenv ramdump_in map # "map" here instructs ramdump to save files to UFS or eMMC (depending on boot mode); ensure this is set to "map"\nsaveenv\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:'For secure boot devices, automatic ramdump capture requires flashing the HB_APDP partition image and enabling secure debug. Refer to the "HB_APDP Generation" section in the RDK S100 Commercial Customer Documentation Addendum. Please contact your FAE to obtain the RDK S100 Commercial Customer Documentation Addendum.'}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"With these settings, ramdump will be automatically captured upon reboot after a panic occurs."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"manual-capture",children:"Manual Capture"}),"\n",(0,a.jsxs)(n.p,{children:["After triggering a Kernel panic and rebooting into Uboot, execute the following commands in Uboot. The data will be stored in the ",(0,a.jsx)(n.code,{children:"/ramdump/"})," directory on eMMC or UFS."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:'Hobot$ setenv enable_ramdump 1\nHobot$ setenv ramdump_part_name ramdump # "ramdump" here indicates the actual partition where dump files will be saved; replace it according to your board\'s partition layout\nHobot$ setenv ramdump_in map # "map" here instructs ramdump to save files to UFS or eMMC (depending on boot mode); ensure this is set to "map"\nHobot$ memdump userdata # This command triggers ramdump; "userdata" here refers to DRAM userdata\nintf mmc,dev 0,part 17 directory /Recovery required\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\ncpu core context dumped to //cpu-contexts.bin\nDRAM bank= 0x0\n-> start   = 0x0000000080000000\n-> size    = 0x0000000080000000\n-> dumpfile = //DDRCS0-0.bin, from memory 0x80000000, length=536870912\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n536870912 bytes written in 10723 ms\nskip secure world memory region\n-> dumpfile = //DDRCS0-2.bin, from memory 0xaa000000, length=1442840576\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n1442840576 bytes written in 23719 ms\nDRAM bank= 0x1\n-> start   = 0x0000000400000000\n-> size    = 0x00000000FFFFF000\n-> dumpfile = //DDRCS1-0.bin, from memory 0x400000000, length=2147483648\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147483648 bytes written in 33548 ms\n-> dumpfile = //DDRCS1-1.bin, from memory 0x480000000, length=2147479552\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147479552 bytes written in 33429 ms\nDRAM bank= 0x2\n-> start   = 0x0000000800000000\n-> size    = 0x00000000FFFFF000\n-> dumpfile = //DDRCS2-0.bin, from memory 0x800000000, length=2147483648\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147483648 bytes written in 33528 ms\n-> dumpfile = //DDRCS2-1.bin, from memory 0x880000000, length=2147479552\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147479552 bytes written in 33656 ms\nDRAM bank= 0x3\n-> start   = 0x0000000C80000000\n-> size    = 0x000000007FFFF000\n-> dumpfile = //DDRCS3-0.bin, from memory 0xc80000000, length=2147479552\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147479552 bytes written in 33372 ms\n'})}),"\n",(0,a.jsx)(n.h3,{id:"introduction-to-crash",children:"Introduction to crash"}),"\n",(0,a.jsx)(n.p,{children:"Crash is primarily used for offline analysis of Linux kernel memory dump files. It integrates the gdb debugger and offers powerful capabilities, such as viewing stack traces, dmesg logs, kernel data structures, disassembly, and more. Crash supports memory dump file formats generated by various tools, including:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Live Linux systems."}),"\n",(0,a.jsx)(n.li,{children:"Normal and compressed memory dump files produced by kdump."}),"\n",(0,a.jsx)(n.li,{children:"Compressed memory dump files generated by the makedumpfile command."}),"\n",(0,a.jsx)(n.li,{children:"Memory dump files generated by netdump."}),"\n",(0,a.jsx)(n.li,{children:"Memory dump files generated by diskdump."}),"\n",(0,a.jsx)(n.li,{children:"Xen memory dump files generated by kdump."}),"\n",(0,a.jsx)(n.li,{children:"Memory dump files generated by LKCD."}),"\n",(0,a.jsx)(n.li,{children:"Memory dump files generated by Mcore."}),"\n",(0,a.jsx)(n.li,{children:"Raw memory dump files in ramdump format."}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"using-crash",children:"Using crash"}),"\n",(0,a.jsx)(n.p,{children:"This document primarily uses crash to analyze ramdump files. Ramdump files are nearly complete memory images\u2014except for certain security-related memory regions that cannot be captured, almost all DRAM contents can be dumped. Some issues are difficult to reproduce or caused by memory corruption, making them impossible to diagnose solely from logs. Therefore, preserving a memory snapshot at the moment an issue occurs enables thorough analysis."}),"\n",(0,a.jsx)(n.h4,{id:"obtaining-and-compiling-crash-tool-source-code",children:"Obtaining and compiling crash tool source code:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:"sudo apt install -y texinfo\ngit clone --depth=1 https://github.com/crash-utility/crash.git\nmake target=arm64\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"Currently, crash is only supported on x86-64 platforms."})}),"\n",(0,a.jsx)(n.h4,{id:"copying-ramdump-files-to-the-server",children:"Copying ramdump files to the server"}),"\n",(0,a.jsxs)(n.p,{children:["Copy the DDR*.bin and cpu-contexts.bin files saved in the board's ramdump partition to the directory containing the crash binary. Since DDR*.bin files are nearly as large as the DDR capacity, we recommend using the ",(0,a.jsx)(n.code,{children:"scp"})," command for transfer."]}),"\n",(0,a.jsx)(n.h4,{id:"obtaining-crash-extension-files-and-cpu-context-parsing-scripts",children:"Obtaining crash extension files and CPU context parsing scripts"}),"\n",(0,a.jsxs)(n.p,{children:["These files are hosted on a public server at:",(0,a.jsx)(n.br,{}),"\n",(0,a.jsx)(n.a,{href:"https://archive.d-robotics.cc/ubuntu-rdk-s100-beta/host-tools/crash-tools/",children:"https://archive.d-robotics.cc/ubuntu-rdk-s100-beta/host-tools/crash-tools/"})]}),"\n",(0,a.jsxs)(n.p,{children:["Download ",(0,a.jsx)(n.code,{children:"parse-cpu-contexts.py"})," and ",(0,a.jsx)(n.code,{children:"arm64-regs.so"}),", and save them to the directory containing the crash binary."]}),"\n",(0,a.jsx)(n.h4,{id:"parsing-cpu-register-information",children:"Parsing CPU register information"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:"python3 parse-cpu-contexts.py cpu-contexts.bin >./coreregs.txt\n"})}),"\n",(0,a.jsx)(n.h4,{id:"launching-crash-to-analyze-the-crash-scene",children:"Launching crash to analyze the crash scene"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:'./crash ./vmlinux DDRCS0-0.bin@0x80000000,/dev/zero@0xa0000000,DDRCS0-2.bin@0xaa000000,DDRCS1-0.bin@0x400000000,DDRCS1-1.bin@0x480000000,DDRCS2-0.bin@0x800000000,DDRCS2-1.bin@0x880000000,DDRCS3-0.bin@0xc80000000 --machdep vabits_actual=48\n\ncrash 9.0.0\nCopyright (C) 2002-2025  Red Hat, Inc.\nCopyright (C) 2004, 2005, 2006, 2010  IBM Corporation\nCopyright (C) 1999-2006  Hewlett-Packard Co  \nCopyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited  \nCopyright (C) 2006, 2007  VA Linux Systems Japan K.K.  \nCopyright (C) 2005, 2011, 2020-2024  NEC Corporation  \nCopyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.  \nCopyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.  \nCopyright (C) 2015, 2021  VMware, Inc.  \nThis program is free software, covered by the GNU General Public License,  \nand you are welcome to change it and/or distribute copies of it under  \ncertain conditions.  Enter "help copying" to see the conditions.  \nThis program has absolutely no warranty.  Enter "help warranty" for details.  \n\nNOTE: setting vabits_actual to: 48  \n\nGNU gdb (GDB) 16.2  \nCopyright (C) 2024 Free Software Foundation, Inc.  \nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>  \nThis is free software: you are free to change and redistribute it.  \nThere is NO WARRANTY, to the extent permitted by law.  \nType "show copying" and "show warranty" for details.  \nThis GDB was configured as "--host=x86_64-pc-linux-gnu --target=aarch64-elf-linux".  \nType "show configuration" for configuration details.  \nFind the GDB manual and other documentation resources online at:  \n    <http://www.gnu.org/software/gdb/documentation/>.  \n\nFor help, type "help".  \nType "apropos word" to search for commands related to "word"...  \n\nWARNING: cpu 0: cannot find NT_PRSTATUS note  \nWARNING: cpu 1: cannot find NT_PRSTATUS note  \nWARNING: cpu 2: cannot find NT_PRSTATUS note  \nWARNING: cpu 3: cannot find NT_PRSTATUS note  \nWARNING: cpu 4: cannot find NT_PRSTATUS note  \nWARNING: cpu 5: cannot find NT_PRSTATUS note  \n      KERNEL: ./vmlinux  \n   DUMPFILES: /var/tmp/ramdump_elf_LKd4AH [temporary ELF header]  \n              DDRCS0-0.bin  \n              /dev/zero  \n              DDRCS0-2.bin  \n              DDRCS1-0.bin  \n              DDRCS1-1.bin  \n              DDRCS2-0.bin  \n              DDRCS2-1.bin  \n              DDRCS3-0.bin  \n        CPUS: 6 [OFFLINE: 5]  \n        DATE: Thu Jun  5 00:01:41 CST 2025  \n      UPTIME: 01:44:00  \nLOAD AVERAGE: 3.95, 4.11, 4.05  \n       TASKS: 672  \n    NODENAME: ubuntu  \n     RELEASE: 6.1.112-rt43-DR-4.0.2-2507251105-g2eb711-g0e5746  \n     VERSION: #6 SMP PREEMPT_RT Fri Jul 25 11:14:37 CST 2025  \n     MACHINE: aarch64  (unknown Mhz)  \n      MEMORY: 12 GB  \n       PANIC: "Kernel panic - not syncing: sysrq triggered crash"  \n         PID: 4240  \n     COMMAND: "bash"  \n        TASK: ffff00040f10f000  [THREAD_INFO: ffff00040f10f000]  \n         CPU: 0  \n       STATE: TASK_RUNNING (PANIC)  \n\ncrash>  \n'})}),"\n",(0,a.jsx)(n.h4,{id:"add-extension-file",children:"Add extension file"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:"crash> extend arm64-regs.so  \n./arm64-regs.so: shared object loaded  \n"})}),"\n",(0,a.jsx)(n.h4,{id:"add-cpu-register-information",children:"Add CPU register information"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:"crash> arm64_core_set -l coreregs.txt  \nloading cpu core regs from coreregs.txt  \nloading cpu core regs from coreregs.txt done  \n"})}),"\n",(0,a.jsx)(n.h4,{id:"view-stack-trace-at-the-time-of-panic",children:"View stack trace at the time of panic"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-Shell",children:'crash> bt  \nPID: 4240     TASK: ffff00040f10f000  CPU: 0    COMMAND: "bash"  \n #0 [ffff8000279cfab0] __arm_smccc_smc at ffff800008029cd0  \n #1 [ffff8000279cfad0] __invoke_psci_fn_smc at ffff8000089a3394  \n #2 [ffff8000279cfb10] psci_sys_reset at ffff8000089a3854  \n #3 [ffff8000279cfb20] atomic_notifier_call_chain at ffff8000080cc094  \n #4 [ffff8000279cfb60] do_kernel_restart at ffff8000080ce818  \n #5 [ffff8000279cfb70] machine_restart at ffff800008019b9c  \n #6 [ffff8000279cfb90] emergency_restart at ffff8000080cdaec  \n #7 [ffff8000279cfba0] panic at ffff800008c0ad68  \n #8 [ffff8000279cfc80] sysrq_handle_crash at ffff800008719354  \n #9 [ffff8000279cfc90] __handle_sysrq at ffff800008719c84  \n#10 [ffff8000279cfce0] write_sysrq_trigger at ffff80000871a318  \n#11 [ffff8000279cfd00] proc_reg_write at ffff8000083a9478  \n#12 [ffff8000279cfd20] vfs_write at ffff80000831b9f4  \n#13 [ffff8000279cfdc0] ksys_write at ffff80000831be6c  \n#14 [ffff8000279cfe00] __arm64_sys_write at ffff80000831bf20  \n#15 [ffff8000279cfe10] invoke_syscall at ffff800008029e5c  \n#16 [ffff8000279cfe40] el0_svc_common.constprop.0 at ffff800008029f80  \n#17 [ffff8000279cfe70] do_el0_svc at ffff80000802a0f4  \n#18 [ffff8000279cfe80] el0_svc at ffff800008c22554  \n#19 [ffff8000279cfea0] el0t_64_sync_handler at ffff800008c239ac  \n#20 [ffff8000279cffe0] el0t_64_sync at ffff8000080115e4  \n     PC: 0000ffffa9a67e10   LR: 0000ffffa9a0506c   SP: 0000ffffebb5a030  \n    X29: 0000ffffebb5a030  X28: 0000000000000000  X27: 0000aaaaab07b000  \n    X26: 0000aaaaab041468  X25: 0000aaaaab085810  X24: 0000000000000002  \n    X23: 0000aaaabe0f0cd0  X22: 0000ffffa99707e0  X21: 0000ffffa9b2c5d8  \n    X20: 0000aaaabe0f0cd0  X19: 0000000000000001  X18: 0000000000000001  \n    X17: 0000ffffa9a01d40  X16: 0000ffffa9a06450  X15: 0000aaaaab08f2e8  \n    X14: 0000000000000000  X13: 0000000000000001  X12: 0000ffffa9ad7720  \n    X11: 0000ffffa9ad7440  X10: 0000000000000063   X9: 0000aaaabe092110  \n     X8: 0000000000000040   X7: 00000000ffffffff   X6: 0000000000000063  \n     X5: 0000aaaabe0f0cd1   X4: 0000aaaabe092111   X3: 0000ffffa9970020  \n     X2: 0000000000000002   X1: 0000aaaabe0f0cd0   X0: 0000000000000001  \n    ORIG_X0: 0000000000000001  SYSCALLNO: 40  PSTATE: 20001000  \ncrash>  \n'})})]})}function f(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);