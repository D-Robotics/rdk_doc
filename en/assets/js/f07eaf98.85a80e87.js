"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[14955],{28453:(n,e,i)=>{i.d(e,{R:()=>d,x:()=>a});var t=i(96540);const r={},s=t.createContext(r);function d(n){const e=t.useContext(s);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:d(n.components),t.createElement(s.Provider,{value:e},n.children)}},96472:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>d,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"Advanced_development/linux_development/kernel_debug","title":"7.2.7 Linux\u8c03\u8bd5\u529f\u80fd\u4ecb\u7ecd","description":"crash\u5206\u6790ramdump","source":"@site/docs_s/07_Advanced_development/02_linux_development/07_kernel_debug.md","sourceDirName":"07_Advanced_development/02_linux_development","slug":"/Advanced_development/linux_development/kernel_debug","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/kernel_debug","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1752816072000,"sidebarPosition":7,"frontMatter":{"sidebar_position":7},"sidebar":"tutorialSidebar","previous":{"title":"7.2.6 OTA","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/OTA"},"next":{"title":"7.3 \u591a\u5a92\u4f53\u5f00\u53d1\u6307\u5357","permalink":"/rdk_doc/en/rdk_s/03_multimedia_development"}}');var r=i(74848),s=i(28453);const d={sidebar_position:7},a="7.2.7 Linux\u8c03\u8bd5\u529f\u80fd\u4ecb\u7ecd",o={},l=[{value:"crash\u5206\u6790ramdump",id:"crash\u5206\u6790ramdump",level:2},{value:"\u6293\u53d6ramdump",id:"\u6293\u53d6ramdump",level:3},{value:"\u81ea\u52a8\u6293\u53d6",id:"\u81ea\u52a8\u6293\u53d6",level:4},{value:"\u624b\u52a8\u6293\u53d6",id:"\u624b\u52a8\u6293\u53d6",level:4},{value:"crash\u4ecb\u7ecd",id:"crash\u4ecb\u7ecd",level:3},{value:"crash\u4f7f\u7528\u65b9\u6cd5",id:"crash\u4f7f\u7528\u65b9\u6cd5",level:3}];function c(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"727-linux\u8c03\u8bd5\u529f\u80fd\u4ecb\u7ecd",children:"7.2.7 Linux\u8c03\u8bd5\u529f\u80fd\u4ecb\u7ecd"})}),"\n",(0,r.jsx)(e.h2,{id:"crash\u5206\u6790ramdump",children:"crash\u5206\u6790ramdump"}),"\n",(0,r.jsx)(e.h3,{id:"\u6293\u53d6ramdump",children:"\u6293\u53d6ramdump"}),"\n",(0,r.jsxs)(e.p,{children:["\u5f53\u524dramdump\u529f\u80fd\u9ed8\u8ba4\u4e3a\u5173\u95ed\u72b6\u6001\uff0c\u5728Linux\u4e0b\u53ef\u4ee5\u901a\u8fc7\u5de5\u5177",(0,r.jsx)(e.code,{children:"hrut_ddr_misc"}),"\u624b\u52a8\u5f00\u542f:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Shell",children:"root@ubuntu:/userdata# hrut_ddr_misc s bit 0 1\nupdate misc para begin\n------------------------------------\nprint new misc para:\nBit idx  Function name   Status\n0        RAMDUMP         on\n------------------------------------\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u67e5\u770b\u5f53\u524dramdump\u529f\u80fd\u662f\u5426\u5f00\u542f\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Shell",children:"root@ubuntu:/userdata# hrut_ddr_misc g\nBit idx  Function name   Status\n0        RAMDUMP         on\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u5f53\u524dramdump\u529f\u80fd\u53ea\u652f\u6301\u6293\u53d6\u7531Kernel panic\u89e6\u53d1\u7684\u573a\u666f"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"ramdump\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u635f\u574f\u4fdd\u5b58dump\u6587\u4ef6\u7684\u5206\u533a\uff0c\u8bf7\u52a1\u5fc5\u5c06dump\u6587\u4ef6\u4fdd\u5b58\u5230\u975e\u6839\u6587\u4ef6\u7cfb\u7edf\u5206\u533a\uff0c\u4e14\u5206\u533a\u5bb9\u91cf\u5927\u4e8eDDR\u5bb9\u91cf"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsxs)(e.strong,{children:["\u5efa\u8bae\u521b\u5efa\u4e00\u4e2a\u4e13\u95e8\u7528\u4e8eramdump\u7684\u5206\u533a\uff0c",(0,r.jsx)(e.a,{href:"../rdk_gen#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E5%8C%BA%E8%AF%B4%E6%98%8E",children:"\u81ea\u5b9a\u4e49\u5206\u533a\u8bf4\u660e"}),"\uff0c\u6bd4\u5982\u5206\u533a\u547d\u540d\u4e3aramdump"]})}),"\n",(0,r.jsx)(e.h4,{id:"\u81ea\u52a8\u6293\u53d6",children:"\u81ea\u52a8\u6293\u53d6"}),"\n",(0,r.jsx)(e.p,{children:"\u6682\u4e0d\u652f\u6301"}),"\n",(0,r.jsx)(e.h4,{id:"\u624b\u52a8\u6293\u53d6",children:"\u624b\u52a8\u6293\u53d6"}),"\n",(0,r.jsx)(e.p,{children:"\u89e6\u53d1Kernel panic\u91cd\u542f\u5230U-Boot\u4e4b\u540e\uff0c\u5728U-Boot\u4e0b\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u6570\u636e\u5b58\u50a8\u5230eMMC\u6216\u8005ufs\u7684/ramdump/\u76ee\u5f55\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Shell",children:"Hobot$ setenv enable_ramdump 1\nHobot$ setenv ramdump_part_name ramdump # \u8fd9\u91cc\u7684ramdump\u8868\u660e\u8981\u4fdd\u5b58dump\u6587\u4ef6\u7684\u5b9e\u9645\u5206\u533a\uff0c\u8bf7\u6839\u636e\u5b9e\u9645\u677f\u5b50\u5206\u533a\u66ff\u6362\nHobot$ setenv ramdump_in map # \u8fd9\u91cc\u7684map\u8868\u660e\u8ba9ramdump\u5c06\u6587\u4ef6\u4fdd\u5b58\u8fdbufs\u6216\u8005emmc\uff08\u6839\u636e\u542f\u52a8\u6a21\u5f0f\uff09\uff0c\u8bf7\u52a1\u5fc5\u8bbe\u7f6e\u6210map\nHobot$ memdump userdata # \u8fd9\u91cc\u662f\u8fdb\u884cramdump\u7684\u547d\u4ee4\uff0c\u547d\u4ee4\u4e2d\u7684userdata\u6307\u7684\u662fDRAM\u7684userdata\nintf mmc,dev 0,part 17 directory /Recovery required\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\ncpu core context dumped to //cpu-contexts.bin\nDRAM bank= 0x0\n-> start   = 0x0000000080000000\n-> size    = 0x0000000080000000\n-> dumpfile = //DDRCS0-0.bin, from memory 0x80000000, length=536870912\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n536870912 bytes written in 10723 ms\nskip secure wolrd memory region\n-> dumpfile = //DDRCS0-2.bin, from memory 0xaa000000, length=1442840576\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n1442840576 bytes written in 23719 ms\nDRAM bank= 0x1\n-> start   = 0x0000000400000000\n-> size    = 0x00000000FFFFF000\n-> dumpfile = //DDRCS1-0.bin, from memory 0x400000000, length=2147483648\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147483648 bytes written in 33548 ms\n-> dumpfile = //DDRCS1-1.bin, from memory 0x480000000, length=2147479552\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147479552 bytes written in 33429 ms\nDRAM bank= 0x2\n-> start   = 0x0000000800000000\n-> size    = 0x00000000FFFFF000\n-> dumpfile = //DDRCS2-0.bin, from memory 0x800000000, length=2147483648\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147483648 bytes written in 33528 ms\n-> dumpfile = //DDRCS2-1.bin, from memory 0x880000000, length=2147479552\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147479552 bytes written in 33656 ms\nDRAM bank= 0x3\n-> start   = 0x0000000C80000000\n-> size    = 0x000000007FFFF000\n-> dumpfile = //DDRCS3-0.bin, from memory 0xc80000000, length=2147479552\nFile System is consistent\nfile found, deleting\nupdate journal finished\nFile System is consistent\nupdate journal finished\n2147479552 bytes written in 33372 ms\n"})}),"\n",(0,r.jsx)(e.h3,{id:"crash\u4ecb\u7ecd",children:"crash\u4ecb\u7ecd"}),"\n",(0,r.jsx)(e.p,{children:"crash\u4e3b\u8981\u662f\u7528\u6765\u79bb\u7ebf\u5206\u6790linux\u5185\u6838\u5185\u5b58\u8f6c\u5b58\u6587\u4ef6\uff0c\u5b83\u6574\u5408\u4e86gdb\u5de5\u5177\uff0c\u5177\u6709\u5f88\u5f3a\u7684\u529f\u80fd\uff0c\u53ef\u4ee5\u67e5\u770b\u5806\u6808\uff0cdmesg\u65e5\u5fd7\uff0c\u5185\u6838\u6570\u636e\u7ed3\u6784\uff0c\u53cd\u6c47\u7f16\u7b49\u7b49\u3002\u5176\u652f\u6301\u591a\u79cd\u5de5\u5177\u751f\u6210\u7684\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u683c\u5f0f\uff0c\u5305\u62ec\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Live linux\u7cfb\u7edf\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"kdump\u4ea7\u751f\u7684\u6b63\u5e38\u7684\u548c\u538b\u7f29\u7684\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7531makedumpfile\u547d\u4ee4\u751f\u6210\u7684\u538b\u7f29\u7684\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7531netdump\u751f\u6210\u7684\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7531diskdump\u751f\u6210\u7684\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7531kdump\u751f\u6210\u7684Xen\u7684\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"LKCD\u751f\u6210\u7684\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Mcore\u751f\u6210\u7684\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"ramdump\u683c\u5f0f\u7684raw\u5185\u5b58\u8f6c\u50a8\u6587\u4ef6\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"crash\u4f7f\u7528\u65b9\u6cd5",children:"crash\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6587\u4e3b\u8981\u4f7f\u7528crash\u6765\u5206\u6790ramdump\u6587\u4ef6\u3002ramdump\u6587\u4ef6\u51e0\u4e4e\u662f\u5bf9\u6574\u4e2a\u5185\u5b58\u7684\u955c\u50cf\uff0c\u9664\u4e86\u4e00\u4e9bsecurity\u7c7b\u578b\u7684memory\u6293\u4e0d\u51fa\u6765\u4e4b\u5916\uff0c\u51e0\u4e4e\u6240\u6709\u7684DRAM\u90fd\u80fd\u88ab\u6293\u4e0b\u6765\u3002\u6709\u4e9b\u95ee\u9898\u7684\u590d\u73b0\u6982\u7387\u4f4e\uff0c\u800c\u4e14\u6709\u4e9b\u95ee\u9898\u662f\u7531\u4e8e\u8e29\u5185\u5b58\u5bfc\u81f4\u7684\uff0c\u8fd9\u79cd\u95ee\u9898\u9760log\u5f80\u5f80\u662f\u65e0\u6cd5\u5206\u6790\u51fa\u6765\u7684\uff0c\u6240\u4ee5\u5982\u679c\u53ef\u4ee5\u5728\u95ee\u9898\u53d1\u751f\u65f6\u5019\u628a\u5185\u5b58\u955c\u50cf\u4fdd\u5b58\u4e0b\u6765\uff0c\u5c31\u53ef\u4ee5\u5206\u6790\u4e86\u3002"}),"\n",(0,r.jsx)(e.p,{children:"crash\u5de5\u5177\u4ee3\u7801\u83b7\u53d6\u53ca\u7f16\u8bd1\u65b9\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Shell",children:"sudo apt install -y texinfo\ngit clone --depth=1 https://github.com/crash-utility/crash.git\nmake target=arm64\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u670d\u52a1\u5668\u547d\u4ee4\u884c\u4e0b\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u5206\u6790\u6293\u53d6\u7684ramdump\u6587\u4ef6\u3002\u5de5\u5177\u8f93\u51fa\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Shell",children:'./crash ./vmlinux DDRCS0-0.bin@0x80000000,/dev/zero@0xa0000000,DDRCS0-2.bin@0xaa000000,DDRCS1-0.bin@0x400000000,DDRCS1-1.bin@0x480000000,DDRCS2-0.bin@0x800000000,DDRCS2-1.bin@0x880000000,DDRCS3-0.bin@0xc80000000 --machdep vabits_actual=48\n\ncrash 9.0.0\nCopyright (C) 2002-2025  Red Hat, Inc.\nCopyright (C) 2004, 2005, 2006, 2010  IBM Corporation\nCopyright (C) 1999-2006  Hewlett-Packard Co\nCopyright (C) 2005, 2006, 2011, 2012  Fujitsu Limited\nCopyright (C) 2006, 2007  VA Linux Systems Japan K.K.\nCopyright (C) 2005, 2011, 2020-2024  NEC Corporation\nCopyright (C) 1999, 2002, 2007  Silicon Graphics, Inc.\nCopyright (C) 1999, 2000, 2001, 2002  Mission Critical Linux, Inc.\nCopyright (C) 2015, 2021  VMware, Inc.\nThis program is free software, covered by the GNU General Public License,\nand you are welcome to change it and/or distribute copies of it under\ncertain conditions.  Enter "help copying" to see the conditions.\nThis program has absolutely no warranty.  Enter "help warranty" for details.\n\nNOTE: setting vabits_actual to: 48\n\nGNU gdb (GDB) 16.2\nCopyright (C) 2024 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\nType "show copying" and "show warranty" for details.\nThis GDB was configured as "--host=x86_64-pc-linux-gnu --target=aarch64-elf-linux".\nType "show configuration" for configuration details.\nFind the GDB manual and other documentation resources online at:\n    <http://www.gnu.org/software/gdb/documentation/>.\n\nFor help, type "help".\nType "apropos word" to search for commands related to "word"...\n\nWARNING: kernel version inconsistency between vmlinux and dumpfile\n\nWARNING: cpu 0: cannot find NT_PRSTATUS note\nWARNING: cpu 1: cannot find NT_PRSTATUS note\nWARNING: cpu 2: cannot find NT_PRSTATUS note\nWARNING: cpu 3: cannot find NT_PRSTATUS note\nWARNING: cpu 4: cannot find NT_PRSTATUS note\nWARNING: cpu 5: cannot find NT_PRSTATUS note\n      KERNEL: ./vmlinux\n   DUMPFILES: /var/tmp/ramdump_elf_VSntZ8 [temporary ELF header]\n              DDRCS0-0.bin\n              /dev/zero\n              DDRCS0-2.bin\n              DDRCS1-0.bin\n              DDRCS1-1.bin\n              DDRCS2-0.bin\n              DDRCS2-1.bin\n              DDRCS3-0.bin\n        CPUS: 6 [OFFLINE: 5]\n        DATE: Thu Feb 20 21:24:21 CST 2025\n      UPTIME: 00:00:20\nLOAD AVERAGE: 2.67, 0.65, 0.22\n       TASKS: 792\n    NODENAME: ubuntu\n     RELEASE: 6.1.112-rt43-DR-4.0.2-2506251650-gac1c88-g0b202b-dirty\n     VERSION: #2 SMP PREEMPT_RT Wed Jun 25 16:57:38 CST 2025\n     MACHINE: aarch64  (unknown Mhz)\n      MEMORY: 12 GB\n       PANIC: ""\n         PID: 0\n     COMMAND: "swapper/0"\n        TASK: ffff80000968ec00  (1 of 6)  [THREAD_INFO: ffff80000968ec00]\n         CPU: 0\n       STATE: TASK_RUNNING (ACTIVE)\n     WARNING: panic task not found\n\ncrash> ps\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u63a5\u4e0b\u6765\u53ef\u4ee5\u8f93\u5165\u547d\u4ee4\u6765\u5206\u6790\u4e86\u3002"})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}}}]);