"use strict";(self.webpackChunkrdk_doc=self.webpackChunkrdk_doc||[]).push([[99751],{28453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>c});var n=s(96540);const i={},r=n.createContext(i);function a(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},66812:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"Advanced_development/linux_development/hardware_unit_test/uart_stress","title":"UART Stress Test","description":"Test Principle","source":"@site/i18n/en/docusaurus-plugin-content-docs-docs_s/current/07_Advanced_development/02_linux_development/05_hardware_unit_test/03-uart_stress.md","sourceDirName":"07_Advanced_development/02_linux_development/05_hardware_unit_test","slug":"/Advanced_development/linux_development/hardware_unit_test/uart_stress","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/hardware_unit_test/uart_stress","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1770604318000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"eMMC Stress Testing","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/hardware_unit_test/emmc_stress"},"next":{"title":"SPI Stress Test","permalink":"/rdk_doc/en/rdk_s/Advanced_development/linux_development/hardware_unit_test/spi_stress"}}');var i=s(74848),r=s(28453);const a={sidebar_position:3},c="UART Stress Test",d={},o=[{value:"Test Principle",id:"test-principle",level:2},{value:"Test Content",id:"test-content",level:3},{value:"Preparation",id:"preparation",level:2},{value:"Usage Instructions for the Stress Test Script",id:"usage-instructions-for-the-stress-test-script",level:3},{value:"Usage Instructions for the Executable Program",id:"usage-instructions-for-the-executable-program",level:3},{value:"Notes",id:"notes",level:3},{value:"Test Metrics",id:"test-metrics",level:2},{value:"UART Stress Test Results",id:"uart-stress-test-results",level:3}];function l(e){const t={br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"uart-stress-test",children:"UART Stress Test"})}),"\n",(0,i.jsx)(t.h2,{id:"test-principle",children:"Test Principle"}),"\n",(0,i.jsx)(t.p,{children:"UART stress testing is a method used to verify the stability and performance of UART communication by exchanging large volumes of data and performing high-load operations. Its principle mainly involves sending and receiving massive amounts of data to simulate real-world UART usage scenarios. Specifically, it includes the following aspects:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Data Transmission and Reception"}),": The core principle of UART stress testing is to send large amounts of data to a UART device and then receive data back from it.","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Data Transmission"}),": A script or program generates large data packets and sends them to the target device via the UART interface."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Data Reception"}),": The target device returns the received data (e.g., through a UART loopback test or an external device\u2019s response). The stress test program receives this data and performs comparison and validation."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Baud Rate and Data Frame Configuration"}),": Baud rate defines the transmission speed of UART communication, typically expressed in bits per second (bps). UART communication also involves other parameters, such as:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Data Bits"}),": The number of data bits in each data frame (commonly 8 or 7 bits)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Stop Bits"}),": Bits indicating the end of data transmission (typically 1 or 2 bits)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Parity Bits"}),": Used for error checking during data transmission (odd/even parity)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"test-content",children:"Test Content"}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"1. Test Procedure:"}),(0,i.jsx)(t.br,{}),"\n","The ",(0,i.jsx)(t.code,{children:"uartstress.sh"})," script uses a loopback test\u2014a common UART testing method\u2014where data sent from the transmitter is physically or logically routed back to the receiver to verify correct data transmission. In the source code ",(0,i.jsx)(t.code,{children:"uart_test.c"}),", the function ",(0,i.jsx)(t.code,{children:"perform_single_loopback_test()"})," implements this test with the following steps:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Open the UART port and configure its parameters using ",(0,i.jsx)(t.code,{children:"open_uart()"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Initialize a semaphore using ",(0,i.jsx)(t.code,{children:"sem_init()"})," to ensure proper thread synchronization."]}),"\n",(0,i.jsxs)(t.li,{children:["Create three threads:","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsxs)(t.strong,{children:["Send thread (",(0,i.jsx)(t.code,{children:"uart_send_thread"}),")"]}),": Responsible for transmitting data."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsxs)(t.strong,{children:["Receive thread (",(0,i.jsx)(t.code,{children:"uart_recv_thread"}),")"]}),": Responsible for receiving data and storing it in a buffer."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsxs)(t.strong,{children:["Data verification thread (",(0,i.jsx)(t.code,{children:"check_recv_thread"}),")"]}),": Compares received data against the originally sent data for consistency."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["Once all threads complete their tasks, ",(0,i.jsx)(t.code,{children:"pthread_join()"})," waits for all threads to finish before concluding the test."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.strong,{children:"2. Command Analysis:"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Test command"}),":",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.code,{children:'uart_test -l -s 1024 -c "$StressCount" -b "$Baudrate" -d "$Device" > "$uart_test_log_file"'})]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Parameter explanation"}),":","\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"-l"}),": Perform a loopback test."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"-s 1024"}),": Specify the data size per test as 1024 bytes."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:'-c "$StressCount"'}),": Define the number of stress test iterations (i.e., how many times the test repeats)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:'-b "$Baudrate"'}),": Set the UART baud rate; the variable ",(0,i.jsx)(t.code,{children:"$Baudrate"})," will be replaced with the actual value provided."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:'-d "$Device"'}),": Specify the UART device path via the variable ",(0,i.jsx)(t.code,{children:"$Device"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:'> "$uart_test_log_file"'}),": Redirect test output to the specified log file ",(0,i.jsx)(t.code,{children:"$uart_test_log_file"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"preparation",children:"Preparation"}),"\n",(0,i.jsx)(t.h3,{id:"usage-instructions-for-the-stress-test-script",children:"Usage Instructions for the Stress Test Script"}),"\n",(0,i.jsxs)(t.p,{children:["UART stress testing supports the ",(0,i.jsx)(t.code,{children:"-h"})," suffix to display command parameter descriptions. For example:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"sunrise@ubuntu:/app/chip_base_test/03_uart_test$ ./uartstress.sh -h\nUsage: ./uartstress.sh [options]\n\nOptions:\n  -b <baudrate>    Set the UART baud rate (default: 115200).\n  -d <device>      Set the UART device (default: /dev/ttyS2).\n  -c <count>       Set the stress count (default: 100).\n  -o <directory>   Set the output directory for logs (default: ../log).\n  -h               Show this help message and exit.\n"})}),"\n",(0,i.jsx)(t.p,{children:"Parameter details:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"-b <baudrate>"}),": Sets the baud rate (default: 115200)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"-d <device>"}),": Specifies the UART device to test (default: ",(0,i.jsx)(t.code,{children:"/dev/ttyS2"}),")."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"-c <count>"}),": Defines the number of stress iterations (default: 100)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"-o <directory>"}),": Sets the log output directory (default: ",(0,i.jsx)(t.code,{children:"../log"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"Example:"}),(0,i.jsx)(t.br,{}),"\n","For instance, the command:",(0,i.jsx)(t.br,{}),"\n",(0,i.jsx)(t.code,{children:"./uartstress.sh -b 115200 -d /dev/ttyS2 -c 50 -o /app/chip_base_test"}),(0,i.jsx)(t.br,{}),"\n","configures the baud rate to 115200, uses UART device ",(0,i.jsx)(t.code,{children:"ttyS2"})," (corresponding to the actual UART in use), runs 50 test iterations, and outputs logs to ",(0,i.jsx)(t.code,{children:"/app/chip_base_test"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"usage-instructions-for-the-executable-program",children:"Usage Instructions for the Executable Program"}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"uart_test"})," program supports multiple test modes. Supported command-line options are as follows:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"Usage: uart_test [OPTIONS]\nOptions:\n  -s, --size      : Specify test data size in KB (default: 1024KB, max: 20480KB / 20MB)\n  -b, --baudrate  : Specify UART baud rate (default: 115200)\n  -c, --count     : Specify number of test iterations (default: infinite loop)\n  -d, --device    : Specify UART device path\n  -l, --loopback  : Enable UART loopback test\n  -r, --read-only : Enable UART read-only mode test\n  -w, --write-only: Enable UART write-only mode test\n  -D, --dual-loopback : Enable dual UART bidirectional loopback test (requires --uart2)\n  -u, --uart2     : Specify second UART device path (mandatory for dual loopback)\n  -V, --verbose   : Set log output mode via bitwise AND:  \n                    1 = send module logs;  \n                    2 = receive module logs;  \n                    4 = data verification logs.  \n                    Combine values (e.g., 3 = send + receive logs).\n  -h, --help      : Display help information\n"})}),"\n",(0,i.jsxs)(t.p,{children:["To change the test mode, simply replace ",(0,i.jsx)(t.code,{children:"-l"})," in the ",(0,i.jsx)(t.code,{children:"uartstress.sh"})," script with another test option. For example, for UART write-only mode:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:'"${script_dir}/uart_test" -w -s 1024 -c "$StressCount" -b "$Baudrate" -d "$Device" > "$uart_test_log_file"\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Afterwards, connect ",(0,i.jsx)(t.code,{children:"uart2_rx"})," and ",(0,i.jsx)(t.code,{children:"uart2_tx"})," to a PC using a TTL UART adapter module, and open a serial terminal tool to observe the transmitted data."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"Test uart device:/dev/ttyS2\nTest size: 2 KBytes, baudrate: 115200\nPerforming uart send...\nStarting send thread\nThis is uart send test 1 times\nThis is uart send test 2 times\nThis is uart send test 3 times\n"})}),"\n",(0,i.jsx)(t.h3,{id:"notes",children:"Notes"}),"\n",(0,i.jsx)(t.p,{children:"For better extensibility of the RDK_S100 interface, I2C5 and UART2 can be switched via DIP switches. To run this test, you must modify the device tree pin multiplexing configuration, recompile the DTB, install it, and set the DIP switch to the correct position."}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"1."})," To test UART2, modify the device tree as follows:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-diff",children:'diff --git a/kernel-dts/rdk-v0p5.dtsi b/kernel-dts/rdk-v0p5.dtsi\nindex 504b21b..8d72794 100644\n--- a/kernel-dts/rdk-v0p5.dtsi\n+++ b/kernel-dts/rdk-v0p5.dtsi\n@@ -210,6 +210,10 @@\n        status = "okay";\n\n };\n\n+&i2c5 {\n+       status = "disabled";\n+};\n\n &i2c4 {\n        status = "okay";\n@@ -267,6 +271,10 @@\n        };\n };\n\n+&uart2 {\n+       status="okay";\n+};\n+\n'})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"2."})," Refer to the RDK_S100 physical diagram below, locate UART2, and switch the DIP switch to the right to connect UART2:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/Actual_device_diagram.png",alt:"Actual_device_diagram"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"3."})," Consult the RDK_S100 schematic to identify the UART2 pins and connector locations, as shown:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/Schematic_diagram.png",alt:"Schematic_diagram"})}),"\n",(0,i.jsxs)(t.p,{children:["Then, use a female-to-female Dupont jumper wire to connect ",(0,i.jsx)(t.code,{children:"uart2_tx"})," and ",(0,i.jsx)(t.code,{children:"uart2_rx"}),"."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{src:"https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/images_to_upload/Connection_diagram.png",alt:"Connection_diagram"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"4."})," Confirm that the following three files exist in the ",(0,i.jsx)(t.code,{children:"/app/chip_base_test/03_uart_test"})," directory: ",(0,i.jsx)(t.code,{children:"uartstress.sh"}),", ",(0,i.jsx)(t.code,{children:"uart_test.c"}),", and ",(0,i.jsx)(t.code,{children:"uart_test"}),"."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"sunrise@ubuntu:/app/chip_base_test/03_uart_test$ tree\n.\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 Readme.md\n\u251c\u2500\u2500 uart_test.c\n\u2514\u2500\u2500 uartstress.sh\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.strong,{children:"5."})," You can regenerate the executable using the following compilation command:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"gcc -o uart_test uart_test.c\n"})}),"\n",(0,i.jsx)(t.p,{children:"After completing all preparations, run the test command:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"./uartstress.sh\n"})}),"\n",(0,i.jsx)(t.p,{children:"After running for a while, the log output will appear as follows:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"sunrise@ubuntu:/app/chip_base_test/03_uart_test# ./uartstress.sh\nUart test starting...\nTest configuration:\n  Baudrate: 115200\n  Device: /dev/ttyS2\n  Stress count: 100\n  Output directory: /app/chip_base_test/log\n  Log file: /app/chip_base_test/log/uart_test_log2.txt\n"})}),"\n",(0,i.jsxs)(t.p,{children:["If no additional messages appear in the console, check the log file directly under ",(0,i.jsx)(t.code,{children:"/app/chip_base_test/log/"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"sunrise@ubuntu:# cat /app/chip_base_test/log/uart_test_log2.txt\nTest uart device:/dev/ttyS2\nTest size: 512 KBytes, baudrate: 115200\nPerforming uart recv...\nPerforming uart send...\nPerforming data check...\nStarting send thread\nStarting receive thread  \nThis is receive test 1 times  \nThis is uart send test 1 times  \nThis is receive test 2 times  \nData verification successful. Received data matches sent data. Test total data count: 0x80000  \nThis is uart send test 2 times  \nThis is receive test 3 times  \nData verification successful. Received data matches sent data. Test total data count: 0x100000  \nThis is uart send test 3 times  \nThis is receive test 4 times  \nData verification successful. Received data matches sent data. Test total data count: 0x180000  \nThis is uart send test 4 times  \n\n"})}),"\n",(0,i.jsx)(t.h2,{id:"test-metrics",children:"Test Metrics"}),"\n",(0,i.jsxs)(t.p,{children:["After the test program starts, it generates the following files in the ",(0,i.jsx)(t.code,{children:"/app/chip_base_test/log/"})," directory:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"uart_test_log*.txt: Records print messages and current status during stress testing."}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The test objective is to ensure the system can operate stably for 48 hours without rebooting or hanging. To verify stability during the test, you can use the following command to check whether the log files contain abnormal messages such as ",(0,i.jsx)(t.code,{children:"fail"}),", ",(0,i.jsx)(t.code,{children:"error"}),", or ",(0,i.jsx)(t.code,{children:"timeout"}),":"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"cd \"/app/chip_base_test/log/\" && grep -iE 'error|fail|timeout' uart_test_log*.txt\n"})}),"\n",(0,i.jsx)(t.h3,{id:"uart-stress-test-results",children:"UART Stress Test Results"}),"\n",(0,i.jsx)(t.p,{children:"After the test script finishes execution, the log files were inspected and no abnormal status messages were found, indicating that the stress test has passed."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"This is receive test 48 times  \nData verification successful. Received data matches sent data. Test total data count: 0x1780000  \nThis is uart send test 48 times  \nThis is receive test 49 times  \nData verification successful. Received data matches sent data. Test total data count: 0x1800000  \nThis is uart send test 49 times  \nThis is receive test 50 times  \nData verification successful. Received data matches sent data. Test total data count: 0x1880000  \nThis is uart send test 50 times  \n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}}}]);