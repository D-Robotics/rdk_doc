<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Robot_development/tros_dev/zero_copy" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">5.5.1 Using &quot;zero-copy&quot; | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/en/Robot_development/tros_dev/zero_copy"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="5.5.1 Using &quot;zero-copy&quot; | RDK DOC"><meta data-rh="true" name="description" content="Background"><meta data-rh="true" property="og:description" content="Background"><link data-rh="true" rel="icon" href="/rdk_doc/en/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/en/Robot_development/tros_dev/zero_copy"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Robot_development/tros_dev/zero_copy" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/Robot_development/tros_dev/zero_copy" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Robot_development/tros_dev/zero_copy" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"5. Robotics Application Development","item":"https://developer.d-robotics.cc/rdk_doc/en/Robot_development"},{"@type":"ListItem","position":2,"name":"5.5.1 Using \"zero-copy\"","item":"https://developer.d-robotics.cc/rdk_doc/en/Robot_development/tros_dev/zero_copy"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/en/assets/css/styles.0fbd7d27.css">
<script src="/rdk_doc/en/assets/js/runtime~main.235d5147.js" defer="defer"></script>
<script src="/rdk_doc/en/assets/js/main.234f0fe6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/en/RDK">RDK X3 / X5</a><a class="navbar__item navbar__link" href="/rdk_doc/en/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>EN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/Robot_development/tros_dev/zero_copy" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/Robot_development/tros_dev/zero_copy" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/en/RDK">D-Robotics RDK Suite</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Quick_start">1. Quick Start</a><button aria-label="Expand sidebar category &#x27;1. Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/System_configuration">2. System Configuration</a><button aria-label="Expand sidebar category &#x27;2. System Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Basic_Application">3. Basic Application Development</a><button aria-label="Expand sidebar category &#x27;3. Basic Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Basic_Development">4. Algorithm Application Development</a><button aria-label="Expand sidebar category &#x27;4. Algorithm Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/en/Robot_development">5. Robotics Application Development</a><button aria-label="Collapse sidebar category &#x27;5. Robotics Application Development&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros">TogetheROS.Bot</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Robot_development/quick_start/preparation">5.1 System Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Robot_development/quick_demo/demo_sensor">5.2 Feature Experience</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Robot_development/boxs/detection/fcos">5.3 Boxs Algorithm Repository</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Robot_development/apps/slam">5.4 Apps Application Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/zero_copy">5.5 Feature Development</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/zero_copy">5.5.1 Using &quot;zero-copy&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/ai_predict">5.5.2 Model Inference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/breakpad">5.5.3 Using Breakpad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/flame_graph">5.5.4 Performance Flame Graph</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/mono2d_trash_detection">5.5.5 Garbage Detection</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Application_case">6. Application Development Guide</a><button aria-label="Expand sidebar category &#x27;6. Application Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Advanced_development">7. Advanced Development</a><button aria-label="Expand sidebar category &#x27;7. Advanced Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/FAQ">8. FAQs</a><button aria-label="Expand sidebar category &#x27;8. FAQs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Appendix">9. Appendix</a><button aria-label="Expand sidebar category &#x27;9. Appendix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/en/Release_Note/release_note">10. Version release</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rdk_doc/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/Robot_development"><span>5. Robotics Application Development</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">5.5 Feature Development</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">5.5.1 Using &quot;zero-copy&quot;</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>5.5.1 Using &quot;zero-copy&quot;</h1></header>
<!-- -->
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h2>
<p>Communication is a fundamental function of the robot development engine. When using native ROS for large-scale data communication, there may be issues such as high latency and system load. TogetheROS.Bot implements the &quot;zero-copy&quot; feature based on the D-Robotics Systems software library hbmem, which enables zero-copy transmission of data across processes, greatly reducing transmission latency and system resource usage for large data blocks. This section explains how to use the tros.b hbmem interface to create a publisher and subscriber node for large-scale data transmission, and calculate transmission latency.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><ul>
<li>The tros.b Foxy version adds a &quot;zero-copy&quot; function based on ROS2 Foxy.</li>
<li>The tros.b Humble version uses the &quot;zero-copy&quot; function of ROS2 Humble. For specific usage, please refer to the ROS2 official <a href="https://docs.ros.org/en/humble/Tutorials/Advanced/FastDDS-Configuration.html#" target="_blank" rel="noopener noreferrer">document</a> and <a href="https://github.com/ros2/demos/blob/humble/demo_nodes_cpp/src/topics/talker_loaned_message.cpp" target="_blank" rel="noopener noreferrer">code</a>.</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2>
<ol>
<li>tros.b has been successfully installed following the guide <a href="/rdk_doc/en/Robot_development/quick_start/install_tros">Installation</a>.</li>
<li>Familiarity with ROS2 nodes, topics, QoS, as well as creating packages and using custom messages. For detailed tutorials, please refer to the <a href="https://docs.ros.org/en/foxy/Tutorials.html" target="_blank" rel="noopener noreferrer">official ROS2 documentation</a>.</li>
<li>The ROS2 package build system ament_cmake has been installed. Installation command: <code>apt update; apt-get install python3-catkin-pkg; pip3 install empy</code>.</li>
<li>Development tools: Compilers and other tools to build ROS packages. <code>sudo apt install ros-dev-tools</code></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-create-a-package">1. Create a package<a href="#1-create-a-package" class="hash-link" aria-label="Direct link to 1. Create a package" title="Direct link to 1. Create a package">​</a></h3>
<p>Open a new terminal and source the tros.b setup script to ensure that the <code>ros2</code> command can be run.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Foxy</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Humble</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/humble/setup.bash</span><br></span></code></pre></div></div></div></div></div>
<p>Create a workspace using the following command. For detailed instructions, refer to the ROS2 official tutorial <a href="https://docs.ros.org/en/foxy/Tutorials/Workspace/Creating-A-Workspace.html" target="_blank" rel="noopener noreferrer">Creating a workspace</a>.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/dev_ws/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws/src</span><br></span></code></pre></div></div>
<p>Run the following command to create a package.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ros2 pkg create --build-type ament_cmake hbmem_pubsub</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-create-a-custom-message">2. Create a custom message<a href="#2-create-a-custom-message" class="hash-link" aria-label="Direct link to 2. Create a custom message" title="Direct link to 2. Create a custom message">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="21-create-a-message-file">2.1 Create a message file<a href="#21-create-a-message-file" class="hash-link" aria-label="Direct link to 2.1 Create a message file" title="Direct link to 2.1 Create a message file">​</a></h4>
<p>Run the following command to create a <code>msg</code> directory to store the custom message file.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws/src/hbmem_pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir msg</span><br></span></code></pre></div></div>
<p>In the <code>msg</code> directory, create a new file named <code>SampleMessage.msg</code> with the following content:</p>
<div class="language-idl codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-idl codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int32 index</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint64 time_stamp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint8[4194304] data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint32 MAX_SIZE=4194304</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="22-dependency-compilation">2.2 Dependency Compilation<a href="#22-dependency-compilation" class="hash-link" aria-label="Direct link to 2.2 Dependency Compilation" title="Direct link to 2.2 Dependency Compilation">​</a></h4>
<p>Return to the <code>~/dev_ws/src/hbmem_pubsub</code> directory and modify <code>package.xml</code>. Add the following content under <code>&lt;buildtool_depend&gt;ament_cmake&lt;/buildtool_depend&gt;</code>:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rosidl_default_generators</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">exec_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rosidl_default_runtime</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">exec_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">member_of_group</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rosidl_interface_packages</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">member_of_group</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="23-compilation-script">2.3 Compilation Script<a href="#23-compilation-script" class="hash-link" aria-label="Direct link to 2.3 Compilation Script" title="Direct link to 2.3 Compilation Script">​</a></h4>
<p>Modify <code>CMakeLists.txt</code> and add the following content under <code># find_package(&lt;dependency&gt; REQUIRED)</code> to compile the msg:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">find_package(rosidl_default_generators REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rosidl_generate_interfaces(${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;msg/SampleMessage.msg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-create-message-publishing-node">3. Create Message Publishing Node<a href="#3-create-message-publishing-node" class="hash-link" aria-label="Direct link to 3. Create Message Publishing Node" title="Direct link to 3. Create Message Publishing Node">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="31-create-a-new-message-publishing-node-file">3.1 Create a New Message Publishing Node File<a href="#31-create-a-new-message-publishing-node-file" class="hash-link" aria-label="Direct link to 3.1 Create a New Message Publishing Node File" title="Direct link to 3.1 Create a New Message Publishing Node File">​</a></h4>
<p>In the <code>~/dev_ws/src/hbmem_pubsub/src</code> directory, create a new file named <code>publisher_hbmem.cpp</code>. This file is used to create the publisher node. The code and explanation are as follows:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Foxy</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Humble</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;chrono&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;functional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;memory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;rclcpp/rclcpp.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hbmem_pubsub/msg/sample_message.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using namespace std::chrono_literals;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MinimalHbmemPublisher : public rclcpp::Node {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MinimalHbmemPublisher() : Node(&quot;minimal_hbmem_publisher&quot;), count_(0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create publisher_hbmem, topic is &quot;topic&quot;, QoS is KEEPLAST(10), and default reliability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publisher_ = this-&gt;create_publisher_hbmem&lt;hbmem_pubsub::msg::SampleMessage&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;topic&quot;, 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Timer, calls timer_callback every 40 milliseconds for message publishing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timer_ = this-&gt;create_wall_timer(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        40ms, std::bind(&amp;MinimalHbmemPublisher::timer_callback, this));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Timer callback function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void timer_callback() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Get the message to send</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto loanedMsg = publisher_-&gt;borrow_loaned_message();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Check if the message is valid, it may become invalid if borrowing the message fails</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (loanedMsg.is_valid()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Get the actual message by reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto&amp; msg = loanedMsg.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Get the current time in microseconds</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto time_now =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              std::chrono::steady_clock::now().time_since_epoch()).count();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Assign values to the index and time_stamp of the message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      msg.index = count_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      msg.time_stamp = time_now;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Print the message to be sent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RCLCPP_INFO(this-&gt;get_logger(), &quot;message: %d&quot;, msg.index);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      publisher_-&gt;publish(std::move(loanedMsg));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Note that loanedMsg is no longer valid after publishing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Increment the counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      count_++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // Failed to get the message, discard it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RCLCPP_INFO(this-&gt;get_logger(), &quot;Failed to get LoanMessage!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Timer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::TimerBase::SharedPtr timer_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Hbmem publisher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::PublisherHbmem&lt;hbmem_pubsub::msg::SampleMessage&gt;::SharedPtr publisher_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  size_t count_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char * argv[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::init(argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::spin(std::make_shared&lt;MinimalHbmemPublisher&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;chrono&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;functional&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;memory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;string&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;rclcpp/rclcpp.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hbmem_pubsub/msg/sample_message.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using namespace std::chrono_literals;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MinimalHbmemPublisher  : public rclcpp::Node {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MinimalHbmemPublisher () : Node(&quot;minimal_hbmem_publisher&quot;), count_(0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    publisher_ = this-&gt;create_publisher&lt;hbmem_pubsub::msg::SampleMessage&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;topic&quot;, rclcpp::SensorDataQoS());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timer_ = this-&gt;create_wall_timer(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        40ms, std::bind(&amp;MinimalHbmemPublisher ::timer_callback, this));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void timer_callback() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto loanedMsg = publisher_-&gt;borrow_loaned_message();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (loanedMsg.is_valid()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto&amp; msg = loanedMsg.get();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      auto time_now =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              std::chrono::steady_clock::now().time_since_epoch()).count();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      msg.index = count_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      msg.time_stamp = time_now;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RCLCPP_INFO(this-&gt;get_logger(), &quot;message: %d&quot;, msg.index);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      publisher_-&gt;publish(std::move(loanedMsg));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      count_++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RCLCPP_INFO(this-&gt;get_logger(), &quot;Failed to get LoanMessage!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::TimerBase::SharedPtr timer_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::Publisher&lt;hbmem_pubsub::msg::SampleMessage&gt;::SharedPtr publisher_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  size_t count_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char * argv[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::init(argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::spin(std::make_shared&lt;MinimalHbmemPublisher&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="32-compilation-dependencies">3.2 Compilation Dependencies<a href="#32-compilation-dependencies" class="hash-link" aria-label="Direct link to 3.2 Compilation Dependencies" title="Direct link to 3.2 Compilation Dependencies">​</a></h4>
<p>Go back to the <code>~/dev_ws/src/hbmem_pubsub</code> directory, modify the <code>package.xml</code>, and add the <code>rclcpp</code> dependency under <code>&lt;member_of_group&gt;rosidl_interface_packages&lt;/member_of_group&gt;</code>:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rclcpp</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="33-compilation-script">3.3 Compilation Script<a href="#33-compilation-script" class="hash-link" aria-label="Direct link to 3.3 Compilation Script" title="Direct link to 3.3 Compilation Script">​</a></h4>
<p>Modify <code>CMakeLists.txt</code>, add the following content below the <code>rosidl_generate_interfaces</code> statement to complete the publisher compilation:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">find_package(rclcpp REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(talker src/publisher_hbmem.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_target_dependencies(talker rclcpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rosidl_target_interfaces(talker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${PROJECT_NAME} &quot;rosidl_typesupport_cpp&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(TARGETS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  talker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DESTINATION lib/${PROJECT_NAME})</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-create-message-reception-node">4. Create Message Reception Node<a href="#4-create-message-reception-node" class="hash-link" aria-label="Direct link to 4. Create Message Reception Node" title="Direct link to 4. Create Message Reception Node">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="41-create-a-new-message-reception-node-file">4.1 Create a New Message Reception Node File<a href="#41-create-a-new-message-reception-node-file" class="hash-link" aria-label="Direct link to 4.1 Create a New Message Reception Node File" title="Direct link to 4.1 Create a New Message Reception Node File">​</a></h4>
<p>Create a new file <code>subscriber_hbmem.cpp</code> in the <code>~/dev_ws/src/hbmem_pubsub/src</code> directory to establish a subscriber node. The specific code and explanation are as follows:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Foxy</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Humble</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;memory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;rclcpp/rclcpp.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hbmem_pubsub/msg/sample_message.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MinimalHbmemSubscriber  : public rclcpp::Node {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MinimalHbmemSubscriber () : Node(&quot;minimal_hbmem_subscriber&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Create subscription_hbmem with topic &quot;sample&quot;, QoS as KEEPLAST(10), and default reliability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Message callback function is topic_callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subscription_ =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this-&gt;create_subscription_hbmem&lt;hbmem_pubsub::msg::SampleMessage&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;topic&quot;, 10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            std::bind(&amp;MinimalHbmemSubscriber ::topic_callback, this,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      std::placeholders::_1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Message callback function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void topic_callback(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const hbmem_pubsub::msg::SampleMessage::SharedPtr msg) const {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Note that msg can only be used within the callback function, the message will be released after the callback function returns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Get current time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto time_now =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            std::chrono::steady_clock::now().time_since_epoch())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .count();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Calculate delay and print it out</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_INFO(this-&gt;get_logger(), &quot;msg %d, time cost %dus&quot;, msg-&gt;index,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                time_now - msg-&gt;time_stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // hbmem subscription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::SubscriptionHbmem&lt;hbmem_pubsub::msg::SampleMessage&gt;::SharedPtr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      subscription_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char * argv[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::init(argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::spin(std::make_shared&lt;MinimalHbmemSubscriber&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;memory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;rclcpp/rclcpp.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hbmem_pubsub/msg/sample_message.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MinimalHbmemSubscriber  : public rclcpp::Node {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  MinimalHbmemSubscriber () : Node(&quot;minimal_hbmem_subscriber&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subscription_ =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this-&gt;create_subscription&lt;hbmem_pubsub::msg::SampleMessage&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;topic&quot;, rclcpp::SensorDataQoS(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            std::bind(&amp;MinimalHbmemSubscriber ::topic_callback, this,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      std::placeholders::_1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void topic_callback(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      const hbmem_pubsub::msg::SampleMessage::SharedPtr msg) const {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    auto time_now =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            std::chrono::steady_clock::now().time_since_epoch())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .count();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_INFO(this-&gt;get_logger(), &quot;msg %d, time cost %dus&quot;, msg-&gt;index,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                time_now - msg-&gt;time_stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // hbmem subscription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::Subscription&lt;hbmem_pubsub::msg::SampleMessage&gt;::SharedPtr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      subscription_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char * argv[])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::init(argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::spin(std::make_shared&lt;MinimalHbmemSubscriber&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="42-build-script">4.2 Build script<a href="#42-build-script" class="hash-link" aria-label="Direct link to 4.2 Build script" title="Direct link to 4.2 Build script">​</a></h4>
<p>Go back to the <code>~/dev_ws/src/hbmem_pubsub</code> directory, as we have added the <code>rclcpp</code> dependency in the <code>package.xml</code>, there is no need to modify it.</p>
<p>Modify the <code>CMakeLists.txt</code> file, add the following content below the <code>install</code> statement, to complete the build of the subscriber:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(listener src/subscriber_hbmem.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_target_dependencies(listener rclcpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rosidl_target_interfaces(listener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${PROJECT_NAME} &quot;rosidl_typesupport_cpp&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(TARGETS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DESTINATION lib/${PROJECT_NAME})</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-build">5. Build<a href="#5-build" class="hash-link" aria-label="Direct link to 5. Build" title="Direct link to 5. Build">​</a></h3>
<p>The directory structure of the entire workspace is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dev_ws/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── hbmem_pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── hbmem_pubsub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── SampleMessage.msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── package.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ├── publisher_hbmem.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └── subscriber_hbmem.cpp</span><br></span></code></pre></div></div>
<p>entire <code>package.xml</code>as follows:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version=&quot;1.0&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml-model href=&quot;http://download.ros.org/schema/package_format3.xsd&quot; schematypens=&quot;http://www.w3.org/2001/XMLSchema&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">package</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">format</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">3</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">hbmem_pubsub</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">name</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">0.0.0</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">TODO: Package description</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">description</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">maintainer</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">email</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">root@todo.todo</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">root</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">maintainer</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">license</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">TODO: License declaration</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">license</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">buildtool_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">ament_cmake</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">buildtool_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rosidl_default_generators</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">exec_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rosidl_default_runtime</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">exec_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">member_of_group</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rosidl_interface_packages</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">member_of_group</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">rclcpp</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">test_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">ament_lint_auto</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">test_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">test_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">ament_lint_common</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">test_depend</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">export</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">build_type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">ament_cmake</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">build_type</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">export</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">package</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>The complete <code>CMakeLists.txt</code> content is as follows:</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake_minimum_required(VERSION 3.5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project(hbmem_pubsub)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Default to C99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(NOT CMAKE_C_STANDARD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set(CMAKE_C_STANDARD 99)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Default to C++14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(NOT CMAKE_CXX_STANDARD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set(CMAKE_CXX_STANDARD 14)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES &quot;Clang&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  add_compile_options(-Wall -Wextra -Wpedantic)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># find dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(ament_cmake REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># uncomment the following section in order to fill in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># further dependencies manually.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># find_package(&lt;dependency&gt; REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(rosidl_default_generators REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rosidl_generate_interfaces(${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;msg/SampleMessage.msg&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(rclcpp REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(talker src/publisher_hbmem.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_target_dependencies(talker rclcpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rosidl_target_interfaces(talker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${PROJECT_NAME} &quot;rosidl_typesupport_cpp&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(TARGETS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  talker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DESTINATION lib/${PROJECT_NAME})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(listener src/subscriber_hbmem.cpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_target_dependencies(listener rclcpp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rosidl_target_interfaces(listener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${PROJECT_NAME} &quot;rosidl_typesupport_cpp&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(TARGETS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listener</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  DESTINATION lib/${PROJECT_NAME})</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(BUILD_TESTING)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  find_package(ament_lint_auto REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # the following line skips the linter which checks for copyrights</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # uncomment the line when a copyright and license is not present in all source files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #set(ament_cmake_copyright_FOUND TRUE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # the following line skips cpplint (only works in a git repo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  # uncomment the line when this package is not in a git repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #set(ament_cmake_cpplint_FOUND TRUE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ament_lint_auto_find_test_dependencies()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_package()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>In the workspace root directory <code>~/dev_ws</code>, build the package:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">colcon build --packages-select hbmem_pubsub</span><br></span></code></pre></div></div>
<p>If the <code>colcon</code> command is not installed, use the following command to install it:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install ros-dev-tools</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="6-run">6. Run<a href="#6-run" class="hash-link" aria-label="Direct link to 6. Run" title="Direct link to 6. Run">​</a></h3>
<p>Open a new terminal, cd to the dev_ws directory, source tros.b and the current workspace setup file:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Foxy</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Humble</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">. install/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run hbmem_pubsub talker</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/humble/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">. install/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export RMW_IMPLEMENTATION=rmw_fastrtps_cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export FASTRTPS_DEFAULT_PROFILES_FILE=/opt/tros/humble/lib/hobot_shm/config/shm_fastdds.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export RMW_FASTRTPS_USE_QOS_FROM_XML=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ROS_DISABLE_LOANED_MESSAGES=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run hbmem_pubsub talker</span><br></span></code></pre></div></div></div></div></div>
<p>On the terminal, the following prints will appear:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227473.431381673] [minimal_hbmem_publisher]: message: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227473.470746697] [minimal_hbmem_publisher]: message: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227473.510923361] [minimal_hbmem_publisher]: message: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227473.550886783] [minimal_hbmem_publisher]: message: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227473.590664377] [minimal_hbmem_publisher]: message: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227473.630857041] [minimal_hbmem_publisher]: message: 5</span><br></span></code></pre></div></div>
<p>Open another terminal and <code>cd</code> to the <code>dev_ws</code> directory, then source the setup file and run the listener node:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Foxy</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Humble</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">. install/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run hbmem_pubsub listener</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/humble/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">. install/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export RMW_IMPLEMENTATION=rmw_fastrtps_cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export FASTRTPS_DEFAULT_PROFILES_FILE=/opt/tros/humble/lib/hobot_shm/config/shm_fastdds.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export RMW_FASTRTPS_USE_QOS_FROM_XML=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export ROS_DISABLE_LOANED_MESSAGES=0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run hbmem_pubsub listener</span><br></span></code></pre></div></div></div></div></div>
<p>On the terminal, the following prints will appear, indicating that the subscriber has successfully received the messages sent by the publisher:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227450.387089523] [minimal_hbmem_subscriber]: msg 10, time cost 1663us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227450.427071280] [minimal_hbmem_subscriber]: msg 11, time cost 1713us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227450.466993413] [minimal_hbmem_subscriber]: msg 12, time cost 1622us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227450.507029960] [minimal_hbmem_subscriber]: msg 13, time cost 1666us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227450.546146910] [minimal_hbmem_subscriber]: msg 14, time cost 998us</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO] [1649227450.587002681] [minimal_hbmem_subscriber]: msg 15, time cost 1768us</span><br></span></code></pre></div></div>
<p>You can use <code>Ctrl+C</code> to end the execution of each node.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-of-this-section">Summary of this section<a href="#summary-of-this-section" class="hash-link" aria-label="Direct link to Summary of this section" title="Direct link to Summary of this section">​</a></h2>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Foxy</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Humble</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>If you have learned how to use ROS2 publishers and subscribers, it is easy to switch to using hbmem publishers and subscribers. You just need to make the following changes:</p><ul>
<li><strong>rclcpp::Publisher</strong> to <strong>rclcpp::PublisherHbmem</strong></li>
<li><strong>create_publisher</strong> to <strong>create_publisher_hbmem</strong></li>
<li><strong>rclcpp::Subscription</strong> to <strong>rclcpp::SubscriptionHbmem</strong></li>
<li><strong>create_subscription</strong> to <strong>create_subscription_hbmem</strong></li>
<li>In the publisher, call <strong>borrow_loaned_message</strong> to get the message, then <strong>check if the message is available</strong>, and if it is, assign the value and send it.</li>
<li>In the subscriber, process the received message in the callback function, and <strong>the received message can only be used in the callback function</strong>. Once the callback function is executed, the message will be released.</li>
</ul><p>Note:- Using zero-copy based on hbmem will occupy ion memory. If multiple large messages publishers are created, there may be insufficient ion memory, resulting in creation failure issues.</p><ul>
<li>When creating a publisher, ion memory that is three times the size of KEEPLAST multiplied by the number of messages will be requested at one time (up to 256MB maximum), which is used for message transmission and will not be dynamically allocated afterwards. If there is an error in message handling on the subscriber side or if it is not processed in a timely manner, the message buffer may be fully occupied, causing the publisher to continuously fail to obtain available messages.</li>
</ul></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>If you have mastered how to use ROS2 publisher and subscriber, it is easy to switch to using zero-copy publisher and subscriber. You only need to make the following changes when using it:</p><ul>
<li><strong>publisher</strong> must first call <strong>borrow_loaned_message</strong> to obtain the message before sending it, and then <strong>confirm whether the message is available</strong>. If it is available, assign it and send it.</li>
<li><strong>subscription</strong> processes the received message in the callback function, and <strong>the received message can only be used</strong> in the callback function. After the callback function is executed, the message will be released</li>
<li>Before <strong>running</strong> the program, use the export command to configure a zero-copy environment in the running terminal.</li>
</ul></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="limitations">Limitations<a href="#limitations" class="hash-link" aria-label="Direct link to Limitations" title="Direct link to Limitations">​</a></h2>
<p>Compared to the publisher/subscriber data transmission method in ROS2, using zero-copy transmission based on hbmem has the following limitations:</p>
<ul>
<li>QOS History only supports KEEPLAST and does not support KEEPALL. Additionally, KEEPLAST cannot be set too large due to memory limitations. Currently, it is set to a maximum of 256MB memory usage.</li>
<li>The size of the transmitted message is fixed, meaning the <code>sizeof</code> value of the message remains unchanged and cannot include variable-length data types such as strings or dynamic arrays.</li>
<li>It can only be used for inter-process communication on the same device and cannot be transmitted across devices.</li>
<li>Publisher messages need to be obtained first and then assigned for sending, and it needs to be checked if the acquisition is successful.</li>
<li>The validity period of received messages on the subscriber side is limited to the callback function and cannot be used outside of the callback function.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-09-26T07:58:06.000Z" itemprop="dateModified">Sep 26, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/en/Robot_development/apps/hobot_llamacpp"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">5.4.10 Vision &amp; Speech Box</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/en/Robot_development/tros_dev/ai_predict"><div class="pagination-nav__sublabel">Next </div><div class="pagination-nav__label">5.5.2 Model Inference</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#1-create-a-package" class="table-of-contents__link toc-highlight">1. Create a package</a></li><li><a href="#2-create-a-custom-message" class="table-of-contents__link toc-highlight">2. Create a custom message</a><ul><li><a href="#21-create-a-message-file" class="table-of-contents__link toc-highlight">2.1 Create a message file</a></li><li><a href="#22-dependency-compilation" class="table-of-contents__link toc-highlight">2.2 Dependency Compilation</a></li><li><a href="#23-compilation-script" class="table-of-contents__link toc-highlight">2.3 Compilation Script</a></li></ul></li><li><a href="#3-create-message-publishing-node" class="table-of-contents__link toc-highlight">3. Create Message Publishing Node</a><ul><li><a href="#31-create-a-new-message-publishing-node-file" class="table-of-contents__link toc-highlight">3.1 Create a New Message Publishing Node File</a></li><li><a href="#32-compilation-dependencies" class="table-of-contents__link toc-highlight">3.2 Compilation Dependencies</a></li><li><a href="#33-compilation-script" class="table-of-contents__link toc-highlight">3.3 Compilation Script</a></li></ul></li><li><a href="#4-create-message-reception-node" class="table-of-contents__link toc-highlight">4. Create Message Reception Node</a><ul><li><a href="#41-create-a-new-message-reception-node-file" class="table-of-contents__link toc-highlight">4.1 Create a New Message Reception Node File</a></li><li><a href="#42-build-script" class="table-of-contents__link toc-highlight">4.2 Build script</a></li></ul></li><li><a href="#5-build" class="table-of-contents__link toc-highlight">5. Build</a></li><li><a href="#6-run" class="table-of-contents__link toc-highlight">6. Run</a></li></ul></li><li><a href="#summary-of-this-section" class="table-of-contents__link toc-highlight">Summary of this section</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GuYueHome<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact US</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 D-Robotics.</div></div></div></footer></div>
</body>
</html>