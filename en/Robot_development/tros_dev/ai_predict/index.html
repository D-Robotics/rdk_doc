<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Robot_development/tros_dev/ai_predict" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">5.5.2 Model Inference | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/en/Robot_development/tros_dev/ai_predict"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="5.5.2 Model Inference | RDK DOC"><meta data-rh="true" name="description" content="Model Inference Development"><meta data-rh="true" property="og:description" content="Model Inference Development"><link data-rh="true" rel="icon" href="/rdk_doc/en/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/en/Robot_development/tros_dev/ai_predict"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Robot_development/tros_dev/ai_predict" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/Robot_development/tros_dev/ai_predict" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Robot_development/tros_dev/ai_predict" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"5. Robotics Application Development","item":"https://developer.d-robotics.cc/rdk_doc/en/Robot_development"},{"@type":"ListItem","position":2,"name":"5.5.2 Model Inference","item":"https://developer.d-robotics.cc/rdk_doc/en/Robot_development/tros_dev/ai_predict"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/en/assets/css/styles.50b7a244.css">
<script src="/rdk_doc/en/assets/js/runtime~main.185ec097.js" defer="defer"></script>
<script src="/rdk_doc/en/assets/js/main.4e710b95.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/en/RDK">RDK X3 / X5</a><a class="navbar__item navbar__link" href="/rdk_doc/en/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>EN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/Robot_development/tros_dev/ai_predict" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/Robot_development/tros_dev/ai_predict" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/en/RDK">D-Robotics RDK Suite</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Quick_start">1. Quick Start</a><button aria-label="Expand sidebar category &#x27;1. Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/System_configuration">2. System Configuration</a><button aria-label="Expand sidebar category &#x27;2. System Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Basic_Application">3. Basic Application Development</a><button aria-label="Expand sidebar category &#x27;3. Basic Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Basic_Development">4. Algorithm Application Development</a><button aria-label="Expand sidebar category &#x27;4. Algorithm Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/en/Robot_development">5. Robotics Application Development</a><button aria-label="Collapse sidebar category &#x27;5. Robotics Application Development&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros">TogetheROS.Bot</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Robot_development/quick_start/preparation">5.1 System Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Robot_development/quick_demo/demo_sensor">5.2 Feature Experience</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Robot_development/boxs/detection/fcos">5.3 Boxs Algorithm Repository</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/en/Robot_development/apps/slam">5.4 Apps Application Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/zero_copy">5.5 Feature Development</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/zero_copy">5.5.1 Using &quot;zero-copy&quot;</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/ai_predict">5.5.2 Model Inference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/breakpad">5.5.3 Using Breakpad</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/flame_graph">5.5.4 Performance Flame Graph</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Robot_development/tros_dev/mono2d_trash_detection">5.5.5 Garbage Detection</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Application_case">6. Application Development Guide</a><button aria-label="Expand sidebar category &#x27;6. Application Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Advanced_development">7. Advanced Development</a><button aria-label="Expand sidebar category &#x27;7. Advanced Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/FAQ">8. FAQs</a><button aria-label="Expand sidebar category &#x27;8. FAQs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Appendix">9. Appendix</a><button aria-label="Expand sidebar category &#x27;9. Appendix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rdk_doc/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/Robot_development"><span>5. Robotics Application Development</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">5.5 Feature Development</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">5.5.2 Model Inference</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>5.5.2 Model Inference</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-inference-development">Model Inference Development<a href="#model-inference-development" class="hash-link" aria-label="Direct link to Model Inference Development" title="Direct link to Model Inference Development">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a href="#background" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h3>
<p><code>hobot_dnn</code> is the edge algorithm inference framework in TogetheROS.Bot software stack. It utilizes the BPU processor on RDK to achieve algorithm inference. Based on the D-Robotics algorithm inference framework and ROS2 Node, it provides a simpler and easier-to-use model integration development interface for robot application development. This includes model management, model description-based input processing and result parsing, and model output memory allocation management.</p>
<p>By reading this chapter, users can use the models provided by D-Robotics to create and run a human detection algorithm Node based on <code>hobot_dnn</code> on RDK. With the help of the components provided by tros.b, it subscribes to the images captured and published by the camera, performs algorithm inference to detect human bounding boxes, and uses the Multi-Object Tracking (MOT) algorithm to track and assign target numbers to the detection boxes. Finally, it achieves real-time rendering and display of images, human bounding box detection, and target tracking results in a web browser on a PC.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparation">Preparation<a href="#preparation" class="hash-link" aria-label="Direct link to Preparation" title="Direct link to Preparation">​</a></h3>
<ol>
<li>
<p>RDK development board with relevant software installed, including:</p>
<ul>
<li>Ubuntu 20.04/22.04 system image provided by D-Robotics.</li>
<li>tros.b software package.</li>
<li>Development tools: Compilers and other tools to build ROS packages. <code>sudo apt install ros-dev-tools</code></li>
</ul>
</li>
<li>
<p>RDK with F37 or GC4663 camera installed.</p>
</li>
<li>
<p>PC that can access RDK through the network.</p>
</li>
</ol>
<p>For detailed instructions on how to use <code>hobot_dnn</code>, please refer to the <a href="https://github.com/D-Robotics/hobot_dnn/blob/develop/README.md" target="_blank" rel="noopener noreferrer">README.md</a> and <a href="https://github.com/D-Robotics/hobot_dnn/blob/develop/dnn_node/docs/API-Manual/API-Manual.md" target="_blank" rel="noopener noreferrer">API documentation</a> in the <code>hobot_dnn</code> code. The workflow of using <code>hobot_dnn</code> is as follows:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/dnnnode_workflow.jpg" alt="" class="img_ev3q"></p>
<p>Without understanding the workflow of using <code>hobot_dnn</code>, users can also follow the steps in this chapter to develop a model inference example using <code>hobot_dnn</code>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The following content in this chapter uses the tros.b Foxy version as an example. If you are using the tros.b Humble version, just replace the <code>source /opt/tros/setup.bash</code> command with <code>source /opt/tros/humble/ setup.bash</code>.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage">Usage<a href="#usage" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-create-package">1. Create package<a href="#1-create-package" class="hash-link" aria-label="Direct link to 1. Create package" title="Direct link to 1. Create package">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/dev_ws/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 pkg create --build-type ament_cmake cpp_dnn_demo --dependencies rclcpp sensor_msgs hbm_img_msgs ai_msgs dnn_node hobot_mot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">touch src/body_det_demo.cpp</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-write-examplethe-created-project-path-can-be-viewed-as-follows">2. Write exampleThe created project path can be viewed as follows:<a href="#2-write-examplethe-created-project-path-can-be-viewed-as-follows" class="hash-link" aria-label="Direct link to 2. Write exampleThe created project path can be viewed as follows:" title="Direct link to 2. Write exampleThe created project path can be viewed as follows:">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# cd ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# tree dev_ws/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev_ws/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── package.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └── body_det_demo.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 directories, 3 files</span><br></span></code></pre></div></div>
<p>Open the created source code file <code>body_det_demo.cpp</code> using tools like vi/vim on the RDK: <code>vi ~/dev_ws/src/cpp_dnn_demo/src/body_det_demo.cpp</code></p>
<p>Copy the following code into the file:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/dnn_node.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/util/image_proc.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/util/output_parser/detection/fasterrcnn_output_parser.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;sensor_msgs/msg/image.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;ai_msgs/msg/perception_targets.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hbm_img_msgs/msg/hbm_msg1080_p.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hobot_mot/hobot_mot.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create an algorithm inference output data structure and add message header information as a member</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct FasterRcnnOutput : public hobot::dnn_node::DnnNodeOutput {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;std_msgs::msg::Header&gt; image_msg_header = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Inherit from the DnnNode base class and create an algorithm inference node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class BodyDetNode : public hobot::dnn_node::DnnNode {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BodyDetNode(const std::string &amp;node_name = &quot;body_det&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const rclcpp::NodeOptions &amp;options = rclcpp::NodeOptions());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> protected:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Implement the pure virtual interface of the base class to configure Node parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int SetNodePara() override;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Implement the virtual interface of the base class to encapsulate the parsed model output data into ROS Msg and publish it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt; &amp;node_output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Width and height of the input image data for the algorithm model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int model_input_width_ = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int model_input_height_ = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Model output index corresponding to the body detection box result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const int32_t box_output_index_ = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Collection of detection box output indexes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const std::vector&lt;int32_t&gt; box_outputs_index_ = {box_output_index_};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Image message subscriber</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::SubscriptionHbmem&lt;hbm_img_msgs::msg::HbmMsg1080P&gt;::ConstSharedPtr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ros_img_subscription_ = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Algorithm inference result message publisher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::Publisher&lt;ai_msgs::msg::PerceptionTargets&gt;::SharedPtr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      msg_publisher_ = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Multi-target tracking algorithm engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;HobotMot&gt; hobot_mot_ = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Image message subscription callback</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void FeedImg(const hbm_img_msgs::msg::HbmMsg1080P::ConstSharedPtr msg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BodyDetNode::BodyDetNode(const std::string &amp; node_name, const rclcpp::NodeOptions &amp; options) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot::dnn_node::DnnNode(node_name, options) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Initialize the algorithm inference using the SetNodePara() method implemented in the BodyDetNode subclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (Init() != 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetModelInputSize(0, model_input_width_, model_input_height_) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Node init fail!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create a message subscriber to subscribe image messages from the camera node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ros_img_subscription_ =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          this-&gt;create_subscription_hbmem&lt;hbm_img_msgs::msg::HbmMsg1080P&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;/hbmem_img&quot;, 10, std::bind(&amp;BodyDetNode::FeedImg, this, std::placeholders::_1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create a message publisher to publish algorithm inference messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg_publisher_ = this-&gt;create_publisher&lt;ai_msgs::msg::PerceptionTargets&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;/cpp_dnn_demo&quot;, 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create a multi-target tracking (MOT) algorithm engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot_mot_ = std::make_shared&lt;HobotMot&gt;(&quot;config/iou2_method_param.json&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int BodyDetNode::SetNodePara() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!dnn_node_para_ptr_) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Specify the model file path and model name to be used for the algorithm inference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node_para_ptr_-&gt;model_file = &quot;config/multitask_body_kps_960x544.hbm&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node_para_ptr_-&gt;model_name = &quot;multitask_body_kps_960x544&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}void BodyDetNode::FeedImg(const hbm_img_msgs::msg::HbmMsg1080P::ConstSharedPtr img_msg) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!rclcpp::ok()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Validate the subscribed image message, this example only supports processing NV12 format image data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!img_msg) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (&quot;nv12&quot; != std::string(reinterpret_cast&lt;const char*&gt;(img_msg-&gt;encoding.data()))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Only support nv12 img encoding!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create model input data based on the model input resolution using the methods provided by DnnNode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto inputs = std::vector&lt;std::shared_ptr&lt;hobot::dnn_node::DNNInput&gt;&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hobot::dnn_node::ImageProc::GetNV12PyramidFromNV12Img(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reinterpret_cast&lt;const char*&gt;(img_msg-&gt;data.data()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      img_msg-&gt;height, img_msg-&gt;width, model_input_height_, model_input_width_)};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create model output data and fill in message header information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto dnn_output = std::make_shared&lt;FasterRcnnOutput&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header = std::make_shared&lt;std_msgs::msg::Header&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header-&gt;set__frame_id(std::to_string(img_msg-&gt;index));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header-&gt;set__stamp(img_msg-&gt;time_stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Run inference asynchronously</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Run(inputs, dnn_output, nullptr, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int BodyDetNode::PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt; &amp;node_output) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!rclcpp::ok()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Validate the output data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (node_output-&gt;outputs.empty() ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static_cast&lt;int32_t&gt;(node_output-&gt;outputs.size()) &lt; box_output_index_) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Invalid outputs&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create parsing output data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Dimension of detection box results is equal to the number of detected object categories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;std::shared_ptr&lt;hobot::dnn_node::parser_fasterrcnn::Filter2DResult&gt;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      results;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Keypoint data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;hobot::dnn_node::parser_fasterrcnn::LandmarksResult&gt; output_body_kps = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Use the built-in Parse method in hobot dnn to parse the algorithm output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (hobot::dnn_node::parser_fasterrcnn::Parse(node_output, nullptr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  box_outputs_index_, -1, -1, results, output_body_kps) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_node_sample&quot;), &quot;Parse node_output fail!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto filter2d_result = results.at(box_output_index_);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!filter2d_result) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Convert the human detection boxes inferred by the algorithm into the MOT algorithm input data type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;MotBox&gt; in_box_list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (auto&amp; rect : filter2d_result-&gt;boxes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    in_box_list.emplace_back(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MotBox(rect.left, rect.top, rect.right, rect.bottom, rect.conf));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Calculate the timestamp of the current frame based on the message header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto fasterRcnn_output =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      std::dynamic_pointer_cast&lt;FasterRcnnOutput&gt;(node_output);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  time_t time_stamp =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fasterRcnn_output-&gt;image_msg_header-&gt;stamp.sec * 1000 +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fasterRcnn_output-&gt;image_msg_header-&gt;stamp.nanosec / 1000 / 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create the output of the MOT algorithm: human detection boxes with target IDs and disappeared target IDs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;MotBox&gt; out_box_list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;std::shared_ptr&lt;MotTrackId&gt;&gt; disappeared_ids;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Run the multi-object tracking algorithm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (hobot_mot_-&gt;DoProcess(in_box_list,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            out_box_list,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            disappeared_ids,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            time_stamp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            model_input_width_,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            model_input_height_) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Do mot fail&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create an ROS Msg for publishing the inference results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs::msg::PerceptionTargets::UniquePtr pub_data(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      new ai_msgs::msg::PerceptionTargets());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Fill in the message header for the ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pub_data-&gt;header.set__stamp(fasterRcnn_output-&gt;image_msg_header-&gt;stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pub_data-&gt;header.set__frame_id(fasterRcnn_output-&gt;image_msg_header-&gt;frame_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Fill in the algorithm inference output frame rate to the ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (node_output-&gt;rt_stat) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;set__fps(round(node_output-&gt;rt_stat-&gt;output_fps));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // If the algorithm inference statistics are updated, output the frame rate statistics of the algorithm model input and output</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (node_output-&gt;rt_stat-&gt;fps_updated) {RCLCPP_WARN(rclcpp::get_logger(&quot;dnn_demo&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;input fps: %.2f, out fps: %.2f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  node_output-&gt;rt_stat-&gt;input_fps,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  node_output-&gt;rt_stat-&gt;output_fps);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (auto&amp; rect : out_box_list) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Validate the effectiveness of the target tracking result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (rect.id &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Fill the target tracking result and detection box into ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Target target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__type(&quot;person&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__track_id(rect.id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Roi roi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.type = &quot;body&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__x_offset(rect.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__y_offset(rect.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__width(rect.x2 - rect.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__height(rect.y2 - rect.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.rois.emplace_back(roi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;targets.emplace_back(std::move(target));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Fill the disappeared targets into ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (const auto&amp; id_info : disappeared_ids) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (id_info-&gt;value &lt; 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hobot_mot::DataState::INVALID == id_info-&gt;state_) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Target target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__type(&quot;person&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__track_id(id_info-&gt;value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Roi roi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.type = &quot;body&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.rois.emplace_back(roi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;disappeared_targets.emplace_back(std::move(target));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Publish ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg_publisher_-&gt;publish(std::move(pub_data));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char** argv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::init(argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::spin(std::make_shared&lt;BodyDetNode&gt;());```cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/dnn_node.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/util/image_proc.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/util/output_parser/detection/fasterrcnn_output_parser.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;sensor_msgs/msg/image.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;ai_msgs/msg/perception_targets.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hbm_img_msgs/msg/hbm_msg1080_p.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hobot_mot/hobot_mot.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="21-node-design">2.1 Node Design<a href="#21-node-design" class="hash-link" aria-label="Direct link to 2.1 Node Design" title="Direct link to 2.1 Node Design">​</a></h5>
<p>The main body detection algorithm node in the example consists of three logically independent functionalities.</p>
<p><strong>(1) Node Initialization and Startup</strong></p>
<p>Configure the model information used by the algorithm, create the publisher for algorithm inference messages and the subscriber for image messages, and start the target tracking algorithm engine.</p>
<p><strong>(2) Message Subscription and Algorithm Inference</strong></p>
<p>When creating the subscriber for image messages, a message callback <code>FeedImg</code> is registered to process the image data for algorithm model inference. The callback does not wait for the algorithm inference to complete.</p>
<p><strong>(3) Processing and Publishing of Inference Results</strong></p>
<p>After the algorithm inference is completed, the inference results are output through the registered callback <code>PostProcess</code>. In the callback, the detection results are processed using the multi-object tracking algorithm (<code>HobotMot</code>), and the algorithm inference result messages are published.</p>
<p>The design and flow logic of the Node are shown in the following figure:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/node_architecture.jpg" alt="" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="22-code-explanation">2.2 Code Explanation<a href="#22-code-explanation" class="hash-link" aria-label="Direct link to 2.2 Code Explanation" title="Direct link to 2.2 Code Explanation">​</a></h5>
<p><strong>Add Header Files</strong></p>
<ul>
<li>
<p><code>dnn_node/dnn_node.h</code>: Header file for the inference framework, used for algorithm model management and inference.</p>
</li>
<li>
<p><code>dnn_node/util/image_proc.h</code>: Header file for algorithm model input image processing.</p>
</li>
<li>
<p><code>dnn_node/util/output_parser/detection/fasterrcnn_output_parser.h</code>: Header file for algorithm model output parsing method, used to parse structured data (in this example, it corresponds to the human detection bounding boxes) from the output address after model inference.</p>
</li>
<li>
<p>ROS Msg header files: Used for message subscription and publishing.</p>
</li>
<li>
<p><code>hobot_mot/hobot_mot.h</code>: Header file for the MOT (Multi-Object Tracking) algorithm engine, used for tracking the detected human bounding boxes.</p>
</li>
</ul>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;dnn_node/dnn_node.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;dnn_node/util/image_proc.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;dnn_node/util/output_parser/detection/fasterrcnn_output_parser.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;sensor_msgs/msg/image.hpp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;ai_msgs/msg/perception_targets.hpp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;hbm_img_msgs/msg/hbm_msg1080_p.hpp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;hobot_mot/hobot_mot.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">Creating algorithm inference output data structure</span><span class="token operator" style="color:#393A34">*</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Inheriting the `DnnNodeOutput` base </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">from</span><span class="token plain"> `hobot_dnn`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> adding a message header information member to represent the image information corresponding to the inference output</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```C</span><span class="token operator" style="color:#393A34">++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">FasterRcnnOutput</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#00009f">public</span><span class="token base-clause"> hobot</span><span class="token base-clause double-colon punctuation" style="color:#393A34">::</span><span class="token base-clause">dnn_node</span><span class="token base-clause double-colon punctuation" style="color:#393A34">::</span><span class="token base-clause class-name">DnnNodeOutput</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">shared_ptr</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">std_msgs</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">msg</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Header</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> image_msg_header </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">nullptr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><strong>Creating algorithm inference Node</strong></p>
<p>Inheriting the virtual base class <code>DnnNode</code> from <code>hobot_dnn</code>, defining the algorithm inference node <code>BodyDetNode</code> and implementing the virtual interfaces defined in <code>DnnNode</code>.</p>
<p><code>int SetNodePara()</code>: Configuring model parameters.</p>
<p><code>int PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt;&amp; node_output)</code>: Callback for inference results, packaging the parsed and structured model output data into ROS Msg and publishing them.</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class BodyDetNode : public hobot::dnn_node::DnnNode {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BodyDetNode(const std::string&amp; node_name = &quot;body_det&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const rclcpp::NodeOptions&amp; options = rclcpp::NodeOptions());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> protected:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int SetNodePara() override;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt;&amp; node_output) override;</span><br></span></code></pre></div></div>
<p><strong>Implementing the constructor of the BodyDetNode subclass</strong></p>
<p>The constructor of the <code>BodyDetNode</code> subclass initializes the Node and retrieves the size of the model&#x27;s input image through the <code>GetModelInputSize</code> interface, including the width <code>model_input_width_</code> and height <code>model_input_height_</code> of the image. This is used for model pre-processing as different models generally have different input image sizes.</p>
<p>Creating a subscriber for image messages using zero-copy communication method, subscribing to image messages from camera node for algorithm model inference. The subscribed topic is <code>/hbmem_img</code> and the message type is the image message type defined in <code>tros.b</code>, <code>hbm_img_msgs::msg::HbmMsg1080P</code>.</p>
<p>Creating a publisher for algorithm inference messages. The published topic is <code>/cpp_dnn_demo</code> and the message type is the algorithm message type defined in <code>tros.b</code>, <code>ai_msgs::msg::PerceptionTargets</code>.</p>
<p>Creating a Multiple Object Tracking (MOT) algorithm engine for tracking each person detection box.</p>
<p>Constructor of <code>BodyDetNode</code>:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BodyDetNode::BodyDetNode(const std::string&amp; node_name, const rclcpp::NodeOptions&amp; options) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot::dnn_node::DnnNode(node_name, options) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Initialize algorithm inference using the SetNodePara() method implemented in the BodyDetNode subclass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (Init() != 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetModelInputSize(0, model_input_width_, model_input_height_) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Node init fail!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create message subscriber, subscribe to image messages from camera node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ros_img_subscription_ =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          this-&gt;create_subscription_hbmem&lt;hbm_img_msgs::msg::HbmMsg1080P&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;/hbmem_img&quot;, 10, std::bind(&amp;BodyDetNode::FeedImg, this, std::placeholders::_1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create message publisher, publish algorithm inference messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg_publisher_ = this-&gt;create_publisher&lt;ai_msgs::msg::PerceptionTargets&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;/cpp_dnn_demo&quot;, 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create multi-object tracking (MOT) algorithm engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot_mot_ = std::make_shared&lt;HobotMot&gt;(&quot;config/iou2_method_param.json&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Where <code>Init()</code> is an interface defined and implemented in the <code>DnnNode</code> base class, which performs algorithm inference initialization, only concatenates the pipeline, and the specific <code>SetNodePara()</code> steps are implemented by the user (in the subclass). The initialization process of the concatenation is as follows:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int DnnNode::Init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RCLCPP_INFO(rclcpp::get_logger(&quot;dnn&quot;), &quot;Node init.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 1. set model info in node para</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ret = SetNodePara();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ret != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Set node para failed!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // check node para</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ModelTaskType::InvalidType == dnn_node_para_ptr_-&gt;model_task_type) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Invalid model task type&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 2. model init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ret = dnn_node_impl_-&gt;ModelInit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ret != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Model init failed!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 3. set output parser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ret = SetOutputParser();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ret != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Set output parser failed!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```// 4. task init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ret = dnn_node_impl_-&gt;TaskInit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ret != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Task init failed!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p><strong>Set model parameters</strong></p>
<p>Set the path and name of the model file used for algorithm inference.</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int BodyDetNode::SetNodePara() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!dnn_node_para_ptr_) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node_para_ptr_-&gt;model_file = &quot;config/multitask_body_kps_960x544.hbm&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node_para_ptr_-&gt;model_name = &quot;multitask_body_kps_960x544&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>Implement the image subscription callback</strong></p>
<p>Create <code>DNNInput</code> type model input data. The subscribed message contains image information (such as encoding method, content data, resolution, etc.). Use the image processing interface <code>hobot::dnn_node::ImageProc::GetNV12PyramidFromNV12Img</code> in <code>hobot_dnn</code> algorithm module to convert the subscribed <code>nv12</code> format image to the data type required by the model input, according to the model input resolution (<code>model_input_width_</code> and <code>model_input_height_</code>, obtained from the loaded model by querying with the <code>GetModelInputSize</code> interface in the constructor of <code>BodyDetNode</code>). The interface is defined as follows:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] in_img_data: image data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] in_img_height: height of the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] in_img_width: width of the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] scaled_img_height: height of the model input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] scaled_img_width: width of the model input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">std::shared_ptr&lt;NV12PyramidInput&gt; GetNV12PyramidFromNV12Img(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const char* in_img_data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int&amp; in_img_height,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int&amp; in_img_width,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int&amp; scaled_img_height,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int&amp; scaled_img_width);</span><br></span></code></pre></div></div>
<p>Create <code>FasterRcnnOutput</code> type model output data. The subscribed message contains message headers (<code>frame_id</code> and timestamp). Use the subscribed message headers to fill in the message headers of the output data, which represent the image information corresponding to the algorithm inference output.</p>
<p>Start inference. Use the <code>Run</code> interface in the base class <code>DnnNode</code> to run the inference asynchronously, with the fourth parameter of the interface set as <code>false</code> indicating the more efficient asynchronous inference mode. The <code>Run</code> interface is defined as follows:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // - Parameters</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //   - [in] inputs: shared pointers to input data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //   - [in] outputs: shared pointer to output data</span><br></span></code></pre></div></div>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct Filter2DResult {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int track_id;  // Target number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hbm_common_msgs::msg::BBox2D bbox;  // bounding box</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Algorithm inference result callback, converting model output data into human detection boxes with target numbers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void BodyDetNode::OnInferenceResult(const std::shared_ptr&lt;hobot::dnn_node::DNNOutput&gt;&amp; output) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!output || !output-&gt;FrameStamps().size()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Fill structured inference result data of type &#x27;Filter2DResult&#x27; based on algorithm inference results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;Filter2DResult&gt; results;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const auto* dnn_output = static_cast&lt;const FasterRcnnOutput*&gt;(output.get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (size_t i = 0; i &lt; dnn_output-&gt;bboxes.size(); ++i) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Filter2DResult result;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.track_id = dnn_output-&gt;track_ids[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.bbox.x = dnn_output-&gt;bboxes[i].tl().x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.bbox.y = dnn_output-&gt;bboxes[i].tl().y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.bbox.width = dnn_output-&gt;bboxes[i].br().x - dnn_output-&gt;bboxes[i].tl().x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    result.bbox.height = dnn_output-&gt;bboxes[i].br().y - dnn_output-&gt;bboxes[i].tl().y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    results.push_back(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Process the inference results using the MOT algorithm to obtain missing target number data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;int&gt; disappear_ids;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // TODO: MOT Algorithm processing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Publish the parsed structured reasoning results and disappearing target numbers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PublishDetection(results);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PublishDisappearingTarget(disappear_ids);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>In the inference result callback &#x27;OnInferenceResult&#x27;, fill in structured inference result data of type &#x27;Filter2DResult&#x27; based on the model output data. Then, use the MOT algorithm to process the inference results and obtain the missing target number data. Finally, publish the parsed structured reasoning results and the missing target number.Using the built-in Parse parsing method in hobot dnn, parse the output of the human detection algorithm.</p>
<p>Run the multi-target tracking algorithm. Convert the human detection boxes outputted by the algorithm into the data type required by the MOT algorithm. Calculate the timestamp of the current frame based on the message header. After processing with the MOT algorithm, obtain the human detection boxes with target ID and the disappeared target ID.</p>
<p>Publish the results of the algorithm inference. Create a ROS Msg, fill in the image message header (frame ID and timestamp) corresponding to the results of the algorithm inference, the human detection boxes with target ID, the frame rate statistics outputted by the algorithm inference, and the disappeared target ID. The published ROS Msg can be subscribed and used by other ROS Nodes.</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int BodyDetNode::PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt; &amp;node_output) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!rclcpp::ok()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Validate the validity of the output data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (node_output-&gt;outputs.empty() ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static_cast&lt;int32_t&gt;(node_output-&gt;outputs.size()) &lt; box_output_index_) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Invalid outputs&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Create the parsing output data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The dimension of detection box results is equal to the number of detected target categories</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;std::shared_ptr&lt;hobot::dnn_node::parser_fasterrcnn::Filter2DResult&gt;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      results;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Key point data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;hobot::dnn_node::parser_fasterrcnn::LandmarksResult&gt; output_body_kps = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Parse the algorithm output using the built-in Parse method in hobot dnn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (hobot::dnn_node::parser_fasterrcnn::Parse(node_output, nullptr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  box_outputs_index_, -1, -1, results, output_body_kps) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_node_sample&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;Parse node_output fail!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto filter2d_result = results.at(box_output_index_);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!filter2d_result) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Convert the human detection boxes outputted by the algorithm inference into the data type required by MOT algorithm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;MotBox&gt; in_box_list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (auto&amp; rect : filter2d_result-&gt;boxes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    in_box_list.emplace_back(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MotBox(rect.left, rect.top, rect.right, rect.bottom, rect.conf));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Calculate the timestamp of the current frame based on the message header</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto fasterRcnn_output =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      std::dynamic_pointer_cast&lt;FasterRcnnOutput&gt;(node_output);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  time_t time_stamp =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fasterRcnn_output-&gt;image_msg_header-&gt;stamp.sec * 1000 +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```fasterRcnn_output-&gt;image_msg_header-&gt;stamp.nanosec / 1000 / 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create output of MOT algorithm: detection boxes with object IDs and disappeared object IDs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">std::vector&lt;MotBox&gt; out_box_list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">std::vector&lt;std::shared_ptr&lt;MotTrackId&gt;&gt; disappeared_ids;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Run multi-object tracking algorithm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (hobot_mot_-&gt;DoProcess(in_box_list,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          out_box_list,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          disappeared_ids,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          time_stamp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          model_input_width_,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          model_input_height_) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Do mot fail&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Create ROS Msg for publishing inference results</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ai_msgs::msg::PerceptionTargets::UniquePtr pub_data(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  new ai_msgs::msg::PerceptionTargets());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Fill message header to ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub_data-&gt;header.set__stamp(fasterRcnn_output-&gt;image_msg_header-&gt;stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pub_data-&gt;header.set__frame_id(fasterRcnn_output-&gt;image_msg_header-&gt;frame_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Fill algorithm inference output FPS to ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (node_output-&gt;rt_stat) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pub_data-&gt;set__fps(round(node_output-&gt;rt_stat-&gt;output_fps));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // If there is an update in algorithm inference statistics, output the statistics of input and output FPS of the algorithm model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (node_output-&gt;rt_stat-&gt;fps_updated) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_WARN(rclcpp::get_logger(&quot;dnn_demo&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;input fps: %.2f, out fps: %.2f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                node_output-&gt;rt_stat-&gt;input_fps,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                node_output-&gt;rt_stat-&gt;output_fps);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for (auto&amp; rect : out_box_list) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Validate the validity of the target tracking result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (rect.id &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Fill target tracking result and detection box to ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs::msg::Target target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target.set__type(&quot;person&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  target.set__track_id(rect.id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs::msg::Roi roi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  roi.type = &quot;body&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  roi.rect.set__x_offset(rect.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  roi.rect.set__y_offset(rect.y1);roi.rect.set__width(rect.x2 - rect.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__height(rect.y2 - rect.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.rois.emplace_back(roi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;targets.emplace_back(std::move(target));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Fill in the disappeared targets to ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (const auto&amp; id_info : disappeared_ids) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (id_info-&gt;value &lt; 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hobot_mot::DataState::INVALID == id_info-&gt;state_) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Target target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__type(&quot;person&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__track_id(id_info-&gt;value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Roi roi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.type = &quot;body&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.rois.emplace_back(roi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;disappeared_targets.emplace_back(std::move(target));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Publish ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg_publisher_-&gt;publish(std::move(pub_data));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>The dnn node contains built-in methods for parsing the output of various detection, classification, and segmentation algorithms. After installing tros.b on the RDK, the supported parsing methods can be queried as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# tree /opt/tros/include/dnn_node/util/output_parser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/tros/include/dnn_node/util/output_parser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── classification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── ptq_classification_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── fasterrcnn_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── fcos_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── nms.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ptq_efficientdet_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ptq_ssd_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ptq_yolo2_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ptq_yolo3_darknet_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── ptq_yolo5_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── perception_common.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── segmentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── ptq_unet_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── utils.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 directories, 12 files</span><br></span></code></pre></div></div>
<p>You can see that there are three paths under the <code>/opt/tros/include/dnn_node/util/output_parser</code> directory, which correspond to the output parsing methods for classification, detection, and segmentation algorithms.</p>
<p><code>perception_common.h</code> defines the data type of the parsed perception results.</p>
<p>The algorithm models and their corresponding output parsing methods are as follows:</p>
<table><thead><tr><th>Algorithm Category</th><th>Algorithm</th><th>Output Parsing Method</th></tr></thead><tbody><tr><td>Object Detection</td><td><a href="/rdk_doc/en/Robot_development/boxs/detection/fcos">FCOS</a></td><td>fcos_output_parser.h</td></tr><tr><td>Object Detection</td><td><a href="/rdk_doc/en/Robot_development/boxs/detection/efficientnet">EfficientNet_Det</a></td><td>ptq_efficientdet_output_parser.h</td></tr><tr><td>Object Detection</td><td><a href="/rdk_doc/en/Robot_development/boxs/detection/mobilenet">MobileNet_SSD</a></td><td>ptq_ssd_output_parser.h</td></tr><tr><td>Object Detection</td><td><a href="/rdk_doc/en/Robot_development/boxs/detection/yolo">YoloV2</a></td><td>ptq_yolo2_output_parser.h</td></tr><tr><td>Object Detection</td><td><a href="/rdk_doc/en/Robot_development/boxs/detection/yolo">YoloV3</a></td><td>ptq_yolo3_darknet_output_parser.h</td></tr><tr><td>Object Detection</td><td><a href="/rdk_doc/en/Robot_development/boxs/detection/yolo">YoloV5</a></td><td>ptq_yolo5_output_parser.h</td></tr><tr><td>Human Detection</td><td><a href="/rdk_doc/en/Robot_development/boxs/function/mono2d_body_detection">FasterRcnn</a></td><td>fasterrcnn_output_parser.h</td></tr><tr><td>Image Classification</td><td><a href="/rdk_doc/en/Robot_development/boxs/classification/mobilenetv2">mobilenetv2</a></td><td>ptq_classification_output_parser.h</td></tr><tr><td>Semantic Segmentation</td><td><a href="/rdk_doc/en/Robot_development/boxs/segmentation/mobilenet_unet">mobilenet_unet</a></td><td>ptq_unet_output_parser.h</td></tr></tbody></table>
<p><strong>Entrance Function</strong></p>
<p>Create an instance of <code>BodyDetNode</code>, initialize and start the inference task in the constructor of <code>BodyDetNode</code>, and stop the inference only when the user inputs the exit signal.</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char** argv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::init(argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::spin(std::make_shared&lt;BodyDetNode&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="23-compilation-dependencies">2.3 Compilation Dependencies<a href="#23-compilation-dependencies" class="hash-link" aria-label="Direct link to 2.3 Compilation Dependencies" title="Direct link to 2.3 Compilation Dependencies">​</a></h5>
<p>In step 1, the <code>cpp_dnn_demo</code> package was created using the <code>ros2 pkg create</code> command. The <code>CMakeLists.txt</code> and <code>package.xml</code> files have been automatically created in the <code>dev_ws/src/cpp_dnn_demo</code> directory.</p>
<p>The <code>package.xml</code> file automatically adds the compiled dependencies, which include <code>rclcpp</code>, <code>sensor_msgs</code>, <code>ai_msgs</code>, <code>hbm_img_msgs</code>, <code>dnn_node</code>, and <code>hobot_mot</code>. <code>ai_msgs</code> defines the message format of the algorithm output in TogatherROS, <code>hbm_img_msgs</code> defines the image message format used for zero-copy communication, <code>dnn_node</code> is the algorithm inference framework, and <code>hobot_mot</code> is the multi-object tracking algorithm. These packages are installed when TogatherROS is installed.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="24-compilation-script">2.4 Compilation Script<a href="#24-compilation-script" class="hash-link" aria-label="Direct link to 2.4 Compilation Script" title="Direct link to 2.4 Compilation Script">​</a></h5>
<p>Add package dependencies and compilation installation information in <code>CMakeLists.txt</code>.</p>
<p>(1) Add dependencies on the multi-object tracking algorithm and the algorithm inference engine library.</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">link_directories(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /opt/tros/lib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">``````cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CMakeLists.txt </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cmake_minimum_required(VERSION 3.5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project(cpp_dnn_demo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Default to C99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(NOT CMAKE_C_STANDARD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set(CMAKE_C_STANDARD 99)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Default to C++14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(NOT CMAKE_CXX_STANDARD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set(CMAKE_CXX_STANDARD 14)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES &quot;Clang&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  add_compile_options(-Wall -Wextra -Wpedantic)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (1) Set the library path to &quot;/usr/lib/hbbpu/&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set(LIBHB_PATH /usr/lib/hbbpu/)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (2) Add pkg compilation information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  src/body_det_demo.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_target_dependencies(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensor_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot_mot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hbm_img_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># (3) Add pkg installation information to enable running the compiled pkg with &quot;ros2 run&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TARGETS ${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RUNTIME DESTINATION lib/${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)# find dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(ament_cmake REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(rclcpp REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(sensor_msgs REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(ai_msgs REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(hbm_img_msgs REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(dnn_node REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(hobot_mot REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">link_directories(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /opt/tros/lib/  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /usr/lib/hbbpu/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  src/body_det_demo.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_target_dependencies(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensor_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot_mot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hbm_img_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install executables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TARGETS ${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RUNTIME DESTINATION lib/${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_package()</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-build-and-run">3 Build and Run<a href="#3-build-and-run" class="hash-link" aria-label="Direct link to 3 Build and Run" title="Direct link to 3 Build and Run">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="31-build">3.1 Build<a href="#31-build" class="hash-link" aria-label="Direct link to 3.1 Build" title="Direct link to 3.1 Build">​</a></h5>
<p>In the RDK with tros.b installed, execute the following command to build the package:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configure tros.b environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```# Compiling pkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colcon build --packages-select cpp_dnn_demo</span><br></span></code></pre></div></div>
<p>If the compilation is successful, an installation package called &quot;install&quot; will be generated in the compilation path for the cpp_dnn_demo pkg. The following information will be displayed in the compilation terminal:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Starting &gt;&gt;&gt; cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Processing: cpp_dnn_demo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Finished &lt;&lt;&lt; cpp_dnn_demo [32.7s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Summary: 1 package finished [33.4s]</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="32-common-compilation-errors">3.2 Common Compilation Errors<a href="#32-common-compilation-errors" class="hash-link" aria-label="Direct link to 3.2 Common Compilation Errors" title="Direct link to 3.2 Common Compilation Errors">​</a></h5>
<ol>
<li>ModuleNotFoundError: No module named &#x27;ament_package&#x27;</li>
</ol>
<p>Specific error message:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># colcon build --packages-select cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting &gt;&gt;&gt; cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- stderr: cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMake Error at CMakeLists.txt:19 (find_package):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  By not providing &quot;Findament_cmake.cmake&quot; in CMAKE_MODULE_PATH this project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  has asked CMake to find a package configuration file provided by</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ament_cmake&quot;, but CMake did not find one.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Could not find a package configuration file provided by &quot;ament_cmake&quot; with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  any of the following names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ament_cmakeConfig.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ament_cmake-config.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Add the installation prefix of &quot;ament_cmake&quot; to CMAKE_PREFIX_PATH or set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ament_cmake_DIR&quot; to a directory containing one of the above files.  If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ament_cmake&quot; provides a separate development package or SDK, be sure it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  has been installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Failed &lt;&lt;&lt; cpp_dnn_demo [2.83s, exited with code 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Summary: 0 packages finished [3.44s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1 package failed: cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1 package had stderr output: cpp_dnn_demo</span><br></span></code></pre></div></div>
<p>This indicates that the ROS2 environment is not configured successfully. Enter the &quot;ros2&quot; command in the terminal to check the environment:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ros2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-bash: ros2: command not found</span><br></span></code></pre></div></div>
<p>If you receive the &quot;command not found&quot; prompt, it means that the ROS2 environment has not been configured successfully. Please check if the command source /opt/tros/setup.bash has been executed successfully. The successful output information is as follows:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ros2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usage: ros2 [-h] Call `ros2 &lt;command&gt; -h` for more detailed usage. ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 is an extensible command-line tool for ROS 2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optional arguments:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -h, --help            show this help message and exit</span><br></span></code></pre></div></div>
<ol start="2">
<li>Cannot find the dnn_node package</li>
</ol>
<p>The specific error message is as follows:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">colcon build --packages-select cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting &gt;&gt;&gt; cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Processing: cpp_dnn_demo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- stderr: cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMake Error at CMakeLists.txt:22 (find_package):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> By not providing &quot;Finddnn_node.cmake&quot; in CMAKE_MODULE_PATH this project has</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> asked CMake to find a package configuration file provided by &quot;dnn_node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> but CMake did not find one.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Could not find a package configuration file provided by &quot;dnn_node&quot; with any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> of the following names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnn_nodeConfig.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnn_node-config.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add the installation prefix of &quot;dnn_node&quot; to CMAKE_PREFIX_PATH or set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;dnn_node_DIR&quot; to a directory containing one of the above files. If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;dnn_node&quot; provides a separate development package or SDK, be sure it has</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> been installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Failed &lt;&lt;&lt; cpp_dnn_demo [59.7s, exited with code 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Summary: 0 packages finished [1min 1s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1 package failed: cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1 package had stderr output: cpp_dnn_demo</span><br></span></code></pre></div></div>
<p>This indicates that the hobot_dnn environment has not been configured successfully. Please check if /opt/tros/share/dnn_node exists.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="33-running">3.3 Running<a href="#33-running" class="hash-link" aria-label="Direct link to 3.3 Running" title="Direct link to 3.3 Running">​</a></h5>
<p>In order to better display the effect of algorithm reasoning and experience perception ability, the MIPI camera image capture, image encoding, and WEB data display Node in tros.b are used to provide the ability of data sensing and display. The system can publish the captured images from the camera on RDK, perform algorithm reasoning to detect human body frames, and render and display the images and human body frame detection results in real time on the WEB browser on the PC side.</p>
<p>The runtime system process diagram is as follows:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/pipeline.jpg" alt="" class="img_ev3q"></p>
<p>There are 4 nodes running on RDK, and algorithm reasoning is one of them in this example.</p>
<p>The system startup process is as follows:</p>
<p>(1) Open terminal one on RDK and start the algorithm reasoning node:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configure the tros.b environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Configure the cpp_dnn_demo environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ./install/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the necessary configuration files for running the example from the tros.b installation path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Model file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p config &amp;&amp; cp /opt/tros/lib/dnn_benchmark_example/config/X3/multitask_body_kps_960x544.hbm config/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Multi-object tracking configuration file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /opt/tros/lib/hobot_mot/config/iou2_method_param.json config/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run the cpp_dnn_demo pkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run cpp_dnn_demo cpp_dnn_demo --ros-args --log-level warn</span><br></span></code></pre></div></div>
<p>(2) Open terminal 2 on RDK and start the image publishing, encoding, and display Node in tros.b:</p>
<p>Since multiple Nodes need to be started, a launch script is used to start the Nodes in batches. Create a launch script <code>cpp_dnn_demo.launch.py</code> in any path on RDK, with the following content:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> LaunchDescription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch_ros</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IncludeLaunchDescription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">launch_description_sources </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PythonLaunchDescriptionSource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> ament_index_python </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_package_share_directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> ament_index_python</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">packages </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_package_prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generate_launch_description</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    web_service_launch_include </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IncludeLaunchDescription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PythonLaunchDescriptionSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                get_package_share_directory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;websocket&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&#x27;launch/websocket_service.launch.py&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> LaunchDescription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        web_service_launch_include</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Start image publishing package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            package</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;mipi_cam&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            executable</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;mipi_cam&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            output</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;screen&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;out_format&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;nv12&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;image_width&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">960</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;image_height&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">544</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;io_method&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared_mem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;video_device&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;F37&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            arguments</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;--ros-args&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--log-level&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Start jpeg image encoding &amp; publishing package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            package</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;hobot_codec&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            executable</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;hobot_codec_republish&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            output</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;screen&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;channel&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;in_mode&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared_mem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;in_format&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;nv12&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;out_mode&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ros&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;out_format&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jpeg&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;sub_topic&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/hbmem_img&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;pub_topic&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/image_jpeg&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            arguments</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;--ros-args&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--log-level&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Start web display package</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            package</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;websocket&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            executable</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;websocket&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            output</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;screen&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;image_topic&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/image_jpeg&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;image_type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mjpeg&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;smart_topic&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/cpp_dnn_demo&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            arguments</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;--ros-args&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--log-level&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">Using startup script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">```shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Configure tros.b environment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">opt</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">tros</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">setup</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Launch the nodes for image publishing, encoding, and display</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 launch cpp_dnn_demo</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">launch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">py</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="34-common-errors">3.4 Common Errors<a href="#34-common-errors" class="hash-link" aria-label="Direct link to 3.4 Common Errors" title="Direct link to 3.4 Common Errors">​</a></h5>
<p>If the following error message is displayed during startup:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">error while loading shared libraries: libdnn_node.so: cannot open shared object file: No such file or directory</span><br></span></code></pre></div></div>
<p>It indicates that the configuration of the hobot_dnn environment has failed. Please check if /opt/tros/share/dnn_node exists.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="35-results">3.5 Results<a href="#35-results" class="hash-link" aria-label="Direct link to 3.5 Results" title="Direct link to 3.5 Results">​</a></h5>
<p>After successful execution, the terminal outputs the following information:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~/dev_ws# ros2 run cpp_dnn_demo cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[BPU_PLAT]BPU Platform Version(1.3.1)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[C][154775][10-25][00:33:53:266][configuration.cpp:49][EasyDNN]EasyDNN version: 0.4.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[HBRT] set log level as 0. version = 3.14.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[DNN] Runtime version = 1.9.7_(3.14.5 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629233.325690884] [dnn]: Run default SetOutputParser.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629233.326263403] [dnn]: Set output parser with default dnn node parser, you will get all output tensors and should parse output_tensors in PostProcess.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(MOTMethod.cpp:34): MOTMethod::Init config/iou2_method_param.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(IOU2.cpp:29): IOU2 Mot::Init config/iou2_method_param.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629234.410291616] [dnn_demo]: input fps: 31.22, out fps: 31.28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629235.410357068] [dnn_demo]: input fps: 30.00, out fps: 30.00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629236.444863458] [dnn_demo]: input fps: 30.01, out fps: 29.98</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629237.476656118] [dnn_demo]: input fps: 30.00, out fps: 30.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629238.478156431] [dnn_demo]: input fps: 30.01, out fps: 29.97</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629239.510039629] [dnn_demo]: input fps: 30.01, out fps: 30.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629240.511561150] [dnn_demo]: input fps: 30.00, out fps: 29.97</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629241.543333811] [dnn_demo]: input fps: 30.01, out fps: 30.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629242.544654089] [dnn_demo]: input fps: 30.01, out fps: 29.97</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629243.576435625] [dnn_demo]: input fps: 30.01, out fps: 30.07</span><br></span></code></pre></div></div>
<p>The log output shows that the model used for algorithm inference during initialization has an input image resolution of 960x544. The <code>MOT</code> algorithm engine is using the configuration file <code>config/iou2_method_param.json</code>. During inference, the input and output frame rate of the algorithm is 30fps, and the statistics are refreshed once per second.</p>
<p>Use the <code>ros2</code> command on RDK to query and output the contents of the <code>/cpp_dnn_demo</code> topic messages published by the inference node.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# ros2 topic list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/hbmem_img08172824022201080202012021072315</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/image_jpeg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/parameter_events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/rosout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# ros2 topic echo /cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">header:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stamp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sec: 1659938514</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nanosec: 550421888</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_id: &#x27;7623&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fps: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perfs: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 106</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 416</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 151</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 135</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 89</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 423</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 155</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 569y_offset: 161</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  height: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  width: 123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 677</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 121</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 398</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 478</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 163</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 348</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 103</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disappeared_targets: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>The output <code>/cpp_dnn_demo</code> topic message indicates that the algorithm detected 5 human body boxes , and output the coordinates and corresponding target tracking results (track_id) for each detection box.</p>
<p>Enter <a href="http://IP:8000" target="_blank" rel="noopener noreferrer">http://IP:8000</a> (IP is the IP address of RDK, for example, the IP address used in this example is 10.64.28.88) on the PC&#x27;s web browser to view real-time images and algorithm inference rendering effects:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/render.jpg" alt="" class="img_ev3q"></p>
<p>Each detection box is rendered with the detection box type (such as <code>body</code> indicating human body detection box) and the target tracking result. The <code>fps</code> field in the lower left corner of the browser indicates the real-time algorithm inference output frame rate.</p>
<p>Enter the <code>Ctrl+C</code> command to exit the program.</p>
<p>Summary of this sectionThis chapter introduces how to use the models provided by D-Robotics to create and run an algorithm inference example for human detection based on <code>hobot_dnn</code>. It uses images published from the camera, obtains the algorithm output, and renders and displays the image and algorithm inference results in real-time on the PC browser.</p>
<p>Users can refer to the <a href="https://github.com/D-Robotics/hobot_dnn/blob/develop/README.md" target="_blank" rel="noopener noreferrer">README.md</a> and the <a href="https://github.com/D-Robotics/hobot_dnn/blob/develop/docs/API-Manual/API-Manual.md" target="_blank" rel="noopener noreferrer">API Manual</a> in <code>hobot_dnn</code> to learn about the richer algorithm inference capabilities.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="algorithm-workflow-construction">Algorithm Workflow Construction<a href="#algorithm-workflow-construction" class="hash-link" aria-label="Direct link to Algorithm Workflow Construction" title="Direct link to Algorithm Workflow Construction">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="background-1">Background<a href="#background-1" class="hash-link" aria-label="Direct link to Background" title="Direct link to Background">​</a></h3>
<p>ROS2 nodes decompose complex robot software systems into multiple functional and logically independent modules. For example, a robot application may include multiple nodes for sensing and algorithm perception functions. Nodes exchange data through &quot;topics&quot;. Nodes with different functions in the robot software system are connected through topics to form a directed acyclic graph (DAG).</p>
<p>The D-Robotics TogetheROS.Bot software stack includes rich robot development components and algorithm nodes. The sensing nodes support capturing image data from the camera and publishing it for use in perception algorithm inference. The human bounding box detection algorithm node in the perception algorithm library performs inference on image data and outputs human bounding box detection results. The human keypoint detection algorithm node performs inference on image data and the human bounding box detection results to output human keypoint detection results. Therefore, the human keypoint detection algorithm node needs to communicate with the human bounding box detection algorithm node by subscribing to the human bounding box messages published by that node.</p>
<p>By reading this chapter, users can use the sensing nodes, human bounding box detection algorithm nodes, and human keypoint detection algorithm nodes in RDK, connect the sensing nodes and perception nodes through ROS2 topics, and achieve the goal of developing complex robot algorithm applications.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparation-1">Preparation<a href="#preparation-1" class="hash-link" aria-label="Direct link to Preparation" title="Direct link to Preparation">​</a></h3>
<ol>
<li>RDK development board with the following software installed:</li>
</ol>
<ul>
<li>
<p>D-Robotics-provided  Ubuntu 20.04/22.04 system image</p>
</li>
<li>
<p><code>tros.b</code> software package</p>
</li>
</ul>
<ol start="2">
<li>
<p>RDK with F37 or GC4663 camera installed</p>
</li>
<li>
<p>A PC in the same network segment (wired or connected to the same wireless network, with the first three segments of the IP address consistent with RDK). The PC needs to have the following environment installed:</p>
</li>
</ol>
<ul>
<li>
<p>Ubuntu 20.04/22.04 system</p>
</li>
<li>
<p><a href="https://docs.ros.org/en/foxy/Installation/Ubuntu-Install-Debians.html" target="_blank" rel="noopener noreferrer">ROS2 Foxy Desktop</a></p>
</li>
<li>
<p><a href="http://docs.ros.org/en/foxy/Concepts/About-RQt.html" target="_blank" rel="noopener noreferrer">rqt graphical tool</a></p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="usage-1">Usage<a href="#usage-1" class="hash-link" aria-label="Direct link to Usage" title="Direct link to Usage">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-start-data-collection-node">1. Start Data Collection Node<a href="#1-start-data-collection-node" class="hash-link" aria-label="Direct link to 1. Start Data Collection Node" title="Direct link to 1. Start Data Collection Node">​</a></h4>
<p>On the RDK, open a terminal and start the image publishing node, which captures image data from the F37 camera and publishes it for algorithm inference:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Configure the tros.b environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start the node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run mipi_cam mipi_cam --ros-args -p out_format:=nv12 -p image_width:=960 -p image_height:=544 -p video_device:=F37 -p io_method:=shared_mem --log-level warn</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-start-human-bounding-box-detection-algorithm-node">2. Start Human Bounding Box Detection Algorithm Node<a href="#2-start-human-bounding-box-detection-algorithm-node" class="hash-link" aria-label="Direct link to 2. Start Human Bounding Box Detection Algorithm Node" title="Direct link to 2. Start Human Bounding Box Detection Algorithm Node">​</a></h4>
<p>On the RDK, open a terminal and start the human bounding box detection algorithm node, which subscribes to the image messages published by the data collection node, detects and publishes human bounding box messages.The publishing topic specified in the launch command is <code>hobot_hand_detection</code>.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Set up tros.b environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the required configuration files from the installation path of tros.b.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /opt/tros/lib/mono2d_body_detection/config/ .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run mono2d_body_detection mono2d_body_detection --ros-args --log-level warn --ros-args -p ai_msg_pub_topic_name:=hobot_hand_detection</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-start-the-node-for-hand-keypoint-detection-algorithm">3 Start the Node for Hand Keypoint Detection Algorithm<a href="#3-start-the-node-for-hand-keypoint-detection-algorithm" class="hash-link" aria-label="Direct link to 3 Start the Node for Hand Keypoint Detection Algorithm" title="Direct link to 3 Start the Node for Hand Keypoint Detection Algorithm">​</a></h4>
<p>Open a terminal on the RDK and start the Node for hand keypoint detection algorithm. It subscribes to image messages published by the data collection Node and hand bounding box messages published by the hand bounding box detection algorithm Node.</p>
<p>The publishing topic is specified as <code>hobot_hand_lmk_detection</code>, and the subscribing topic is specified as <code>hobot_hand_detection</code> in the launch command.</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Set up tros.b environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copy the required configuration files from the installation path of tros.b.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /opt/tros/lib/hand_lmk_detection/config/ .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run hand_lmk_detection hand_lmk_detection --ros-args --log-level warn --ros-args -p ai_msg_pub_topic_name:=hobot_hand_lmk_detection -p ai_msg_sub_topic_name:=hobot_hand_detection</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-view-the-output-of-the-algorithm-inference">4 View the Output of the Algorithm Inference<a href="#4-view-the-output-of-the-algorithm-inference" class="hash-link" aria-label="Direct link to 4 View the Output of the Algorithm Inference" title="Direct link to 4 View the Output of the Algorithm Inference">​</a></h4>
<p>Open a terminal on the RDK and use the ROS2 command to view the Topic messages published by the algorithm inference Node.</p>
<p><strong>View the hand bounding box detection messages published by the hand bounding box detection algorithm Node</strong></p>
<p>Query command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Set up tros.b environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic echo /hobot_hand_detection</span><br></span></code></pre></div></div>
<p>Output:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">header:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stamp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sec: 1660034025</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nanosec: 429969208</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_id: &#x27;8049&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fps: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: hand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 619</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 229</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 168</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disappeared_targets: []</span><br></span></code></pre></div></div>
<p>The message contains the results of a person&#x27;s hand detection algorithm (roi type: hand) published by the fps: 30 target detection algorithm Node.</p>
<p><strong>View the hand keypoint detection message published by the hand keypoint detection algorithm Node</strong></p>
<p>Query command:</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Configure the tros.b environment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Start the Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic echo /hobot_hand_lmk_detection</span><br></span></code></pre></div></div>
<p>Output result:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">header:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stamp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sec: 1660034025</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nanosec: 429969208</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_id: &#x27;8049&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fps: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: hand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 619</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 229</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 168do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">points:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: hand_kps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  point:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 715.2421875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 348.0546875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 673.4921875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 315.8515625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 655.2265625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 294.3828125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 639.5703125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 262.1796875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 621.3046875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 229.9765625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 686.5390625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 247.8671875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 683.9296875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 201.3515625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 683.9296875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 176.3046875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 681.3203125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 147.6796875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 712.6328125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 240.7109375</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 717.8515625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 194.1953125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 720.4609375</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 161.9921875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 723.0703125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 129.7890625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 736.1171875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 247.8671875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - x: 743.9453125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y: 201.3515625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    z: 0.0- x: 749.1640625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  y: 172.7265625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- x: 749.1640625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  y: 140.5234375</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- x: 759.6015625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  y: 262.1796875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- x: 770.0390625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  y: 226.3984375</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- x: 775.2578125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  y: 204.9296875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- x: 775.2578125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  y: 179.8828125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">confidence: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disappeared_targets: []</span><br></span></code></pre></div></div>
<p>We can see that the published message contains the bounding box and keypoint detection results of the hand. The bounding box information is consistent with the subscribed message.The Rqt&#x27;s Node Graph function on the PC side (<strong>the PC needs to be in the same network segment as the RDK</strong>) can visualize the Nodes running on the RDK, the topics published and subscribed by the Nodes, and the graph composed of these topics, as shown in the figure below:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/rosgraph_handlmk.jpg" alt="" class="img_ev3q"></p>
<p>In the figure, the ellipses represent the Node names, and the rectangles represent the Topic names. It can be seen that the entire graph consists of 3 Nodes and 2 Topics.</p>
<p>The &quot;mipi_cam&quot; (sensing Node) is the starting point, responsible for capturing and publishing images from the camera.</p>
<p>The &quot;mono2d_body_det&quot; (algorithm perception Node) is the middle node, subscribing to the image data published by the &quot;mipi_cam&quot; Node and performing human body box detection.</p>
<p>The &quot;hand_lmk_det&quot; (algorithm perception Node) is the end node, subscribing to the image data published by the &quot;mipi_cam&quot; Node and the human body box detection data published by the &quot;mono2d_body_det&quot; Node, and performing hand keypoint detection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">​</a></h3>
<p>This chapter introduces the use of sensing Nodes, human body box detection Nodes, and hand keypoint detection algorithm Nodes in the RDK, based on ROS2 topic communication. By connecting two perception algorithm Nodes, images captured from the camera are used for algorithm inference and the detected hand keypoints are published as messages.</p>
<p>Based on the algorithm chaining principle introduced in this chapter, users can connect more algorithm Nodes on the RDK and develop feature-rich robot algorithm applications.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-06-20T08:49:43.000Z" itemprop="dateModified">Jun 20, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/en/Robot_development/tros_dev/zero_copy"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">5.5.1 Using &quot;zero-copy&quot;</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/en/Robot_development/tros_dev/breakpad"><div class="pagination-nav__sublabel">Next </div><div class="pagination-nav__label">5.5.3 Using Breakpad</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model-inference-development" class="table-of-contents__link toc-highlight">Model Inference Development</a><ul><li><a href="#background" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#preparation" class="table-of-contents__link toc-highlight">Preparation</a></li><li><a href="#usage" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#1-create-package" class="table-of-contents__link toc-highlight">1. Create package</a></li><li><a href="#2-write-examplethe-created-project-path-can-be-viewed-as-follows" class="table-of-contents__link toc-highlight">2. Write exampleThe created project path can be viewed as follows:</a><ul><li><a href="#21-node-design" class="table-of-contents__link toc-highlight">2.1 Node Design</a></li><li><a href="#22-code-explanation" class="table-of-contents__link toc-highlight">2.2 Code Explanation</a></li><li><a href="#23-compilation-dependencies" class="table-of-contents__link toc-highlight">2.3 Compilation Dependencies</a></li><li><a href="#24-compilation-script" class="table-of-contents__link toc-highlight">2.4 Compilation Script</a></li></ul></li><li><a href="#3-build-and-run" class="table-of-contents__link toc-highlight">3 Build and Run</a><ul><li><a href="#31-build" class="table-of-contents__link toc-highlight">3.1 Build</a></li><li><a href="#32-common-compilation-errors" class="table-of-contents__link toc-highlight">3.2 Common Compilation Errors</a></li><li><a href="#33-running" class="table-of-contents__link toc-highlight">3.3 Running</a></li><li><a href="#34-common-errors" class="table-of-contents__link toc-highlight">3.4 Common Errors</a></li><li><a href="#35-results" class="table-of-contents__link toc-highlight">3.5 Results</a></li></ul></li></ul></li></ul></li><li><a href="#algorithm-workflow-construction" class="table-of-contents__link toc-highlight">Algorithm Workflow Construction</a><ul><li><a href="#background-1" class="table-of-contents__link toc-highlight">Background</a></li><li><a href="#preparation-1" class="table-of-contents__link toc-highlight">Preparation</a></li><li><a href="#usage-1" class="table-of-contents__link toc-highlight">Usage</a><ul><li><a href="#1-start-data-collection-node" class="table-of-contents__link toc-highlight">1. Start Data Collection Node</a></li><li><a href="#2-start-human-bounding-box-detection-algorithm-node" class="table-of-contents__link toc-highlight">2. Start Human Bounding Box Detection Algorithm Node</a></li><li><a href="#3-start-the-node-for-hand-keypoint-detection-algorithm" class="table-of-contents__link toc-highlight">3 Start the Node for Hand Keypoint Detection Algorithm</a></li><li><a href="#4-view-the-output-of-the-algorithm-inference" class="table-of-contents__link toc-highlight">4 View the Output of the Algorithm Inference</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GuYueHome<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact US</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 D-Robotics.</div></div></div></footer></div>
</body>
</html>