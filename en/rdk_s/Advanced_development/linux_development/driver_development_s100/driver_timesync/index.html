<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-docs_s docs-version-current docs-doc-page docs-doc-id-Advanced_development/linux_development/driver_development_s100/driver_timesync" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">时间同步方案 | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" property="og:title" content="时间同步方案 | RDK DOC"><meta data-rh="true" name="description" content="名词缩写及解释"><meta data-rh="true" property="og:description" content="名词缩写及解释"><link data-rh="true" rel="icon" href="/rdk_doc/en/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"7. 进阶开发","item":"https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development"},{"@type":"ListItem","position":2,"name":"7.2. Linux开发指南","item":"https://developer.d-robotics.cc/rdk_doc/en/rdk_s/linux_development"},{"@type":"ListItem","position":3,"name":"7.2.4 RDK S100驱动开发指南","item":"https://developer.d-robotics.cc/rdk_doc/en/rdk_s/driver_development_s100"},{"@type":"ListItem","position":4,"name":"时间同步方案","item":"https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/en/assets/css/styles.50b7a244.css">
<script src="/rdk_doc/en/assets/js/runtime~main.1ae53ad8.js" defer="defer"></script>
<script src="/rdk_doc/en/assets/js/main.0b819dd2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a class="navbar__item navbar__link" href="/rdk_doc/en/RDK">RDK X3 / X5</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/en/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>EN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/en/rdk_s/RDK">D-Robotics RDK 套件</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Quick_start">1. 快速开始</a><button aria-label="Expand sidebar category &#x27;1. 快速开始&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/System_configuration">2. 系统配置</a><button aria-label="Expand sidebar category &#x27;2. 系统配置&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Basic_Application">3. 基础应用开发</a><button aria-label="Expand sidebar category &#x27;3. 基础应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Basic_Development">4. 算法应用开发</a><button aria-label="Expand sidebar category &#x27;4. 算法应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Robot_development">5. 机器人应用开发</a><button aria-label="Expand sidebar category &#x27;5. 机器人应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Application_case">6. 应用开发指南</a><button aria-label="Expand sidebar category &#x27;6. 应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/en/rdk_s/Advanced_development">7. 进阶开发</a><button aria-label="Collapse sidebar category &#x27;7. 进阶开发&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/hardware_development">7.1 硬件开发指南</a><button aria-label="Expand sidebar category &#x27;7.1 硬件开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/en/rdk_s/linux_development">7.2. Linux开发指南</a><button aria-label="Collapse sidebar category &#x27;7.2. Linux开发指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/environment_build">7.2.1 开发环境搭建及编译说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/kernel_headers">7.2.2 内核头文件</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/realtime_kernel">7.2.3 应用实时内核</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/en/rdk_s/driver_development_s100">7.2.4 RDK S100驱动开发指南</a><button aria-label="Collapse sidebar category &#x27;7.2.4 RDK S100驱动开发指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/uboot_kernel_config">配置U-Boot和Kernel选项参数</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_uart_dev">UART驱动调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_i2c_dev">I2C调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_gpio_dev">GPIO使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_pinctrl_dev">Pinctrl调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_ipc">IPC模块介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_spi_dev">SPI调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_pwm">PWM 驱动调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_thermal_dev">Thermal 系统</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_lowpower">低功耗模式调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_audio">音频调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_timesync">时间同步方案</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/13_driver_pcie">PCIe使用指南</a><button aria-label="Expand sidebar category &#x27;PCIe使用指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_wifi">WiFi驱动调试指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/15_driver_hbmem">HBMEM使用指南</a><button aria-label="Expand sidebar category &#x27;HBMEM使用指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/hardware_unit_test">7.2.5 硬件单元测试</a><button aria-label="Expand sidebar category &#x27;7.2.5 硬件单元测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/OTA">7.2.6 OTA</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/03_multimedia_development">7.3 多媒体开发指南</a><button aria-label="Expand sidebar category &#x27;7.3 多媒体开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/04_toolchain_development">7.4 算法工具链开发指南</a><button aria-label="Expand sidebar category &#x27;7.4 算法工具链开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/05_MCU_development">7.5 MCU开发指南</a><button aria-label="Expand sidebar category &#x27;7.5 MCU开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/rdk_gen">7.6 RDK S100构建系统开发指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/FAQ">8. 常见问题</a><button aria-label="Expand sidebar category &#x27;8. 常见问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Appendix">9. 附录</a><button aria-label="Expand sidebar category &#x27;9. 附录&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/en/rdk_s/Release_Note/roadmap">10. 版本发布</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rdk_doc/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/rdk_s/Advanced_development"><span>7. 进阶开发</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/rdk_s/linux_development"><span>7.2. Linux开发指南</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/rdk_s/driver_development_s100"><span>7.2.4 RDK S100驱动开发指南</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">时间同步方案</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>时间同步方案</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="名词缩写及解释">名词缩写及解释<a href="#名词缩写及解释" class="hash-link" aria-label="Direct link to 名词缩写及解释" title="Direct link to 名词缩写及解释">​</a></h2>
<table><thead><tr><th><strong>缩写</strong></th><th><strong>解释</strong></th></tr></thead><tbody><tr><td>GPS</td><td>Global Positioning System</td></tr><tr><td>RTC</td><td>Real_Time Clock</td></tr><tr><td>PHC</td><td>PTP hardware clock</td></tr><tr><td>PTP</td><td>precision time protocol</td></tr><tr><td>gPTP</td><td>precision time protocol, extension of PTP Protocol</td></tr><tr><td>MCU</td><td>Microcontroller Unit</td></tr><tr><td>UART</td><td>Universal Asynchronous Receiver/Transmitter</td></tr><tr><td>CAN</td><td>Controller Area Network</td></tr><tr><td>PPS</td><td>Pulse Per Second</td></tr><tr><td>NMEA</td><td>National Marine Electronics Association</td></tr><tr><td>NTP</td><td>Network Time Protocol</td></tr><tr><td>NIC</td><td>Network Interface Card</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ptp时间同步">ptp时间同步<a href="#ptp时间同步" class="hash-link" aria-label="Direct link to ptp时间同步" title="Direct link to ptp时间同步">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能">功能<a href="#功能" class="hash-link" aria-label="Direct link to 功能" title="Direct link to 功能">​</a></h3>
<p>该软件包含两个程序：ptp4l和phc2sys。这两个软件结合使用，就可以实现从master获取时间，同步S100的PHC时间和Linux系统时间。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ptp4l使用方法">ptp4l使用方法<a href="#ptp4l使用方法" class="hash-link" aria-label="Direct link to ptp4l使用方法" title="Direct link to ptp4l使用方法">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="命令行参数">命令行参数<a href="#命令行参数" class="hash-link" aria-label="Direct link to 命令行参数" title="Direct link to 命令行参数">​</a></h4>
<p>ptp4l支持gptp功能，可以作为master，也可以作为slave；如果作为slave，可以从master获取时间，同步S100的PHC时间和RTC时间。</p>
<p>可以通过ptp4l -h查看帮助信息：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  root@ubuntu:/userdata# ptp4l -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usage: ptp4l [options]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Delay Mechanism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -A Auto, starting with E2E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -E E2E, delay request-response (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -P P2P, peer delay mechanism</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Network Transport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -2 IEEE 802.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -4 UDP IPV4 (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -6 UDP IPV6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Time Stamping</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -H HARDWARE (default)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -S SOFTWARE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -L LEGACY HW</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Other Options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -f [file] read configuration from &#x27;file&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -i [dev] interface device to use, for example &#x27;eth0&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (may be specified multiple times)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p [dev] Clock device to use, default auto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  (ignored for SOFTWARE/LEGACY HW time stamping)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -s slave only mode (overrides configuration file)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -l [num] set the logging level to &#x27;num&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -m print messages to stdout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -q do not print messages to the syslog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v prints the software version and exits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -h prints this message and exits</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置文件的使用">配置文件的使用<a href="#配置文件的使用" class="hash-link" aria-label="Direct link to 配置文件的使用" title="Direct link to 配置文件的使用">​</a></h4>
<p>ptp4l可以通过-f参数指定配置文件。</p>
<p>配置文件按段划分，空行和#开头的行会被忽略。</p>
<p>有三种段类型：</p>
<p>[global]段，用来配置program选项，clock选项，默认port选项。</p>
<p>port段使用被配置的网口的名字，如[eth0]段，其配置的选项会覆盖[global]段中默认port选项。port段可以为空内容，作用只是指定网口，这样命令行中不必使用-i选项。</p>
<p>[unicast_master_table]段，配置单播table。</p>
<p>配置文件的详细信息可以参考：<a href="https://linuxptp.nwtime.org/documentation/ptp4l/" target="_blank" rel="noopener noreferrer">https://linuxptp.nwtime.org/documentation/ptp4l/</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="automotive配置示例">automotive配置示例<a href="#automotive配置示例" class="hash-link" aria-label="Direct link to automotive配置示例" title="Direct link to automotive配置示例">​</a></h4>
<p>automotive-master.cfg:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Automotive Profile example configuration for master containing those</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># attributes which differ from the defaults.  See the file, default.cfg, for</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the complete list of available options.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[global]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Options carried over from gPTP.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gmCapable       1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority1       248</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority2       248</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logSyncInterval     -3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syncReceiptTimeout  3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">neighborPropDelayThresh 800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_neighbor_prop_delay -20000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assume_two_step     1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path_trace_enabled  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">follow_up_info      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transportSpecific   0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptp_dst_mac     01:80:C2:00:00:0E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network_transport   L2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delay_mechanism     P2P</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Automotive Profile specific options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BMCA            noop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">masterOnly      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inhibit_announce    1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asCapable               true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inhibit_delay_req       1</span><br></span></code></pre></div></div>
<p>automotive-slave.cfg:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Automotive Profile example configuration for slaves containing those</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># attributes which differ from the defaults.  See the file, default.cfg, for</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># the complete list of available options.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[global]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Options carried over from gPTP.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gmCapable       1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority1       248</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority2       248</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logSyncInterval     -3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syncReceiptTimeout  3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">neighborPropDelayThresh 800</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min_neighbor_prop_delay -20000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">assume_two_step     1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path_trace_enabled  1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">follow_up_info      1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transportSpecific   0x1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ptp_dst_mac     01:80:C2:00:00:0E</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">network_transport   L2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">delay_mechanism     P2P</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Automotive Profile specific options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BMCA            noop</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slaveOnly       1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">inhibit_announce    1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">asCapable               true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ignore_source_id    1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Required to quickly correct Time Jumps in master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">step_threshold          1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">operLogSyncInterval     0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">operLogPdelayReqInterval 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msg_interval_request     1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">servo_offset_threshold   30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">servo_num_offset_values  10</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="phc2sys使用方法">phc2sys使用方法<a href="#phc2sys使用方法" class="hash-link" aria-label="Direct link to phc2sys使用方法" title="Direct link to phc2sys使用方法">​</a></h3>
<p>phc2sys用于将linux系统时间同步到phc时间，或者将phc时间同步到linux系统时间。</p>
<p>可以通过phc2sys --h查看使用说明：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  root@ubuntu:/userdata# phc2sys -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  usage: phc2sys [options]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  automatic configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -a turn on autoconfiguration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -r synchronize system (realtime) clock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeat -r to consider it also as a time source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  manual configuration:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -c [dev|name] slave clock (CLOCK_REALTIME)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -d [dev] master PPS device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -s [dev|name] master clock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -O [offset] slave-master time offset (0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -w wait for ptp4l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  common options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -f [file] configuration file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -E [pi|linreg] clock servo (pi)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -P [kp] proportional constant (0.7)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -I [ki] integration constant (0.3)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -S [step] step threshold (disabled)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -F [step] step threshold only on start (0.00002)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -R [rate] slave clock update rate in HZ (1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -N [num] number of master clock readings per update (5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -L [limit] sanity frequency limit in ppb (200000000)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -M [num] NTP SHM segment number (0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -u [num] number of clock updates in summary stats (0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -n [num] domain number (0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -x apply leap seconds by servo instead of kernel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -z [path] server address for UDS (/var/run/ptp4l)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -l [num] set the logging level to &#x27;num&#x27; (6)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -t [tag] add tag to log messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -m print messages to stdout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -q do not print messages to the syslog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -v prints the software version and exits</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -h prints this message and exits</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="综合示例">综合示例<a href="#综合示例" class="hash-link" aria-label="Direct link to 综合示例" title="Direct link to 综合示例">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="命令行参数-1">命令行参数<a href="#命令行参数-1" class="hash-link" aria-label="Direct link to 命令行参数" title="Direct link to 命令行参数">​</a></h4>
<p>下面示范如何通过ptp4l和phc2sys，将master的网卡时间同步到slave的网卡时间和系统时间。用户需要保证master设备和slave设备之间网络联通。</p>
<p>Master端执行如下命令:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l -i eth0 -f /usr/hobot/lib/pkgconfig/automotive-master.cfg -m -l 7</span><br></span></code></pre></div></div>
<p>Slave端执行如下命令:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l -i eth0 -f /usr/hobot/lib/pkgconfig/automotive-slave.cfg -m -l 7 &gt; ptp4l.log &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  phc2sys -s eth0 -c CLOCK_REALTIME --transportSpecific=1 -m --step_threshold=1000 -w &gt; phc2sys.log &amp;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="log示例">Log示例<a href="#log示例" class="hash-link" aria-label="Direct link to Log示例" title="Direct link to Log示例">​</a></h4>
<p>Slave端log:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[8330.884]: PI servo: sync interval 1.000 kp 0.700 ki 0.300000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[8330.885]: master offset 21 s3 freq -391 path delay 690</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[8330.998]: port 1: delay timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[8330.999]: delay filtered 689 raw 687</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[8331.884]: master offset 35 s3 freq -371 path delay 689</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[8332.885]: master offset 47 s3 freq -349 path delay 689</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[8333.885]: master offset 50 s3 freq -332 path delay 689</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[8334.885]: master offset 22 s3 freq -345 path delay 689</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Master端log:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.136]: config item /var/run/ptp4l.inhibit_delay_req is 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.136]: config item (null).uds_address is &#x27;/var/run/ptp4l&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.136]: port 0: INITIALIZING to LISTENING on INIT_COMPLETE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.136]: config item (null).slaveOnly is 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.136]: port 1: received link status notification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.136]: interface index 2 is up</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.261]: port 1: master sync timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.386]: port 1: master sync timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.511]: port 1: master sync timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.636]: port 1: master sync timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.761]: port 1: master sync timeout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ptp4l[3469.886]: port 1: master sync timeout</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="全局时间源配置">全局时间源配置<a href="#全局时间源配置" class="hash-link" aria-label="Direct link to 全局时间源配置" title="Direct link to 全局时间源配置">​</a></h2>
<p>由于当前系统中存在多个timeline，比如systime、phc、rtc等，而各个模块支持选择不同的timeline来打印各自的时间戳。为了统一各个模块的日志中时间戳的timeline，添加了一个hb_systime的模块，来统一系统各个模块的timeline的选择。该模块实现的具体功能如下：</p>
<p>解析dts里默认的timeline的配置，如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  globaltime: globaltime {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;hobot,globaltime&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    globaltime = &lt;2&gt;; /* 0-systime, 1-phc, 2-rtc */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    phc-index = &lt;0&gt;; /* phc index */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span></code></pre></div></div>
<p>其中dts中 globaltime 属性表示系统默认用的全局timeline，S100默认使用RTC时间。对应关系如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  0:systime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1:phc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  2:rtc</span><br></span></code></pre></div></div>
<p>如果timeline选中网卡phc时间， 则通过phc-index属性进一步判断当前使用哪个网卡phc的时间。对应关系如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  0:phc0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1:phc1</span><br></span></code></pre></div></div>
<p>向应用层提供/sys接口用来设置或者获取当前系统全局的timeline的选择，命令如下：</p>
<p>查看当前系统全局的timeline的配置：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  cat /sys/devices/platform/soc/soc:globaltime/globaltime</span><br></span></code></pre></div></div>
<p>设置系统全局timeline的选项：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  echo 0 &gt;/sys/devices/platform/soc/soc:globaltime/globaltime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  或</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo 1 &gt;/sys/devices/platform/soc/soc:globaltime/globaltime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  或</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo 2 &gt;/sys/devices/platform/soc/soc:globaltime/globaltime</span><br></span></code></pre></div></div>
<p>向应用层提供/sys接口用来设置或者获取当前选中的phc编号</p>
<p>查看当前选中的phc编号：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  cat /sys/devices/platform/soc/soc:globaltime/phcindex</span><br></span></code></pre></div></div>
<p>设置phc编号：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  echo 0 &gt;/sys/devices/platform/soc/soc:globaltime/phcindex</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  或</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo 1 &gt;/sys/devices/platform/soc/soc:globaltime/phcindex</span><br></span></code></pre></div></div>
<div style="border-left:4px solid orange;background:#fff7f0;padding:10px;border-radius:8px"><p>📍 <strong>注意：</strong> phcindex设置不要超过网卡实际数量。</p></div>
<p>向内核其他模块提供接口，查看当前系统用的哪个timeline，以及使用的是哪个phc，如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  int32_t hobot_get_global_time_type(uint32_t *global_time_type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32_t hobot_get_phc_index(uint32_t *phc_index);</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="mcu时间同步说明">MCU时间同步说明<a href="#mcu时间同步说明" class="hash-link" aria-label="Direct link to MCU时间同步说明" title="Direct link to MCU时间同步说明">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mcu支持的时间类型">MCU支持的时间类型<a href="#mcu支持的时间类型" class="hash-link" aria-label="Direct link to MCU支持的时间类型" title="Direct link to MCU支持的时间类型">​</a></h3>
<p>PHC时间：这个是网卡内部的一个计时器；</p>
<p>RTC时间：这个是S100 MCU侧带的一个实时时钟，不支持通过纽扣电池供电；</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mcu支持的时间同步方式">MCU支持的时间同步方式<a href="#mcu支持的时间同步方式" class="hash-link" aria-label="Direct link to MCU支持的时间同步方式" title="Direct link to MCU支持的时间同步方式">​</a></h3>
<p>MCU只支持下面的时间同步方式:</p>
<p>基于PPS的Timesync：在秒脉冲上升沿捕捉到两个时间的snapshot，根据snapshot计算误差，根据误差进行时间同步 ；</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="基于pps的timesync">基于PPS的Timesync<a href="#基于pps的timesync" class="hash-link" aria-label="Direct link to 基于PPS的Timesync" title="Direct link to 基于PPS的Timesync">​</a></h3>
<p>代码目录： mcu/Service/TimeSync/src/</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="支持的时间">支持的时间<a href="#支持的时间" class="hash-link" aria-label="Direct link to 支持的时间" title="Direct link to 支持的时间">​</a></h4>
<ul>
<li>RTC</li>
<li>PHC</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置方法">配置方法<a href="#配置方法" class="hash-link" aria-label="Direct link to 配置方法" title="Direct link to 配置方法">​</a></h4>
<p>通过修改配置决定使用哪种时间同步方式。配置代码在./Service/TimeSync/src/Hobot_TimeSync.c文件中。目前只是支持下面一种时间同步方式：</p>
<p>PHC同步RTC</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  /*TimeSync Config Begin*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint8 ConfigSource[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperRTC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperGPS Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperStbmPhc Source //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperSpi Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperIPC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperPHC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE //TimeKeeperGpt Source //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _Bool EnableTimeKeeper[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperRTC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperGPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperStbmPhc //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperSpi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperIPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperPHC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE//TimeKeeperGpt //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _Bool Enable_TimeSync_RTC_Once= FALSE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _Bool Enable_HobotTimesync_Debug = FALSE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _Bool EthTsync_Master_Use_Phc = TRUE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint8 TimeSync_PPS_Index = TIMESYNC_MCU_ETH0_PPS;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /*TimeSync Config End*/</span><br></span></code></pre></div></div>
<p>ConfigSource：配置每个时间的时间源，如果一个时间不需要和其他时间同步，时间源配置成TIMEKEEPER_NONE。</p>
<p>可以配置的时间源为 ：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  typedef enum TimeKeeperIndexEnum {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_RTC_INDEX,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_GPS_INDEX,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_STBMPHC_INDEX, //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_SPI_INDEX,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_IPC_INDEX,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_PHC_INDEX,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_STBMGPT_INDEX, //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NUM_MAX,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } TimeKeeperIndex;</span><br></span></code></pre></div></div>
<p>EnableTimeKeeper： 配置时间是否打开 ；</p>
<p>Enable_HobotTimesync_Debug： 配置是否开启打印 ；</p>
<p>TimeSync_PPS_Index： 配置使用哪个PPS进行时间同步，可以使用的PPS如下 ：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_AON_RTC_PPS 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_PPS0 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_PPS1 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_PPS2 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_PCIE0_PTM_PPS 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_PCIE1_PTM_PPS 7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_ACORE_ETH0_PPS 8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_ACORE_ETH1_PPS 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_MCU_ETH0_PPS 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  #define TIMESYNC_PPS_DISABLE 11</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置举例">配置举例<a href="#配置举例" class="hash-link" aria-label="Direct link to 配置举例" title="Direct link to 配置举例">​</a></h4>
<p>如果想配置RTC和GPS进行时间同步， 配置如下:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  /*TimeSync Config Begin*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint8 ConfigSource[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_GPS_INDEX, //TimeKeeperRTC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperGPS Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperStbmPhc Source //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperSpi Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperIPC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE, //TimeKeeperPHC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE //TimeKeeperGpt Source //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _Bool EnableTimeKeeper[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TRUE,//TimeKeeperRTC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TRUE,//TimeKeeperGPS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperStbmPhc //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperSpi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperIPC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,//TimeKeeperPHC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE//TimeKeeperGpt //Not Used in S100</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _Bool Enable_TimeSync_RTC_Once= FALSE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  _Bool Enable_HobotTimesync_Debug = FALSE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /*TimeSync Config End*/</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="PPS">PPS说明<a href="#PPS" class="hash-link" aria-label="Direct link to PPS说明" title="Direct link to PPS说明">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="s100-pps-介绍">S100 PPS 介绍<a href="#s100-pps-介绍" class="hash-link" aria-label="Direct link to S100 PPS 介绍" title="Direct link to S100 PPS 介绍">​</a></h3>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_s100/image43.png" alt="" class="img_ev3q"></p>
<p>如上图所示，S100上的PPS可以分为PPS Source和PPS Target。PPS Source产生PPS，经过中间的Trigger Bus送到PPS Target，PPS Target利用送来的PPS产生snapshot或者LPWM波形。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pps-target">PPS Target<a href="#pps-target" class="hash-link" aria-label="Direct link to PPS Target" title="Direct link to PPS Target">​</a></h3>
<p>PPS Target表示被PPS触发的对象，用于产生snapshot或者LPWM波形，S100使用PPS触发的对象主要有以下几个：</p>
<p>PPS OUT：PPS2的管脚复用在当前软件版本上默认是设置为PPS OUT的，即可以通过这个pad脚将芯片内的PPS向外输出到片外；</p>
<p>GIC：当前软件版本默认将MCU RTC，PPS0，PPS1，PPS2和MCU ETH PPS的中断给到了GIC；</p>
<p>Acore ETH：Acore ETH可以接受PPS源，并通过PPS打自身硬件的snapshot时间；</p>
<p>LPWM：LPWM可以接受PPS源输入，并通过PPS产生对应的LPWM波形；</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pps-source">PPS Source<a href="#pps-source" class="hash-link" aria-label="Direct link to PPS Source" title="Direct link to PPS Source">​</a></h3>
<p>S100的PPS source有多个源可选，其中常用的源有以下几个，其它是reserve的：</p>
<p>编号0：MCU RTC PPS，是MCU侧RTC输出的PPS，当前软件版本默认已有输出，周期1秒1次；</p>
<p>编号2：PPS0，PPS的pad，可用于GPS PPS等外部PPS源输入到芯片内部；</p>
<p>编号3：PPS1，PPS的pad，可用于GPS PPS等外部PPS源输入到芯片内部；</p>
<p>编号4：PPS2，PPS的pad，可用于GPS PPS等外部PPS源输入到芯片内部，也可以用于将内部的PPS输出到外部；</p>
<p>编号8：Acore Eth0 PPS， 是Acore Eth0产生的PPS，可以设置灵活的时间周期，比如1秒1次，400毫秒1次等；</p>
<p>编号9：Acore Eth1 PPS， 是Acore Eth1产生的PPS；可以设置灵活的时间周期，比如1秒1次，400毫秒1次等；</p>
<p>编号10：MCU Eth PPS，是MCU侧Eth输出的PPS，当前软件版本默认已有输出，周期1秒1次;</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="pps的pad配置">PPS的PAD配置<a href="#pps的pad配置" class="hash-link" aria-label="Direct link to PPS的PAD配置" title="Direct link to PPS的PAD配置">​</a></h3>
<p>当前软件版本默认将PPS0和PPS1设置为了PPS的IN，即用于接收GPS PPS等外部PPS的输入；把PPS2设置为了PPS的OUT，即将S100芯片的PPS输出到外部；
它们的配置均由MCU侧的Port模块进行了配置，如需要修改，则在Port模块中进行修改。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="Acore_Eth_PPS">Acore Eth PPS介绍<a href="#Acore_Eth_PPS" class="hash-link" aria-label="Direct link to Acore Eth PPS介绍" title="Direct link to Acore Eth PPS介绍">​</a></h3>
<p>Acore Eth PPS有两种输出方法，flex mode和fix mode两种。上电默认是fix mode。可以通过下文中ethtool命令设置为flex mode。若要重置为fix mode，可以通过重启网卡或者重启系统完成恢复。</p>
<p>flex mode: 灵活的pps模式，它的开始/结束时间、周期、占空比均可以灵活配置，其上升沿是整秒时刻，PPS输出不会随着PHC时间的变化而变化；当前软件版本下，其占空比是百分之一，周期可以根据下方配置方法灵活配置，常用的有1s，400ms。</p>
<p>fixed mode: 固定的pps模式，它的周期固定，且占空比也固定为46.3%。PPS输出会随着PHC时间的变化而变化。当前软件版本下，其支持1s周期，波形的整秒时刻是下降沿，经过537ms的低电平后，再输出463ms的高电平。</p>
<p>整秒输出需求配置方法：</p>
<p>若在flex mode下有整秒时刻输出PPS的需求，需要在gptp时间同步完成后，再配置PPS输出；</p>
<p>若在fixed mode下有整秒时刻输出PPS的需求，需要注意ETH的整秒时刻在下降沿出现，而LPWM被ETH上升沿同步。因此需要参考下图，调整LPWM的offset。以camera一秒30帧举例，PPS上升沿在537ms，下降沿在1s整秒处，要求在整秒位置出图的话，offset=463对33.333取余数=29.671ms。</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_s100/image44.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="acore-eth-pps的输出配置方法">Acore Eth PPS的输出配置方法<a href="#acore-eth-pps的输出配置方法" class="hash-link" aria-label="Direct link to Acore Eth PPS的输出配置方法" title="Direct link to Acore Eth PPS的输出配置方法">​</a></h3>
<p>Acore Eth PPS的输出，可以借助ethtool工具，命令格式如下 :</p>
<p>配置Eth0的PPS输出1秒的周期：ethtool hobot_gmac --set-flex-pps eth0 index 0 fpps on interval 1000000000;</p>
<p>配置Eth1的PPS输出1秒的周期：ethtool hobot_gmac --set-flex-pps eth1 index 0 fpps on interval 1000000000;</p>
<p>如果需要修改输出周期的话，修改最后一个参数&lt;1000000000&gt;，该参数的单位是ns，如果要修改为400ms的话，则改为&lt;400000000&gt;。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mcu-eth-pps的配置方法">MCU Eth PPS的配置方法<a href="#mcu-eth-pps的配置方法" class="hash-link" aria-label="Direct link to MCU Eth PPS的配置方法" title="Direct link to MCU Eth PPS的配置方法">​</a></h3>
<p>MCU Eth PPS的信号周期和脉冲宽度在<code>Config/McalCdd/gen_s100_sip_B_mcu1/Ethernet/src/Mac_Ip_PBcfg.c</code>配置文件中设置默认值，其中PpsInterval的默认值为1000(ms)，参数PpsWidth的默认值为10(ms)。</p>
<p>限制条件：</p>
<ul>
<li>配置项EthGlobalTimeSupport需要被使能，默认使能；</li>
<li>参数PpsWidth的值必须小于PpsInterval；</li>
</ul>
<p>配置使能后通过查看sys节点assert变化确认PPS配置是否生效。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /sys/class/pps/pps[4]/assert</span><br></span></code></pre></div></div>
<p>/sys/class/pps下包含多个pps，通过name确认哪个PPS对应MCU PPS。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /sys/class/pps/pps[*]/name</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="时间同步整体方案">时间同步整体方案<a href="#时间同步整体方案" class="hash-link" aria-label="Direct link to 时间同步整体方案" title="Direct link to 时间同步整体方案">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能概述">功能概述<a href="#功能概述" class="hash-link" aria-label="Direct link to 功能概述" title="Direct link to 功能概述">​</a></h3>
<p>本文主要以S100为例，介绍时间同步方案。目前MCU主线默认支持的是时间源接入S100
Acore的单时间域方案。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="软件架构说明">软件架构说明<a href="#软件架构说明" class="hash-link" aria-label="Direct link to 软件架构说明" title="Direct link to 软件架构说明">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="时间源接入acore的单时间域方案">时间源接入Acore的单时间域方案<a href="#时间源接入acore的单时间域方案" class="hash-link" aria-label="Direct link to 时间源接入Acore的单时间域方案" title="Direct link to 时间源接入Acore的单时间域方案">​</a></h5>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/02_linux_development/driver_development_s100/image45.png" alt="" class="img_ev3q"></p>
<p>上图时间同步流程总结如下：</p>
<ul>
<li>
<p>外部gptp master设备作为整个S100的时间源；</p>
</li>
<li>
<p>首先通过ptp4l软件将gptp master的时间同步给Acore侧的网卡；然后通过phc2sys将网卡时间同步给Linux系统时间，该过程持续进行；</p>
</li>
<li>
<p>接下来通过Acore timesync_sample软件将网卡时间同步给MCU侧Rtc；</p>
</li>
</ul>
<p>特性说明：</p>
<ul>
<li>
<p>Rtc支持给图中的CIM和CAN打硬件时间戳；</p>
</li>
<li>
<p>Acore 网卡可以发出pps，触发lpwm进行曝光同步；</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="代码位置及目录结构">代码位置及目录结构<a href="#代码位置及目录结构" class="hash-link" aria-label="Direct link to 代码位置及目录结构" title="Direct link to 代码位置及目录结构">​</a></h4>
<p>Acore侧timesync sample代码位于工程目录：<code>{sdk_dir}/source/hobot-sp-samples/debian/app/timesync_demo</code></p>
<p>MCU侧timesync sample代码位于工程目录：<code>{mcu_dir}/mcu/Service/TimeSync</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="acore编译">Acore编译<a href="#acore编译" class="hash-link" aria-label="Direct link to Acore编译" title="Direct link to Acore编译">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译环境">编译环境<a href="#编译环境" class="hash-link" aria-label="Direct link to 编译环境" title="Direct link to 编译环境">​</a></h4>
<p>板端在安装hobot-sp-samples_*.deb包后，会包含codec_demo源码内容。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译说明">编译说明<a href="#编译说明" class="hash-link" aria-label="Direct link to 编译说明" title="Direct link to 编译说明">​</a></h4>
<p>本sample主要依赖ipcfhal和timesync提供的API头文件</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hb_ipcf_hal.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hobot_clock_hal.h&quot;</span><br></span></code></pre></div></div>
<p>编译依赖的库有如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  LIBS := -lhbipcfhal -lhbtimesynchal -lpthread -lalog</span><br></span></code></pre></div></div>
<p>编译命令：</p>
<p>板端进入/app/timesync_demo/sample_timesync目录，执行</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  make</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mcu编译">MCU编译<a href="#mcu编译" class="hash-link" aria-label="Direct link to MCU编译" title="Direct link to MCU编译">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="编译环境-1">编译环境<a href="#编译环境-1" class="hash-link" aria-label="Direct link to 编译环境" title="Direct link to 编译环境">​</a></h4>
<p>MCU侧本sample的编译环境使用MCU代码中的build工具，请参考：<a href="/rdk_doc/en/rdk_s/Advanced_development/05_mcu_development/01_S100/basic_information.md#%E6%9C%BA%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83%E8%A6%81%E6%B1%82">MCU编译</a></p>
<p>编译FreeRtos镜像版本。注意</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # 进入Build/FreeRtos目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  python build_freertos.py s100_sip_B debug # 硬件板或者项目名</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="运行">运行<a href="#运行" class="hash-link" aria-label="Direct link to 运行" title="Direct link to 运行">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="支持平台">支持平台<a href="#支持平台" class="hash-link" aria-label="Direct link to 支持平台" title="Direct link to 支持平台">​</a></h5>
<p>S100</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="板端部署及配置">板端部署及配置<a href="#板端部署及配置" class="hash-link" aria-label="Direct link to 板端部署及配置" title="Direct link to 板端部署及配置">​</a></h5>
<p>需要做好如下准备工作：</p>
<p>烧写好支持MCU侧时间  同步服务的MCU固件。</p>
<p>若需要运行gptp时间同步，需要保证网络连通。</p>
<p>为了防止Linux操作系统自带时间同步服务产生干扰，需要执行如下命令关闭Linux自带时间同步服务。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  systemctl stop systemd-timesyncd</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="运行指南">运行指南<a href="#运行指南" class="hash-link" aria-label="Direct link to 运行指南" title="Direct link to 运行指南">​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="时间源接入acore的单时间域方案-1">时间源接入Acore的单时间域方案<a href="#时间源接入acore的单时间域方案-1" class="hash-link" aria-label="Direct link to 时间源接入Acore的单时间域方案" title="Direct link to 时间源接入Acore的单时间域方案">​</a></h6>
<p>MCU侧在./Service/TimeSync/src/Hobot_TimeSync.c代码中进行如下配置修改：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Timesync Config Begin */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uint8_t ConfigSource[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_IPC_INDEX,   // TimeKeeperRTC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE,        // TimeKeeperGPS Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_IPC_INDEX,   // TimeKeeperStbmPhc Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE,        // TimeKeeperSpi Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE,        // TimeKeeperIPC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE,        // TimeKeeperPHC Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMEKEEPER_NONE         // TimeKeeperGpt Source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_Bool EnableTimeKeeper[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TRUE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TRUE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    FALSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_Bool Enable_TimeSync_RTC_Once = FALSE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">_Bool Enable_HobotTimesync_Debug = TRUE;</span><br></span></code></pre></div></div>
<p>MCU侧的修改需要注意 PRODUCT_IMAGE宏的影响，详细内容请参考上述注意事项章节。</p>
<p>刷写启动后，默认MCU执行如下命令，第一条命令指定PPS触发源为mcu eth；第二条命令启动时间同步服务</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  TimeSyncCtrl 4 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TimeSyncCtrl 6</span><br></span></code></pre></div></div>
<p>Acore执行如下命令，第一条命令设置log等级，允许输出打印到控制台；第二条命令启动ptp时间同步，将外部ptp master时间同步到Acore网卡；
第三条命令将网卡时间同步到Linux系统时间；第五条命令启动时间同步程序，将Acore网卡时间同步给MCU侧Rtc。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ptp4l -i eth0 -f /usr/hobot/lib/pkgconfig/automotive-slave.cfg -m -l 7 &gt; ptp4l.log &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">phc2sys -s eth0 -c CLOCK_REALTIME --transportSpecific=1 -m --step_threshold=1000 -w &gt; phc2sys.log &amp;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd /app/timesync_demo/sample_timesync</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./timesync_sample -p 0 -P 4 -r</span><br></span></code></pre></div></div>
<p>关键参数说明：</p>
<p>-p 1: 同步网卡1的时间； -p 0: 同步网卡0的时间(默认)</p>
<p>-r: 将Acore网卡时间同步给MCU Rtc时间</p>
<p>Acore时间同步log如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:510] ************************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:517] Monotonic_raw time: second = 222, nanosecond = 557846725</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:520] PPS fetch infobuf time: second = 1745925136, nanosecond = 454616475</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:531] rtc snapshot: sec = 1745925136, nsec = 455389596</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:538] ptp0 snapshot: sec = 1745925136, nsec = 455462040</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:582] Timesync Info: timesync ipc send data succeed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][][/app/timesync_demo/sample_timesync/timesync_sample.c:510] ************************************************</span><br></span></code></pre></div></div>
<p>Acore log说明：</p>
<p>&quot;snapshot&quot;字段为MCU网卡发出pps秒脉冲时各个clock对应的硬件时间戳；</p>
<p>&quot;PPS fetch infobuf time&quot;字段为Acore pps驱动捕获到的系统时间；</p>
<p>&quot;timesync ipc send data succeed&quot;提示说明Acore网卡时间戳成功发送给MCU，由MCU侧进行时间同步，时间同步质量在MCU侧查看。</p>
<p>MCU时间同步log如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[0162.799758 0]*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0162.802970 0]RTC snapshot time:1745925071.455114934</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0163.000408 0]Timesync_RecvCallback.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0163.000661 0]Get Time From Acore success 1745925071 455188935</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0163.001958 0]TimeKeeperRTC and TimeKeeperIPC Offset : - 0s.74001ns</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[0163.789774 0]*</span><br></span></code></pre></div></div>
<p>MCU log说明：</p>
<p>&quot;Get Time From Acore success&quot; 表明MCU从Acore拿时间成功；</p>
<p>&quot;TimeKeeperRTC and TimeKeeperIPC Offset&quot; ，表明在同步时，Rtc使用IPC时间同步时的offset。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-06-25T04:05:57.000Z" itemprop="dateModified">Jun 25, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/en/rdk_s/Advanced_development/linux_development/driver_development_s100/driver_audio"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">音频调试指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/en/rdk_s/13_driver_pcie"><div class="pagination-nav__sublabel">Next </div><div class="pagination-nav__label">PCIe使用指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#名词缩写及解释" class="table-of-contents__link toc-highlight">名词缩写及解释</a></li><li><a href="#ptp时间同步" class="table-of-contents__link toc-highlight">ptp时间同步</a><ul><li><a href="#功能" class="table-of-contents__link toc-highlight">功能</a></li><li><a href="#ptp4l使用方法" class="table-of-contents__link toc-highlight">ptp4l使用方法</a><ul><li><a href="#命令行参数" class="table-of-contents__link toc-highlight">命令行参数</a></li><li><a href="#配置文件的使用" class="table-of-contents__link toc-highlight">配置文件  的使用</a></li><li><a href="#automotive配置示例" class="table-of-contents__link toc-highlight">automotive配置示例</a></li></ul></li><li><a href="#phc2sys使用方法" class="table-of-contents__link toc-highlight">phc2sys使用方法</a></li><li><a href="#综合示例" class="table-of-contents__link toc-highlight">综合示例</a><ul><li><a href="#命令行参数-1" class="table-of-contents__link toc-highlight">命令行参数</a></li><li><a href="#log示例" class="table-of-contents__link toc-highlight">Log示例</a></li></ul></li></ul></li><li><a href="#全局时间源配置" class="table-of-contents__link toc-highlight">全局时间源配置</a></li><li><a href="#mcu时间同步说明" class="table-of-contents__link toc-highlight">MCU时间同步说明</a><ul><li><a href="#mcu支持的时间类型" class="table-of-contents__link toc-highlight">MCU支持的时间类型</a></li><li><a href="#mcu支持的时间同步方式" class="table-of-contents__link toc-highlight">MCU支持的时间同步方式</a></li><li><a href="#基于pps的timesync" class="table-of-contents__link toc-highlight">基于PPS的Timesync</a><ul><li><a href="#支持的时间" class="table-of-contents__link toc-highlight">支持的时间</a></li><li><a href="#配置方法" class="table-of-contents__link toc-highlight">配置方法</a></li><li><a href="#配置举例" class="table-of-contents__link toc-highlight">配置举例</a></li></ul></li></ul></li><li><a href="#PPS" class="table-of-contents__link toc-highlight">PPS说明</a><ul><li><a href="#s100-pps-介绍" class="table-of-contents__link toc-highlight">S100 PPS 介绍</a></li><li><a href="#pps-target" class="table-of-contents__link toc-highlight">PPS Target</a></li><li><a href="#pps-source" class="table-of-contents__link toc-highlight">PPS Source</a></li><li><a href="#pps的pad配置" class="table-of-contents__link toc-highlight">PPS的PAD配置</a></li><li><a href="#Acore_Eth_PPS" class="table-of-contents__link toc-highlight">Acore Eth PPS介绍</a></li><li><a href="#acore-eth-pps的输出配置方法" class="table-of-contents__link toc-highlight">Acore Eth PPS的输出配置方法</a></li><li><a href="#mcu-eth-pps的配置方法" class="table-of-contents__link toc-highlight">MCU Eth PPS的配置方法</a></li></ul></li><li><a href="#时间同步整体方案" class="table-of-contents__link toc-highlight">时间同步整体方案</a><ul><li><a href="#功能概述" class="table-of-contents__link toc-highlight">功能概述</a><ul><li><a href="#软件架构说明" class="table-of-contents__link toc-highlight">软件架构说明</a><ul><li><a href="#时间源接入acore的单时间域方案" class="table-of-contents__link toc-highlight">时间源接入Acore的单时间域方案</a></li></ul></li><li><a href="#代码位置及目录结构" class="table-of-contents__link toc-highlight">代码位置及目录结构</a></li></ul></li><li><a href="#acore编译" class="table-of-contents__link toc-highlight">Acore编译</a><ul><li><a href="#编译环境" class="table-of-contents__link toc-highlight">编译环境</a></li><li><a href="#编译说明" class="table-of-contents__link toc-highlight">编译说明</a></li></ul></li><li><a href="#mcu编译" class="table-of-contents__link toc-highlight">MCU编译</a><ul><li><a href="#编译环境-1" class="table-of-contents__link toc-highlight">编译环境</a></li><li><a href="#运行" class="table-of-contents__link toc-highlight">运行</a><ul><li><a href="#支持平台" class="table-of-contents__link toc-highlight">支持平台</a></li><li><a href="#板端部署及配置" class="table-of-contents__link toc-highlight">板端部署及配置</a></li><li><a href="#运行指南" class="table-of-contents__link toc-highlight">运行指南</a></li></ul></li></ul></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GuYueHome<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact US</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 D-Robotics.</div></div></div></footer></div>
</body>
</html>