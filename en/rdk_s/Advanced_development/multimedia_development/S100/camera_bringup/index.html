<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-docs_s docs-version-current docs-doc-page docs-doc-id-Advanced_development/multimedia_development/S100/camera_bringup" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Camera Bring-up | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" property="og:title" content="Camera Bring-up | RDK DOC"><meta data-rh="true" name="description" content="HBN Sensor Bring-up"><meta data-rh="true" property="og:description" content="HBN Sensor Bring-up"><link data-rh="true" rel="icon" href="/rdk_doc/en/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"7. Advanced Development","item":"https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development"},{"@type":"ListItem","position":2,"name":"7.3 Multimedia Development Guide","item":"https://developer.d-robotics.cc/rdk_doc/en/rdk_s/03_multimedia_development"},{"@type":"ListItem","position":3,"name":"7.3.1 S100 Multimedia Development Guide","item":"https://developer.d-robotics.cc/rdk_doc/en/rdk_s/category/731-s100-多媒体开发指南"},{"@type":"ListItem","position":4,"name":"Camera Bring-up","item":"https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script>
<script src="/rdk_doc/js/dify-config.js"></script>
<script src="https://rdk.d-robotics.cc/embed.min.js" id="MltLQTHPb5EeP7uz" defer="defer"></script><link rel="stylesheet" href="/rdk_doc/en/assets/css/styles.e31f7a90.css">
<script src="/rdk_doc/en/assets/js/runtime~main.cb64c579.js" defer="defer"></script>
<script src="/rdk_doc/en/assets/js/main.c7d87d1a.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a class="navbar__item navbar__link" href="/rdk_doc/en/RDK">RDK X3 / X5</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/en/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>EN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/en/rdk_s/RDK">D-Robotics RDK Kit</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Quick_start">1. Quick Start</a><button aria-label="Expand sidebar category &#x27;1. Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/System_configuration">2. System Configuration</a><button aria-label="Expand sidebar category &#x27;2. System Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Basic_Application">3. Basic Application Development</a><button aria-label="Expand sidebar category &#x27;3. Basic Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Basic_Development">4. Algorithm Application Development</a><button aria-label="Expand sidebar category &#x27;4. Algorithm Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Robot_development">5. Robotics Application Development</a><button aria-label="Expand sidebar category &#x27;5. Robotics Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Application_case">6. Application Development Guide</a><button aria-label="Expand sidebar category &#x27;6. Application Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/en/rdk_s/Advanced_development">7. Advanced Development</a><button aria-label="Collapse sidebar category &#x27;7. Advanced Development&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/hardware_development">7.1 Hardware Development Guide</a><button aria-label="Expand sidebar category &#x27;7.1 Hardware Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/linux_development">7.2. Linux Development Guide</a><button aria-label="Expand sidebar category &#x27;7.2. Linux Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/en/rdk_s/03_multimedia_development">7.3 Multimedia Development Guide</a><button aria-label="Collapse sidebar category &#x27;7.3 Multimedia Development Guide&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/en/rdk_s/category/731-s100-多媒体开发指南">7.3.1 S100 Multimedia Development Guide</a><button aria-label="Collapse sidebar category &#x27;7.3.1 S100 Multimedia Development Guide&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camsys">Camsys Subsystem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camera_bringup">Camera Bring-up</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/codec">Codec</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/display">Display Subsystem</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camerasync">Multi-Camera and Synchronization with Lidar</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/02_multimedia_application">7.3.2 Multimedia Application Development </a><button aria-label="Expand sidebar category &#x27;7.3.2 Multimedia Application Development &#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/04_toolchain_development">7.4 Algorithm Toolchain Development Guide</a><button aria-label="Expand sidebar category &#x27;7.4 Algorithm Toolchain Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/rdk_s/05_MCU_development">7.5 MCU Development Guide</a><button aria-label="Expand sidebar category &#x27;7.5 MCU Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/rdk_s/Advanced_development/rdk_gen">7.6 RDK S100 Build System Development Guide</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/FAQ">8. FAQ</a><button aria-label="Expand sidebar category &#x27;8. FAQ&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/rdk_s/Appendix">9. Appendix</a><button aria-label="Expand sidebar category &#x27;9. Appendix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/en/rdk_s/Release_Note/roadmap">10. Version release</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rdk_doc/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/rdk_s/Advanced_development"><span>7. Advanced Development</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/rdk_s/03_multimedia_development"><span>7.3 Multimedia Development Guide</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/rdk_s/category/731-s100-多媒体开发指南"><span>7.3.1 S100 Multimedia Development Guide</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Camera Bring-up</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Camera Bring-up</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="hbn-sensor-bring-up">HBN Sensor Bring-up<a href="#hbn-sensor-bring-up" class="hash-link" aria-label="Direct link to HBN Sensor Bring-up" title="Direct link to HBN Sensor Bring-up">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="scope">Scope<a href="#scope" class="hash-link" aria-label="Direct link to Scope" title="Direct link to Scope">​</a></h3>
<p>This section provides an overview of the RDK-S100 camera bring-up process, helping readers quickly understand and master the RDK-S100 camera framework, how to rapidly add new camera configurations, and successfully bring up the camera.</p>
<p>This documentation uses the RDK-S100 development board with an imx219 camera module as an example for configuration instructions. For other hardware platforms or camera modules, please refer to actual hardware specifications.<br>
<img decoding="async" loading="lazy" src="http://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_01-en.jpg" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="preparation">Preparation<a href="#preparation" class="hash-link" aria-label="Direct link to Preparation" title="Direct link to Preparation">​</a></h3>
<p><strong>Hardware resources</strong>: RDK-S100 development board, camera module.<br>
<strong>Software resources</strong>: System SDK, camera driver source code, sensor datasheet, sensor initialization settings, etc.</p>
<p>The camera-related hardware resources of the RDK-S100 development board are listed below:</p>
<table><thead><tr><th>RDK-S100</th><th>MIPI host</th><th>I2C</th><th>gpio_en</th><th>gpio_lpwm_mclk</th><th>Others</th></tr></thead><tbody><tr><td>RX0<br> Supports imx219 module</td><td><strong>0</strong><br>  4 lane</td><td><strong>1</strong></td><td>SPI1_CSN0<br>  gpio_number:502</td><td>Selectable via DIP switch<br>  • LPWM0_DOUT0<br>  gpio_number:456<br>  • mclk 24MHz</td><td>Note: The imx219 module has an external 24MHz crystal oscillator, so SOC-side mclk output is not required</td></tr><tr><td>RX1<br> Supports imx219 module</td><td><strong>1</strong><br>   4 lane</td><td><strong>2</strong></td><td>SD_WPROT<br>  gpio_number:494</td><td>Selectable via DIP switch<br>  • LPWM0_DOUT1<br> gpio_number:457<br>  • mclk 24MHz</td><td>Note: The imx219 module has an external 24MHz crystal oscillator, so SOC-side mclk output is not required</td></tr><tr><td>RX4<br> For SerDes connection</td><td><strong>4</strong><br>  4 lane</td><td><strong>3</strong></td><td>Not specified</td><td>Not specified</td><td>Deserializer max96712, addr: 0x29; PoC max20087, addr: 0x28</td></tr></tbody></table>
<p>Hardware connection diagram:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_02.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="steps-to-add-and-bring-up-a-new-sensor">Steps to Add and Bring Up a New Sensor<a href="#steps-to-add-and-bring-up-a-new-sensor" class="hash-link" aria-label="Direct link to Steps to Add and Bring Up a New Sensor" title="Direct link to Steps to Add and Bring Up a New Sensor">​</a></h3>
<p>When adapting <strong>new hardware</strong> and a <strong>new camera</strong> to the RDK-S100 platform, you only need to modify the platform device tree (DTS), camera driver library, and related configuration files. System libraries generally do not require modification.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="dts-modifications">DTS Modifications<a href="#dts-modifications" class="hash-link" aria-label="Direct link to DTS Modifications" title="Direct link to DTS Modifications">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sensor-gpio-configuration">Sensor GPIO Configuration<a href="#sensor-gpio-configuration" class="hash-link" aria-label="Direct link to Sensor GPIO Configuration" title="Direct link to Sensor GPIO Configuration">​</a></h5>
<p>Ensure that the GPIOs used by the new sensor hardware are configured in the <code>drobot-s100-pinctrl.dtsi --&gt; pinctrl_video --&gt; video_gpio</code> node. This ensures the system configures the corresponding pins as GPIOs during boot-up, allowing user programs to control them.</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_03.png" alt="" class="img_ev3q"></p>
<p><code>vcon</code> is the RDK-S100 camera DTS node used to manage sensor hardware. If the sensor requires specific timing signals to start correctly, the corresponding GPIOs must be configured in this node. Configure these settings according to your actual hardware connections; relevant information can be obtained from schematics and pin lists.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// DTS: Set GPIOs in the corresponding vcon node. Note that vcon port numbers correspond one-to-one with MIPI RX ports:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// vcon0 -- RX0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// vcon3 -- RX3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vin_vcon0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bus </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gpio_poc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gpio_des </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sensor_err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//gpio_oth = &lt;444 445&gt;; // Not needed for imx219, so commented out and left empty</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lpwm_chn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rx_phy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="sensor-i2c-configuration">Sensor I2C Configuration<a href="#sensor-i2c-configuration" class="hash-link" aria-label="Direct link to Sensor I2C Configuration" title="Direct link to Sensor I2C Configuration">​</a></h5>
<p>The I2C bus number must be bound to the MIPI RX port in the DTS <code>vcon</code> node. Configure this according to your actual hardware connections; relevant information can be obtained from schematics.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Set I2C bus in the corresponding vcon node; for example, RX0 uses I2C2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">vin_vcon0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        bus </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gpio_poc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        gpio_des </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sensor_err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lpwm_chn </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rx_phy </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="mclk-configuration">MCLK Configuration<a href="#mclk-configuration" class="hash-link" aria-label="Direct link to MCLK Configuration" title="Direct link to MCLK Configuration">​</a></h5>
<p>The RDK-S100 baseboard hardware currently does not support SOC-generated MCLK signals connected directly to the sensor module. Only modules with external crystal oscillators are supported.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="dts-modification-verification">DTS Modification Verification<a href="#dts-modification-verification" class="hash-link" aria-label="Direct link to DTS Modification Verification" title="Direct link to DTS Modification Verification">​</a></h5>
<p>If the DTS configuration is correct and the hardware is properly connected—with proper sensor power supply and MCLK—you should be able to detect the sensor’s I2C address using <code>i2cdetect</code>.</p>
<p>Use the <code>echo</code> command to control sensor power-on or reset (note: for the imx219 module, GPIO operations are not required):</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo </span><span class="token number" style="color:#36acaa">502</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">sys</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">class</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gpio</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">export</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo out </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">sys</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">class</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gpio</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gpio502</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">direction</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">sys</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">class</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gpio</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gpio502</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo </span><span class="token number" style="color:#36acaa">502</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">sys</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">class</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">gpio</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">unexport</span><br></span></code></pre></div></div>
<p>Use <code>i2cdetect</code> to scan for the sensor’s I2C address. If the correct address appears as shown below, the DTS configuration is correct; otherwise, review your DTS settings.</p>
<table><thead><tr><th><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_04.png" alt="" class="img_ev3q"></th><th><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_05.png" alt="" class="img_ev3q"></th></tr></thead></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="adding-sensor-driver-files">Adding Sensor Driver Files<a href="#adding-sensor-driver-files" class="hash-link" aria-label="Direct link to Adding Sensor Driver Files" title="Direct link to Adding Sensor Driver Files">​</a></h4>
<p>Sensors from different manufacturers come with varying driver styles and settings. Therefore, you must convert the original sensor driver into RDK-S100-compatible camera driver code, compile it into a shared library (.so), and copy it to <code>/usr/hobot/lib/sensor/</code> on the device. <strong>Note: Before MIPI starts, ensure the sensor stream is not active.</strong></p>
<p>The system SDK includes a sensor driver template file (<code>imx219_utility.c</code>) and adapted drivers for other sensors under <code>hobot-camera/drivers/sensor/</code>. When adding support for a new camera sensor, refer to and modify these files accordingly.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">ifdef</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">CAMERA_FRAMEWORK_HBN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">SENSOR_MODULE_F</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imx219</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> CAM_MODULE_FLAG_A16D8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token class-name">sensor_module_t</span><span class="token plain"> imx219 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">module </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SENSOR_MNAME</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imx219</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token class-name">sensor_module_t</span><span class="token plain"> imx219 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">module </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;imx219&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">init </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_init</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">start </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stop </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_stop</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deinit </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_deinit</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">aexp_gain_control </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_aexp_gain_control</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">aexp_line_control </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_aexp_line_control</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">power_on </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_poweron</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">power_off </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_poweroff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">userspace_control </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sensor_userspace_control</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>As shown above, the sensor driver interface in the RDK-S100 camera framework is encapsulated in the <code>sensor_module_t</code> structure. The filename, structure name, and <code>module</code> field must be consistent. For example, if the filename is <code>imx219_utility.c</code>, both the structure name and <code>module</code> field must be <code>imx219</code>. When bringing up a new sensor, users must implement the following functions:</p>
<ul>
<li><strong>init</strong>: Sensor initialization and setting configuration</li>
<li><strong>deinit</strong>: Sensor de-initialization</li>
<li><strong>start</strong>: Start sensor streaming</li>
<li><strong>stop</strong>: Stop sensor streaming</li>
<li><strong>power_on</strong>: Power on the sensor</li>
<li><strong>power_off</strong>: Power off the sensor</li>
<li><strong>aexp_gain_control</strong>: Sensor gain control</li>
<li><strong>aexp_line_control</strong>: Sensor line exposure control</li>
<li><strong>userspace_control</strong>: Enable user callback functionality</li>
</ul>
<p>For 3A control, the system supports both driver registration and application-layer callbacks. By default, application-layer callbacks are used. The interface definitions are as follows:</p>
<table><thead><tr><th>Function</th><th>Purpose</th><th>Input Parameters</th></tr></thead><tbody><tr><td>aexp_gain_control</td><td>Sensor gain control</td><td><code>info</code>: Sensor bus info; <code>mode</code>: Sensor operation mode (linear/hdr/pwl); <code>again</code>: Sensor analog gain (up to 4 values); <code>dgain</code>: Sensor digital gain (up to 4 values); <code>gain_num</code>: Number of gain parameters</td></tr><tr><td>aexp_line_control</td><td>Sensor exposure control</td><td><code>info</code>: Sensor bus info; <code>mode</code>: Sensor operation mode (linear/hdr/pwl); <code>line</code>: Sensor exposure lines (up to 4 values); <code>line_num</code>: Number of line parameters</td></tr><tr><td>awb_control</td><td>Sensor-side AWB control</td><td><code>info</code>: Sensor bus info; <code>mode</code>: Sensor operation mode (linear/hdr/pwl); <code>rgain</code>: Sensor red gain; <code>bgain</code>: Sensor blue gain; <code>grgain</code>: Sensor green-red gain; <code>gbgain</code>: Sensor green-blue gain</td></tr><tr><td>userspace_control</td><td>HAL-layer control switches</td><td><code>port</code>: Sensor port number; <code>enable</code>: Enable user callback control (disabled by default). Bit definitions: <br><code>#define HAL_LINE_CONTROL 0x00000001</code><br><code>#define HAL_GAIN_CONTROL 0x00000002</code><br><code>#define HAL_AWB_CONTROL 0x00000004</code></td></tr></tbody></table>
<p>The following code demonstrates initialization of the main sensor driver structure, which must be filled in according to each sensor’s specific characteristics:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Actual output width of the sensor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1920</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Actual output height of the sensor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">active_height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1080</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Lines per second, calculated as 1/(time per line) or (fps * vts). Note that vts may be named differently across sensors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// (e.g., frame_length, vts, etc.), but always represents total lines per frame (including active and blanking lines).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// lines_per_second can also be interpreted as HMAX. Note: Some sensors do not have an HMAX concept.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">lines_per_second </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vts </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> sensor_info</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">fps</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Maximum short exposure time (i.e., maximum exposure lines per frame for short exposure).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Calculated as (frame exposure time) / (line exposure time) = (1/fps) / (1/lines_per_second)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exposure_time_max </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vts</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Maximum analog gain multiplier. For example, if turning_data.sensor_data.analog_gain_max = 126,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// the maximum gain ratio is calculated as 2^(X/32), where X = 126. This X value varies by sensor manufacturer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// and should be obtained from the sensor datasheet or vendor. Alternatively, obtain the sensor’s maximum gain,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// then look up the corresponding index in the J5-ISP gain table—the index value represents the maximum gain ratio.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">analog_gain_max </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">109</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">digital_gain_max </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Minimum short exposure time (minimum exposure lines per frame for short exposure).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Exposure time per line can be calculated using the formula: 1 second / (frame rate * (active lines + blanking)), i.e., 1 / lines_per_second.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exposure_time_min </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Maximum long exposure time (maximum exposure lines per frame for long exposure).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exposure_time_long_max </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> vts</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Fill in sensor bit width (data_width), bayer_start (RGGB pattern start: R/Gr/Gb/B),</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// and bayer_pattern (RGGB/RCCC/RIrGB/RGIrB) information.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sensor_data_bayer_fill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">BAYER_START_R</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">BAYER_PATTERN_RGGB</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Fill in exposure_max_bit_width (pwl mode bits) information.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sensor_data_bits_fill</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sensor_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// setting stream ctrl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Stream ON/OFF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stream_ctrl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data_length </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// again LUT table: firmware uses the index to look up the LUT table and find the corresponding sensor register values.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// LUT tables are separated for a_gain and d_gain.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// LUT table sizes: again_lut[again_control_num][256], dgain_lut[dgain_control_num][256].</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">again_lut </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">again_lut </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">again_lut</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">again_lut</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imx219_gain_lut</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imx219_gain_lut</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dgain_lut </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">malloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">256</span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dgain_lut </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">memset</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dgain_lut</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0xff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">memcpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">turning_data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">normal</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dgain_lut</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> imx219_dgain_lut</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imx219_dgain_lut</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>• turning_data.sensor_data.active_width: Actual output width of the sensor.</p>
<p>• turning_data.sensor_data.active_height: Actual output height of the sensor.</p>
<p>• turning_data.sensor_data.analog_gain_max: Maximum analog gain multiplier.<br>
<!-- -->For example, if turning_data.sensor_data.analog_gain_max = 126, the maximum gain is calculated as 2^(X/32), where X = 126.This X value varies by sensor manufacturer and must be obtained from the sensor datasheet or the sensor vendor.</p>
<p>• turning_data.sensor_data.digital_gain_max: Maximum digital gain multiplier.</p>
<p>• turning_data.sensor_data.exposure_time_min: Minimum short exposure time (minimum exposure lines per frame for short exposure).<br>
<!-- -->Exposure time per line can be derived using the formula: 1 second / (frame rate * (active lines + blanking)), i.e., 1 / lines_per_second.</p>
<p>• turning_data.sensor_data.exposure_time_max: Maximum short exposure time (maximum exposure lines per frame for short exposure).The maximum short exposure lines per frame can be calculated as: single-frame exposure time / exposure time per line = (1/fps) / (1/lines_per_second).</p>
<p>• turning_data.sensor_data.exposure_time_long_max: Maximum long exposure time (maximum exposure lines per frame for long exposure), used for HDR sensors.</p>
<p>• turning_data.sensor_data.lines_per_second: Number of exposure lines per second, calculated as 1 / line time or (fps * vts).The term &quot;vts&quot; may differ across sensors—it might be called frame_length, vts, etc.—but always represents the total number of lines per frame, including active lines and blanking.<br>
<!-- -->lines_per_second can also be interpreted as HMAX. Note that some sensors do not have an HMAX concept.</p>
<p>• turning_data.normal.again_lut: Analog gain LUT table. Firmware uses an index to look up this LUT table to find the corresponding sensor register values.<br>
<!-- -->LUT tables are separated for a_gain and d_gain, with table sizes: again_lut[again_control_num][256], dgain_lut[dgain_control_num][256].</p>
<p>Note 1: When a certain gain value does not exist, fill the entry with 0xffffffff. During gain allocation, the program searches downward until a valid gain is found.<br>
<!-- -->The LUT table sent to the kernel must already have undergone high/low byte swapping to avoid performing this operation in kernel space.<br>
<!-- -->For example, if gain = 0x1234 and it is written to registers 0x3012 and 0x3013, some sensors write 0x12 to 0x3012 while others write 0x12 to 0x3013. This difference should be handled and abstracted in the HAL layer.</p>
<p>Note 2: The LUT represents 256 gain control points in the range [0, 255]. The conversion formula is 2^(x/32), so the actual gain range is [2^(0/32), 2^(255/32)].<br>
<!-- -->The gain control curve is logarithmic. Any sensor’s gain control is discretized into 256 control points because current 3A control algorithms provide exactly 256 control points.<br>
<!-- -->Providing more control points would not improve gain control precision.</p>
<p>Before MIPI start, ensure the sensor stream is OFF. This should be configured in the camera sensor initialization settings.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">uint32_t</span><span class="token plain"> imx219_linear_init_setting</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 0x0100,0x01,  // Stream ON configuration should NOT be included at the end of the settings.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>After completing the sensor driver and settings, copy *_utility.c and *_setting.h to the corresponding SDK directory and recompile the SDK to generate the sensor driver library.<br>
<!-- -->The generated files will be located in: out/deploy/rootfs/usr/hobot/lib/sensor.</p>
<p>Generally, if the code structure is correct, the framework can successfully load the sensor driver even if some tuning_data parameters are misconfigured.<br>
<!-- -->If logcat shows &quot;sensor so check failed&quot; or &quot;load failed&quot;, verify that the code structure strictly follows the HBN framework.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="user-application">User Application<a href="#user-application" class="hash-link" aria-label="Direct link to User Application" title="Direct link to User Application">​</a></h4>
<p>Refer to existing user applications in the SDK, which include CIM and ISP parameter configurations. These configurations must be tailored according to the specific sensor’s resolution, frame rate, and data format.<br>
<!-- -->Below are the fields that require individual configuration; other fields can remain at their default values and do not need attention.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="mipi-configuration">MIPI Configuration<a href="#mipi-configuration" class="hash-link" aria-label="Direct link to MIPI Configuration" title="Direct link to MIPI Configuration">​</a></h5>
<table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>rx_enable</td><td>Enable MIPI RX device. Enable the corresponding MIPI RX port. Default value is 1. Note: This field enables MIPI RX but does NOT specify the MIPI RX port number.</td></tr><tr><td>phy</td><td>0: Represents MIPI D-PHY.</td></tr><tr><td>lane</td><td>Number of MIPI lanes. Currently, each MIPI RX supports up to 4 lanes by default.</td></tr><tr><td>datatype</td><td>MIPI input data format, which must match the sensor configuration. Common values: RAW8: 0x2A, RAW10: 0x2B, RAW12: 0x2C, YUV422 8-bit: 0x1E.</td></tr><tr><td>fps</td><td>Frame rate, used for calculating certain MIPI configurations. Enter the sensor’s output frame rate (obtain from FAE).</td></tr><tr><td>mipiclk</td><td>Total MIPI transmission rate (across all lanes). Obtain from FAE; typically provided alongside sensor init settings.</td></tr><tr><td>width</td><td>Input image width in pixels.</td></tr><tr><td>height</td><td>Input image height in pixels.</td></tr><tr><td>linelength</td><td>MIPI line length. Configure based on actual sensor specifications—read from sensor registers or measure on hardware.</td></tr><tr><td>framelength</td><td>MIPI frame length. Configure based on actual sensor specifications—read from sensor registers or measure on hardware.</td></tr><tr><td>settle</td><td>MIPI settle time for PHY. Configure based on hardware measurement. Adjust if MIPI PHY errors occur; valid range: 0–120.</td></tr><tr><td>channel_num</td><td>MIPI virtual channel number: set to 1 for linear mode, 2 for HDR DOL2 mode.</td></tr><tr><td>channel_sel[MIPIHOST_CHANNEL_NUM]</td><td>Mapping of MIPI virtual channels to IPI channels.</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The commercial version offers more comprehensive feature support, deeper hardware capability access, and exclusive customization. To ensure compliance and secure delivery, access to the commercial version will be granted through the following process.</p><p><strong>Commercial Version Access Process:</strong></p><ol>
<li><strong>Complete a questionnaire</strong>: Submit your organization’s information and intended use case.</li>
<li><strong>Sign an NDA</strong>: We will contact you based on your submission to finalize and sign a confidentiality agreement.</li>
<li><strong>Content release</strong>: After NDA execution, we will provide access to commercial version materials via a private channel.</li>
</ol><p>If you wish to obtain the commercial version, please complete the questionnaire below. We will contact you within 3–5 business days:</p><p>Questionnaire link: <a href="https://horizonrobotics.feishu.cn/share/base/form/shrcnJQBMIkRm6K79rjXR0hr0Fg" target="_blank" rel="noopener noreferrer">https://horizonrobotics.feishu.cn/share/base/form/shrcnJQBMIkRm6K79rjXR0hr0Fg</a></p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="camera-sensor-configuration">Camera Sensor Configuration<a href="#camera-sensor-configuration" class="hash-link" aria-label="Direct link to Camera Sensor Configuration" title="Direct link to Camera Sensor Configuration">​</a></h5>
<table><thead><tr><th>Field</th><th>Description</th></tr></thead><tbody><tr><td>name[CAMERA_MODULE_NAME_LEN]</td><td>Camera module name, which must match the sensor library name. For example, if the sensor driver is named libimx219.so, then name should be &quot;imx219&quot;.</td></tr><tr><td>addr</td><td>Sensor device address, typically a 7-bit I2C address.</td></tr><tr><td>sensor_mode</td><td>Sensor operating mode: 1: NORMAL_M (linear mode), 2: DOL2_M (HDR, 2 frames merged into 1), 3: DOL3_M (HDR, 3 frames merged into 1), 4: DOL4_M (HDR, 4 frames merged into 1), 5: PWL_M (HDR mode with internal sensor merging).</td></tr><tr><td>gpio_enable</td><td>Whether to use GPIO to control camera sensor pins to meet power-up/down timing requirements (e.g., controlling the sensor’s XSHUTDN pin via GPIO). <strong>Note</strong>: Corresponding GPIO numbers must be configured in the DTS. 0: Do not use GPIO. Non-zero: Use GPIO; GPIO count is enabled by bits. For example, 0x07 enables GPIOs [a, b, c].</td></tr><tr><td>gpio_level</td><td>If gpio_enable is set, configure gpio_level to control pin logic levels. The relationship between a GPIO bit and sensor pin level is: 0: Output low first, sleep 1s (sleep duration can be customized via usleep in the sensor driver’s power_on function), then output high. 1: Output high first, sleep 1s, then output low. Example: 0x05 = 101 (binary). From bit0 to bit2: GPIO a outputs high→low, GPIO b outputs low→high, GPIO c outputs high→low. <strong>Note</strong>: Customize according to the sensor’s power-up timing in its datasheet.</td></tr><tr><td>fps</td><td>Sensor frame rate configuration.</td></tr><tr><td>width</td><td>Sensor output image width in pixels.</td></tr><tr><td>height</td><td>Sensor output image height in pixels.</td></tr><tr><td>format</td><td>Sensor MIPI data type. Common values: RAW8: 0x2A, RAW10: 0x2B, RAW12: 0x2C, YUV422 8-bit: 0x1E.</td></tr><tr><td>extra_mode</td><td>Module index configuration, used in some sensor drivers.</td></tr><tr><td>config_index</td><td>Feature configuration, used in some sensor drivers.</td></tr><tr><td>calib_lname</td><td>Path to the sensor tuning library. Default path: /usr/hobot/lib/sensor.</td></tr><tr><td>end_flag</td><td>Fixed value: CAMERA_CONFIG_END_FLAG.</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="vio-configuration">VIO Configuration<a href="#vio-configuration" class="hash-link" aria-label="Direct link to VIO Configuration" title="Direct link to VIO Configuration">​</a></h5>
<table><thead><tr><th>Field 1</th><th>Field 2</th><th>Field 3</th><th>Description</th></tr></thead><tbody><tr><td>VIN</td><td>cim</td><td>mipi_en</td><td>Enable MIPI interface</td></tr><tr><td></td><td></td><td>mipi_rx</td><td>MIPI RX port number</td></tr><tr><td></td><td></td><td>vc_index</td><td>MIPI virtual channel index, default is 0</td></tr><tr><td></td><td></td><td>ipi_channel</td><td>IPI channel number, 1 for linear mode, 2 for HDR mode DOL2</td></tr><tr><td></td><td></td><td>cim_isp_flyby</td><td>CIM/SIF online to ISP. 0: SIF offline to ISP, data passes through DDR. 1: SIF online to ISP, data doesn&#x27;t pass through DDR.</td></tr><tr><td></td><td>input channel</td><td>format</td><td>VIN format, sensor output format</td></tr><tr><td></td><td></td><td>width</td><td>Sensor output resolution width (pixels)</td></tr><tr><td></td><td></td><td>height</td><td>Sensor output resolution height (pixels)</td></tr><tr><td></td><td>output channel / ddr</td><td>ddr_en</td><td>Whether data is dumped to DDR</td></tr><tr><td></td><td></td><td>wstride</td><td>Set to 0, driver will automatically calculate wstride</td></tr><tr><td></td><td></td><td>format</td><td>Sensor format set when dumping to DDR</td></tr><tr><td></td><td></td><td>buffers_num</td><td>CIM/SIF buffer number for DDR dumping, set to 1-6</td></tr><tr><td></td><td></td><td>flags</td><td>Usually set in the program</td></tr><tr><td></td><td></td><td></td><td>HB_MEM_USAGE_CPU_READ_OFTEN | HB_MEM_USAGE_CPU_WRITE_OFTEN | HB_MEM_USAGE_CACHED</td></tr><tr><td>ISP</td><td>base</td><td>hw_id and slot_id</td><td>CIM hardware direct connection to ISP: hw_id needs to correspond one-to-one with cim&#x27;s rx_index. When sched_mode is set to 1, CIM online ISP slot_id ranges from 0 to 3, corresponding one-to-one with cim vc_index. When sched_mode is set to 2, slot_id is fixed at 0, and cim vc_index can be set from 0 to 3 based on actual sensor connection. CIM DDR connection to ISP: hw_id has no restrictions and can be selected based on actual sensor connection and project requirements. slot id only needs to start from 4 to 11. Note: In multi-channel stress scenarios using CIM DDR connection, large resolution sensor channels should try to connect to ISP channels with smaller slot id values to ensure real-time sensor control.</td></tr><tr><td></td><td></td><td>sched_mode</td><td>ISP working mode, 1: manual mode (software scheduling), 2: passthru mode (full online exclusive ISP working mode)</td></tr><tr><td></td><td></td><td>width</td><td>Input image width</td></tr><tr><td></td><td></td><td>height</td><td>Input image height</td></tr><tr><td></td><td></td><td>frame_rate</td><td>Input frame rate, no actual effect</td></tr><tr><td></td><td></td><td>algo_state</td><td>2A switch parameter</td></tr><tr><td></td><td>output channel</td><td>stream_output_mode and axi_output_mode</td><td>ISP mode</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="run-program-on-board">Run Program on Board<a href="#run-program-on-board" class="hash-link" aria-label="Direct link to Run Program on Board" title="Direct link to Run Program on Board">​</a></h4>
<p>Execute the corresponding test program</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="isp-image-preview">ISP Image Preview<a href="#isp-image-preview" class="hash-link" aria-label="Direct link to ISP Image Preview" title="Direct link to ISP Image Preview">​</a></h4>
<p><strong>Add Tuning Program in SDK Code</strong></p>
<p>Modify the /app/tuning_tool/scripts/tuning_menu.sh file, following the existing sensor examples to add new configurations.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ITEM_IMX219_RGGB</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;module:Raw10_IMX219_RDK-S100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">IMX219_RGGB_Raw10_IMX219_RDK</span><span class="token operator" style="color:#393A34">-</span><span class="token function" style="color:#d73a49">S100</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IDESC</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;imx219 rggb raw10 RDK-S100&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setup_case $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">folder</span><span class="token punctuation" style="color:#393A34">}</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">tuning_imx219_cim_isp_1080p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Create the tuning_imx219_cim_isp_1080p folder under the /app/tuning_tool/cfg/matrix directory, and add the corresponding three files: hb_j6dev.json, mipi.json, and vpm_config.json.</p>
<p>Compile the SDK system code to ensure the board includes the modified and added files.</p>
<p><strong>Execute Tuning Program on Board</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /app/tuning_tool/scripts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bash run_tuning.sh </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Follow the interactive prompts to select the corresponding sensor</span><br></span></code></pre></div></div>
<p><strong>Image Preview</strong></p>
<p>Click <a href="/rdk_doc/en/rdk_s/Quick_start/download#tools-download">here</a> to download the image viewing tool hbplayer, then open hbplayer and set the network address (ensure the PC can ping the board). Click &quot;Apply&quot; to apply the settings, then click &quot;Connect&quot; to view the real-time video stream. The real-time preview operation is illustrated in the figure below.</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_06.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="error-codes">Error Codes<a href="#error-codes" class="hash-link" aria-label="Direct link to Error Codes" title="Direct link to Error Codes">​</a></h3>
<p>Below are common sensor error codes and basic troubleshooting directions:</p>
<table><thead><tr><th>Error Code</th><th>Definition</th><th>Troubleshooting Direction</th></tr></thead><tbody><tr><td>203</td><td>HB_CAM_INIT_FAIL</td><td>Sensor initialization failed; typically caused by I2C communication failure or unsupported sensor mode configuration</td></tr><tr><td>205</td><td>HB_CAM_START_FAIL</td><td>Sensor start failed; typically caused by I2C communication failure or unsupported sensor mode configuration</td></tr><tr><td>207</td><td>HB_CAM_I2C_WRITE_FAIL</td><td>Sensor I2C communication failed.</td></tr><tr><td>217</td><td>HB_CAM_SENSOR_POWERON_FAIL</td><td>Sensor power-on failed; possibly due to incorrect sensor GPIO configuration.</td></tr><tr><td>218</td><td>HB_CAM_SENSOR_POWEROFF_FAIL</td><td>Sensor power-off failed; possibly due to incorrect sensor GPIO configuration.</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="faq">FAQ<a href="#faq" class="hash-link" aria-label="Direct link to FAQ" title="Direct link to FAQ">​</a></h3>
<p><strong>control-tool Usage Instructions</strong></p>
<p>Navigate to the tuning directory:<br>
<code>cd /app/tuning_tool/control_tool</code></p>
<p>Follow the interactive prompts and execute the startup script: <code>sh server_isp*_8000.sh</code>.<br>
<!-- -->The ISP hardware contains two IP cores, each of which can run independently. To enable ISP control, run the script: <code>sh server_isp0_8000.sh</code>.</p>
<p>The startup method is shown in the figure below.</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_07.png" alt="" class="img_ev3q"></p>
<p>The script automatically detects the board&#x27;s IP address, checking the <code>eth1</code> network interface by default. To switch to <code>eth0</code>, modify the script by setting <code>eth_id=eth0</code>. The modification location is shown in the figure below.</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_08.png" alt="" class="img_ev3q"></p>
<p>Diagram illustrating how to modify the communication address:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_09.png" alt="" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="v4l2-sensor-bring-up">V4L2 Sensor Bring-up<a href="#v4l2-sensor-bring-up" class="hash-link" aria-label="Direct link to V4L2 Sensor Bring-up" title="Direct link to V4L2 Sensor Bring-up">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="v4l2-sensor-driver-development-guide">V4L2 Sensor Driver Development Guide<a href="#v4l2-sensor-driver-development-guide" class="hash-link" aria-label="Direct link to V4L2 Sensor Driver Development Guide" title="Direct link to V4L2 Sensor Driver Development Guide">​</a></h3>
<p>The S100 Camsys sensor V4L2 driver software framework follows the standard V4L2 sub-device driver model.</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_10.png" alt="" class="img_ev3q"></p>
<p>Using the IMX219 driver as an example, the following describes the V4L2 driver development process for a MIPI-direct-connected sensor. The IMX219 driver source code is located at: <code>kernel/drivers/media/i2c/imx219.c</code>.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="define-the-sensors-private-structure">Define the Sensor&#x27;s Private Structure<a href="#define-the-sensors-private-structure" class="hash-link" aria-label="Direct link to Define the Sensor&#x27;s Private Structure" title="Direct link to Define the Sensor&#x27;s Private Structure">​</a></h4>
<p>The IMX219 private structure is as follows:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">imx219</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">v4l2_subdev</span><span class="token plain"> sd</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">media_pad</span><span class="token plain"> pad</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">i2c_client</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">i2c_client</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">v4l2_ctrl</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">xxx_ctrl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<ul>
<li><code>sd</code>: V4L2 sub-device handle, used to operate subdev ops;</li>
<li><code>pad</code>: Media pad, used to establish media links with downstream modules;</li>
<li><code>i2c_client</code>: I2C client handle, used to communicate with the sensor over the I2C bus;</li>
<li><code>xxx_ctrl</code>: V4L2 control attributes (e.g., exposure, flip, blank); implementation is optional;</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="implement-v4l2-callback-functions">Implement V4L2 Callback Functions<a href="#implement-v4l2-callback-functions" class="hash-link" aria-label="Direct link to Implement V4L2 Callback Functions" title="Direct link to Implement V4L2 Callback Functions">​</a></h4>
<p>A V4L2-compliant sensor driver must implement certain ops functions, which the V4L2 framework uses to control the sensor:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">v4l2_subdev_ops</span><span class="token plain"> imx219_subdev_ops </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">core </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">imx219_core_ops</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">video </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">imx219_video_ops</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pad </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">imx219_pad_ops</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>This implements the V4L2 subdev ops callbacks, including core ops, video ops, and pad ops.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">v4l2_subdev_pad_ops</span><span class="token plain"> imx219_pad_ops </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">enum_mbus_code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imx219_enum_mbus_code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_fmt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imx219_get_pad_format</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">set_fmt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imx219_set_pad_format</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">enum_frame_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imx219_enum_frame_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The pad ops define callback interfaces for format configuration and negotiation, which must be implemented.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">v4l2_subdev_video_ops</span><span class="token plain"> imx219_video_ops </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">s_stream </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imx219_set_stream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The video ops primarily define the sensor stream start/stop interface, which must be implemented.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">v4l2_subdev_core_ops</span><span class="token plain"> imx219_core_ops </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">subscribe_event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v4l2_ctrl_subdev_subscribe_event</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">unsubscribe_event </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> v4l2_event_subdev_unsubscribe</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The core ops define functionalities such as ioctl event handling, which are optional.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">v4l2_subdev_internal_ops</span><span class="token plain"> imx219_internal_ops </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">open </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> imx219_open</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The internal ops define callbacks for managing the sub-device&#x27;s lifecycle (e.g., open, close, release), implemented as needed.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sensor-probe-function">Sensor Probe Function<a href="#sensor-probe-function" class="hash-link" aria-label="Direct link to Sensor Probe Function" title="Direct link to Sensor Probe Function">​</a></h4>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">imx219_probe</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">i2c_client</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imx219 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">devm_kzalloc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">client</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">imx219</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> GFP_KERNEL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">imx219</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ENOMEM</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">v4l2_i2c_subdev_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">imx219</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">sd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">imx219_subdev_ops</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imx219</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">sd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flags </span><span class="token operator" style="color:#393A34">|=</span><span class="token plain"> V4L2_SUBDEV_FL_HAS_DEVNODE </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        ┆   V4L2_SUBDEV_FL_HAS_EVENTS</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imx219</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">sd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">entity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">function </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MEDIA_ENT_F_CAM_SENSOR</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imx219</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pad</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">flags </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> MEDIA_PAD_FL_SOURCE</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">media_entity_pads_init</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">imx219</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">sd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">entity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">imx219</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">pad</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">v4l2_async_register_subdev_sensor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">imx219</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">sd</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ol>
<li>Initialize the sensor structure and allocate memory;</li>
<li>Initialize a V4L2 subdev and bind it to the I2C client;</li>
<li>Initialize the media entity&#x27;s pad information so the media controller knows the sensor has one output pad that can connect to downstream modules;</li>
<li>Asynchronously register the sensor subdev with the V4L2 framework;</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sensor-device-tree">Sensor Device Tree<a href="#sensor-device-tree" class="hash-link" aria-label="Direct link to Sensor Device Tree" title="Direct link to Sensor Device Tree">​</a></h4>
<p>By default, S100 loads the IMX219 device tree. The device tree format is shown below. To connect a different MIPI sensor, override the IMX219 DTS using a DTS overlay.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">i2c1 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        imx219@</span><span class="token number" style="color:#36acaa">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compatible </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sony,imx219&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0x10</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Sensor I2C address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                port </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        cam_to_mipi_csi0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> endpoint </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// MIPI-related properties</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                remote</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">endpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rdk_s100_mipi_csi0_from_cam</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Connected to MIPI RX0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lanes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lanes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                link</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">frequencies </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                        </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">bits</span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">456000000</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                virtual</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mipi_host0 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ports </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                port@</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        rdk_s100_mipi_csi0_from_sensor0</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> endpoint </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                remote</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">endpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sensor0_to_mipi_csi0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                clock</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lanes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                data</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">lanes </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// MIPI data lanes: 2-lane</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                lane</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">rate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1728</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// MIPI data rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                vc_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Virtual channel ID from sensor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                emb</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">en </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">1</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Whether sensor output includes embedded data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="v4l2-gmsl-serdes-interface-usage-guide">V4L2 GMSL SerDes Interface Usage Guide<a href="#v4l2-gmsl-serdes-interface-usage-guide" class="hash-link" aria-label="Direct link to V4L2 GMSL SerDes Interface Usage Guide" title="Direct link to V4L2 GMSL SerDes Interface Usage Guide">​</a></h3>
<p>The S100 Camsys supports sensors connected via Maxim&#x27;s serializer. The camera daughterboard includes the Maxim deserializer MAX96712 by default. GMSL sensors are also integrated into the V4L2 framework as V4L2 subdevs. The serializer and deserializer drivers provide function sets for GMSL sensor drivers but are not implemented as V4L2 subdevs themselves.</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_11.png" alt="" class="img_ev3q"></p>
<p>SerDes-related data structures and callback function definitions are located in <code>kernel/include/media/i2c/serdes_core.h</code>. Include this header file: <code>#include &lt;media/i2c/serdes_core.h&gt;</code>.</p>
<p>This section uses the AR0820C GMSL sensor as an example to illustrate Camsys GMSL sensor development.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="add-new-members-to-the-sensor-structure">Add New Members to the Sensor Structure<a href="#add-new-members-to-the-sensor-structure" class="hash-link" aria-label="Direct link to Add New Members to the Sensor Structure" title="Direct link to Add New Members to the Sensor Structure">​</a></h4>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">ar0820</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_ctx</span><span class="token plain"> g_ctx</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The sensor driver needs to include two structures, <code>ser_dev</code> and <code>dser_dev</code>, for operating the serializer and deserializer.It must also include the <code>serdes context</code> member <code>g_ctx</code> to store SerDes-related properties. The main structure members are described as follows:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_ctx</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        u32 serdes_csi_link</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Stores the deserializer&#x27;s port value in the sensor driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        u32 ser_reg</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic">// Target value for serializer I2C address mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        u32 sdev_reg</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// Actual I2C address of the sensor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        u32 sdev_def</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// Target value for sensor I2C address mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sen_dev</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        u32 lane_num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// Stores the number of MIPI data lanes connecting the sensor to the serializer in the sensor driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        u32 data_type</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Stores the data type output by the sensor in the sensor driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        u32 dst_vc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">             </span><span class="token comment" style="color:#999988;font-style:italic">// Stores the virtual channel of the sensor output in the sensor driver</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="serdes-callback-functions">SerDes Callback Functions<a href="#serdes-callback-functions" class="hash-link" aria-label="Direct link to SerDes Callback Functions" title="Direct link to SerDes Callback Functions">​</a></h4>
<p>Both the serializer and deserializer provide the following callback functions for use in the sensor driver. These callbacks must be invoked using the <code>SERDES_OP</code> macro.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* By default, a return value &gt;= 0 indicates success; a return value &lt; 0 indicates failure */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_ops</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Initialize serializer and deserializer with basic configurations only */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Currently used for additional initialization of d457 -&gt; MAX9295A, enabling all 4 pipes of MAX9295A */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">init_ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Reserved */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">reset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Pass DTS-parsed values to the serializer and deserializer via serdes_ctx */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">set_ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_ctx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Used by the deserializer to establish a link. By default, link is disabled; this op enables it */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">setup_link</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sen_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* remote_contrl_get -&gt; map_addr -&gt; remote_contrl_put are used together to ensure stability of sensor/serializer during I2C address remapping */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">remote_contrl_get</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                 </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sen_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">remote_contrl_put</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Called by the serializer to remap I2C addresses of both serializer and sensor */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">map_addr</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Serializer pulls high a specific MFP */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">enable_mfp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">uint8_t</span><span class="token plain"> gpio_index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Serializer pulls low a specific MFP */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">clear_mfp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">uint8_t</span><span class="token plain"> gpio_index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Deserializer enables MIPI TX to start streaming. Serializer TX is enabled by default, so no explicit call is needed */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">set_stream</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                          </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sen_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> enable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Configure GMSL video pipe attributes for both serializer and deserializer, parsed from DTS. By default, configures pipe-Z */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">set_pipe</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sen_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* For complex scenarios, configure GMSL video pipe data flexibly per pipe */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">set_pipe_ex</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">sen_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           </span><span class="token class-name">uint8_t</span><span class="token plain"> pipe</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">uint8_t</span><span class="token plain"> vc_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token class-name">uint8_t</span><span class="token plain"> data_type</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Check if the deserializer has an available pipe based on virtual channel ID. Returns available pipe ID (0-3).</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">           Used by D457 sensor before streaming, paired with release_pipe_id */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">get_pipe_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           </span><span class="token class-name">uint8_t</span><span class="token plain"> vc_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Release the deserializer&#x27;s video pipe after use */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">release_pipe_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">serdes_device</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">serdes_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                               </span><span class="token class-name">uint8_t</span><span class="token plain"> pipe_id</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<ol>
<li>In the sensor probe function, certain SerDes ops must be called to perform software initialization, parse DTS values, and pass them via <code>set_ctx</code> to both serializer and deserializer drivers.</li>
</ol>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set_ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">g_ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set_ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">g_ctx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>These calls establish a software-level link between the sensor driver and both serializer/deserializer by invoking their respective <code>set_ctx</code> functions.</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> init</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> setup_link</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sen_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> remote_contrl_get</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> map_addr</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> remote_contrl_put</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> init</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set_pipe</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sen_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set_pipe</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sen_dev</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> clear_mfp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">mfp_reset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> enable_mfp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">mfp_reset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>These ops perform initialization of SerDes link, address mapping, pipe configuration, MFP control, etc.</p>
<ol start="2">
<li>In <code>s_stream</code>, configure the deserializer to start streaming and enable the serializer&#x27;s MFP:</li>
</ol>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> enable_mfp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">ser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">mfp_trigger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set_stream</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sen_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="sensor-device-tree-1">Sensor Device Tree<a href="#sensor-device-tree-1" class="hash-link" aria-label="Direct link to Sensor Device Tree" title="Direct link to Sensor Device Tree">​</a></h4>
<p>The S100 V4L2 GMSL sensor loads the AR0820C DTS by default. The GMSL sensor device tree is organized as follows:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ar0820@</span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                compatible</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;d-robotics,ar0820&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0x11</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// Mapped address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0x10</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Actual sensor I2C address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mfp</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">reset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Reset pin connected to serializer&#x27;s MFP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                mfp</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">trigger </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">7</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token comment" style="color:#999988;font-style:italic">// Trigger pin connected to serializer&#x27;s MFP</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                d</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">robotics</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">serdes</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ser</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ser_a</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Linked to serializer on Link A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                d</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">robotics</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">serdes</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dser</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dser</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Connected to deserializer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                port </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        cam_0_to_mipi_csi4</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> endpoint </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Connected to MIPI RX4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                remote</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">endpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mipi_csi4_from_cam_0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                virtual</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sensor-dtbo-file-configuration-guide">Sensor DTBO File Configuration Guide<a href="#sensor-dtbo-file-configuration-guide" class="hash-link" aria-label="Direct link to Sensor DTBO File Configuration Guide" title="Direct link to Sensor DTBO File Configuration Guide">​</a></h3>
<p>The S100 Uboot supports Device Tree Blob Overlay (DTBO) functionality, allowing users to add or modify (but not delete) nodes in the currently loaded DTB without changing the original DTS file.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="generating-sensor-dtbo-files">Generating Sensor DTBO Files<a href="#generating-sensor-dtbo-files" class="hash-link" aria-label="Direct link to Generating Sensor DTBO Files" title="Direct link to Generating Sensor DTBO Files">​</a></h4>
<ol>
<li>Write a <code>.dtso</code> file:</li>
</ol>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;dt-bindings/gpio/gpio.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain">dts</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">v1</span><span class="token operator" style="color:#393A34">/</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain">plugin</span><span class="token operator" style="color:#393A34">/</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fragment@</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        target</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/soc/i2c@39450000/&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            __overlay__ </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                d457@</span><span class="token number" style="color:#36acaa">11</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    compatible</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;intel,d4xx&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    reg </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0x11</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    def</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0x10</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    width </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">640</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    height </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">480</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    cam</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Depth&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    data_type </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0x2e</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    lane_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    vc_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    d</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">robotics</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">serdes</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">ser</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">ser_a</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    d</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">robotics</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">serdes</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">dser</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">dser</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    status </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;okay&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    port </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        sensor_0_to_mipi_csi4</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> endpoint </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            remote</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">endpoint </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">mipi_csi4_from_sensor_0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            virtual</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">channel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token number" style="color:#36acaa">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<ol start="2">
<li>Compile the DTBO on the board:</li>
</ol>
<ul>
<li>Install the <code>dtc</code> tool:</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo apt install device</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">tree</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">compiler </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">y</span><br></span></code></pre></div></div>
<ul>
<li>Preprocess the <code>.dtso</code> file (only needed if the <code>.dtso</code> includes headers or macros):</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">Get DTS header path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HEADER_DIR</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">find </span><span class="token operator" style="color:#393A34">/</span><span class="token plain">usr</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">src </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">maxdepth </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">type d </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">name </span><span class="token string" style="color:#e3116c">&quot;linux-headers-*&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> sort </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">Vr </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> head </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">n </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">DTS_HEAD_PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;$HEADER_DIR/include&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression" style="color:#36acaa">Preprocess </span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression" style="color:#36acaa">dtso to generate </span><span class="token macro property expression punctuation" style="color:#393A34">.</span><span class="token macro property expression" style="color:#36acaa">dtbi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cpp </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">nostdinc </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">I </span><span class="token string" style="color:#e3116c">&quot;$DTS_HEAD_PATH&quot;</span><span class="token plain"> sample</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dtso </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sample</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dtbi</span><br></span></code></pre></div></div>
<ul>
<li>Compile to generate the final <code>.dtbo</code> file:</li>
</ul>
<p>If you have a <code>.dtbi</code> file:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dtc </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">q </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">@ </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">I dts </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">O dtb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">o sample</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dtbo sample</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dtbi</span><br></span></code></pre></div></div>
<p>If you don’t have a <code>.dtbi</code> file:</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dtc </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">q </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">@ </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">I dts </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">O dtb </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">o sample</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dtbo sample</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dtso</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-sensor-dtbo-at-boot">Enabling Sensor DTBO at Boot<a href="#enabling-sensor-dtbo-at-boot" class="hash-link" aria-label="Direct link to Enabling Sensor DTBO at Boot" title="Direct link to Enabling Sensor DTBO at Boot">​</a></h4>
<ol>
<li>Place the compiled <code>.dtbo</code> file in <code>/boot/overlays</code>.<br>
<!-- -->If the <code>/boot/overlays</code> directory doesn’t exist, create it manually or install <code>hobot-camera.deb</code> to obtain the directory and example D457 sensor DTBO files.</li>
</ol>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_12.png" alt="" class="img_ev3q"></p>
<ol start="2">
<li>Modify <code>config.txt</code> to specify the DTBO file to load.<br>
<!-- -->If <code>config.txt</code> doesn’t exist, create it manually.</li>
</ol>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_13.png" alt="" class="img_ev3q"></p>
<p>Edit <code>config.txt</code> as follows:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dtbo_file_path=/overlays/v0p5_d457_2v_depth_color.dtbo</span><br></span></code></pre></div></div>
<ol start="3">
<li>Reboot the board to apply the DTBO configuration. In debug builds of Uboot, you can verify DTBO loading from the boot logs.</li>
</ol>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/03_multimedia_development/02_S100/camera_bringup/camera_bringup_14.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sensor-gain-lut-table-implementation-guide">Sensor Gain LUT Table Implementation Guide<a href="#sensor-gain-lut-table-implementation-guide" class="hash-link" aria-label="Direct link to Sensor Gain LUT Table Implementation Guide" title="Direct link to Sensor Gain LUT Table Implementation Guide">​</a></h3>
<p>For RAW-format sensors interfaced with the S100 ISP imaging system, in addition to writing the V4L2 sensor driver, you must also create a shared object (<code>.so</code>) containing the sensor gain LUT (Look-Up Table), including analog gain (again) LUT, digital gain (dgain) LUT, etc.</p>
<p>Human perception of brightness is closer to a logarithmic scale than linear, and the dB unit better matches this perception. Therefore, the gain arrays stored in the S100 ISP sensor gain LUT must contain <strong>continuous dB-unit sensor gain values</strong> corresponding to actual sensor register settings. This allows the ISP to look up the correct register values when adjusting sensor gain and send them to the sensor.</p>
<p>Below is an example using the IMX219 sensor to illustrate how to build the V4L2 sensor LUT <code>.so</code> file.</p>
<p>The IMX219 sensor gain LUT implementation directory in the SDK is:<br>
<code>hobot-camera/v4l2/v4l2_helper/imx219_v4l2</code></p>
<ol>
<li>Add the following files:<!-- -->
<ul>
<li><code>&lt;sensor_name&gt;_camera_helper.c</code></li>
<li><code>Makefile</code></li>
<li>Version file `version.mk</li>
</ul>
</li>
</ol>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">imx219_v4l2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── imx219_camera_helper</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── version</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mk</span><br></span></code></pre></div></div>
<ol start="2">
<li>In the <code>xxx_helper.c</code> file, create the <code>again</code> LUT table and the <code>dgain</code> LUT table. Each LUT is an array of type <code>uint32_t</code>, containing up to 256 entries. Each entry holds the register configuration value corresponding to a specific gain. The dB values corresponding to adjacent entries must be continuous. Taking <code>imx219</code> as an example:</li>
</ol>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">uint32_t</span><span class="token plain"> imx219_again_lut</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x00</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 0 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x05</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 0.2 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x0B</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 0.4 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x0F</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 0.6 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x15</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 0.8 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0xE7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 20.4 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0xE8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 20.6 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0xffff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// end flag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token class-name">uint32_t</span><span class="token plain"> imx219_dgain_lut</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x0100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 0 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x0106</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 0.2 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x010c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 0.4 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x0112</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 0.6 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x0f53</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 23.6 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x0fa9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 23.8 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0x0fd9</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// approx. 24.0 dB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token number" style="color:#36acaa">0xffff</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// end flag</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The last entry of each LUT must always be <code>0xffff</code>.</p>
<ol start="3">
<li>Implement the <code>again index to reg</code> and <code>dgain index to reg</code> callback functions, along with the interface to retrieve these callbacks. You can reuse the implementation from the IMX219:</li>
</ol>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token class-name">uint32_t</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">AGainIndexToReg_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint8_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Input: uint8_t index; Output: uint32_t sensor register configuration value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token class-name">uint32_t</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">DGainIndexToReg_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint8_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Same as above</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AGainIndexToReg_t again_index_to_reg_callback</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DGainIndexToReg_t dgain_index_to_reg_callback</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> Callbacks</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Callback structure; no modification needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">again_index_to_reg_function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint8_t</span><span class="token plain"> isp_index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isp_index </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imx219_again_lut</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                isp_index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imx219_again_lut</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> imx219_again_lut</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isp_index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token class-name">uint32_t</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">dgain_index_to_reg_function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint8_t</span><span class="token plain"> isp_index</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isp_index </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imx219_dgain_lut</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                isp_index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">imx219_dgain_lut</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">/</span><span class="token keyword" style="color:#00009f">sizeof</span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">uint32_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> imx219_dgain_lut</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isp_index</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Callbacks cb </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">again_index_to_reg_function</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                dgain_index_to_reg_function</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// get_index_to_reg_callbacks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Callbacks</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_index_to_reg_callbacks</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">cb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>The generated shared library should be named <code>lib&lt;sensor_name&gt;_v4l2.so</code>. At runtime, this <code>.so</code> file will be automatically matched and loaded via <code>dlopen</code>, and the LUT tables will be retrieved through the exported symbols.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="exposure-synchronization-sensor-driver-instructions">Exposure Synchronization Sensor Driver Instructions<a href="#exposure-synchronization-sensor-driver-instructions" class="hash-link" aria-label="Direct link to Exposure Synchronization Sensor Driver Instructions" title="Direct link to Exposure Synchronization Sensor Driver Instructions">​</a></h3>
<p>The S100 camsys SerDes provides trigger-related interfaces that can be called within the sensor driver to configure LPWM hardware and enable LPWM.</p>
<p>Hardware-synchronized exposure currently supports only GMSL sensors. The correct trigger MFP pin must be configured in the sensor&#x27;s device tree source (DTS).</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> trigger_cfg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sen_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> period</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> duty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Call <code>trigger_cfg</code> during the sensor&#x27;s initialization when setting the format to apply LPWM configuration.</p>
<ul>
<li><code>period</code> is in nanoseconds (ns), calculated as <code>(1000000 / fps) * 1000</code>.</li>
<li><code>duty</code> is also in nanoseconds (ns); if there are no special requirements, it can be set to <code>10000</code>.</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">SERDES_OP</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> trigger_enable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> priv</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">dser_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sen_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> enable</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Call <code>trigger_enable</code> when starting or stopping the video stream to turn LPWM output on or off.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2026-02-14T04:38:46.000Z" itemprop="dateModified">Feb 14, 2026</time></b></span></div></div></footer></article><nav class="pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/camsys"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Camsys Subsystem</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/en/rdk_s/Advanced_development/multimedia_development/S100/codec"><div class="pagination-nav__sublabel">Next </div><div class="pagination-nav__label">Codec</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hbn-sensor-bring-up" class="table-of-contents__link toc-highlight">HBN Sensor Bring-up</a><ul><li><a href="#scope" class="table-of-contents__link toc-highlight">Scope</a></li><li><a href="#preparation" class="table-of-contents__link toc-highlight">Preparation</a></li><li><a href="#steps-to-add-and-bring-up-a-new-sensor" class="table-of-contents__link toc-highlight">Steps to Add and Bring Up a New Sensor</a><ul><li><a href="#dts-modifications" class="table-of-contents__link toc-highlight">DTS Modifications</a><ul><li><a href="#sensor-gpio-configuration" class="table-of-contents__link toc-highlight">Sensor GPIO Configuration</a></li><li><a href="#sensor-i2c-configuration" class="table-of-contents__link toc-highlight">Sensor I2C Configuration</a></li><li><a href="#mclk-configuration" class="table-of-contents__link toc-highlight">MCLK Configuration</a></li><li><a href="#dts-modification-verification" class="table-of-contents__link toc-highlight">DTS Modification Verification</a></li></ul></li><li><a href="#adding-sensor-driver-files" class="table-of-contents__link toc-highlight">Adding Sensor Driver Files</a></li><li><a href="#user-application" class="table-of-contents__link toc-highlight">User Application</a><ul><li><a href="#mipi-configuration" class="table-of-contents__link toc-highlight">MIPI Configuration</a></li><li><a href="#camera-sensor-configuration" class="table-of-contents__link toc-highlight">Camera Sensor Configuration</a></li><li><a href="#vio-configuration" class="table-of-contents__link toc-highlight">VIO Configuration</a></li></ul></li><li><a href="#run-program-on-board" class="table-of-contents__link toc-highlight">Run Program on Board</a></li><li><a href="#isp-image-preview" class="table-of-contents__link toc-highlight">ISP Image Preview</a></li></ul></li><li><a href="#error-codes" class="table-of-contents__link toc-highlight">Error Codes</a></li><li><a href="#faq" class="table-of-contents__link toc-highlight">FAQ</a></li></ul></li><li><a href="#v4l2-sensor-bring-up" class="table-of-contents__link toc-highlight">V4L2 Sensor Bring-up</a><ul><li><a href="#v4l2-sensor-driver-development-guide" class="table-of-contents__link toc-highlight">V4L2 Sensor Driver Development Guide</a><ul><li><a href="#define-the-sensors-private-structure" class="table-of-contents__link toc-highlight">Define the Sensor&#39;s Private Structure</a></li><li><a href="#implement-v4l2-callback-functions" class="table-of-contents__link toc-highlight">Implement V4L2 Callback Functions</a></li><li><a href="#sensor-probe-function" class="table-of-contents__link toc-highlight">Sensor Probe Function</a></li><li><a href="#sensor-device-tree" class="table-of-contents__link toc-highlight">Sensor Device Tree</a></li></ul></li><li><a href="#v4l2-gmsl-serdes-interface-usage-guide" class="table-of-contents__link toc-highlight">V4L2 GMSL SerDes Interface Usage Guide</a><ul><li><a href="#add-new-members-to-the-sensor-structure" class="table-of-contents__link toc-highlight">Add New Members to the Sensor Structure</a></li><li><a href="#serdes-callback-functions" class="table-of-contents__link toc-highlight">SerDes Callback Functions</a></li><li><a href="#sensor-device-tree-1" class="table-of-contents__link toc-highlight">Sensor Device Tree</a></li></ul></li><li><a href="#sensor-dtbo-file-configuration-guide" class="table-of-contents__link toc-highlight">Sensor DTBO File Configuration Guide</a><ul><li><a href="#generating-sensor-dtbo-files" class="table-of-contents__link toc-highlight">Generating Sensor DTBO Files</a></li><li><a href="#enabling-sensor-dtbo-at-boot" class="table-of-contents__link toc-highlight">Enabling Sensor DTBO at Boot</a></li></ul></li><li><a href="#sensor-gain-lut-table-implementation-guide" class="table-of-contents__link toc-highlight">Sensor Gain LUT Table Implementation Guide</a></li><li><a href="#exposure-synchronization-sensor-driver-instructions" class="table-of-contents__link toc-highlight">Exposure Synchronization Sensor Driver Instructions</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GuYueHome<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact US</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 D-Robotics.</div></div></div></footer></div>
</body>
</html>