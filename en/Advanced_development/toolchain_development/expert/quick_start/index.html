<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Advanced_development/toolchain_development/expert/quick_start" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Quick Start | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/en/Advanced_development/toolchain_development/expert/quick_start"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Quick Start | RDK DOC"><meta data-rh="true" name="description" content="quick_start}"><meta data-rh="true" property="og:description" content="quick_start}"><link data-rh="true" rel="icon" href="/rdk_doc/en/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/en/Advanced_development/toolchain_development/expert/quick_start"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Advanced_development/toolchain_development/expert/quick_start" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/Advanced_development/toolchain_development/expert/quick_start" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/Advanced_development/toolchain_development/expert/quick_start" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"7. Advanced Development","item":"https://developer.d-robotics.cc/rdk_doc/en/Advanced_development"},{"@type":"ListItem","position":2,"name":"7.4 Algorithm Toolchain Development Guide","item":"https://developer.d-robotics.cc/rdk_doc/en/04_toolchain_development"},{"@type":"ListItem","position":3,"name":"7.4.3 Expert Guide","item":"https://developer.d-robotics.cc/rdk_doc/en/Advanced_development/toolchain_development/expert/"},{"@type":"ListItem","position":4,"name":"Quick Start","item":"https://developer.d-robotics.cc/rdk_doc/en/Advanced_development/toolchain_development/expert/quick_start"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/en/assets/css/styles.0fbd7d27.css">
<script src="/rdk_doc/en/assets/js/runtime~main.79cca384.js" defer="defer"></script>
<script src="/rdk_doc/en/assets/js/main.5cc85b9b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/en/img/logo.png" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/en/RDK">RDK X3 / X5</a><a class="navbar__item navbar__link" href="/rdk_doc/en/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>EN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/Advanced_development/toolchain_development/expert/quick_start" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/Advanced_development/toolchain_development/expert/quick_start" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/en/RDK">D-Robotics RDK Suite</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Quick_start">1. Quick Start</a><button aria-label="Expand sidebar category &#x27;1. Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/System_configuration">2. System Configuration</a><button aria-label="Expand sidebar category &#x27;2. System Configuration&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Basic_Application">3. Basic Application Development</a><button aria-label="Expand sidebar category &#x27;3. Basic Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Basic_Development">4. Algorithm Application Development</a><button aria-label="Expand sidebar category &#x27;4. Algorithm Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Robot_development">5. Robotics Application Development</a><button aria-label="Expand sidebar category &#x27;5. Robotics Application Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Application_case">6. Application Development Guide</a><button aria-label="Expand sidebar category &#x27;6. Application Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/en/Advanced_development">7. Advanced Development</a><button aria-label="Collapse sidebar category &#x27;7. Advanced Development&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/hardware_development">7.1 Hardware Development Guide</a><button aria-label="Expand sidebar category &#x27;7.1 Hardware Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/linux_development">7.2. Linux Development Guide</a><button aria-label="Expand sidebar category &#x27;7.2. Linux Development Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/03_multimedia_development">7.3 RDK X3 多媒体开发指南</a><button aria-label="Expand sidebar category &#x27;7.3 RDK X3 多媒体开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/en/04_toolchain_development">7.4 Algorithm Toolchain Development Guide</a><button aria-label="Collapse sidebar category &#x27;7.4 Algorithm Toolchain Development Guide&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/overview">7.4.1 Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/intermediate/">7.4.2 Advanced Guide</a><button aria-label="Expand sidebar category &#x27;7.4.2 Advanced Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/">7.4.3 Expert Guide</a><button aria-label="Collapse sidebar category &#x27;7.4.3 Expert Guide&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/environment_config">Environment Dependency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/quick_start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/user_guide">Development Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/advanced_content">Deep Exploration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/api_reference">API Manual</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/note">Appendix</a></li></ul></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/FAQ">8. FAQs</a><button aria-label="Expand sidebar category &#x27;8. FAQs&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/en/Appendix">9. Appendix</a><button aria-label="Expand sidebar category &#x27;9. Appendix&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/en/Release_Note/release_note">10. Version release</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rdk_doc/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/Advanced_development"><span>7. Advanced Development</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/04_toolchain_development"><span>7.4 Algorithm Toolchain Development Guide</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/"><span>7.4.3 Expert Guide</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Quick Start</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Quick Start</h1></header>
<p>The D-Robotics Plugin Pytorch (referred to as Plugin) refers to the PyTorch official quantization interface and ideas. The Plugin adopts the Quantization Aware Training (QAT) scheme. Therefore, it is recommended that users first read the relevant parts of the <a href="https://pytorch.org/docs/stable/quantization.html#quantization" target="_blank" rel="noopener noreferrer"><strong>PyTorch official documentation</strong></a> and be familiar with the usage of quantization training and deployment tools provided by PyTorch.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="basic-process">Basic Process<a href="#basic-process" class="hash-link" aria-label="Direct link to Basic Process" title="Direct link to Basic Process">​</a></h2>
<p>The basic process of using the quantization training tool is as follows:</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/04_toolchain_development/expert/quick_start.svg" alt="quick_start" class="img_ev3q"></p>
<p>Below, we take the <code>MobileNetV2</code> model in <code>torchvision</code> as an example to introduce the specific operations of each stage in the process.</p>
<p>For the sake of execution speed in the process demonstration, we use the <code>cifar-10</code> dataset instead of the ImageNet-1K dataset.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> copy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> torch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">nn </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> nn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> torchvision</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">transforms </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> transforms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> torch </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Tensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quantization </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> DeQuantStub</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> torchvision</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">datasets </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> CIFAR10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> torchvision</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mobilenetv2 </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> MobileNetV2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">utils </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> typing </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Callable</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> List</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> Tuple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> horizon_plugin_pytorch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">functional </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> rgb2centered_yuv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quantization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> horizon_plugin_pytorch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">march </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> March</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> set_march</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> horizon_plugin_pytorch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quantization </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        QuantStub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        convert_fx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        prepare_qat_fx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set_fake_quantize</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FakeQuantState</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        check_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compile_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        perf_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        visualize_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> horizon_plugin_pytorch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quantization</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">qconfig </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_calib_8bit_fake_quant_qconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_qat_8bit_fake_quant_qconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_qat_8bit_weight_32bit_out_fake_quant_qconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default_calib_8bit_weight_32bit_out_fake_quant_qconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">basicConfig</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">logging</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">INFO</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">format</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;%(levelname)s: %(message)s&quot;</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2023-06-29 14:46:09,502] WARNING: `fx_force_duplicate_shared_convbn` will be set False by default after plugin 1.9.0. If you are not loading old checkpoint, please set `fx_force_duplicate_shared_convbn` False to train your new model.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2023-06-29 14:46:09,575] WARNING: due to bug of torch.quantization.fuse_modules, it is replaced by horizon.quantization.fuse_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="get-float-model">Get Float Model<a href="#get-float-model" class="hash-link" aria-label="Direct link to Get Float Model" title="Direct link to Get Float Model">​</a></h2>
<p>First, make necessary modifications to the float model to support quantization-related operations. The necessary operations for modifying the model are:</p>
<ul>
<li>
<p>Insert a <code>QuantStub</code> before the model input.</p>
</li>
<li>
<p>Insert a <code>DequantStub</code> after the model output.</p>
</li>
</ul>
<p>When modifying the model, please note:</p>
<ul>
<li>
<p>The inserted <code>QuantStub</code> and <code>DequantStub</code> must be registered as sub-modules of the model, otherwise their quantization states will not be handled correctly.</p>
</li>
<li>
<p>Multiple inputs can share the same <code>QuantStub</code> only when their scales are the same. Otherwise, please define a separate <code>QuantStub</code> for each input.</p>
</li>
<li>
<p>If you need to specify the data source of the input data when on board as &quot;pyramid&quot;, please manually set the <code>scale</code> parameter of the corresponding <code>QuantStub</code> to 1/128.</p>
</li>
<li>
<p>You can also use <code>torch.quantization.QuantStub</code>, but only <code>horizon_plugin_pytorch.quantization.QuantStub</code> supports manually fixing the scale through parameters.</p>
</li>
</ul>
<p>The modified model can seamlessly load the parameters of the original model, so if there is an already trained float model, you can load it directly. Otherwise, you need to train it normally in float.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>The input image data when the model is on board is generally in the format of centered_yuv444. Therefore, when training the model, the image needs to be converted to the centered_yuv444 format (pay attention to the use of <code>rgb2centered_yuv</code> in the code below).
If it is not possible to convert to centered_yuv444 format for model training, please refer to the <strong>RGB888 Data Deployment</strong> section for instructions on how to modify the model accordingly. (Note that this method may lead to a decrease in model accuracy)
In this example, the number of epochs for float and QAT training is small, just to illustrate the usage of the training tool, and the accuracy does not represent the best performance of the model.</p></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Users can modify the following parameters as needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 1. Paths for saving model checkpoints and compilation artifacts</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    model_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;model/mobilenetv2&quot;</span><span class="token comment" style="color:#999988;font-style:italic"># 2. Data set download and save path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data_path </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 3. Batch size used during training</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 4. Batch size used during prediction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eval_batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 5. Number of epochs for training</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    epoch_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 6. Device used for model saving and computation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    device </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cuda&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cuda</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">is_available</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;cpu&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Prepare data loaders, please note the use of rgb2centered_yuv in collate_fn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">prepare_data_loaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data_path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_batch_size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_batch_size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Tuple</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        normalize </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> transforms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Normalize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mean</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">128.0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">collate_fn</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">batch</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            batched_img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">stack</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">from_numpy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">array</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> copy</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> example </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> batch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">permute</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            batched_target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tensor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">example</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> example </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> batch</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            batched_img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rgb2centered_yuv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">batched_img</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            batched_img </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> normalize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">batched_img</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> batched_img</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> batched_target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        train_dataset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CIFAR10</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            transforms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Compose</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    transforms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RandomHorizontalFlip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    transforms</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RandAugment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            download</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eval_dataset </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> CIFAR10</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">        download</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_data_loader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        train_dataset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        batch_size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">train_batch_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sampler</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RandomSampler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">train_dataset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num_workers</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        collate_fn</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">collate_fn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pin_memory</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eval_data_loader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DataLoader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eval_dataset</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        batch_size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">eval_batch_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        sampler</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">SequentialSampler</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eval_dataset</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num_workers</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        collate_fn</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">collate_fn</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pin_memory</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> train_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_data_loader</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Make necessary modifications to the floating-point model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">FxQATReadyMobileNetV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">MobileNetV2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        num_classes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        width_mult</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inverted_residual_setting</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Optional</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">List</span><span class="token punctuation" style="color:#393A34">[</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        round_nearest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">__init__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            num_classes</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> width_mult</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inverted_residual_setting</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> round_nearest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quant </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> QuantStub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">scale</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">128</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dequant </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> DeQuantStub</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Tensor</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> Tensor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">quant</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">super</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">forward</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dequant</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">exists</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">makedirs</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> exist_ok</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic"># Float model initialization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    float_model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> FxQATReadyMobileNetV2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Prepare dataset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_data_loader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prepare_data_loaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_batch_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_batch_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Since the last layer of the model is inconsistent with the pretrained model, float finetuning is needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    optimizer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optim</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Adam</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.001</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weight_decay</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1e-3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    best_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> nepoch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoch_num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">train</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        train_one_epoch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            float_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CrossEntropyLoss</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            optimizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            train_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            device</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Float precision testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        float_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        top1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> evaluate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">float_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> device</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;Float Epoch {}: evaluation Acc@1 {:.3f} Acc@5 {:.3f}&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                nepoch</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top5</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> top1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> best_acc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            best_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> top1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># Save the best parameters of the float model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                float_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;float-checkpoint.ckpt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Files already downloaded and verified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Files already downloaded and verified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................Full cifar-10 train set: Loss 2.116 Acc@1 20.744 Acc@5 70.668</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 0: evaluation Acc@1 34.140 Acc@5 87.330</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.815 Acc@1 32.464 Acc@5 84.110</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 1: evaluation Acc@1 42.770 Acc@5 90.560</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.682 Acc@1 38.276 Acc@5 87.374</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 2: evaluation Acc@1 45.810 Acc@5 91.240</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.581 Acc@1 42.676 Acc@5 89.224</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 3: evaluation Acc@1 50.070 Acc@5 92.620</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.495 Acc@1 45.882 Acc@5 90.668</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 4: evaluation Acc@1 53.860 Acc@5 93.690</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.413 Acc@1 49.274 Acc@5 91.892</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 5: evaluation Acc@1 51.230 Acc@5 94.370</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.339 Acc@1 52.488 Acc@5 92.760</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 6: evaluation Acc@1 58.460 Acc@5 95.450</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.269 Acc@1 54.710 Acc@5 93.702</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 7: evaluation Acc@1 59.870 Acc@5 95.260</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.208 Acc@1 57.170 Acc@5 94.258</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 8: evaluation Acc@1 60.040 Acc@5 95.870</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.147 Acc@1 59.420 Acc@5 95.150</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 9: evaluation Acc@1 61.370 Acc@5 96.830</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.098 Acc@1 61.652 Acc@5 95.292</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 10: evaluation Acc@1 66.410 Acc@5 96.910</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.060 Acc@1 62.902 Acc@5 95.758</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 11: evaluation Acc@1 67.900 Acc@5 96.660</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 1.013 Acc@1 64.606 Acc@5 96.250</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................Float Epoch 12: evaluation Acc@1 69.120 Acc@5 97.180</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.980 Acc@1 65.954 Acc@5 96.486</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 13: evaluation Acc@1 70.410 Acc@5 97.420</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.944 Acc@1 67.002 Acc@5 96.792</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 14: evaluation Acc@1 71.200 Acc@5 97.410</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.915 Acc@1 68.024 Acc@5 96.896</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 15: evaluation Acc@1 72.570 Acc@5 97.780</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.892 Acc@1 69.072 Acc@5 97.062</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 16: evaluation Acc@1 72.950 Acc@5 98.020</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.868 Acc@1 70.072 Acc@5 97.234</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 17: evaluation Acc@1 75.020 Acc@5 98.230</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.850 Acc@1 70.544 Acc@5 97.384</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 18: evaluation Acc@1 74.870 Acc@5 98.140</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.826 Acc@1 71.334 Acc@5 97.476</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 19: evaluation Acc@1 74.700 Acc@5 98.090</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.817 Acc@1 71.988 Acc@5 97.548</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 20: evaluation Acc@1 75.690 Acc@5 98.140</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.796 Acc@1 72.530 Acc@5 97.734</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Float Epoch 21: evaluation Acc@1 76.500 Acc@5 98.470</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..............................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.786 Acc@1 72.754 Acc@5 97.770</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Float Epoch 22: evaluation Acc@1 76.200 Acc@5 98.290</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.772 Acc@1 73.392 Acc@5 97.802</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Float Epoch 23: evaluation Acc@1 74.800 Acc@5 98.640</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.753 Acc@1 73.982 Acc@5 97.914</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Float Epoch 24: evaluation Acc@1 77.150 Acc@5 98.490</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................Full cifar-10 train set: Loss 0.741 Acc@1 74.278 Acc@5 98.038</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Float Epoch 25: evaluation Acc@1 77.270 Acc@5 98.690</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Full cifar-10 train set: Loss 0.737 Acc@1 74.582 Acc@5 97.916</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Float Epoch 26: evaluation Acc@1 77.050 Acc@5 98.580</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Full cifar-10 train set: Loss 0.725 Acc@1 75.254 Acc@5 98.038</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Float Epoch 27: evaluation Acc@1 79.120 Acc@5 98.620</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Full cifar-10 train set: Loss 0.714 Acc@1 75.290 Acc@5 98.230</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Float Epoch 28: evaluation Acc@1 78.060 Acc@5 98.550</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Full cifar-10 train set: Loss 0.711 Acc@1 75.662 Acc@5 98.218</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Float Epoch 29: evaluation Acc@1 77.580 Acc@5 98.610</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Calibration">Calibration<a href="#Calibration" class="hash-link" aria-label="Direct link to Calibration" title="Direct link to Calibration">​</a></h2>
<p>After the model transformation is complete and the floating-point training is completed, calibration can be performed. In this process, the distribution of data is calculated by inserting observers into the model during the forward process, in order to calculate the appropriate quantization parameters:</p>
<ul>
<li>
<p>For some models, only calibration is necessary to achieve the required accuracy, and there is no need to perform time-consuming quantization-aware training.</p>
</li>
<li>
<p>Even if the calibrated model does not meet the precision requirements, this process can reduce the difficulty of subsequent quantization-aware training, shorten the training time, and improve the final training accuracy.</p>
</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Users can modify the following parameters as needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 1. Batch size used during calibration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    calib_batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 2. Batch size used during validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eval_batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 3. Number of examples used during calibration, set to inf to use all data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    num_examples </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">float</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;inf&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 4. The code for the target hardware platform</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    march </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> March</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">BAYES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Set the hardware platform that the model will run on before the model transformation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_march</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">march</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Convert the model to calibration state to calculate the numerical distribution characteristics of data at each location</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    calib_model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prepare_qat_fx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token comment" style="color:#999988;font-style:italic"># The output model will share the attributes of the input model to avoid affecting the subsequent use of float_model. A &#x27;deepcopy&#x27; is performed here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    copy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deepcopy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">float_model</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default_calib_8bit_fake_quant_qconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;module_name&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token comment" style="color:#999988;font-style:italic"># When the output layer of the model is Conv or Linear, &#x27;out_qconfig&#x27; can be used to configure high-precision output.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;classifier&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default_calib_8bit_weight_32bit_out_fake_quant_qconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        device</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># The &#x27;prepare_qat_fx&#x27; interface does not guarantee that the output model&#x27;s device is completely consistent with the input model.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Prepare the dataset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    calib_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_data_loader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prepare_data_loaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> calib_batch_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_batch_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Perform the Calibration process (no need for backward)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Note the control over the model&#x27;s state, the model needs to be in &#x27;eval&#x27; state to ensure that the behavior of BatchNorm matches the requirements.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    calib_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_fake_quantize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">calib_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FakeQuantState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CALIBRATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">no_grad</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cnt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> calib_data_loader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            image</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            calib_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">image</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;.&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> end</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> flush</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            cnt </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> image</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">size</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> cnt </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> num_examples</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token keyword" style="color:#00009f">break</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Test the precision of fake quantization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Note the control over the model&#x27;s state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    calib_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_fake_quantize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">calib_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FakeQuantState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VALIDATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    top1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> evaluate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        calib_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        eval_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        device</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Calibration: evaluation Acc@1 {:.3f} Acc@5 {:.3f}&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            top1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top5</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token comment" style="color:#999988;font-style:italic"># Save Calibration Model Parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        calib_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;calib-checkpoint.ckpt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    Files already downloaded and verified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Files already downloaded and verified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/users/yushu.gao/horizon/qat_logger/horizon_plugin_pytorch/quantization/observer_v2.py:405: UserWarning: _aminmax is deprecated as of PyTorch 1.11 and will be removed in a future release. Use aminmax instead. This warning will only appear once per process. (Triggered internally at ../aten/src/ATen/native/TensorCompare.cpp:568.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_val_cur, max_val_cur = torch._aminmax(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /home/users/yushu.gao/horizon/qat_logger/horizon_plugin_pytorch/quantization/observer_v2.py:672: UserWarning: _aminmax is deprecated as of PyTorch 1.11 and will be removed in a future release. Use aminmax instead. This warning will only appear once per process. (Triggered internally at ../aten/src/ATen/native/ReduceAllOps.cpp:45.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    min_val_cur, max_val_cur = torch._aminmax(x)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ....................................................................................................................................................................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Calibration: evaluation Acc@1 77.890 Acc@5 98.640</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>If the quantization accuracy of the model after calibration already meets the requirements, you can directly proceed to the next step of <strong>converting the model to fixed point</strong>, otherwise, you need to perform <strong>quantization-aware training</strong> to further improve the accuracy.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="quantization-aware-training">Quantization-Aware Training<a href="#quantization-aware-training" class="hash-link" aria-label="Direct link to Quantization-Aware Training" title="Direct link to Quantization-Aware Training">​</a></h2>
<p>Quantization-aware training inserts fake quantization nodes into the model to make the model aware of the impact of quantization during the training process. In this case, the model parameters are fine-tuned to improve the accuracy after quantization.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># The following parameters can be modified according to your needs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 1. Batch size used during training</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 2. Batch size used during validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eval_batch_size </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">256</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 3. Number of epochs for training</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    epoch_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Prepare the data loaders</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    train_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_data_loader </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prepare_data_loaders</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> train_batch_size</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eval_batch_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Convert the model to QAT state</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    qat_model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> prepare_qat_fx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    copy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">deepcopy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">float_model</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default_qat_8bit_fake_quant_qconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;module_name&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;classifier&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default_qat_8bit_weight_32bit_out_fake_quant_qconfig</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Load quantization parameters from calibration model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    qat_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">load_state_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">calib_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Perform Quantization-Aware Training (QAT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># As a fine-tuning process, QAT generally requires a smaller learning rate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    optimizer </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optim</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Adam</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qat_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> lr</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1e-3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> weight_decay</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1e-4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    best_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> nepoch </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">epoch_num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Control QAT model&#x27;s training mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qat_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">train</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set_fake_quantize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qat_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FakeQuantState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">QAT</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        train_one_epoch</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            qat_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            nn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">CrossEntropyLoss</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            optimizer</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            train_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            device</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># Control QAT model&#x27;s evaluation mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qat_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">eval</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        set_fake_quantize</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">qat_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> FakeQuantState</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">VALIDATION</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        top1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> evaluate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            qat_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            eval_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            device</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">&quot;QAT Epoch {}: evaluation Acc@1 {:.3f} Acc@5 {:.3f}&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                nepoch</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top5</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> top1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> best_acc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">best_acc </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> top1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        qat_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">state_dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;qat-checkpoint.ckpt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Files already downloaded and verified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Files already downloaded and verified</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...............................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.759 Acc@1 73.692 Acc@5 97.940</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QAT Epoch 0: evaluation Acc@1 79.170 Acc@5 98.490</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...............................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.718 Acc@1 75.414 Acc@5 97.998</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QAT Epoch 1: evaluation Acc@1 78.540 Acc@5 98.580</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...............................................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Full cifar-10 train set: Loss 0.719 Acc@1 75.180 Acc@5 98.126</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    QAT Epoch 2: evaluation Acc@1 78.200 Acc@5 98.540</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="convert-to-fixed-point-model">Convert to Fixed-Point Model<a href="#convert-to-fixed-point-model" class="hash-link" aria-label="Direct link to Convert to Fixed-Point Model" title="Direct link to Convert to Fixed-Point Model">​</a></h2>
<p>After the accuracy of the quantization model meets the requirement, the model can be converted to a fixed-point model. It is generally believed that the results of the fixed-point model and the compiled model are exactly the same.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><p>Fixed-point models and quantized models cannot achieve exact numerical consistency, so please refer to the accuracy of the fixed-point model. If the fixed-point accuracy does not meet the requirements, further quantization training is needed.</p></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Users can modify the following parameters as needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 1. Use which model as the input of the process, you can choose calib_model or qat_model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    base_model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> qat_model</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Convert the model to fixed-point mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantized_model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> convert_fx</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">base_model</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">device</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Test the accuracy of the fixed-point model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    top1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top5 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> evaluate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    quantized_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    eval_data_loader</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    device</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&quot;Quantized model: evaluation Acc@1 {:.3f} Acc@5 {:.3f}&quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            top1</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> top5</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">avg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[2023-06-29 14:55:05,825] WARNING: AdaptiveAvgPool2d has not collected any statistics of activations and its scale is 1, please check whether this is intended!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">........................................</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Quantized model: evaluation Accuracy@1 78.390, Accuracy@5 98.640</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="model-deployment">Model Deployment<a href="#model-deployment" class="hash-link" aria-label="Direct link to Model Deployment" title="Direct link to Model Deployment">​</a></h2>
<p>After verifying the quantized model&#x27;s accuracy and ensuring it meets requirements, proceed with deployment steps, including model inspection, compilation, performance testing, and visualization.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Note</div><div class="admonitionContent_BuS1"><ul>
<li>If desired, you can skip the actual calibration and quantization-aware training processes and directly proceed with model inspection to ensure there are no issues preventing successful compilation.</li>
<li>Since the compiler only supports CPUs, both the model and data must be on the CPU.</li>
</ul></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Users can modify these parameters as needed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Optimization level for compilation, can be 0-3; higher levels result in</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#    faster execution on the board but slower compilation times.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_opt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;O1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">######################################################################</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># `example_input` can also be randomly generated data, but using real data is recommended</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># for more accurate performance testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">example_input </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">iter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">eval_data_loader</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Trace the model, serialize it, and generate the computation graph. Ensure the model and data are on CPU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">script_model </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">trace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">quantized_model</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cpu</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> example_input</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">torch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">jit</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">save</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">script_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;int_model.pt&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Model inspection</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">check_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">script_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">example_input</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/home/users/yushu.gao/horizon/qat_logger/horizon_plugin_pytorch/qtensor.py:992: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can&#x27;t record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if scale is not None and scale.numel() &gt; 1:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/users/yushu.gao/horizon/qat_logger/horizon_plugin_pytorch/nn/quantized/conv2d.py:290: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can&#x27;t record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">per_channel_axis=-1 if self.out_scale.numel() == 1 else 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/users/yushu.gao/horizon/qat_logger/horizon_plugin_pytorch/nn/quantized/adaptive_avg_pool2d.py:30: TracerWarning: Converting a tensor to a Python boolean might cause the trace to be incorrect. We can&#x27;t record the data flow of Python values, so this value will be treated as a constant in the future. This means that the trace might not generalize to other inputs!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/home/users/yushu.gao/horizon/qat_logger/horizon_plugin_pytorch/utils/script_quantized_fn.py:224: UserWarning: operator() profile_node %59 : int[] = prim::profile_ivalue(%57)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">does not have profile information (Triggered internally at ../torch/csrc/jit/codegen/cuda/graph_fuser.cpp:105.)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return compiled_fn(*args, **kwargs)</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">This model is supported!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HBDK model check PASS</span><br></span></code></pre></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Compile the model, the generated hbm file is the deployable model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">compile_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    script_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">example_input</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hbm</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;model.hbm&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    input_source</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;pyramid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    opt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">compile_opt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: launch 16 threads for optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[==================================================] 100%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: arg0 can not be assigned to NCHW_NATIVE layout because it&#x27;s input source is pyramid/resizer.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">consumed time 10.4302</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HBDK model compilation SUCCESS</span><br></span></code></pre></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Model performance testing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perf_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    script_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">example_input</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">out_dir</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;perf_out&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">input_source</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;pyramid&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">opt</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">compile_opt</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">layer_details</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INFO: launch 16 threads for optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[==================================================] 100%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WARNING: arg0 can not be assigned to NCHW_NATIVE layout because it&#x27;s input source is pyramid/resizer.</span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">consumed time 10.3666</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HBDK model compilation SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FPS=5722.98, latency = 44731.9 us   (see model/mobilenetv2/perf_out/FxQATReadyMobileNetV2.html)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HBDK model compilation SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">HBDK performance estimation SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{&#x27;summary&#x27;: {&#x27;BPU OPs per frame (effective)&#x27;: 12249856,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;BPU OPs per run (effective)&#x27;: 3135963136,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;BPU PE number&#x27;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;BPU core number&#x27;: 1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;BPU march&#x27;: &#x27;BAYES&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;DDR bytes per frame&#x27;: 1403592.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;DDR bytes per run&#x27;: 359319552,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;DDR bytes per second&#x27;: 8032734694,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;DDR megabytes per frame&#x27;: 1.339,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;DDR megabytes per run&#x27;: 342.674,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;DDR megabytes per second&#x27;: 7660.6,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;FPS&#x27;: 5722.98,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;HBDK version&#x27;: &#x27;3.46.4&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;compiling options&#x27;: &#x27;--march bayes -m /tmp/hbdktmp_ocro1_9_.hbir -f hbir --O1 -o /tmp/hbdktmp_ocro1_9_.hbm --jobs 16 -n FxQATReadyMobileNetV2 -i pyramid --input-name arg0 --output-layout NCHW --progressbar --debug&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;frame per run&#x27;: 256,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;frame per second&#x27;: 5722.98,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;input features&#x27;: [[&#x27;input name&#x27;, &#x27;input size&#x27;], [&#x27;arg0&#x27;, &#x27;256x32x32x3&#x27;]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;interval computing unit utilization&#x27;: [0.081,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.113,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.021,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.001,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.063,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.004,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.092,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.019,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.001,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.065,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.078,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.11,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.108,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.235,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.078,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.179,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.246,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.219,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.154,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.046,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.108,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.064,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.099,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.113,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.153,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.046,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.052,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.075,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.041,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.077,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.081,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.081,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.06,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.304,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.603,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.521,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.104,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.11],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;interval computing units utilization&#x27;: [0.081,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.113,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.021,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.001,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.063,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.004,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.092,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.019,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.001,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.016,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.053,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.021,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.001,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.0930.065,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.078,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.11,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.108,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.235,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.078,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.179,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.246,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.219,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.154,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.046,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.16,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.108,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.064,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.099,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.113,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.153,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.046,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.052,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.075,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.041,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.077,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.081,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.081,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.06,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.304,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.603,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.521,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.104,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0.11],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;interval loading bandwidth (megabytes/s)&#x27;: [798,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2190,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3291,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3001,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4527,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6356,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5985,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4096,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3098,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5315,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5907,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3763,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2887,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4891,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6121,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4107,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2900,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1686,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3146,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3855,4372,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2714,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2180,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2074,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2516,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3674,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4533,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3849,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4317,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3738,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3378,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3901,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3068,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4697,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6180,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3583,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3760,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6467,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3897,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3404,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5554,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4941,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2143,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2572,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5019],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;interval number&#x27;: 45,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;interval storing bandwidth (megabytes/s)&#x27;: [4000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3368,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4334,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6936,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5824,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3695,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2524,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3720,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6066,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4863,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2938,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3924,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6061,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4752,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2250,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2238,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4500,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    1500,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3000,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3041,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4458,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3617,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3295,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3841,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3495,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4500,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3927,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4839,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5822,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3302,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3749,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    6609,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3749,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3177,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    5876,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    4570,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2255,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2187,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    3430,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    2812,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    942],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;interval time (ms)&#x27;: 1.0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;latency (ms)&#x27;: 44.73,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;latency (ms) by segments&#x27;: [44.732],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;latency (us)&#x27;: 44731.9,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;layer details&#x27;: [[&#x27;layer&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;ops&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;computing cost (no DDR)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;load/store cost&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;29 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;267 us (0.5% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_1_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;37,748,736&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;42 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1156 us (2.5% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_1_conv_1_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;67,108,864&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;20 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_2_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;201,326,592&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;44 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;3132 us (7.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_2_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;28,311,552&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;54 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;3132 us (7.0% of model)&#x27;],[&#x27;_features_2_conv_2_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;75,497,472&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;23 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;1 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_3_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;24 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;638 us (1.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_3_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;42,467,328&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;33 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;3592 us (8.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_3_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;14 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;637 us (1.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_4_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;45 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;2433 us (5.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_4_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;10,616,832&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;63 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;2432 us (5.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_4_conv_2_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;37,748,736&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;21 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;1 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_5_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;40 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;3 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_5_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;14,155,776&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;45 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;463 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_5_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;23 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;462 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_6_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;40 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;3 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_6_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;14,155,776&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;23 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;463 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_6_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,[&#x27;23 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;462 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_7_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;61 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;813 us (1.8% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_7_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;3,538,944&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;76 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;812 us (1.8% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_7_conv_2_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;25,165,824&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;47 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;3 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_8_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;76 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;5 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_8_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;7,077,888&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;75 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;463 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_8_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;67 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;465 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_9_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;76 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;5 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_9_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;7,077,888&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;75 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;463 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_9_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;67 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;465 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_10_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;76 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;5 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_10_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;7,077,888&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;51 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;463 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_10_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;67 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;465 us (1.0% of model)&#x27;][&#x27;_features_11_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;50,331,648&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;76 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;5 us (0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_11_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;7,077,888&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;75 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;463 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_11_conv_2_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;75,497,472&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;110 us (0.2% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;467 us (1.0% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_12_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;43 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;644 us (1.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_12_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;10,616,832&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;46 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;1274 us (2.8% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_12_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;37 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;643 us (1.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_13_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;43 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;644 us (1.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_13_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;10,616,832&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;55 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;1274 us (2.8% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_13_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;31 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;642 us (1.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_14_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;113,246,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;67 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;644 us (1.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_14_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;2,654,208&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;72 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;1274 us (2.8% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_14_conv_2_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;47,185,920&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;108 us (0.2% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;647 us (1.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_15_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;78,643,200&#x27;    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_15_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;4,423,680&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;51 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1973 us (4.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_15_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;78,643,200&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;48 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1004 us (2.2% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_16_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;78,643,200&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;39 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1004 us (2.2% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_16_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;4,423,680&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;56 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1973 us (4.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_16_generated_add_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;78,643,200&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;41 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1004 us (2.2% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_17_conv_0_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;78,643,200&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;80 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1004 us (2.2% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_17_conv_1_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;4,423,680&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;63 us (0.1% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1973 us (4.4% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_17_conv_2_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;157,286,400&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;99 us (0.2% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;1021 us (2.2% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_18_0_hz_conv2d&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;209,715,200&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;878 us (1.9% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;2601 us (5.8% of model)&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_features_18_0_hz_conv2d_torch_native&#x27;, &#x27;0&#x27;, &#x27;11 us (0% of model)&#x27;, &#x27;0&#x27;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [&#x27;_classifier_1_hz_linear_torch_native&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;6,553,600&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;5 us (0% of model)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;7 us (0% of model)&#x27;]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;loaded bytes per frame&#x27;: 707232,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;loaded bytes per run&#x27;: 181051392,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;model json CRC&#x27;: &#x27;51b16a11&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;model json file&#x27;: &#x27;/tmp/hbdktmp_ocro1_9_.hbir&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;model name&#x27;: &#x27;FxQATReadyMobileNetV2&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;model param CRC&#x27;: &#x27;00000000&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &#x27;multicore sync time (ms)&#x27;: 0.0,&#x27;run per second&#x27;: 22.36,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;runtime version&#x27;: &#x27;3.15.29.0&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;stored bytes per frame&#x27;: 696360,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;stored bytes per run&#x27;: 178268160,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;worst FPS&#x27;: 5722.98</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Model visualization</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    visualize_model</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        script_model</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">example_input</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        save_path</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">model_path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;model.svg&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        show</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    INFO: launch 1 threads for optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumed time 1.6947</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HBDK model compilation SUCCESS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-08-12T10:03:16.000Z" itemprop="dateModified">Aug 12, 2025</time></b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/environment_config"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Environment Dependency</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/en/Advanced_development/toolchain_development/expert/user_guide"><div class="pagination-nav__sublabel">Next </div><div class="pagination-nav__label">Development Guide</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-process" class="table-of-contents__link toc-highlight">Basic Process</a></li><li><a href="#get-float-model" class="table-of-contents__link toc-highlight">Get Float Model</a></li><li><a href="#Calibration" class="table-of-contents__link toc-highlight">Calibration</a></li><li><a href="#quantization-aware-training" class="table-of-contents__link toc-highlight">Quantization-Aware Training</a></li><li><a href="#convert-to-fixed-point-model" class="table-of-contents__link toc-highlight">Convert to Fixed-Point Model</a></li><li><a href="#model-deployment" class="table-of-contents__link toc-highlight">Model Deployment</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GuYueHome<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Contact US</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 D-Robotics.</div></div></div></footer></div>
</body>
</html>