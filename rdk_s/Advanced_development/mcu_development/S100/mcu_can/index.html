<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-docs_s docs-version-current docs-doc-page docs-doc-id-Advanced_development/mcu_development/S100/mcu_can" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">CAN使用指南 | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_can"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" property="og:title" content="CAN使用指南 | RDK DOC"><meta data-rh="true" name="description" content="基本概述"><meta data-rh="true" property="og:description" content="基本概述"><link data-rh="true" rel="icon" href="/rdk_doc/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_can"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_can" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/mcu_development/S100/mcu_can" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_can" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"7. 进阶开发","item":"https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development"},{"@type":"ListItem","position":2,"name":"7.5 MCU开发指南","item":"https://developer.d-robotics.cc/rdk_doc/rdk_s/05_MCU_development"},{"@type":"ListItem","position":3,"name":"7.5.1 S100 MCU开发指南","item":"https://developer.d-robotics.cc/rdk_doc/rdk_s/01_S100"},{"@type":"ListItem","position":4,"name":"CAN使用指南","item":"https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_can"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/assets/css/styles.0fbd7d27.css">
<script src="/rdk_doc/assets/js/runtime~main.fd3ee8a6.js" defer="defer"></script>
<script src="/rdk_doc/assets/js/main.886eb987.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a class="navbar__item navbar__link" href="/rdk_doc/RDK">RDK X3 / X5</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>CN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_can" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/rdk_s/Advanced_development/mcu_development/S100/mcu_can" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/rdk_s/RDK">D-Robotics RDK 套件</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Quick_start">1. 快速开始</a><button aria-label="展开侧边栏分类 &#x27;1. 快速开始&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/System_configuration">2. 系统配置</a><button aria-label="展开侧边栏分类 &#x27;2. 系统配置&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Basic_Application">3. 基础应用开发</a><button aria-label="展开侧边栏分类 &#x27;3. 基础应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Basic_Development">4. 算法应用开发</a><button aria-label="展开侧边栏分类 &#x27;4. 算法应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Robot_development">5. 机器人应用开发</a><button aria-label="展开侧边栏分类 &#x27;5. 机器人应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Application_case">6. 应用开发指南</a><button aria-label="展开侧边栏分类 &#x27;6. 应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/rdk_s/Advanced_development">7. 进阶开发</a><button aria-label="折叠侧边栏分类 &#x27;7. 进阶开发&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/hardware_development">7.1 硬件开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.1 硬件开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/linux_development">7.2. Linux开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.2. Linux开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/03_multimedia_development">7.3 多媒体开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.3 多媒体开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/04_toolchain_development">7.4 算法工具链开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.4 算法工具链开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/rdk_s/05_MCU_development">7.5 MCU开发指南</a><button aria-label="折叠侧边栏分类 &#x27;7.5 MCU开发指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/rdk_doc/rdk_s/01_S100">7.5.1 S100 MCU开发指南</a><button aria-label="折叠侧边栏分类 &#x27;7.5.1 S100 MCU开发指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/code_release">MCU代码包结构介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/basic_information">MCU快速入门指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/MCU_build_system">MCU系统说明</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/FreeRTOS_development">MCU1开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_uart">UART使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_pwm">PWM使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_spi">SPI使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_adc">ADC使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_ipc">IPC使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_can">CAN使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_i2c">I2C使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_eth">Eth使用指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/07_Advanced_development/05_mcu_development/01_S100/12_mcu_port">PORT模块指南</a><button aria-label="展开侧边栏分类 &#x27;PORT模块指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_ramdump">MCU ramdump功能</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/rdk_gen">7.6 RDK S100构建系统开发指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/FAQ">8. 常见问题</a><button aria-label="展开侧边栏分类 &#x27;8. 常见问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Appendix">9. 附录</a><button aria-label="展开侧边栏分类 &#x27;9. 附录&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/rdk_s/Release_Note/roadmap">10. 版本发布</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/rdk_doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/rdk_s/Advanced_development"><span>7. 进阶开发</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/rdk_s/05_MCU_development"><span>7.5 MCU开发指南</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/rdk_s/01_S100"><span>7.5.1 S100 MCU开发指南</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">CAN使用指南</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>CAN使用指南</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="基本概述">基本概述<a href="#基本概述" class="hash-link" aria-label="基本概  述的直接链接" title="基本概述的直接链接">​</a></h2>
<ul>
<li>最大可使用CAN controller数量：10。</li>
<li>CAN最高传输速率：8M。(受限于transceiver的波特率限制，目前实验室只测试验证到5M波特率。)</li>
<li>一个controller的Ram内划分的Block个数：<!-- -->
<ul>
<li>CAN0~CAN3：4 Block (可变payload);</li>
<li>CAN4~CAN9：4 Block (可变payload)+ 4 Block(固定payload)。</li>
</ul>
</li>
<li>一个controller支持的最大Mailbox个数为128。</li>
<li>一个controller支持一路RxFIFO，FIFO深度为：<!-- -->
<ul>
<li>CAN0~CAN3：8 * 64 bytes;</li>
<li>CAN4~CAN9：32 * 64 bytes。</li>
</ul>
</li>
<li>不支持 TTController，即不支持TTCAN（一种基于CAN总线的高层协议）。</li>
<li>CAN支持多核使用，可将不同的CAN控制器绑定在不同的核心上，但不支持多个核心同时使用同一个CAN控制器。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="软件架构">软件架构<a href="#软件架构" class="hash-link" aria-label="软件架构的直接链接" title="软件架构的直接链接">​</a></h2>
<p>S100芯片的CAN控制器位于MCU域，负责CAN数据收发。由于感知等应用位于Acore，因此部分CAN数据需要通过IPC核间通信机制转发到Acore。架构保证传输可靠性，转发机制实现数据正确性检测、丢包检测和传输超时检测等机制。此外，还需要规避MCU侧高频转发小数据块导致CPU占用率过高，造成MCU实时性降低等性能问题。</p>
<p>S100 CAN转发方案的核心流程如下：</p>
<ul>
<li>首先通过MCU侧CAN2IPC模块将CAN通道映射到对应IPC通道，然后通过Acore侧CANHAL模块将IPC通道反映射为虚拟CAN设备通道。最后用户通过CANHAL提供的API接口获取虚拟CAN设备中的数据。其中，CAN2IPC模块为MCU侧服务，CANHAL模块为Acore侧提供给应用程序的动态库。</li>
<li>CAN2IPC模块周期性采集MCU侧CAN数据，按照指定传输协议进行打包，然后通过IPC核间通信转发到Acore。Ipc instance 0中的channel0~channel7默认分配给CAN转发使用。</li>
<li>CANHAL模块获取来自MCU侧的IPC数据，按照指定的传输协议解析数据，并支持业务软件通过API获取原始CAN帧。</li>
</ul>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/05_mcu_development/01_S100/mcu_can.png" alt="Acore与MCU之间透传CAN数据架构图" class="img_ev3q"></p>
<p>数据流如上图所示：</p>
<ul>
<li>外设数据通过CAN的PHY和控制器器件被MCU域CAN驱动接收后，CAN驱动将数据上报并缓存在hobot CANIF模块。</li>
<li>CAN2IPC Service周期性从CANIF模块取出CAN帧，按照可靠传输协议进行打包，然后通过IPC核间通信机制转发给Acore。</li>
<li>CANHAL模块获取来自MCU侧的IPC数据，按照指定的传输协议解析数据，Acore 应用程序通过CANHAL Lib库提供的API获取CAN帧。</li>
</ul>
<p>方案特性说明：</p>
<ul>
<li>支持数据透传正确性校验。</li>
<li>支持数据透传丢包检测。</li>
<li>支持传输超时检测。MCU侧CAN2IPC转发数据时将数据包打上MCU侧的时间戳，Acore CANHAL接收到数据后会读取Acore的时间戳，如果传输超时会报警。注意，需要提前启动时间同步完成MCU RTC时间和Acore 网卡phc0的时间同步。</li>
<li>支持多个CAN通道并行传输。MCU侧多个CAN控制器的数据可同时被转发给Acore，Acore应用程序通过CANHAL从不同通道号读出CAN数据。</li>
<li>由于CANHAL底层通过ipc核间通信进行传输，而ipc目前不支持多个进程或者线程读写同一个通道，因此CANHAL也不支持该特性。</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="硬件连接说明">硬件连接说明<a href="#硬件连接说明" class="hash-link" aria-label="硬件连接说明的直接链接" title="硬件连接说明的直接链接">​</a></h2>
<ul>
<li>
<p>CAN物理层的形式主要分为闭环总  线及开环总线网络两种，一个适合于高速通讯，一个适合于远距离通讯；<strong>S100的sample默认采用闭环总线网络架构</strong>。</p>
</li>
<li>
<p>CAN总线的引脚位于S100的MCU扩展板上，引出了5路CAN接口，连接器分别对应了5个绿色的螺丝式的3 PIN连接器。1 PIN（三角标志）为GND，中间PIN为CAN_L，剩下的为CAN_H。</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" src="http://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/05_mcu_development/01_S100/mcu_can_phy.png" alt="MCU CAN物理图示" class="img_ev3q"></p>
<ul>
<li>MCU小板通过2pin跳帽的形式来选择是否在CAN_H和CAN_L之间接入120欧姆电阻；当插入跳帽时，接入电阻，适用于闭环网络所需的终端匹配阻抗‌；移除跳帽则断开终端电阻，适用于开环网络或中继节点场景‌。</li>
</ul>
<p><img decoding="async" loading="lazy" src="http://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/05_mcu_development/01_S100/mcu_can_sche.png" alt="MCU CAN简笔图示" class="img_ev3q"></p>
<p>CAN闭环网络使用两个120欧姆电阻是CAN总线的标准配置，以下以S100举例，如何正确接入电阻：</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>整体而言，开环网络配置不需要接入120欧姆电阻，而闭环网络配置总共需要插入<strong>两个</strong>120欧姆电阻；</p></div></div>
<ul>
<li>在使用开环网络时，确保CAN_H与CAN_L线路正确连接，所用到的CAN不要插入跳线帽(在网络中不接入120欧姆电阻)；</li>
<li>  若将S100的CAN5和CAN6连接组成双节点内部闭环网络，确保CAN_H与CAN_L线路正确连接，还需要在CAN5和CAN6接线端子后面的插针插入跳帽(在网络中插入两个120欧姆电阻)；</li>
<li>若将S100的CAN5~CAN9连接组成多节点内部闭环网络，确保CAN_H与CAN_L线路正确连接，还需要插入两个跳线帽，任意选择两个，严禁插入超过2个跳线帽，以免出现不可预测的问题；</li>
<li>若将S100的CAN5~CAN9中的任意一个控制器和其它CAN设备组成外部闭环网络，确保CAN_H与CAN_L线路正确连接外，还需要在RDK的CAN控制器的接线端子后面的插针插入跳帽，并在网络中其它设备端接入一个120Ω电阻；</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="can-filter-配置">CAN Filter 配置<a href="#can-filter-配置" class="hash-link" aria-label="CAN Filter 配置的直接链接" title="CAN Filter 配置的直接链接">​</a></h2>
<p>标准帧的filter最多可配置128个，扩展帧的filter最多可配置64个，可选择的filter类型如下：</p>
<ul>
<li>ONE_ID_FILTER：指定ID并可配置MASK来忽略ID中的哪些bit进行过滤，</li>
<li>RANGE_ID_FILTER：按照ID范围进行过滤，</li>
<li>TWO_ID_FILTER：指定两个ID进行过滤。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="过滤器的识别">过滤器的识别<a href="#过滤器的识别" class="hash-link" aria-label="过滤器的识别的直接链接" title="过滤器的识别的直接链接">​</a></h3>
<p>过滤器类型通过检查u32HwFilterCode的最高2位来确定：</p>
<ul>
<li>0b00: ONE_ID_FILTER</li>
<li>0b01: RANGE_ID_FILTER</li>
<li>0b10: TWO_ID_FILTER</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @struct Can_HwFilterType</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @brief Can Hardware Filter</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> * @NO{S01E03C01}</span><br></span><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token class-name">Can_HwFilterType</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> uint32 u32HwFilterCode</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/**&lt; @brief Specifies (together with the filter mask) the identifiers range that passes the hardware filter. */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> uint32 u32HwFilterMask</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/**&lt; @brief Describes a mask for hardware-based filtering of CAN identifiers. */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">Can_HwFilterType</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<ul>
<li>配置举例：<!-- -->
<ul>
<li>这是CAN 7 的过滤器配置，拥有两个过滤器</li>
<li>过滤器0的第一个元素的高2位为01，属于范围过滤方式</li>
<li>过滤器0和过滤1为&quot;或&quot;关系，即如果至少有一个过滤元件满足匹配标准，则CAN消息内容将被传输到增强型RX FIFO存储器</li>
</ul>
</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Config/McalCdd/gen_s100_sip_B_mcu1/Can/src/Can_PBcfg.c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Can_HwFilterType Can_aHwFilter_Object7</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2U</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 接收id为0x0~0x7ff的消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x400007ffU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x00000000U</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 接收id为0x600~0x7ff的消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x400007ffU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x00000600U</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="one_id_filter单id过滤方式">ONE_ID_FILTER（单ID过滤方式）<a href="#one_id_filter单id过滤方式" class="hash-link" aria-label="ONE_ID_FILTER（单ID过滤方式）的直接链接" title="ONE_ID_FILTER（单ID过滤方式）的直接链接">​</a></h3>
<p>这是最常见的过滤器类型，使用过滤器代码和掩码进行过滤,伪代码如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Received_ID </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Filter_Mask</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Filter_Code </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> Filter_Mask</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 接收该消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 丢弃该消</span><br></span></code></pre></div></div>
<p>举例代码如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Config/McalCdd/gen_s100_sip_B_mcu1/Can/src/Can_PBcfg.c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Can_HwFilterType Can_aHwFilter_Object7</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2U</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x00000400U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 只接收id = 0x400&amp;0x7ff = 0x400 消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x000007ffU</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 范围过滤方式，支持混用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x400007ffU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x00000600U</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="range_id_filter范围过滤方式">RANGE_ID_FILTER（范围过滤方式）<a href="#range_id_filter范围过滤方式" class="hash-link" aria-label="RANGE_ID_FILTER（范围过滤方式）的直接链接" title="RANGE_ID_FILTER（范围过滤方式）的直接链接">​</a></h3>
<p>在这种模式下，使用范围过滤逻辑：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">id1 </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> Received_ID </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> id2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 接收该消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 丢弃该消息</span><br></span></code></pre></div></div>
<p>这也是S100mcu的默认模式;举例代码如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Config/McalCdd/gen_s100_sip_B_mcu1/Can/src/Can_PBcfg.c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Can_HwFilterType Can_aHwFilter_Object7</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2U</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 接收id为0x0~0x7ff的消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x400007ffU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x00000000U</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 接收id为0x600~0x7ff的消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x400007ffU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x00000600U</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="two_id_filter双id过滤方式">TWO_ID_FILTER（双ID过滤方式）<a href="#two_id_filter双id 过滤方式" class="hash-link" aria-label="TWO_ID_FILTER（双ID过滤方式）的直接链接" title="TWO_ID_FILTER（双ID过滤方式）的直接链接">​</a></h3>
<p>这种类型允许指定两个独立的ID进行匹配：</p>
<ul>
<li>id1: 第一个匹配ID</li>
<li>id2: 第二个匹配ID</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Received_ID </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> id1 </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> Received_ID </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> id2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 接收该消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 丢弃该消息</span><br></span></code></pre></div></div>
<p>举例代码如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Config/McalCdd/gen_s100_sip_B_mcu1/Can/src/Can_PBcfg.c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Can_HwFilterType Can_aHwFilter_Object7</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2U</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x80000404U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token comment" style="color:#999988;font-style:italic">// 只接收id为404的消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x00000303U</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 只接收id为303的消息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// 范围过滤方式，支持混用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x400007ffU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0x00000600U</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><ol>
<li>RDK S100软硬件支持同时接收扩展帧和标准帧，而不需要修改配置</li>
<li>RDK S100硬件支持对扩展帧和标准帧分别过滤，软件暂不支持对扩展帧的过滤</li>
<li>扩展帧的id长度最高为11位，即最大为0x7FF</li>
</ol></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="波特率配置">波特率配置<a href="#波特率配置" class="hash-link" aria-label="波特率配置的直接链接" title="波特率配置的直接链接">​</a></h2>
<p>CAN的标称位时（Nominal bit timing）可以分为四个段：</p>
<ol>
<li>同步段(sync_seg)‌：用于节点间的时钟同步，所有节点在此段内检测信号边沿。其长度固定为1个时间单位(TQ)</li>
<li>传播段(prop_seg)‌：补偿信号在物理线路上的传播延迟。其长度可调整，用于确保信号在物理介质上的传输时间</li>
<li>相位缓冲段1(phase_seg1)‌：用于调整相位误差，确保采样点的准确性，可以扩展重同步</li>
<li>相位缓冲段2(phase_seg2)‌：同样用于调整相位误差，但可以缩短
这些段的总和决定了CAN的总位时间，通  过调整这些段的长度，可以配置不同的波特率。
此外还有以下几个重要概念：</li>
<li>同步跳转宽度(SJW，synchronization jump width)：CAN 总线同步机制中允许调整相位缓冲段的最大时间量，在 硬同步 和 重同步 过程中补偿节点间的时钟偏差，确保采样点对齐。</li>
<li>延迟补偿偏移量(Transceiver Delay Compensation Offset)：仅 CAN FD 支持，用于解决数据段高速传输时的物理层时序偏移用于补偿 CAN FD 模式下 收发器环路延迟 和 信号传播时间 的固定修正值</li>
<li>采样点：CAN控制器在位时间内对总线电平进行采样的精确时刻，用于判定位的逻辑值（显性0或隐性1）</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="取值范围和公式计算">取值范围和公式计算<a href="#取值范围和公式计算" class="hash-link" aria-label="取值范围和公式计算的直接链接" title="取值范围和公式计算的直接链接">​</a></h3>
<ol>
<li>采样点计算：（sync_seg + prop_seg + phase_seg1）/（sync_seg + prop_seg + phase_seg1 + phase_seg2）×100%</li>
<li>同步段固定一个tq</li>
<li>prop_seg + phase_seg1&gt;phase_seg2</li>
<li>SJW ≤ min(Phase_Seg1, Phase_Seg2)</li>
<li>当配置5M及以上波特率时，需配置补偿参数，补偿参数计算公式如下：</li>
</ol>
<ul>
<li>TDC offset = (PropSeg + Seg1 + 1) * Fd Prescaler</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置仲裁段1m数据段5m实例说明">配置仲裁段1M数据段5M实例说明<a href="#配置仲裁段1m数据段5m实例说明" class="hash-link" aria-label="配置仲裁段1M数据段5M实例说明的直接链接" title="配置仲裁段1M数据段5M实例说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-基础参数确认">1. 基础参数确认<a href="#1-基础参数确认" class="hash-link" aria-label="1. 基础参数确认的直接链接" title="1. 基础参数确认的直接链接">​</a></h4>
<ul>
<li>CAN时钟频率（CAN_CLK）: 40 MHz</li>
<li>目标波特率（Bit Rate）: 5 Mbps</li>
<li>预分频值（Prescaler）: 1（不分频）</li>
<li>单Bit时间内的TQ总数: TQ = CAN_CLK/(Bit Rate×Prescaler)=40MHz/5Mbps×1=8TQ</li>
<li>时间量子：Tq time = 1 / (40M / prescaler) = 1/40M = 25ns</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-时间量子tq分配">2. 时间量子（TQ）分配<a href="#2-时间量子tq分配" class="hash-link" aria-label="2. 时间量子（TQ）分配的直接链接" title="2. 时间量子（TQ）分配的直接链接">​</a></h4>
<p>Sync_Seg（固定段）: 1 TQ（同步段不可修改）</p>
<p>剩余TQ分配: Prop_Seg+Phase_Seg1+Phase_Seg2=8−1=7TQ</p>
<p>此处取Prop_Seg=1，Phase_Seg1=4，Phase_Seg2=2，则采样点= (Sync_Seg+Prop_Seg+Phase_Seg1)/Total TQ x 100% = (1+4+1)/8 x 100%= 75%</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-延迟补偿偏移量transceiver-delay-compensation-offset">3. 延迟补偿偏移量（Transceiver Delay Compensation Offset）<a href="#3-延迟补偿偏移量transceiver-delay-compensation-offset" class="hash-link" aria-label="3. 延迟补偿偏移量（Transceiver Delay Compensation Offset）的直接链接" title="3. 延迟补偿偏移量（Transceiver Delay Compensation Offset）的直接链接">​</a></h4>
<p>Offset=(Prop_Seg+Phase_Seg1+1)×Prescaler = (1+4+1)×1=6TQ</p>
<p><strong>SJW（Synchronization Jump Width）设置</strong>：</p>
<p>SJW必须满足: SJW≤min⁡(Phase_Seg1,Phase_Seg2)=min⁡(4,2)=2</p>
<p>因此，配置 SJW = 2 TQ。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-终配置参数">4. 终配置参数<a href="#4-终配置参数" class="hash-link" aria-label="4. 终配置参数的直接链接" title="4. 终配置参数的直接链接">​</a></h4>
<p>根据上述的方式同理可以计算到1M情况下的参数，由于部分寄存器获取到的值会自动加一，所以实际写入的值要减一，具体可看下表</p>
<ul>
<li>5M 75%数据段配置</li>
</ul>
<table><thead><tr><th>参数名</th><th>值（TQ或时间）</th><th>需写入寄存器的值</th></tr></thead><tbody><tr><td>Sync_Seg</td><td>1 TQ</td><td>无需写入，固定为1</td></tr><tr><td>Prop_Seg</td><td>1 TQ</td><td>1</td></tr><tr><td>Phase_Seg1</td><td>4 TQ</td><td>3</td></tr><tr><td>Phase_Seg2</td><td>2 TQ</td><td>1</td></tr><tr><td>Prescaler</td><td>1</td><td>0</td></tr><tr><td>SJW</td><td>2 TQ</td><td>1</td></tr><tr><td>延迟补偿偏移量</td><td>6 TQ</td><td>6</td></tr></tbody></table>
<ul>
<li>1M 80%仲裁段配置</li>
</ul>
<table><thead><tr><th>参数名</th><th>值（TQ或时间）</th><th>需写入寄存器的值</th></tr></thead><tbody><tr><td>Sync_Seg</td><td>1 TQ</td><td>无需写入，固定为1</td></tr><tr><td>Prop_Seg</td><td>7 TQ</td><td>6</td></tr><tr><td>Phase_Seg1</td><td>8 TQ</td><td>7</td></tr><tr><td>Phase_Seg2</td><td>4 TQ</td><td>3</td></tr><tr><td>Prescaler</td><td>2</td><td>1</td></tr><tr><td>SJW</td><td>2 TQ</td><td>1</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-8m的配置相对于5m较为特殊使用60的采样">5. 8M的配置相对于5M较为特殊，使用60%的采样<a href="#5-8m的配置相对于5m较为特殊使用60的采样" class="hash-link" aria-label="5. 8M的配置相对于5M较为特殊，使用60%的采样的直接链接" title="5. 8M的配置相对于5M较为特殊，使用60%的采样的直接链接">​</a></h4>
<table><thead><tr><th>参数名</th><th>值（TQ或时间）</th><th>需写入寄存器的值</th></tr></thead><tbody><tr><td>Sync_Seg</td><td>1 TQ</td><td>无需写入，固定为1</td></tr><tr><td>Prop_Seg</td><td>1 TQ</td><td>1</td></tr><tr><td>Phase_Seg1</td><td>1 TQ</td><td>0</td></tr><tr><td>Phase_Seg2</td><td>2 TQ</td><td>1</td></tr><tr><td>Prescaler</td><td>1</td><td>0</td></tr><tr><td>SJW</td><td>1 TQ</td><td>0</td></tr><tr><td>延迟补偿偏移量</td><td>3 TQ</td><td>3</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="6-将结果更新到配置文件中">6. 将结  果更新到配置文件中<a href="#6-将结果更新到配置文件中" class="hash-link" aria-label="6. 将结果更新到配置文件中的直接链接" title="6. 将结果更新到配置文件中的直接链接">​</a></h4>
<p>配置文件路径:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">${mcu_sdk}/Config/McalCdd/gen_s100_sip_B_mcu1/Can/src/Can_PBcfg.c</span><br></span></code></pre></div></div>
<p>配置文件中存在两个波特率相关的重要结构体，下面以CAN5为例分别说明：</p>
<ul>
<li>Can_aControllerConfig：用于配置 CAN 控制器。每个控制器都有一个对应的配置项</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Can_ControllerConfigType Can_aControllerConfig</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">CAN_CONTROLLER_CONFIG_COUNT</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Controller ID configured */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">5U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Hw controller Offset */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">5U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Base Address */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        FLEXCAN_5_BASE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Activation or not */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">TRUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Bus Off uses polling or not */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">TRUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Global mask of Legacy FIFO (not used) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint32</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0xFFFFFFFFU</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Acceptance Mode of Legacy FIFO (not used)*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CAN_LEGACY_FIFO_FORMAT_A</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Legacy FIFO Warning Notification */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NULL_PTR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Legacy FIFO Overflow Notification */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NULL_PTR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Enhanced FIFO Overflow Notification */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NULL_PTR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Error interrupt enable or not */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">TRUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Can Error Notification */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Can_ErrorNotif</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* CanFd Error Notification */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        CanFd_ErrorNotif</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Default Baudrate ID, 4--1M+5M 5--1M+8M */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">4U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token comment" style="color:#999988;font-style:italic">/* Baudrate config Count*/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">6U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Pointer to baudrate config Structure */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Can_aBaudrateConfig_Ctrl5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Pointer to LLD structure to IP config */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">Flexcan_aCtrlConfigPB</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">5U</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* HwObject count */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">9U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Point to group of HwObject that referenced to the current Controller */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Can_apHwObject_Ctrl5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ul>
<li>Can_aBaudrateConfig_Ctrl5：用于定义特定控制器的波特率配置，这是一个大数组，上述步骤中生成的参数均写到这个数组中</li>
</ul>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Can_BaudrateConfigType Can_aBaudrateConfig_Ctrl5</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">6U</span><span class="token punctuation" style="color:#393A34">]</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/*Enhance CBT support */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">TRUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Tx Bit Rate Switch or not */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">TRUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* CanFd support */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">TRUE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Nominal bit rate */</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//仲裁段配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">6U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 传播段(prop_seg)‌</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">7U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 相位缓冲段1(phase_seg1)‌</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">3U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 相位缓冲段2(phase_seg2)‌</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">3U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 预分频值（Prescaler）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">1U</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//同步跳转宽度(SJW)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Data bit rate */</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">//数据段配置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">3U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">3U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">1U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">3U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">1U</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Tx Arbitration Start delay */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">12U</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 延迟补偿偏移量(Transceiver Delay Compensation Offset)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* Tranceiver Delay Disable */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">boolean</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">FALSE</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">uint8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token number" style="color:#36acaa">0U</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><br></span></code></pre></div></div>
<p>RDK S100默认配置了6组参数，用户可以通过修改Can_aControllerConfig中的u16DefaultBaudrateID成员值来选择波特率,下表为索引对应的波特率参数：</p>
<table><thead><tr><th>u16DefaultBaudrateID</th><th>仲裁段频率</th><th>数据段频率</th></tr></thead><tbody><tr><td>0</td><td>500K</td><td>1M</td></tr><tr><td>1</td><td>500K</td><td>2M</td></tr><tr><td>2</td><td>1M</td><td>2M</td></tr><tr><td>3</td><td>1M</td><td>5M（短距离:小于50m）</td></tr><tr><td>4</td><td>1M</td><td>5M（长距离:大于50m）</td></tr><tr><td>5</td><td>1M</td><td>8M</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="应用sample">应用sample<a href="#应用sample" class="hash-link" aria-label="应用sample的直接链接" title="应用sample的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用指南">使用指南<a href="#使用指南" class="hash-link" aria-label="使用指南的直接链接" title="使用指南的直接链接">​</a></h3>
<p>MCU侧CAN2IPC源码目录：mcu/Service/HouseKeeping/can_ipc/src/hb_CAN2IPC.c</p>
<ul>
<li>源码中hb_CAN2IPC_MainFunction函数被OS周期性调用，其内部通过调用hb_CAN2IPC_Proc 函数将指定的CAN控制器数据通过IPC转发到Acore。</li>
<li>hb_CAN2IPC_Proc 函数中三个传入参数分别为：CAN控制器、ipc instance、ipc 指定instance下的虚拟chennel。</li>
</ul>
<p>S100 默认将CAN5~CAN9 转发给ACORE，示例如下</p>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">hb_CAN2IPC_MainFunction</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">hb_CAN2IPC_Proc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CANTRANS_INS0CH5_CONTROLLER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_IpcInstance_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_0_IpcChannel_4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//CAN4 for chassis,map to ipc channel 4 and 5，for Acore vechileio and pnc</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">hb_CAN2IPC_Proc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CANTRANS_INS0CH6_CONTROLLER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_IpcInstance_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_0_IpcChannel_6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//CAN6 for radar, map to ipc channel 6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">hb_CAN2IPC_Proc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CANTRANS_INS0CH7_CONTROLLER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_IpcInstance_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_0_IpcChannel_7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//CAN7 for radar, map to ipc channel 7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">hb_CAN2IPC_Proc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CANTRANS_INS0CH8_CONTROLLER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_IpcInstance_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_0_IpcChannel_2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//CAN8 for radar, map to ipc channel 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">hb_CAN2IPC_Proc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">CANTRANS_INS0CH9_CONTROLLER</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_IpcInstance_0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> IpcConf_IpcInstance_0_IpcChannel_3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">//CAN9 for radar, map to ipc channel 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Acore canhal使用可参考sample源码目录：<code>source/hobot-io-samples/debian/app/Can</code>，可以在S100的<code>/app/Can</code>目录下直接make编译使用。</p>
<p>以多路透传为例，目录结构如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree /app/Can/can_multi_ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── channels.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ipcf_channel.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── nodes.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── main.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── readme.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── run.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>json文件配置主要包括3个json配置文件：node.json、ipcf_channel.json、channels.json。目前为了支持多进程，各个进程都会去当前路径下的config目录下寻找这3个配置文件。</p>
<p>node.json负责创建虚拟CAN设备节点给CANHAL API访问。关键配置选项包括：</p>
<ul>
<li>channel_id字段指定该虚拟CAN设备从ipc配置文件ipcf_channel.json中哪一个节点获取数据。</li>
<li>target字段表示该虚拟CAN设备节点的名称，CANHAL API通过该名称访问指定的节点。</li>
<li>enable字段表示该节点是否使能。</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;nodes&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;enable&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;mode_comment&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;value_table: R, W, RW&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;mode&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RW&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;target&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;can6_ins0ch6&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;clk_source&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/dev/hrtc0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;io_channel&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;device_type_comment&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;value_table: can, eth, ipcf, spi&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;device_type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ipcf&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;channel_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;raw_protocol&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;built_1.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    .....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;enable&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;mode_comment&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;value_table: R, W, RW&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;mode&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RW&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;target&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;can5_ins0ch4&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;clk_source&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/dev/hrtc0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;io_channel&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;device_type_comment&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;value_table: can, eth, ipcf, spi&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;device_type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ipcf&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;channel_id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;raw_protocol&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;built_1.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>ipcf_channel.json将node.json中用到的ipc节点映射到具体的instance和channel。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;enable&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;libipcf_path&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/usr/hobot/lib/libhbipcfhal.so.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;channels&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;channel&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;can6_ins0ch6&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;instance&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;channel&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;fifo_size&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;fifo_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;pkg_size_max&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;dev_path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;/dev/ipcdrv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;dev_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;ipcdrv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;recv_timeout&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ......</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;channel&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;can5_ins0ch4&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;instance&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;channel&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;fifo_size&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;fifo_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;pkg_size_max&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;dev_path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;/dev/ipcdrv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;dev_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;ipcdrv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;recv_timeout&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>channels.json指定ipc配置文件，用户一般不需要更改。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;io_channels&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token property" style="color:#36acaa">&quot;ipcf&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;./config/ipcf_channel.json&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Acore无法直接操作CAN外设，需要通过借助Ipc模块来中转数据，与外设通道的映射关系可以查阅 <a href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_ipc">MCU IPC使用指南</a> 中的IPC 使用情况章节。</p>
<p>Acore应用程序通过CANHAL获取MCU侧CAN帧的流程伪代码如下：</p>
<div class="language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">send_frame_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> count </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> count</span><span class="token operator" style="color:#393A34">--</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">canSendMsgFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">test_params</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">frame</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token function" style="color:#d73a49">recv_frame_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">arg</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">exit_flag</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">canRecvMsgFrame</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">target</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> frame</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">pack</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// non blocking</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	ret </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">canInit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">pthread_create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">send_thread</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> send_frame_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">tx_params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">pthread_create</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rx_threads</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> recv_frame_data</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">rx_params</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">pthread_join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">send_thread</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">pthread_join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">rx_threads</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">NULL</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token function" style="color:#d73a49">canDeInit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<ul>
<li>首先执行canInit()完成初始化,然后创建发送线程和接收线程</li>
<li>发送线程调用canSendMsgFrame()发送数据包，接收线程调用canRecvMsgFrame()接收数据包，其中target参数为json文件中配置好的通道。</li>
<li>pack信息包含这一包数据的信息，包括can帧数量、mcu侧的时间戳以及acore侧的monotic时间戳等信息。</li>
<li>canhal会从这一包ipc数据中解析出can帧，用户通过frame指针读取出所有can帧。</li>
<li>最后执行canDeInit()释放资源。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="acore侧实例说明">ACORE侧实例说明<a href="#acore侧实例说明" class="hash-link" aria-label="ACORE侧实例说明的直接链接" title="ACORE侧实例说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="简单的can收发sample">简单的can收发sample<a href="#简单的can收发sample" class="hash-link" aria-label="简单的can收发sample的直接链接" title="简单的can收发sample的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="目录介绍">目录介绍<a href="#目录介绍" class="hash-link" aria-label="目录介绍的直接链接" title="目录介绍的直接链接">​</a></h5>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// /app/Can/can_send</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile // 主编译脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── canhal_send.c // 发送一帧标准帧数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── config // 配置文件目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── channels.json  // 通道映射配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── ipcf_channel.json  // 通道映射配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── nodes.json // 通道映射配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// /app/Can/can_get</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile // 主编译脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── canhal_get.c // while 1循环，接收数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── config // 配置文件目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── channels.json   // 通道映射配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── ipcf_channel.json  // 通道映射配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── nodes.json  // 通道映射配置文件</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用前提">使用前提<a href="#使用前提" class="hash-link" aria-label="使用前提的直接链接" title="使用前提的直接链接">​</a></h5>
<p>这里仅给出一个简单的sample，实际应用中需要根据实际需求进行修改。</p>
<p>使用前提：</p>
<ul>
<li>MCU1正常运行</li>
<li>硬件连接：使用CAN闭环总线网络，CAN5连接CAN6，CAN_H和CAN_L之间接入120欧姆电阻（CAN5和CAN6接线柱后面的2 PIN引脚使用跳线帽或杜邦线短接）。</li>
<li>由于can_send和can_get都使用的instance channel4(默认映射来自CAN5的数据)，<strong>由于Ipc单个channel只能被一个线程使用</strong>，因此修改can_send中的ipcf_channel.json，改为使用instance channel6，改动如下</li>
</ul>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;enable&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;libipcf_path&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/usr/hobot/lib/libhbipcfhal.so.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;channels&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;channel&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bypass&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;instance&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;channel&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 这里由4改成了6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;fifo_size&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">64000</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;fifo_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;pkg_size_max&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4096</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;dev_path&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;/dev/ipcdrv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;dev_name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;ipcdrv&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;recv_timeout&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="使用方式">使用方式<a href="#使用方式" class="hash-link" aria-label="使用方式的直接链接" title="使用方式的直接链接">​</a></h5>
<ol>
<li>分别编译can_send和can_get两个sample</li>
<li>进入can_get目录执行以下命令</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./canhal_get bypass &amp;</span><br></span></code></pre></div></div>
<ol start="3">
<li>进入can_send目录执行以下命令</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:/app/Can/can_send# ./canhal_send bypass 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CANHAL][INFO][ipcf_dev.cpp:32][2025-2-20 21:43:47.522]:the path of ipcf plugin is /usr/hobot/lib/libhbipcfhal.so.1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">group name is bypass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CANHAL][INFO][comps_mgr.cpp:158][2025-2-20 21:43:47.523]:channel constructor Register dev: ipcf success.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CANHAL][INFO][node.cpp:17][2025-2-20 21:43:47.523]:channel id is 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][hb_ipcf_hal.cpp:282] [channel] bypass [ins] 0 [id] 6 init success.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][hb_ipcf_hal.cpp:333] [channel] bypass [ins] 0 [id] 6 config success.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CANHAL][INFO][node.cpp:39][2025-2-20 21:43:47.523]:io_channel init successful</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CANHAL][INFO][node.cpp:44][2025-2-20 21:43:47.523]:protocol is built_1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Send end, send package total: 1 frame total: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CANHAL][INFO][can_hal_impl.cpp:120][2025-2-20 21:43:47.524]:Deinit node: bypass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[INFO][hb_ipcf_hal.cpp:553] [channel] bypass [ins] 0 [id] 6 deinit success.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CANHAL][INFO][can_hal_impl.cpp:128][2025-2-20 21:43:47.524]:Deinit node: bypass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[CANHAL][INFO][channel_ctor.cpp:47][2025-2-20 21:43:47.524]:Deinit device: ipcf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*********************************************</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[bypass] [pack]length: 1 soc_ts: 1186831 mcu_ts: 1191955</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[canhal_get] [bypass] [canframe] canid is 0x00000131 timestamp is 0x123013 data is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0  0xaa  0xaa  0xaa  0xaa  0xaa  0xaa  0xfc</span><br></span></code></pre></div></div>
<ol start="4">
<li>出现如下打印则测试成功：</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[canhal_get] [bypass] [canframe] canid is 0x00000131 timestamp is 0x10b221 data is:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 0x0  0xaa  0xaa  0xaa  0xaa  0xaa  0xaa  0xfc</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="多通道传输">多通道传输<a href="#多通道传输" class="hash-link" aria-label="多通道传输的直接链接" title="多通道传输的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="目录介绍-1">目录介绍<a href="#目录介绍-1" class="hash-link" aria-label="目录介绍的直接链接" title="目录介绍的直接链接">​</a></h5>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// /app/Can/can_multi_ch</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── Makefile // 主编译脚本</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── config  // 配置文件目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── channels.json // 通道映射配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ipcf_channel.json // IPCF通道映射配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── nodes.json // Can虚拟设备映射配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── main.cpp // 主程序</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── readme.md // 说明文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── run.sh // 运行脚本</span><br></span></code></pre></div></div>
<p>本程序实现CAN总线多通道数据发送与接收：</p>
<ul>
<li><strong>硬件连接</strong>：使用CAN闭环总线网络，Can6连接Can7， Can8连接Can9，Can5单独通道不接，CAN_H和CAN_L之间接入120欧姆电阻（把所用到的CAN总线的接线柱后面的2 PIN引脚使用跳线帽或杜邦线短接）。</li>
<li><strong>发送线程</strong>：为每个通道创建独立线程发送数据，当使用CANFD时，数据包含计数器和时间戳,当使用经典CAN时，数据为全0x55。</li>
<li><strong>接收线程</strong>：为每个通道创建独立线程接收数据并验证数据正确性。</li>
</ul>
<p>发送策略：</p>
<ul>
<li>相隔固定时间通过CAN发送数据，可通过修改延时调整发送频率，目前测试4路CAN的收发，每路CAN的最高发送频率为1000Hz，大于时会出现丢包情况。</li>
<li>数据内容：通过CANFD发送扩展帧(64bytes)的数据。</li>
<li>目标通道：CAN6~CAN9轮询发送</li>
</ul>
<p>接收策略:</p>
<ul>
<li>被动接收数据，不进行数据处理</li>
<li>超过5s未  收到数据则退出程序</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="依赖">依赖<a href="#依赖" class="hash-link" aria-label="依赖的直接链接" title="依赖的直接链接">​</a></h5>
<ul>
<li><code>pthread</code>线程库</li>
<li><code>hobot_can_hal</code> CAN接口库</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="通道映射关系">通道映射关系<a href="#通道映射关系" class="hash-link" aria-label="通道映射关系的直接链接" title="通道映射关系的直接链接">​</a></h5>
<table><thead><tr><th>通道</th><th>对应线程名称</th><th>设备名</th></tr></thead><tbody><tr><td>CAN5</td><td>CAN5RX</td><td>&quot;can5_ins0ch4&quot;</td></tr><tr><td>CAN6</td><td>CAN6RX</td><td>&quot;can6_ins0ch6&quot;</td></tr><tr><td>CAN7</td><td>CAN7RX</td><td>&quot;can7_ins0ch7&quot;</td></tr><tr><td>CAN8</td><td>CAN8RX</td><td>&quot;can8_ins0ch2&quot;</td></tr><tr><td>CAN9</td><td>CAN9RX</td><td>&quot;can9_ins0ch3&quot;</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="debug开关">DEBUG开关<a href="#debug开关" class="hash-link" aria-label="DEBUG开关的直接链接" title="DEBUG开关的直接链接">​</a></h5>
<div class="language-C language-c codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">define</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property macro-name" style="color:#36acaa">VERBOSE</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property expression number" style="color:#36acaa">0</span><span class="token macro property expression" style="color:#36acaa"> </span><span class="token macro property comment" style="color:#999988;font-style:italic">//修改为1时打印调试信息</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="编译命令">编译命令<a href="#编译命令" class="hash-link" aria-label="编译命令的直接链接" title="编译命令的直接链接">​</a></h5>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make # 编译</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">make clean # 清除编译文件</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="运行命令">运行命令<a href="#运行命令" class="hash-link" aria-label="运行命令的直接链接" title="运行命令的直接链接">​</a></h5>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">./can_multi_ch</span><br></span></code></pre></div></div>
<p>观察log可以看到收发数据的基本情况</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>持续更新中</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="多can组网传输">多can组网传输<a href="#多can组网传输" class="hash-link" aria-label="多can组网传输的直接链接" title="多can组网传输的直接链接">​</a></h4>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>持续更新中</p></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="应用层修改can波特率等配置">应用层修改can波特率等配置<a href="#应用层修改can波特率等配置" class="hash-link" aria-label="应用层修改can波特率等配置的直接链接" title="应用层修改can波特率等配置的直接链接">​</a></h4>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>持续更新中</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="库文件打印开关">库文件打印开关<a href="#库文件打印开关" class="hash-link" aria-label="库文件打印开关的直接链接" title="库文件打印开关的直接链接">​</a></h3>
<p>CAN_HAL_DEBUG_LEVEL 是一个环境变量，用于控制库文件libhbcanhal.so日志输出的级别。它的不同值代表不同的日志级别，这些级别决定了哪些日志信息会被记录下来</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0 (log_trace): 跟踪级别。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1 (log_debug): 调试级别。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2 (log_info): 信息级别。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 (log_warn): 警告级别。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4 (log_err): 错误级别。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 (log_critical): 致命级 别。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">6 (log_never): 不打印任何日志。</span><br></span></code></pre></div></div>
<p>通过设置 CAN_HAL_DEBUG_LEVEL 的值，可以控制日志输出的详细程度。例如，如果设置为 2，那么只有 log_info、log_warn、log_err 和 log_critical 级别的日志会被打印</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mcu侧debug应用说明">MCU侧DEBUG应用说明<a href="#mcu侧debug应用说明" class="hash-link" aria-label="MCU侧DEBUG应用说明的直接链接" title="MCU侧DEBUG应用说明的直接链接">​</a></h3>
<ol>
<li>进入MCU1的控制台</li>
<li>输入命令：can_tran_debug</li>
</ol>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">D-Robotics:/$ can_tran_debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.785483 0]Ipc2Can Statistics: // IPC 收到的数据包统计</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.785712 0]Channel 0 FifoOverflowCnt:          0 MsgOverLengthCnt:          0 MsgCRCErrCnt:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.786895 0]Channel 1 FifoOverflowCnt:          0 MsgOverLengthCnt:          0 MsgCRCErrCnt:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.788077 0]Channel 2 FifoOverflowCnt:          0 MsgOverLengthCnt:          0 MsgCRCErrCnt:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.789260 0]Channel 3 FifoOverflowCnt:          0 MsgOverLengthCnt:          0 MsgCRCErrCnt:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.790443 0]Channel 4 FifoOverflowCnt:          0 MsgOverLengthCnt:          0 MsgCRCErrCnt:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.791625 0]Channel 5 FifoOverflowCnt:          0 MsgOverLengthCnt:          0 MsgCRCErrCnt:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.792808 0]Channel 6 FifoOverflowCnt:          0 MsgOverLengthCnt:          0 MsgCRCErrCnt:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.793991 0]Channel 7 FifoOverflowCnt:          0 MsgOverLengthCnt:          0 MsgCRCErrCnt:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.796039 0]Soc2Can Statistics: // 解包之后的数据统计</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.796268 0]RecvAllNum: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.796605 0]RollCntErr: 3 // 此错误不影响，当acore端应用发送数据填写好有序的序号时，此错误将消失。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.796941 0]InvaildChannelErr: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.798140 0]CanLengthErr: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.798424 0]CanDisableErr: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.798793 0]RecvNum[0]: 0, OverFlowErr[0]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.800115 0]RecvNum[1]: 0, OverFlowErr[1]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.800570 0]RecvNum[2]: 0, OverFlowErr[2]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.801112 0]RecvNum[3]: 0, OverFlowErr[3]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.802343 0]RecvNum[4]: 0, OverFlowErr[4]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.802886 0]RecvNum[5]: 0, OverFlowErr[5]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.804158 0]RecvNum[6]: 1, OverFlowErr[6]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.804661 0]RecvNum[7]: 1, OverFlowErr[7]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.806059 0]RecvNum[8]: 1, OverFlowErr[8]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.806435 0]RecvNum[9]: 1, OverFlowErr[9]: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.806978 0]Hb_CanIf Statistics: // CAN控制器收发数据统计</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.808159 0]Can 0 RxNum:          0 TxNum:          0 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.809520 0]Can 1 RxNum:          0 TxNum:          0 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.810941 0]Can 2 RxNum:          0 TxNum:          0 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.812362 0]Can 3 RxNum:          0 TxNum:          0 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.813784 0]Can 4 RxNum:          0 TxNum:          0 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.815205 0]Can 5 RxNum:          4 TxNum:          0 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.816626 0]Can 6 RxNum:          3 TxNum:          1 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.818048 0]Can 7 RxNum:          3 TxNum:          1 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.819469 0]Can 8 RxNum:          3 TxNum:          1 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[01217.820891 0]Can 9 RxNum:          3 TxNum:          1 RxOverFlowErr:          0 TxCanBusyErr:          0 TxPduErr:          0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="应用程序接口">应用程序接口<a href="#应用程序接口" class="hash-link" aria-label="应用程序接口的直接链接" title="应用程序接口的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_initconst-can_configtype-config">void Can_Init(const Can_ConfigType* Config)<a href="#void-can_initconst-can_configtype-config" class="hash-link" aria-label="void Can_Init(const Can_ConfigType* Config)的直接链接" title="void Can_Init(const Can_ConfigType* Config)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function initializes the module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Config: Pointer to driver configuration.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：None</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_getversioninfostd_versioninfotype-versioninfo">void Can_GetVersionInfo(Std_VersionInfoType* versioninfo)<a href="#void-can_getversioninfostd_versioninfotype-versioninfo" class="hash-link" aria-label="void Can_GetVersionInfo(Std_VersionInfoType* versioninfo)的直接链接" title="void Can_GetVersionInfo(Std_VersionInfoType* versioninfo)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：Returns the version information of this module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    versioninfo: Pointer to where to store the version information of this module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：None</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_deinitvoid">void Can_DeInit(void)<a href="#void-can_deinitvoid" class="hash-link" aria-label="void Can_DeInit(void)的直接链接" title="void Can_DeInit(void)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function de-initializes the module.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：None</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="std_returntype-can_setcontrollermodeuint8-controller-can_controllerstatetype-transition">Std_ReturnType Can_SetControllerMode(uint8 Controller, Can_ControllerStateType Transition)<a href="#std_returntype-can_setcontrollermodeuint8-controller-can_controllerstatetype-transition" class="hash-link" aria-label="Std_ReturnType Can_SetControllerMode(uint8 Controller, Can_ControllerStateType Transition)的直接链接" title="Std_ReturnType Can_SetControllerMode(uint8 Controller, Can_ControllerStateType Transition)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function performs software triggered state transitions of the CAN controller State machine.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Controller: CAN controller for which the status shall be changed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Transition: Transition value to request new CAN controller state.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：Std_ReturnType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	E_OK: request accepted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_NOT_OK: request not accepted, a development error occurred.</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_disablecontrollerinterruptsuint8-controller">void Can_DisableControllerInterrupts(uint8 Controller)<a href="#void-can_disablecontrollerinterruptsuint8-controller" class="hash-link" aria-label="void Can_DisableControllerInterrupts(uint8 Controller)的直接链接" title="void Can_DisableControllerInterrupts(uint8 Controller)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function disables all interrupts for this CAN controller.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Controller: CAN controller for which interrupts shall be disabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：None</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_enablecontrollerinterruptsuint8-controller">void Can_EnableControllerInterrupts(uint8 Controller)<a href="#void-can_enablecontrollerinterruptsuint8-controller" class="hash-link" aria-label="void Can_EnableControllerInterrupts(uint8 Controller)的直接链接" title="void Can_EnableControllerInterrupts(uint8 Controller)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function enables all allowed interrupts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Controller: CAN controller for which interrupts shall be re-enabled.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：None</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="std_returntype-can_getcontrollererrorstateuint8-controllerid-can_errorstatetype-errorstateptr">Std_ReturnType Can_GetControllerErrorState(uint8 ControllerId, Can_ErrorStateType* ErrorStatePtr)<a href="#std_returntype-can_getcontrollererrorstateuint8-controllerid-can_errorstatetype-errorstateptr" class="hash-link" aria-label="Std_ReturnType Can_GetControllerErrorState(uint8 ControllerId, Can_ErrorStateType* ErrorStatePtr)的直接链接" title="Std_ReturnType Can_GetControllerErrorState(uint8 ControllerId, Can_ErrorStateType* ErrorStatePtr)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This service obtains the error state of the CAN controller.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ControllerId: Abstracted CanIf ControllerId which is assigned to a CAN controller, which is requested for ErrorState.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ErrorStatePtr:Pointer to a memory location, where the error state of the CAN controller will be stored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：Std_ReturnType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	E_OK: Error state request has been accepted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_NOT_OK: Error state request has not been accepted.</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="std_returntype-can_getcontrollermodeuint8-controller-can_controllerstatetype-controllermodeptr">Std_ReturnType Can_GetControllerMode(uint8 Controller, Can_ControllerStateType* ControllerModePtr)<a href="#std_returntype-can_getcontrollermodeuint8-controller-can_controllerstatetype-controllermodeptr" class="hash-link" aria-label="Std_ReturnType Can_GetControllerMode(uint8 Controller, Can_ControllerStateType* ControllerModePtr)的直接链接" title="Std_ReturnType Can_GetControllerMode(uint8 Controller, Can_ControllerStateType* ControllerModePtr)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This service reports about the current status of the requested CAN controller.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Controller: CAN controller for which the status shall be requested.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ControllerModePtr: Pointer to a memory location, where the current mode of the CAN controller will be stored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：Std_ReturnType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_OK: Controller mode request has been accepted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_NOT_OK: Controller mode request has not been accepted.</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="std_returntype-can_getcontrollerrxerrorcounteruint8-controllerid-uint8-rxerrorcounterptr">Std_ReturnType Can_GetControllerRxErrorCounter(uint8 ControllerId, uint8* RxErrorCounterPtr)<a href="#std_returntype-can_getcontrollerrxerrorcounteruint8-controllerid-uint8-rxerrorcounterptr" class="hash-link" aria-label="Std_ReturnType Can_GetControllerRxErrorCounter(uint8 ControllerId, uint8* RxErrorCounterPtr)的直接链接" title="Std_ReturnType Can_GetControllerRxErrorCounter(uint8 ControllerId, uint8* RxErrorCounterPtr)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：Returns the Rx error counter for a CAN controller.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             This value might not be available for all CAN controllers, in which case E_NOT_OK would be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             returned.Please note that the value of the counter might not be correct at the moment the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             API returns it, because the Rx counter is handled as ynchronously in hardware.Applications</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             should not trust this value for any assumption about the current bus state.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ControllerId: CAN controller, whose current Rx error counter shall be acquired.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RxErrorCounterPtr: Pointer to a memory location, where the current Rx error counter of the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       CAN controller will be stored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：Std_ReturnType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_OK: Rx error counter available.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_NOT_OK: Wrong ControllerId, or Rx error counter not available.</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="std_returntype-can_getcontrollertxerrorcounteruint8-controllerid-uint8-txerrorcounterptr">Std_ReturnType Can_GetControllerTxErrorCounter(uint8 ControllerId, uint8* TxErrorCounterPtr)<a href="#std_returntype-can_getcontrollertxerrorcounteruint8-controllerid-uint8-txerrorcounterptr" class="hash-link" aria-label="Std_ReturnType Can_GetControllerTxErrorCounter(uint8 ControllerId, uint8* TxErrorCounterPtr)的直接链接" title="Std_ReturnType Can_GetControllerTxErrorCounter(uint8 ControllerId, uint8* TxErrorCounterPtr)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：Returns the Tx error counter for a CAN controller. This value might not be available</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             for all CAN controllers, in which case E_NOT_OK would be returned.Please note that the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             value of the counter might not be correct at the moment the API returns it, because the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             Tx counter is handled as ynchronously in hardware.Applications should not trust this</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             value for any assumption about the current bus state.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ControllerId: CAN controller, whose current Rx error counter shall be acquired.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TxErrorCounterPtr:Pointer to a memory location, where the current Tx error counter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      of the CAN controller will be stored.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：Std_ReturnType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_OK: Rx error counter available.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_NOT_OK: Wrong ControllerId, or Rx error counter not available.</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="std_returntypecan_writecan_hwhandletype-hth-const-can_pdutype-pduinfo">Std_ReturnTypeCan_Write(Can_HwHandleType Hth, const Can_PduType* PduInfo)<a href="#std_returntypecan_writecan_hwhandletype-hth-const-can_pdutype-pduinfo" class="hash-link" aria-label="Std_ReturnTypeCan_Write(Can_HwHandleType Hth, const Can_PduType* PduInfo)的直接链接" title="Std_ReturnTypeCan_Write(Can_HwHandleType Hth, const Can_PduType* PduInfo)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function is called by CanIf to pass a CAN message to CanDrv for tran smission.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Hth:information which HW-transmit handle shall be used for transmit.Implicitly this is</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        also the information about the controller to use because the Hth numbers are unique</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        inside one hardware unit.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：Std_ReturnType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_OK: Write command has been accepted.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    E_NOT_OK: development error occurred.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CAN_BUSY: No TX hardware buffer available or pre-emptive call of Can_Write that can’t be</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              implemented re-entrant (see Can_ReturnType).</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_mainfunction_writevoid">void Can_MainFunction_Write(Void)<a href="#void-can_mainfunction_writevoid" class="hash-link" aria-label="void Can_MainFunction_Write(Void)的直接链接" title="void Can_MainFunction_Write(Void)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function performs the polling of TX confirmation when CAN_TX_PROCESSING</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             is set to POLLING.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value: None</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_mainfunction_readvoid">void Can_MainFunction_Read(Void)<a href="#void-can_mainfunction_readvoid" class="hash-link" aria-label="void Can_MainFunction_Read(Void)的直接链接" title="void Can_MainFunction_Read(Void)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：Returns the value of the specified CAN channel.This function performs the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             polling of RX indications when CAN_RX_PROCESSING is set to POLLING.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：None</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_mainfunction_busoffvoid">void Can_MainFunction_BusOff(Void)<a href="#void-can_mainfunction_busoffvoid" class="hash-link" aria-label="void Can_MainFunction_BusOff(Void)的直接链接" title="void Can_MainFunction_BusOff(Void)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function performs the polling of bus-off events that are configured statically</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             as ‘to be polled’.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：None</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="void-can_mainfunction_modevoid">void Can_MainFunction_Mode(Void)<a href="#void-can_mainfunction_modevoid" class="hash-link" aria-label="void Can_MainFunction_Mode(Void)的直接链接" title="void Can_MainFunction_Mode(Void)的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Description：This function performs the polling of CAN controller mode transitions.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sync/Async: Synchronous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(in)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(inout)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Parameters(out)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Return value：None</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2025-09-15T02:00:08.000Z" itemprop="dateModified">2025年9月15日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_ipc"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">IPC使用指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_i2c"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">I2C使用指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#基本概述" class="table-of-contents__link toc-highlight">基本概述</a></li><li><a href="#软件架构" class="table-of-contents__link toc-highlight">软件架构</a></li><li><a href="#硬件连接说明" class="table-of-contents__link toc-highlight">硬件连接说明</a></li><li><a href="#can-filter-配置" class="table-of-contents__link toc-highlight">CAN Filter 配置</a><ul><li><a href="#过滤器的识别" class="table-of-contents__link toc-highlight">过滤器的识别</a></li><li><a href="#one_id_filter单id过滤方式" class="table-of-contents__link toc-highlight">ONE_ID_FILTER（单ID过滤方式）</a></li><li><a href="#range_id_filter范围过滤方式" class="table-of-contents__link toc-highlight">RANGE_ID_FILTER（范围过滤方式）</a></li><li><a href="#two_id_filter双id过滤方式" class="table-of-contents__link toc-highlight">TWO_ID_FILTER（双ID过滤方式）</a></li></ul></li><li><a href="#波特率配置" class="table-of-contents__link toc-highlight">波特率配置</a><ul><li><a href="#取值范围和公式计算" class="table-of-contents__link toc-highlight">取值范围和公 式计算</a></li><li><a href="#配置仲裁段1m数据段5m实例说明" class="table-of-contents__link toc-highlight">配置仲裁段1M数据段5M实例说明</a><ul><li><a href="#1-基础参数确认" class="table-of-contents__link toc-highlight">1. 基础参数确认</a></li><li><a href="#2-时间量子tq分配" class="table-of-contents__link toc-highlight">2. 时间量子（TQ）分配</a></li><li><a href="#3-延迟补偿偏移量transceiver-delay-compensation-offset" class="table-of-contents__link toc-highlight">3. 延迟补偿偏移量（Transceiver Delay Compensation Offset）</a></li><li><a href="#4-终配置参数" class="table-of-contents__link toc-highlight">4. 终配置参数</a></li><li><a href="#5-8m的配置相对于5m较为特殊使用60的采样" class="table-of-contents__link toc-highlight">5. 8M的配置相对于5M较为特殊，使用60%的采样</a></li><li><a href="#6-将结果更新到配置文件中" class="table-of-contents__link toc-highlight">6. 将结果更新到配置文件中</a></li></ul></li></ul></li><li><a href="#应用sample" class="table-of-contents__link toc-highlight">应用sample</a><ul><li><a href="#使用指南" class="table-of-contents__link toc-highlight">使用指南</a></li><li><a href="#acore侧实例说明" class="table-of-contents__link toc-highlight">ACORE侧实例说明</a><ul><li><a href="#简单的can收发sample" class="table-of-contents__link toc-highlight">简单的can收发sample</a><ul><li><a href="#目录介绍" class="table-of-contents__link toc-highlight">目录介绍</a></li><li><a href="#使用前提" class="table-of-contents__link toc-highlight">使用前提</a></li><li><a href="#使用方式" class="table-of-contents__link toc-highlight">使用方式</a></li></ul></li><li><a href="#多通道传输" class="table-of-contents__link toc-highlight">多通道传输</a><ul><li><a href="#目录介绍-1" class="table-of-contents__link toc-highlight">目录介绍</a></li><li><a href="#依赖" class="table-of-contents__link toc-highlight">依赖</a></li><li><a href="#通道映射关系" class="table-of-contents__link toc-highlight">通道映射关系</a></li><li><a href="#debug开关" class="table-of-contents__link toc-highlight">DEBUG开关</a></li><li><a href="#编译命令" class="table-of-contents__link toc-highlight">编译命令</a></li><li><a href="#运行命令" class="table-of-contents__link toc-highlight">运行命令</a></li></ul></li><li><a href="#多can组网传输" class="table-of-contents__link toc-highlight">多can组网传输</a></li><li><a href="#应用层修改can波特率等配置" class="table-of-contents__link toc-highlight">应用层修改can波特率等配置</a></li></ul></li><li><a href="#库文件打印开关" class="table-of-contents__link toc-highlight">库文件打印开关</a></li><li><a href="#mcu侧debug应用说明" class="table-of-contents__link toc-highlight">MCU侧DEBUG应用说明</a></li><li><a href="#应用程序接口" class="table-of-contents__link toc-highlight">应用程序接口</a><ul><li><a href="#void-can_initconst-can_configtype-config" class="table-of-contents__link toc-highlight">void Can_Init(const Can_ConfigType* Config)</a></li><li><a href="#void-can_getversioninfostd_versioninfotype-versioninfo" class="table-of-contents__link toc-highlight">void Can_GetVersionInfo(Std_VersionInfoType* versioninfo)</a></li><li><a href="#void-can_deinitvoid" class="table-of-contents__link toc-highlight">void Can_DeInit(void)</a></li><li><a href="#std_returntype-can_setcontrollermodeuint8-controller-can_controllerstatetype-transition" class="table-of-contents__link toc-highlight">Std_ReturnType Can_SetControllerMode(uint8 Controller, Can_ControllerStateType Transition)</a></li><li><a href="#void-can_disablecontrollerinterruptsuint8-controller" class="table-of-contents__link toc-highlight">void Can_DisableControllerInterrupts(uint8 Controller)</a></li><li><a href="#void-can_enablecontrollerinterruptsuint8-controller" class="table-of-contents__link toc-highlight">void Can_EnableControllerInterrupts(uint8 Controller)</a></li><li><a href="#std_returntype-can_getcontrollererrorstateuint8-controllerid-can_errorstatetype-errorstateptr" class="table-of-contents__link toc-highlight">Std_ReturnType Can_GetControllerErrorState(uint8 ControllerId, Can_ErrorStateType* ErrorStatePtr)</a></li><li><a href="#std_returntype-can_getcontrollermodeuint8-controller-can_controllerstatetype-controllermodeptr" class="table-of-contents__link toc-highlight">Std_ReturnType Can_GetControllerMode(uint8 Controller, Can_ControllerStateType* ControllerModePtr)</a></li><li><a href="#std_returntype-can_getcontrollerrxerrorcounteruint8-controllerid-uint8-rxerrorcounterptr" class="table-of-contents__link toc-highlight">Std_ReturnType Can_GetControllerRxErrorCounter(uint8 ControllerId, uint8* RxErrorCounterPtr)</a></li><li><a href="#std_returntype-can_getcontrollertxerrorcounteruint8-controllerid-uint8-txerrorcounterptr" class="table-of-contents__link toc-highlight">Std_ReturnType Can_GetControllerTxErrorCounter(uint8 ControllerId, uint8* TxErrorCounterPtr)</a></li><li><a href="#std_returntypecan_writecan_hwhandletype-hth-const-can_pdutype-pduinfo" class="table-of-contents__link toc-highlight">Std_ReturnTypeCan_Write(Can_HwHandleType Hth, const Can_PduType* PduInfo)</a></li><li><a href="#void-can_mainfunction_writevoid" class="table-of-contents__link toc-highlight">void Can_MainFunction_Write(Void)</a></li><li><a href="#void-can_mainfunction_readvoid" class="table-of-contents__link toc-highlight">void Can_MainFunction_Read(Void)</a></li><li><a href="#void-can_mainfunction_busoffvoid" class="table-of-contents__link toc-highlight">void Can_MainFunction_BusOff(Void)</a></li><li><a href="#void-can_mainfunction_modevoid" class="table-of-contents__link toc-highlight">void Can_MainFunction_Mode(Void)</a></li></ul></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">古月居<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">联系我们</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/437998606" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiLiBiLi<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 D-Robotics.</div></div></div></footer></div>
</body>
</html>