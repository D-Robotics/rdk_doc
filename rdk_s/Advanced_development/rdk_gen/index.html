<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-docs_s docs-version-current docs-doc-page docs-doc-id-Advanced_development/rdk_gen" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">7.6 RDK S100构建系统开发指南 | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/rdk_gen"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" property="og:title" content="7.6 RDK S100构建系统开发指南 | RDK DOC"><meta data-rh="true" name="description" content="7.6.1 概述"><meta data-rh="true" property="og:description" content="7.6.1 概述"><link data-rh="true" rel="icon" href="/rdk_doc/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/rdk_gen"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/rdk_gen" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Advanced_development/rdk_gen" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/rdk_gen" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"7. 进阶开发","item":"https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development"},{"@type":"ListItem","position":2,"name":"7.6 RDK S100构建系统开发指南","item":"https://developer.d-robotics.cc/rdk_doc/rdk_s/Advanced_development/rdk_gen"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/assets/css/styles.0fbd7d27.css">
<script src="/rdk_doc/assets/js/runtime~main.e980b197.js" defer="defer"></script>
<script src="/rdk_doc/assets/js/main.88164765.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a class="navbar__item navbar__link" href="/rdk_doc/RDK">RDK X3 / X5</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>CN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/rdk_s/Advanced_development/rdk_gen" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/rdk_s/Advanced_development/rdk_gen" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/rdk_s/RDK">D-Robotics RDK 套件</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Quick_start">1. 快速开始</a><button aria-label="展开侧边栏分类 &#x27;1. 快速开始&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/System_configuration">2. 系统配置</a><button aria-label="展开侧边栏分类 &#x27;2. 系统配置&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Basic_Application">3. 基础应用开发</a><button aria-label="展开侧边栏分类 &#x27;3. 基础应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Basic_Development">4. 算法应用开发</a><button aria-label="展开侧边栏分类 &#x27;4. 算法应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Robot_development">5. 机器人应用开发</a><button aria-label="展开侧边栏分类 &#x27;5. 机器人应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Application_case">6. 应用开发指南</a><button aria-label="展开侧边栏分类 &#x27;6. 应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/rdk_s/Advanced_development">7. 进阶开发</a><button aria-label="折叠侧边栏分类 &#x27;7. 进阶开发&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/hardware_development">7.1 硬件开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.1 硬件开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/linux_development">7.2. Linux开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.2. Linux开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/03_multimedia_development">7.3 多媒体开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.3 多媒体开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/04_toolchain_development">7.4 算法工具链开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.4 算法工具链开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/rdk_doc/rdk_s/05_MCU_development">7.5 MCU开发指南</a><button aria-label="展开侧边栏分类 &#x27;7.5 MCU开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/rdk_s/Advanced_development/rdk_gen">7.6 RDK S100构建系统开发指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/FAQ">8. 常见问题</a><button aria-label="展开侧边栏分类 &#x27;8. 常见问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Appendix">9. 附录</a><button aria-label="展开侧边栏分类 &#x27;9. 附录&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/rdk_s/Release_Note/roadmap">10. 版本发布</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/rdk_doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/rdk_s/Advanced_development"><span>7. 进阶开发</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">7.6 RDK S100构建系统开发指南</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>7.6 RDK S100构建系统开发指南</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="761-概述">7.6.1 概述<a href="#761-概述" class="hash-link" aria-label="7.6.1 概述的直接链接" title="7.6.1 概述的直接链接">​</a></h2>
<p>本章节主要针对需要对RDK构建系统进行定制化修改的介绍，rdk_gen的使用说明，请参考rdk_gen仓库的README.md。</p>
<p>基本的使用说明：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 在线镜像构建，从地瓜及第三方APT源下载依赖的deb包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./pack_image.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 离线镜像构建，只安装out/product/deb_packages下的deb包，使用此选项时请确保out/product/deb_packages内的deb符合预期，同时out/product/rootfs_packages下已有预编译根文件系统包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./pack_image.sh -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 仅搭建deb包编译环境，不打包镜像</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./pack_images.sh -p</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 构建所有deb包</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./mk_debs.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 构建特定deb包，以hobot-configs为例</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./mk_debs.sh hobot-configs</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="762-根文件系统预编译包构建说明">7.6.2 根文件系统预编译包构建说明<a href="#762-根文件系统预编译包构建说明" class="hash-link" aria-label="7.6.2 根文件系统预编译包构建说明的直接链接" title="7.6.2 根文件系统预编译包构建说明的直接链接">​</a></h2>
<p>RDK S100的根文件系统由multistrap+chroot构建生成。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="multistrap">multistrap<a href="#multistrap" class="hash-link" aria-label="multistrap的直接链接" title="multistrap的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="官方文档">官方文档<a href="#官方文档" class="hash-link" aria-label="官方文档的直接链接" title="官方文档的直接链接">​</a></h4>
<ul>
<li><a href="https://wiki.debian.org/Multistrap" target="_blank" rel="noopener noreferrer">Debian Wiki | Multistrap</a></li>
<li><a href="https://manpages.debian.org/bookworm/multistrap/multistrap.1.en.html" target="_blank" rel="noopener noreferrer">Debian manpage</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="工具简介">工具简介<a href="#工具简介" class="hash-link" aria-label="工具简介的直接链接" title="工具简介的直接链接">​</a></h4>
<p>总结而言，<code>multistrap</code>是独立于<code>debbootstrap</code>工具的另一套debian/Ubuntu等以apt源为基础生成根文件系统的工具。它基于一个/多个配置文件定义生成根文件系统所使用的apt源，以及需要默认生成哪些包。
与<code>debootstrap</code>最大的区别  有以下几点：</p>
<ol>
<li>灵活性：<code>multistrap</code>允许用户完全自定义新生成的根文件系统内的所有包，包括apt源内标记为必选的包，但是用户需要自行保证根文件系统的完整性和可用性；</li>
<li>生成流程：<code>multistrap</code>不同于<code>debbootstrap</code>，它的生成流程可以概括为以下几个步骤，最大的区别在于第四步，<code>multistrap</code>只进行包的解压缩，没有对包进行配置（也就是执行[pre/post]install脚本）：</li>
<li>读取配置文件</li>
<li>根据配置文件从获取指定的apt源的元数据</li>
<li>根据配置文件尝试下载指定的包</li>
<li>根据配置文件解压缩指定的包
在地瓜提供的<code>multistrap</code>编译脚本中，我们基于实践经验，通过使用<code>binfmt-support + chroot</code>，在sudo权限下实现了对包的配置，以达到用户制作的根文件系统可以直接烧录上板使用。</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置文件简介">配置文件简介<a href="#配置文件简介" class="hash-link" aria-label="配置文件简介的直接链接" title="配置文件简介的直接链接">​</a></h4>
<p><code>multistrap</code>的配置文件支持单文件/多文件两种形式。多文件情况下可以通过“include”字段将基础版本所包含的所有内容添加上后，只针对特定版本进行配置，极大的方便了多文件系统的维护工作。
以下章节内容的配置文件在S100的代码路径：<code>samplefs/configs</code>:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree samplefs/configs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">samplefs/configs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── jammy-base.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── jammy-desktop.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── jammy-server.conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── pip-requirements.list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 directories, 4 files</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="基本格式介绍">基本格式介绍<a href="#基本格式介绍" class="hash-link" aria-label="基本格式介绍的直接链接" title="基本格式介绍的直接链接">​</a></h5>
<p>详细的字段介绍请参考官方文档，这里主要针对地瓜的配置文件中的重要配置进行说明。</p>
<ol>
<li>字段：<code>key1=value1</code>的格式，定义了某个字段“key1”的值为“value1”</li>
<li>字段集（stanza/section）：通过定义“<code>[Some-Section]</code>”来归集从该行开始，到下一个“<code>[Next-Section]</code>”为止中间所有字段为一个“<code>Section</code>”</li>
</ol>
<p>重点字段介绍：</p>
<ul>
<li>include<!-- -->
<ul>
<li>定义需要include的配置文件的路径</li>
</ul>
</li>
<li>bootstrap<!-- -->
<ul>
<li>定义生成根文件系统所使用的apt源和要下载并解压缩的包所在的字段集</li>
</ul>
</li>
<li>aptsources<!-- -->
<ul>
<li>定义生成的根文件系统中路径/etc/sources.list.d/内会保存的apt源所在的字段集。<strong>注意</strong>，这个源不一定需要与bootstrap中用于生成根文件系统的源 保持一致，但我们强烈建议aptsources定义的apt源是bootstrap定义的源的超集。</li>
</ul>
</li>
<li>source/suite/components/omitdebsrc<!-- -->
<ul>
<li>定义apt源使用的关键字。可以参考<a href="https://manpages.ubuntu.com/manpages/xenial/man5/sources.list.5.html" target="_blank" rel="noopener noreferrer">apt源格式定义</a></li>
<li>source：apt源的根链接，与apt源格式的“uri”字段匹配</li>
<li>suite：apt源的suite，与apt源格式的“suite”字段匹配，一般代表该源对应的系统code name+属性，例如Ubuntu的jammy/focal/jammy-updates/jammy-security</li>
<li>components：apt源的component，与apt源格式的“component”字段匹配，同样可以添加多个</li>
<li>omitdebsrc：拉取apt元数据及包时，是否下载deb包对应的src包，一般配置为“true”，即不下载deb包对应的src包，以加速构建。</li>
</ul>
</li>
<li>packages<!-- -->
<ul>
<li>用于定义需要拉取的包的字段，一个packages字段可以定义多个包，包之间以空格分隔，多个packages字段的合集会作为最终的包定义。</li>
</ul>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="多文件配置示例">多文件配置示例<a href="#多文件配置示例" class="hash-link" aria-label="多文件配置示例的直接链接" title="多文件配置示例的直接链接">​</a></h5>
<p>请参考代码路径<code>samplefs/configs/jammy-desktop.conf</code></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rdk-s100的实现">RDK S100的实现<a href="#rdk-s100的实现" class="hash-link" aria-label="RDK S100的实现的直接链接" title="RDK S100的实现的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="配置文件设计">配置文件设计<a href="#配置文件设计" class="hash-link" aria-label="配置文件设计的直接链接" title="配置文件设计的直接链接">​</a></h4>
<p>RDK S100上，multistrap的配置文件默认分为3部分：</p>
<ul>
<li>jammy-base.conf：用于配置RDK S100通用的默认根文件系统配置，包括使用的apt源，RDK S100所有版本默认包含的包等；</li>
<li>jammy-desktop.conf：用于配置RDK S100桌面版根文件系统基于jammy-base.conf新增的包；</li>
<li>jammy-server.conf：用于配置RDK S100服务器版根文件系统基于jammy-base.conf新增的包；</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="构建流程说明">构建流程说明<a href="#构建流程说明" class="hash-link" aria-label="构建流程说明的直接链接" title="构建流程说明的直接链接">​</a></h4>
<p>用户一般使用<code>samplefs/make_ubuntu_samplefs.sh</code>脚本来进行根文件系统的构建，如果使用sudo调用该脚本，则根文件系统构建过程会包括对包的配置，耗时会显著增加。</p>
<p>如果不使用sudo调用该脚本，则构建过程不会包括对包的配置，耗时会相对减少，但是首次启动需要在板端使用命令<code>rm -rf /var/lock/* ; dpkg --configure -a --force-confdef --force-confold ; systemctl enable /etc/systemd/system/S*.service</code>命令来初始化系统并重启以确保系统正常工作。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span><strong>提示</strong></div><div class="admonitionContent_BuS1"><p>推荐<strong>使用sudo</strong>调用samplefs/make_ubuntu_samplefs.sh。</p></div></div>
<p>调用<code>samplefs/make_ubuntu_samplefs.sh</code>脚本需要在samplefs目录下进行。</p>
<p>在不添加参数的情况下直接在使用<code>sudo ./make_ubuntu_samplefs.sh</code>，脚本默认构建桌面版镜像，也就是使用<code>jammy-desktop.conf</code>文件来构建根文件系统。</p>
<p>指定使用的配置文件的命令：<code>sudo ./make_ubuntu_samplefs.sh build &lt;config_file_name&gt;</code>，例如新增的配置文件为：<code>new-desktop.conf</code>，则命令就是：<code>sudo ./make_ubuntu_samplefs.sh build new-desktop.conf</code>，<code>new-desktop.conf</code>文件需要放到<code>samplefs/configs</code>文件夹内。</p>
<p>脚本构建流程图如下：
<img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/06_rdk_gen/samplefs_flowchart.png" alt="samplefs_flowchart" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="裁剪自定义根文件系统的方法">裁剪/自定义根文件系统的方法<a href="#裁剪自定义根文件系统的方法" class="hash-link" aria-label="裁剪/自定义根文件系统的方法的直接链接" title="裁剪/自定义根文件系统的方法的直接链接">​</a></h4>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>apt源(deb包的control信息)中的Priority字段会区分裁剪/自定义的流程。
multistrap默认会将所有Priority为“Required”的包进行安装。
地瓜定义important包也会被安装。</p></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="仅裁剪自定义apt优先级不为importantrequired的包">仅裁剪/自定义apt优先级不为“important”/“required”的包<a href="#仅裁剪自定义apt优先级不为importantrequired的包" class="hash-link" aria-label="仅裁剪/自定义apt优先级不为“important”/“required”的包的直接链接" title="仅 裁剪/自定义apt优先级不为“important”/“required”的包的直接链接">​</a></h5>
<p>用户直接在samplefs/configs/jammy-base.conf等配置文件的各个“packages”字段中删除自己不需要的包，或者定义一个新的字段集，并在“[General]”字段集的“boostrap”字段中去掉原有字段集并添加自己的字段集即可。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="需要裁剪自定义apt优先级为importantrequired的包">需要裁剪/自定义apt优先级为“important”/“required”的包<a href="#需要裁剪自定义apt优先级为importantrequired的包" class="hash-link" aria-label="需要裁剪/自定义apt优先级为“important”/“required”的包的直接链接" title="需要裁剪/自定义apt优先级为“important”/“required”的包的直接链接">​</a></h5>
<p><strong>注意</strong>：一般来说各个apt源的维护者会将他们认为该系统（Ubuntu/Debian的各个版本）的最小集的包的优先级标为“Required”，但是是可以进一步裁剪的。进行这种程度的根文件系统裁剪时，用户需要<strong>自己保证根文件系统的完整性和可用性</strong>。</p>
<p>步骤如下：</p>
<ol>
<li>在<code>[Gerneral]</code>字段集中添加<code>omitrequired=true</code>；</li>
<li>在<code>Packages</code>中对所有需要添加的包进行定义。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="763-rdk-s100-deb包构建流程说明">7.6.3 RDK S100 deb包构建流程说明<a href="#763-rdk-s100-deb包构建流程说明" class="hash-link" aria-label="7.6.3 RDK S100 deb包构建流程说明的直接链接" title="7.6.3 RDK S100 deb包构建流程说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a href="#简介" class="hash-link" aria-label="简介的直接链接" title="简介的直接链接">​</a></h3>
<p>RDK S100默认以deb包的形式来管理用户层的地瓜定制功能。在SDK的source/目录下保存了所有地瓜定制功能的deb包构建的源码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="构建脚本介绍">构建脚本介绍<a href="#构建脚本介绍" class="hash-link" aria-label="构建脚本介绍的直接链接" title="构建脚本介绍的直接链接">​</a></h3>
<p>构建deb的入口脚本为<code>mk_debs.sh</code>，该脚本位于SDK包的根目录。用户可以通过该脚本构建仓库内的deb包。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deb包源码目录">deb包源码目录<a href="#deb包源码目录" class="hash-link" aria-label="deb包源码目录的直接链接" title="deb包源码目录的直接链接">​</a></h3>
<p><code>source</code>下的目录，除<code>bootloader</code>，<code>kernel</code>，<code>hobot-drivers</code>外均为地瓜定制化功能的deb包的构建源码。其中<code>hobot-spdev</code>，<code>hobot-camera</code>，<code>hobot-io</code>等目录内包含了相应动态库的源码，通过mk_debs.sh脚本构建这两个包时，对应的源码会被编译。
deb包源码目录的基本结构（以hobot-configs为例）内会包括：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hobot-configs/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── LICENSE          # deb包源码的License信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md        # deb包的简单说明</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── VERSION          # deb包的版本号，以major.minor.patch的形式保存，编译时默认添加时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── debian           # deb包的根目录，相当于板端安装时的根目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── DEBIAN       # deb包的元数据信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |   ├── postinst # deb包标准脚本之一，在dpkg安装的拷贝步骤后执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── postrm   # deb包标准脚本之一，在dpkg删除的文件删除步骤后执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   ├── preinst  # deb包标准脚本之一，在dpkg安装的拷贝步骤前执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    │   └── prerm    # deb包标准脚本之一，在dpkg删除的文件删除步骤前执行</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── etc          # 具体需要拷贝到根文件系统的文件，根据实际情况创建即可。相对“debian”的目录，就是相对根文件系统的目录，例如这个目录就会被安装到板端/etc目录下</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── lib          # 具体需要拷贝到根文件系统的文件，根据实际情况创建即可。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── usr          # 具体需要拷贝到根文件系统的文件，根据实际情况创建即可。</span><br></span></code></pre></div></div>
<p>包含源码的deb包目录，则会在debian目录之外，新增源码目录，如hobot-camera：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hobot-camera/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── LICENSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── README.md</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── VERSION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── debian</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── DEBIAN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── usr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── drivers             # 需要编译的源码目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── Makefile        # 源码编译的入口Makefile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── deserial        # 源码子目录</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── inc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── sensor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── lib -&gt; ../hobot-multimedia/debian/usr/hobot/lib # 方便编译的源码软连接</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── sensor_calibration       # Sensor tuning库，下列库仅为示例，以实际情况为准</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── lib_imx219_linear.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── tuning_tool              # 地瓜提供的Sensor tuning工具</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── control_tool</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ├── res</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── scripts</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="构建流程说明-1">构建流程说明<a href="#构建流程说明-1" class="hash-link" aria-label="构建流程说明的直接链接" title="构建流程说明的直接链接">​</a></h3>
<p>详细流程请参考<code>mk_debs.sh</code>脚本实现，以下是一个简略的流程图：
<img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/07_Advanced_development/06_rdk_gen/mk_debs_flowchart.png" alt="mk_debs_flowchart" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="自定义deb包流程说明">自定义deb包流程说明<a href="#自定义deb包流程说明" class="hash-link" aria-label="自定义deb包流程说明的直接链接" title="自定义deb包流程说明的直接链接">​</a></h3>
<ol>
<li>在<code>source/</code>文件夹下，新建对应包的包名（dpkg内的package name）命名的文件夹，这里以&quot;new_package&quot;为例；</li>
<li>在<code>source/new_package</code>文件  夹下，新建<code>debian</code>文件夹，里面创建4个脚本文件，这4个脚本文件可以为空：<!-- -->
<ul>
<li>preinst：安装new_package包拷贝前需要执行的脚本；</li>
<li>postinst：安装new_package包拷贝执行完成后需要执行的脚本；</li>
<li>prerm：移除new_package包执行删除命令前需要执行的脚本；</li>
<li>postrm：移除new_package包执行删除命令后需要执行的脚本。</li>
</ul>
</li>
<li>如果需要在<code>mk_debs.sh</code>不带入参时自动对该包进行编译，则在<code>mk_debs.sh</code>脚本的<code>deb_pkg_list</code>变量内添加<code>new_package</code>字段；</li>
<li>在<code>mk_debs.sh</code>脚本的<code>make_debian_deb</code>函数的<code>switch</code>内添加<code>new_package</code>的<code>case</code>：<!-- -->
<ul>
<li>在<code>case</code>内调度<code>gen_control_file</code>函数，生成构建deb包所需要的control文件；</li>
<li>在<code>case</code>内调度<code>sed</code>命令，将默认的“depends”字段替换为真正的deb依赖。假设<code>new_package</code>的依赖为<code>dep_pkg1</code>和<code>dep_pkg2</code>；<!-- -->
<ul>
<li>如果有依赖，则使用<code>sed -i &#x27;s/Depends: .*$/Depends: dep_pkg1,dep_pkg2/&#x27; &quot;${deb_dst_dir}&quot;/DEBIAN/control;</code></li>
<li>如果没有依赖，则使用<code>sed -i &#x27;s/Depends: .*$/Depends: /&#x27; &quot;${deb_dst_dir}&quot;/DEBIAN/control</code>;</li>
</ul>
</li>
<li>(可选)如果该deb在打包前，需要进行源码编译，则进行源码编译命令的调度，请注意最终的所有输出，均需要输出到<code>out/build/debs/new_pkg/debian/</code>目录下;</li>
<li>置位<code>is_allowed=1</code></li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="764-deb包编入镜像流程说明">7.6.4 deb包编入镜像流程说明<a href="#764-deb包编入镜像流程说明" class="hash-link" aria-label="7.6.4 deb包编入镜像流程说明的直接链接" title="7.6.4 deb包编入镜像流程 说明的直接链接">​</a></h2>
<p>在镜像构建的过程中，deb包会被编入板端根文件系统内。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="在线镜像构建">在线镜像构建<a href="#在线镜像构建" class="hash-link" aria-label="在线镜像构建的直接链接" title="在线镜像构建的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="流程说明">流程说明<a href="#流程说明" class="hash-link" aria-label="流程说明的直接链接" title="流程说明的直接链接">​</a></h4>
<p>当<code>pack_image.sh</code>不添加-l选项进行调度时，会进入在线镜像构建流程。流程介绍如下：</p>
<ol>
<li>从<code>pack_image.sh</code>的<code>DEFAULT_CONFIG</code>字段获取当前的默认编译配置文件，以<code>build_params/ubuntu-22.04_desktop_rdk-s100_release.conf</code>为例；<!-- -->
<ul>
<li>该配置文件可以通过-c选项指定</li>
</ul>
</li>
<li>从<code>build_params/ubuntu-22.04_desktop_rdk-s100_release.conf</code>内获取<code>RDK_DPKG_DEB_PKG_LIST</code>字段；</li>
<li>chroot到<code>out/deploy/rootfs</code>目录下：<!-- -->
<ol>
<li>根据<code>RDK_DPKG_DEB_PKG_LIST</code>字段从现有板端apt源内尝试下载所有deb包；</li>
<li>安装所有deb包；</li>
</ol>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="添加额外deb包的方法">添加额外deb包的方法<a href="#添加额外deb包的方法" class="hash-link" aria-label="添加额外deb包的方法的直接链接" title="添加额外deb包的方法的直接链接">​</a></h4>
<ol>
<li>找到需要安装的包名；</li>
<li>在指定的编译配置文件内的<code>RDK_DPKG_DEB_PKG_LIST</code>变量内添加对应的包名。</li>
</ol>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>获取报名的方法请参考<a href="#get_package_name">获取所需deb包名的方法</a></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="离线镜像构建">离线镜像构建<a href="#离线镜像构建" class="hash-link" aria-label="离线镜像构建的直接链接" title="离线镜像构建的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="流程说明-1">流程说明<a href="#流程说明-1" class="hash-link" aria-label="流程说明的直接链接" title="流程说明的直接链接">​</a></h4>
<p>当<code>pack_image.sh</code>添加-l选项进行调度时，会进入离线镜像构建流程。流程介绍如下：</p>
<ol>
<li>chroot：<!-- -->
<ol>
<li>根据<code>out/product/deb_packages</code>内现有的deb包，对每个deb包进行安装；</li>
</ol>
</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="添加额外deb包的方法-1">添加额外deb包的方法<a href="#添加额外deb包的方法-1" class="hash-link" aria-label="添加额外deb包的方法的直接链接" title="添加额外deb包的方法的直接链接">​</a></h4>
<ol>
<li>找到需要安装的包名；</li>
<li>执行以下命令将对应包下载到<code>out/product/deb_packages</code></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd out/product/deb_packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt download &lt;package names&gt;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>获取报名的方法请参考<a href="#get_package_name">获取所需deb包名的方法</a></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="get_package_name">获取所需deb包名的方法<a href="#get_package_name" class="hash-link" aria-label="获取所需deb包名的方法的直接链接" title="获取所需deb包名的方法的直接链接">​</a></h3>
<p>包名可以通过两个方式获取：</p>
<ol>
<li>仅知道需要的文件且host没有安装过该包：<!-- -->
<ul>
<li>建议通过Google/Baidu等搜索引擎确认该文件所属的deb包名，并确认该deb包所属的apt源，参考流程如下：<!-- -->
<ul>
<li>在<a href="https://www.debian.org/distrib/packages" target="_blank" rel="noopener noreferrer">debian.org</a>上通过文件名确认deb包名，注意需要在&quot;Search the contents of packages&quot;一节进行搜索；</li>
<li>确认包名后，在<a href="https://launchpad.net/ubuntu/+search" target="_blank" rel="noopener noreferrer">Ubuntu Launchpad</a>上搜索具体的包归属的源，确认jammy/jammy-updates的main/universe/multiverse等components中有该包；</li>
</ul>
</li>
</ul>
</li>
<li>知道需要的文件，且host端有安装过：<!-- -->
<ul>
<li>可以通过<code>dpkg -S &lt;filename&gt;</code>命令获取包名。</li>
</ul>
</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="765-自定义分区说明">7.6.5 自定义分区说明<a href="#765-自定义分区说明" class="hash-link" aria-label="7.6.5 自定义分区说明的直接链接" title="7.6.5 自定义分区说 明的直接链接">​</a></h2>
<p>RDK S100的分区定义文件保存在<code>source/bootloader/device/rdk/s100/partition_config_files</code>文件夹下，默认使用的分区表为：<code>source/bootloader/device/rdk/s100/partition_config_files/s100-gpt.json</code></p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;global&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;antirollbackUpdate_host&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;antirollbackUpdate_hsm&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;ab_sync&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;backup_dir&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/tmp/ota/backup&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;AB_part_a&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_a&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;AB_part_b&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_b&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;BAK_part_bak&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;_bak&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;fpt&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fpt_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                   </span><span class="token comment" style="color:#999988;font-style:italic">// 从这一行开始为Flash上的分区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;recovery&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;recovery_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;misc&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;misc_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;HB_APDP&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token string" style="color:#e3116c">&quot;HB_APDP_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;keystorage&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;keystorage_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;HSM_FW&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HSM_FW_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;HSM_RCA&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;HSM_RCA_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;keyimage&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;keyimage_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;SBL&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;SBL_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;scp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;scp_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;spl&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;spl_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;MCU&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MCU_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;quickboot&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;quickboot_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 从这一行开始为eMMC/UFS上的分区</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;veeprom&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;veeprom_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;ubootenv&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ubootenv_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;acore_cfg&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;acore_cfg_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;bl31&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bl31_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;optee&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;optee_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;uboot&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;uboot_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;boot&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;boot_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;ota&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ota_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;log&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;log_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;userdata&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;userdata_common&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;system&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;system_common&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="配置文件说明">配置文件说明<a href="#配置文件说明" class="hash-link" aria-label="配置文件说明的直接链接" title="配置文件说明的直接链接">​</a></h3>
<p>整体分区表的配置分为全局共享配置和分区单独配置，其中全局共享配置放在“global”字段中，这是对所有分区都有效的配置。
<strong>支持的全局参数：</strong></p>
<ul>
<li><code>antirollbackUpdate_host</code>：是否更新host的anti-rollback版本，true或false；</li>
<li><code>antirollbackUpdate_hsm</code>：是否更新hsm的anti-rollback版本，true或false；</li>
<li><code>ab_sync</code>：地瓜内部reserved字段；</li>
<li><code>backup_dir</code>：hsm备份目录；</li>
<li><code>AB_part_a</code>：AB分区的A分区后缀；</li>
<li><code>AB_part_b</code>：AB分区的B分区后缀；</li>
<li><code>BAK_part_bak</code>：备份分区后缀；</li>
</ul>
<p>分区单独配置使用“分区名”：“分区配置类型”的形式，可以根据需要选择不同的分区配置类型。 例如：boot分区就需要首先在分区全局配置中添加boot分区的描述，然后在<code>source/bootloader/device/rdk/s100/partition_config_files/sub_config</code>文件夹中创建<code>boot.json</code>，并在其中定义<code>boot_common</code>：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;boot_common&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;components&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string" style="color:#e3116c">&quot;${TARGET_DEPLOY_DIR}/rootfs/boot/:60m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;pre_cmd&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string" style="color:#e3116c">&quot;pack_boot.sh;[ $? -ne 0 ] &amp;&amp; exit 1;rm -rf ${TARGET_DEPLOY_DIR}/rootfs/boot/System.map*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;post_cmd&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string" style="color:#e3116c">&quot;pack_avb_img.sh boot boot&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;fs_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ext4&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;medium&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emmc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;ota_is_update&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;ota_update_mode&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;image&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;part_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AB&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;part_type_guid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C12A7328-F81F-11D2-BA4B-00A0C93EC93B&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;size&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token property" style="color:#36acaa">&quot;boot_ota&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;components&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string" style="color:#e3116c">&quot;${TARGET_DEPLOY_DIR}/rootfs/boot/:60m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;pre_cmd&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string" style="color:#e3116c">&quot;pack_boot.sh;[ $? -ne 0 ] &amp;&amp; exit 1;rm -rf ${TARGET_DEPLOY_DIR}/rootfs/boot/System.map*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;post_cmd&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">			</span><span class="token string" style="color:#e3116c">&quot;pack_avb_img.sh boot boot&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;fs_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ext4&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;medium&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;emmc&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;ota_is_update&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;ota_update_mode&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;image&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;part_type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AB&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;part_type_guid&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;C12A7328-F81F-11D2-BA4B-00A0C93EC93B&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		</span><span class="token property" style="color:#36acaa">&quot;size&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;60m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>支持的分区参数：</strong></p>
<ul>
<li><code>depends</code>：表示分区依赖关系，当前分区的制作需要依赖哪些分区制作完成，列表的形式，在其中添加依赖的分区名；</li>
<li><code>components</code>：表示当前分区需要包含哪些内容，可以是子镜像路径或文件目录，文件目录会做成文件系统，当前支持的文件系统有ext4和fat16，在路径后使用“:”表示当前这一部分在分区中所占的大小。子镜像可以为多个，子镜像建议放在 out/xxx/deploy 下的对应分区的目录中；</li>
<li><code>components_nose</code>：非安全启动镜像组件；</li>
<li><code>pre_cmd</code>：在根据component内容制作镜像以前需要执行的命令；</li>
<li><code>post_cmd</code>：在根据component内容制作完镜像之后需要执行的命令；</li>
<li><code>fs_type</code>：镜像类型，None/ext4/fat16/misc；</li>
<li><code>medium</code>：镜像位于emmc/nor；</li>
<li><code>ota_is_update</code>：全量ota包是否包含；</li>
<li><code>ota_update_mode</code>：分区的OTA升级方式；image为镜像升级，默认值，image_diff为镜像差分；</li>
<li><code>is_rootfs</code>：是否是rootfs分区；</li>
<li><code>part_type</code>：分区类型，当前支持AB，BAK，PERMANENT；</li>
<li><code>size</code>：表示分区的大小，单位可以是k, m, g；</li>
<li><code>magic</code>：表示分区的magic，只针对添加flash镜像头的分区镜像有效；</li>
<li><code>have_anti_ver</code>：当前分区镜像中是否包含antirollback版本，true或false；</li>
<li><code>load_addr</code>：表示镜像的加载地址，只针对添加flash镜像头的分区镜像有效；</li>
<li><code>entry_addr</code>：表示镜像的入口地址，只针对添加flash镜像头的分区镜像有效；</li>
<li><code>nose_support</code>：非安全启动镜像支持；</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><ol>
<li>JSON文件中的分区顺序即为板端实际分区顺序；</li>
<li>分区大小需要根据该分区所属储存介质的扇区大小做对齐；</li>
</ol></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="分区修改说明">分区修改说明<a href="#分区修改说明" class="hash-link" aria-label="分区修改说明的直接链接" title="分区修改说明的直接链接">​</a></h3>
<p>S100X支持变更eMMC/UFS上的分区，只需添加或删除或修改分区配置对应的分区字段。对于flash分区，如有变更需求，请联系地瓜。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>分区修改注意事项</div><div class="admonitionContent_BuS1"><ol>
<li>分区表中，<code>log</code>及其以前的分区为启动分区，原则上不建议修改。</li>
<li>其他分区，如<code>userdata</code>，<code>system</code>等，可以自由调整大小，如果新增分区，注意调整<code>fstab</code>文件以确保分区被正常挂载；</li>
</ol></div></div>
<p>分区表修改后，需要经过以下步骤生效：</p>
<ol>
<li>构建hobot-miniboot deb包：<!-- -->
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># In RDK Source Root Directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./mk_debs.sh hobot-miniboot</span><br></span></code></pre></div></div>
</li>
<li>本地构建镜像：<!-- -->
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># In RDK Source Root Directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./pack_image.sh -l</span><br></span></code></pre></div></div>
</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>提示</div><div class="admonitionContent_BuS1"><p>商业版提供更完整的功能支持、更深入的硬件能力开放和专属的定制内容。为确保内容合规、安全交付，我们将通过以下方式开放商业版访问权限：</p><p>商业版本获取流程：
填写问卷：提交您的机构信息、使用场景等基本情况
签署保密协议（NDA）：我们将根据提交信息与您联系，双方确认后签署保密协议
内容释放：完成协议签署后，我们将通过私有渠道为您开放商业版本资料
如您希望获取商业版内容，请填写下方问卷，我们将在3～5个工作日内与您联系：</p><p>问卷链接：<a href="https://horizonrobotics.feishu.cn/share/base/form/shrcnpBby71Y8LlixYF2N3ENbre" target="_blank" rel="noopener noreferrer">https://horizonrobotics.feishu.cn/share/base/form/shrcnpBby71Y8LlixYF2N3ENbre</a></p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2025-10-27T10:08:38.000Z" itemprop="dateModified">2025年10月27日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/rdk_s/Advanced_development/mcu_development/S100/mcu_ramdump"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">MCU ramdump功能</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/rdk_s/FAQ"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">8. 常见问题</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#761-概述" class="table-of-contents__link toc-highlight">7.6.1 概述</a></li><li><a href="#762-根文件系统预编译包构建说明" class="table-of-contents__link toc-highlight">7.6.2 根文件系统预编译包构建说明</a><ul><li><a href="#multistrap" class="table-of-contents__link toc-highlight">multistrap</a><ul><li><a href="#官方文档" class="table-of-contents__link toc-highlight">官方文档</a></li><li><a href="#工具简介" class="table-of-contents__link toc-highlight">工具简介</a></li><li><a href="#配置文件简介" class="table-of-contents__link toc-highlight">配置文件简介</a><ul><li><a href="#基本格式介绍" class="table-of-contents__link toc-highlight">基本格式介绍</a></li><li><a href="#多文件配置示例" class="table-of-contents__link toc-highlight">多文件配置示例</a></li></ul></li></ul></li><li><a href="#rdk-s100的实现" class="table-of-contents__link toc-highlight">RDK S100的实现</a><ul><li><a href="#配置文件设计" class="table-of-contents__link toc-highlight">配置文件设计</a></li><li><a href="#构建流程说明" class="table-of-contents__link toc-highlight">构建流程说明</a></li><li><a href="#裁剪自定义根文件系统的方法" class="table-of-contents__link toc-highlight">裁剪/自定义根文件系统的方法</a><ul><li><a href="#仅裁剪自定 义apt优先级不为importantrequired的包" class="table-of-contents__link toc-highlight">仅裁剪/自定义apt优先级不为“important”/“required”的包</a></li><li><a href="#需要裁剪自定义apt优先级为importantrequired的包" class="table-of-contents__link toc-highlight">需要裁剪/自定义apt优先级为“important”/“required”的包</a></li></ul></li></ul></li></ul></li><li><a href="#763-rdk-s100-deb包构建流程说明" class="table-of-contents__link toc-highlight">7.6.3 RDK S100 deb包构建流程说明</a><ul><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#构建脚本介绍" class="table-of-contents__link toc-highlight">构建脚本介绍</a></li><li><a href="#deb包源码目录" class="table-of-contents__link toc-highlight">deb包源码目录</a></li><li><a href="#构建流程说明-1" class="table-of-contents__link toc-highlight">构建流程说明</a></li><li><a href="#自定义deb包流程说明" class="table-of-contents__link toc-highlight">自定义deb包流程说明</a></li></ul></li><li><a href="#764-deb包编入镜像流程说明" class="table-of-contents__link toc-highlight">7.6.4 deb包编入镜像流程说明</a><ul><li><a href="#在线镜像构建" class="table-of-contents__link toc-highlight">在线镜像构建</a><ul><li><a href="#流程说明" class="table-of-contents__link toc-highlight">流程说明</a></li><li><a href="#添加额外deb包的方法" class="table-of-contents__link toc-highlight">添加额外deb包的方法</a></li></ul></li><li><a href="#离线镜像构建" class="table-of-contents__link toc-highlight">离线镜像构建</a><ul><li><a href="#流程说明-1" class="table-of-contents__link toc-highlight">流程说明</a></li><li><a href="#添加额外deb包的方法-1" class="table-of-contents__link toc-highlight">添加额外deb包的方法</a></li></ul></li><li><a href="#get_package_name" class="table-of-contents__link toc-highlight">获取所需deb包名的方法</a></li></ul></li><li><a href="#765-自定义分区说明" class="table-of-contents__link toc-highlight">7.6.5 自定义分区说明</a><ul><li><a href="#配置文件说明" class="table-of-contents__link toc-highlight">配置文件说明</a></li><li><a href="#分区修改说明" class="table-of-contents__link toc-highlight">分区修改说明</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">古月居<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">联系我们</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/437998606" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiLiBiLi<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 D-Robotics.</div></div></div></footer></div>
</body>
</html>