<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-docs_s docs-version-current docs-doc-page docs-doc-id-Robot_development/tros_dev/ai_predict" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">5.5.2 模型推理 | RDK DOC</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://developer.d-robotics.cc/rdk_doc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://developer.d-robotics.cc/rdk_doc/rdk_s/Robot_development/tros_dev/ai_predict"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-docs_s-current"><meta data-rh="true" property="og:title" content="5.5.2 模型推理 | RDK DOC"><meta data-rh="true" name="description" content="模型推理开发"><meta data-rh="true" property="og:description" content="模型推理开发"><link data-rh="true" rel="icon" href="/rdk_doc/img/logo.png"><link data-rh="true" rel="canonical" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Robot_development/tros_dev/ai_predict"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Robot_development/tros_dev/ai_predict" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/en/rdk_s/Robot_development/tros_dev/ai_predict" hreflang="en"><link data-rh="true" rel="alternate" href="https://developer.d-robotics.cc/rdk_doc/rdk_s/Robot_development/tros_dev/ai_predict" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"5. 机器人应用开发","item":"https://developer.d-robotics.cc/rdk_doc/rdk_s/Robot_development"},{"@type":"ListItem","position":2,"name":"5.5.2 模型推理","item":"https://developer.d-robotics.cc/rdk_doc/rdk_s/Robot_development/tros_dev/ai_predict"}]}</script><script src="https://hm.baidu.com/hm.js?24dd63cad43b63889ea6bede5fd1ab9e" async></script><link rel="stylesheet" href="/rdk_doc/assets/css/styles.0fbd7d27.css">
<script src="/rdk_doc/assets/js/runtime~main.b2eb5b0c.js" defer="defer"></script>
<script src="/rdk_doc/assets/js/main.ffcb45f9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/rdk_doc/img/logo.png" alt="地瓜机器人社区 logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">D-Robotics</b></a><a class="navbar__item navbar__link" href="/rdk_doc/RDK">RDK X3 / X5</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rdk_doc/rdk_s/RDK">RDK S100</a><a href="https://developer.d-robotics.cc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>CN</a><ul class="dropdown__menu"><li><a href="/rdk_doc/rdk_s/Robot_development/tros_dev/ai_predict" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">CN</a></li><li><a href="/rdk_doc/en/rdk_s/Robot_development/tros_dev/ai_predict" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">EN</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rdk_doc/rdk_s/RDK">D-Robotics RDK 套件</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Quick_start">1. 快速开始</a><button aria-label="展开侧边栏分类 &#x27;1. 快速开始&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/System_configuration">2. 系统配置</a><button aria-label="展开侧边栏分类 &#x27;2. 系统配置&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Basic_Application">3. 基础应用开发</a><button aria-label="展开侧边栏分类 &#x27;3. 基础应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Basic_Development">4. 算法应用开发</a><button aria-label="展开侧边栏分类 &#x27;4. 算法应用开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/rdk_doc/rdk_s/Robot_development">5. 机器人应用开发</a><button aria-label="折叠侧边栏分类 &#x27;5. 机器人应用开发&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/tros">TogetheROS.Bot 简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/quick_start/preparation">5.1 系统安装</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/quick_demo/demo_sensor">5.2 功能体验</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/boxs/detection/fcos">5.3 Boxs算法仓库</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/apps/slam">5.4 Apps应用示例</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/tros_dev/zero_copy">5.5 功能开发</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/tros_dev/zero_copy">5.5.1 使用“zero-copy”</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/tros_dev/ai_predict">5.5.2 模型推理</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/tros_dev/breakpad">5.5.3 breakpad使用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/tros_dev/flame_graph">5.5.4 性能火焰图</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/rdk_doc/rdk_s/Robot_development/tros_dev/mono2d_trash_detection">5.5.5 垃圾检测</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Application_case">6. 应用开发指南</a><button aria-label="展开侧边栏分类 &#x27;6. 应用开发指南&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Advanced_development">7. 进阶开发</a><button aria-label="展开侧边栏分类 &#x27;7. 进阶开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/FAQ">8. 常见问题</a><button aria-label="展开侧边栏分类 &#x27;8. 常见问题&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/rdk_doc/rdk_s/Appendix">9. 附录</a><button aria-label="展开侧边栏分类 &#x27;9. 附录&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rdk_doc/rdk_s/Release_Note/roadmap">10. 版本发布</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/rdk_doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/rdk_doc/rdk_s/Robot_development"><span>5. 机器人应用开发</span></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">5.5 功能开发</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">5.5.2 模型推理</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>5.5.2 模型推理</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="模型推理开发">模型推理开发<a href="#模型推理开发" class="hash-link" aria-label="模型推理开发的直接链接" title="模型推理开发的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能背景">功能背景<a href="#功能背景" class="hash-link" aria-label="功能背景的直接链接" title="功能背景的直接链接">​</a></h3>
<p><code>hobot_dnn</code>是TogetheROS.Bot软件栈中的板端算法推理框架，在RDK上利用BPU处理器实现算法推理功能，基于D-Robotics算法推理框架和ROS2 Node进行二次开发，为机器人应用开发提供更简单易用的模型集成开发接口，包括模型管理、基于模型描述的输入处理及结果解析，以及模型输出内存分配管理等功能。</p>
<p>通过阅读本章节，用户可以使用D-Robotics提供的模型，在RDK上基于<code>hobot_dnn</code>创建并运行一个人体检测的算法Node。借助tros.b提供的组件，订阅摄像头采集&amp;发布的图像，对图像进行算法推理检测出人体框后，使用多目标跟踪（<code>multi-target tracking</code>，即<code>MOT</code>）算法对检测框进行跟踪和目标编号分配，最终实现在PC端的Web浏览器上实时渲染展示图像、人体框检测和目标跟踪结果。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="前置条件">前置条件<a href="#前置条件" class="hash-link" aria-label="前置条件的  直接链接" title="前置条件的直接链接">​</a></h3>
<p>1 RDK开发板，并且已安装好相关软件，包括：</p>
<ul>
<li>
<p>Ubuntu 20.04/Ubuntu 22.04系统镜像。</p>
</li>
<li>
<p>tros.b软件包。</p>
</li>
<li>
<p>ROS2软件包构建、编译等工具。安装命令：<code>sudo apt install ros-dev-tools</code></p>
</li>
</ul>
<p>2 RDK已安装F37或者GC4663摄像头。</p>
<p>3 可以通过网络访问RDK的PC。</p>
<p>关于<code>hobot_dnn)的详细使用说明可以参考</code>hobot_dnn)代码中的<a href="https://github.com/D-Robotics/hobot_dnn/blob/develop/README.md" target="_blank" rel="noopener noreferrer">README.md</a>和<a href="https://github.com/D-Robotics/hobot_dnn/blob/develop/dnn_node/docs/API-Manual/API-Manual.md" target="_blank" rel="noopener noreferrer">接口说明文档</a>。hobot_dnn的使用逻辑流程如下：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/dnnnode_workflow.jpg" alt="" class="img_ev3q"></p>
<p>在不了解<code>hobot_dnn)使用流程的情况下，用户也可以按照本章节流程使用</code>hobot_dnn)开发出模型推理示例。</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>本章节以下内容使用tros.b Foxy版本举例说明，如果您使用的是tros.b Humble版本，只需将<code>source /opt/tros/setup.bash</code>命令替换为<code>source /opt/tros/humble/setup.bash</code>。</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="任务内容">任务内容<a href="#任务内容" class="hash-link" aria-label="任务内容的直接链接" title="任务内容的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-创建package">1 创建package<a href="#1-创建package" class="hash-link" aria-label="1 创建package的直接链接" title="1 创建package的直接链接">​</a></h4>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p ~/dev_ws/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws/src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 pkg create --build-type ament_cmake cpp_dnn_demo --dependencies rclcpp sensor_msgs hbm_img_msgs ai_msgs dnn_node hobot_mot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">touch src/body_det_demo.cpp</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-编写示例">2 编写示例<a href="#2-编写示例" class="hash-link" aria-label="2 编写示例的直接链接" title="2 编写示例的直接链接">​</a></h4>
<p>查看创建后的工程路径如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# cd ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# tree dev_ws/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dev_ws/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── CMakeLists.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── include</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        │   └── cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ├── package.xml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── src</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            └── body_det_demo.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">5 directories, 3 files</span><br></span></code></pre></div></div>
<p>在RDK上使用vi/vim等工具打开创建的代码源文件<code>body_det_demo.cpp</code>：<code>vi ~/dev_ws/src/cpp_dnn_demo/src/body_det_demo.cpp</code></p>
<p>拷贝如下代码到文件中：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/dnn_node.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/util/image_proc.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/util/output_parser/detection/fasterrcnn_output_parser.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;sensor_msgs/msg/image.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;ai_msgs/msg/perception_targets.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hbm_img_msgs/msg/hbm_msg1080_p.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hobot_mot/hobot_mot.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 创建算法推理输出数据结构，添加消息头信息成员</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct FasterRcnnOutput : public hobot::dnn_node::DnnNodeOutput {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;std_msgs::msg::Header&gt; image_msg_header = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 继承DnnNode虚基类，创建算法推理节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class BodyDetNode : public hobot::dnn_node::DnnNode {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BodyDetNode(const std::string &amp;node_name = &quot;body_det&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const rclcpp::NodeOptions &amp;options = rclcpp::NodeOptions());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> protected:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 实现基类的纯虚接口，用于配置Node参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int SetNodePara() override;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 实现基类的虚接口，将解析后的模型输出数据封装成ROS Msg后发布</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt; &amp;node_output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 算法模型输入图片数据的宽和高</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int model_input_width_ = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int model_input_height_ = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 人体检测框结果对应的模型输出索引</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const int32_t box_output_index_ = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 检测框输出索引集合</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const std::vector&lt;int32_t&gt; box_outputs_index_ = {box_output_index_};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 图片消息订阅者</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::Subscription&lt;hbm_img_msgs::msg::HbmMsg1080P&gt;::ConstSharedPtr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ros_img_subscription_ = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 算法推理结果消息发布者</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::Publisher&lt;ai_msgs::msg::PerceptionTargets&gt;::SharedPtr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      msg_publisher_ = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 多目标跟踪算法引擎</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;HobotMot&gt; hobot_mot_ = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 图片消 息订阅回调</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void FeedImg(const hbm_img_msgs::msg::HbmMsg1080P::ConstSharedPtr msg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BodyDetNode::BodyDetNode(const std::string &amp; node_name, const rclcpp::NodeOptions &amp; options) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot::dnn_node::DnnNode(node_name, options) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Init中使用BodyDetNode子类实现的SetNodePara()方法进行算法推理的初始化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (Init() != 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetModelInputSize(0, model_input_width_, model_input_height_) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Node init fail!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建消息订阅者，从摄像头节点订阅图像消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ros_img_subscription_ =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          this-&gt;create_subscription&lt;hbm_img_msgs::msg::HbmMsg1080P&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;/hbmem_img&quot;, 10, std::bind(&amp;BodyDetNode::FeedImg, this, std::placeholders::_1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建消息发布者，发布算法推理消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg_publisher_ = this-&gt;create_publisher&lt;ai_msgs::msg::PerceptionTargets&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;/cpp_dnn_demo&quot;, 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建多目标跟踪（MOT）算法引擎</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot_mot_ = std::make_shared&lt;HobotMot&gt;(&quot;config/iou2_method_param.json&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int BodyDetNode::SetNodePara() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!dnn_node_para_ptr_) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 指定算法推理使用的模型文件路径和模型名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node_para_ptr_-&gt;model_file = &quot;config/multitask_body_kps_960x544.hbm&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node_para_ptr_-&gt;model_name = &quot;multitask_body_kps_960x544&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void BodyDetNode::FeedImg(const hbm_img_msgs::msg::HbmMsg1080P::ConstSharedPtr img_msg) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!rclcpp::ok()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 对订阅到的图片消息进行验证，本示例只支持处理NV12格式图片数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!img_msg) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (&quot;nv12&quot; != std::string(reinterpret_cast&lt;const char*&gt;(img_msg-&gt;encoding.data()))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Only support nv12 img encoding!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 根据模型输  入图片分辨率，使用DnnNode中提供的方法创建模型输入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto inputs = std::vector&lt;std::shared_ptr&lt;hobot::dnn_node::DNNInput&gt;&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hobot::dnn_node::ImageProc::GetNV12PyramidFromNV12Img(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reinterpret_cast&lt;const char*&gt;(img_msg-&gt;data.data()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      img_msg-&gt;height, img_msg-&gt;width, model_input_height_, model_input_width_)};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建模型输出数据，填充消息头信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto dnn_output = std::make_shared&lt;FasterRcnnOutput&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header = std::make_shared&lt;std_msgs::msg::Header&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header-&gt;set__frame_id(std::to_string(img_msg-&gt;index));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header-&gt;set__stamp(img_msg-&gt;time_stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 以异步模式运行推理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Run(inputs, dnn_output, nullptr, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int BodyDetNode::PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt; &amp;node_output) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!rclcpp::ok()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 验证输出数据的有效性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (node_output-&gt;output_tensors.empty() ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static_cast&lt;int32_t&gt;(node_output-&gt;output_tensors.size()) &lt; box_output_index_) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Invalid outputs&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建解析输出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 检测框results的维度等于检测出来的目标类别数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;std::shared_ptr&lt;hobot::dnn_node::parser_fasterrcnn::Filter2DResult&gt;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      results;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 关键点数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;hobot::dnn_node::parser_fasterrcnn::LandmarksResult&gt; output_body_kps = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 使用hobot dnn内置的Parse解析方法，解析算法输出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (hobot::dnn_node::parser_fasterrcnn::Parse(node_output, nullptr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  box_outputs_index_, -1, -1, results, output_body_kps) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_node_sample&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;Parse node_output fail!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto filter2d_result = results.at(box_output_index_);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!filter2d_result) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 将算法推理输出的人体检测框转成MOT算法输入数据类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;MotBox&gt; in_box_list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (auto&amp; rect : filter2d_result-&gt;boxes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    in_box_list.emplace_back(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MotBox(rect.left, rect.top, rect.right, rect.bottom, rect.conf));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 根据消息头计算当前帧的时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto fasterRcnn_output =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      std::dynamic_pointer_cast&lt;FasterRcnnOutput&gt;(node_output);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  time_t time_stamp =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fasterRcnn_output-&gt;image_msg_header-&gt;stamp.sec * 1000 +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fasterRcnn_output-&gt;image_msg_header-&gt;stamp.nanosec / 1000 / 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建MOT算法的输出：带有目标编号的人体检测框和消失的目标编号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;MotBox&gt; out_box_list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;std::shared_ptr&lt;MotTrackId&gt;&gt; disappeared_ids;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 运行多目标跟踪算法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (hobot_mot_-&gt;DoProcess(in_box_list,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            out_box_list,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            disappeared_ids,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            time_stamp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            model_input_width_,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            model_input_height_) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Do mot fail&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建用于发布推理结果的ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs::msg::PerceptionTargets::UniquePtr pub_data(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      new ai_msgs::msg::PerceptionTargets());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 将消息头填充到ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pub_data-&gt;header.set__stamp(fasterRcnn_output-&gt;image_msg_header-&gt;stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pub_data-&gt;header.set__frame_id(fasterRcnn_output-&gt;image_msg_header-&gt;frame_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 将算法推理输出帧率填充到ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (node_output-&gt;rt_stat) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;set__fps(round(node_output-&gt;rt_stat-&gt;output_fps));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果算法推理统计有更新，输出算法模型输入和输出的帧率统计</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (node_output-&gt;rt_stat-&gt;fps_updated) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RCLCPP_WARN(rclcpp::get_logger(&quot;dnn_demo&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;input fps: %.2f, out fps: %.2f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  node_output-&gt;rt_stat-&gt;input_fps,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  node_output-&gt;rt_stat-&gt;output_fps);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (auto&amp; rect : out_box_list) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 验证目标跟踪结果的有效性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (rect.id &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 将目标跟踪结果和检测框填充到ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Target target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__type(&quot;person&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__track_id(rect.id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Roi roi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.type = &quot;body&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__x_offset(rect.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__y_offset(rect.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__width(rect.x2 - rect.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__height(rect.y2 - rect.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.rois.emplace_back(roi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;targets.emplace_back(std::move(target));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 将消失的目标填充到ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (const auto&amp; id_info : disappeared_ids) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (id_info-&gt;value &lt; 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hobot_mot::DataState::INVALID == id_info-&gt;state_) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Target target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__type(&quot;person&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__track_id(id_info-&gt;value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Roi roi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.type = &quot;body&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.rois.emplace_back(roi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;disappeared_targets.emplace_back(std::move(target));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 发布ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg_publisher_-&gt;publish(std::move(pub_data));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char** argv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::init(argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::spin(std::make_shared&lt;BodyDetNode&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="21-node设计">2.1 Node设计<a href="#21-node设计" class="hash-link" aria-label="2.1 Node设计的直接链接" title="2.1 Node设计的直接链接">​</a></h5>
<p>示例的人体检测算法Node主要包含三部分逻辑独立的功能。</p>
<p><strong>（1）Node初始化和启动</strong></p>
<p>配置算法使用的模型信息，创建算法推理消息的发布者和图像消息的订阅者，启动目标跟踪算法引擎。</p>
<p><strong>（2）订阅消息和算法推理</strong></p>
<p>在创建图像消息订阅者时，注册了消息回调<code>FeedImg</code>，实现图像数据的处理并用于算法模型推理，回调中不等待算法推理完成。</p>
<p><strong>（3）推理结果的处理和发布</strong></p>
<p>算法推理完成后，通过注册的回调<code>PostProcess</code>输出推理结果，回调中对检测结果进行多目标跟踪算法（<code>HobotMot</code>）处理后，发布算法推理结果消息。</p>
<p>Node的设计和流程逻辑如下图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/node_architecture.jpg" alt="" class="img_ev3q"></p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="22-代码说明">2.2 代码说明<a href="#22-代码说明" class="hash-link" aria-label="2.2 代码说明的直接链接" title="2.2 代码说明的直接链接">​</a></h5>
<p><strong>添加头文件</strong></p>
<p>推理框架头文件<code>dnn_node/dnn_node.h</code>，用于算法模型管理和推理。</p>
<p>算法模型输入处理头文件<code>dnn_node/util/image_proc.h</code>，用于算法模型输入图片处理。</p>
<p>算法模型输出解析方法头文件<code>dnn_node/util/output_parser/detection/fasterrcnn_output_parser.h</code>，用于模型推理完成后，从输出地址解析出结构化数据（对于本示例使用的人体检测算法，对应的结构化数据为人体检测框）。</p>
<p>ROS Msg头文件，用于消息的订阅和发布。</p>
<p>MOT算法引擎头文件，用于对检测出的人体框进行目标跟踪。</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/dnn_node.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/util/image_proc.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;dnn_node/util/output_parser/detection/fasterrcnn_output_parser.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;sensor_msgs/msg/image.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;ai_msgs/msg/perception_targets.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hbm_img_msgs/msg/hbm_msg1080_p.hpp&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;hobot_mot/hobot_mot.h&quot;</span><br></span></code></pre></div></div>
<p><strong>创建算法推理输出数据结构</strong></p>
<p>继承<code>hobot_dnn)中的</code>DnnNodeOutput`基类，添加消息头信息成员，用于表示推理输出对应的图片信息。</p>
<div class="language-C++ language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct FasterRcnnOutput : public hobot::dnn_node::DnnNodeOutput {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;std_msgs::msg::Header&gt; image_msg_header = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p><strong>创建算法推理Node</strong></p>
<p>继承<code>hobot_dnn)中的</code>DnnNode<code>虚基类，定义算法推理节点</code>BodyDetNode<code>，实现</code>DnnNode`中定义的虚接口。</p>
<p><code>int SetNodePara()</code>：配置模型参数。</p>
<p><code>int PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt; &amp;node_output)</code>：推理结果回调，将解析后结构化的模型输出数据封装成ROS Msg后发布。</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class BodyDetNode : public hobot::dnn_node::DnnNode {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  BodyDetNode(const std::string &amp;node_name = &quot;body_det&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const rclcpp::NodeOptions &amp;options = rclcpp::NodeOptions());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> protected:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int SetNodePara() override;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt; &amp;node_output)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    override;</span><br></span></code></pre></div></div>
<p><strong>实现BodyDetNode子类的构造</strong></p>
<p><code>BodyDetNode</code>子类的构造函数中进行Node的初始化，同时通过<code>GetModelInputSize</code>接口获取了模型输入图片的尺寸，包括图片的宽<code>model_input_width_</code>和高<code>model_input_height_</code>，用于模型前处理，不同的模型一般输入图片的尺寸不同。</p>
<p>通过零拷贝的通信方式，创建图片消息的订阅者，从摄像头节点订阅图像消息，用于算法模型推理。订阅的topic为<code>/hbmem_img</code>，消息类型为tros.b中定义的图片消息类型<code>hbm_img_msgs::msg::HbmMsg1080P</code>。</p>
<p>创建消息发布者，用于发布算法推理消息。发布的topic为<code>/cpp_dnn_demo</code>，消息类型为tros.b中定义的算法消息类型<code>ai_msgs::msg::PerceptionTargets</code>。</p>
<p>创建多目标跟踪（MOT）算法引擎，用于对每个人体检测框进行目标跟踪。</p>
<p><code>BodyDetNode</code>构造函数实现：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BodyDetNode::BodyDetNode(const std::string &amp; node_name, const rclcpp::NodeOptions &amp; options) :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot::dnn_node::DnnNode(node_name, options) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Init中使用BodyDetNode子类实现的SetNodePara()方法进行算法推理的初始化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (Init() != 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GetModelInputSize(0, model_input_width_, model_input_height_) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Node init fail!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建消息订阅者，从摄像头节点订阅图像消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ros_img_subscription_ =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          this-&gt;create_subscription&lt;hbm_img_msgs::msg::HbmMsg1080P&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          &quot;/hbmem_img&quot;, 10, std::bind(&amp;BodyDetNode::FeedImg, this, std::placeholders::_1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建消息发布者，发布算法推理消息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg_publisher_ = this-&gt;create_publisher&lt;ai_msgs::msg::PerceptionTargets&gt;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;/cpp_dnn_demo&quot;, 10);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建多目标跟踪（MOT）算法引擎</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot_mot_ = std::make_shared&lt;HobotMot&gt;(&quot;config/iou2_method_param.json&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>其中<code>Init()</code>是<code>DnnNode</code>基类中定义并实现的接口，执行算法推理初始化，只做pipeline的串联，具体的<code>SetNodePara()</code>步骤由用户（子类中）实现。串联的初始化流程如下：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int DnnNode::Init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RCLCPP_INFO(rclcpp::get_logger(&quot;dnn&quot;), &quot;Node init.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 1. set model info in node para</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ret = SetNodePara();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ret != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Set node para failed!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // check node para</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ModelTaskType::InvalidType == dnn_node_para_ptr_-&gt;model_task_type) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Invalid model task type&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 2. model init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ret = dnn_node_impl_-&gt;ModelInit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ret != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Model init failed!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 3. set output parser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ret = SetOutputParser();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ret != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Set output parser failed!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 4. task init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ret = dnn_node_impl_-&gt;TaskInit();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (ret != 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn&quot;), &quot;Task init failed!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>配置模型参数</strong></p>
<p>配置算法推理使用的模型文件路径和模型名。</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int BodyDetNode::SetNodePara() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!dnn_node_para_ptr_) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node_para_ptr_-&gt;model_file = &quot;config/multitask_body_kps_960x544.hbm&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node_para_ptr_-&gt;model_name = &quot;multitask_body_kps_960x544&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>实现图片订阅结果回调</strong></p>
<p>创建<code>DNNInput</code>类型的模型输入数据。订阅到的消息中包含图片信息（图片的编码方式、内容数据和分辨率等信息），使用<code>hobot_dnn)中的算法模型输入图片处理接口</code>hobot::dnn_node::ImageProc::GetNV12PyramidFromNV12Img<code>，将订阅到的</code>nv12<code>格式的图片按照模型输入分辨率（</code>model_input_width_<code>和</code>model_input_height_<code>，在</code>BodyDetNode<code>的构造函数中通过</code>GetModelInputSize`接口从加载的模型中查询得到）转成模型输入的数据类型。接口定义如下：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] in_img_data 图片数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] in_img_height 图片的高度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] in_img_width 图片的宽度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] scaled_img_height 模型输入的高度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//   - [in] scaled_img_width 模型输入的宽度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">std::shared_ptr&lt;NV12PyramidInput&gt; GetNV12PyramidFromNV12Img(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const char* in_img_data,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int&amp; in_img_height,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int&amp; in_img_width,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int&amp; scaled_img_height,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const int&amp; scaled_img_width);</span><br></span></code></pre></div></div>
<p>创建<code>FasterRcnnOutput</code>类型的模型输出数据。订阅到的消息中包含消息头（frame_id和时间戳），使用订阅到的消息头填充输出数据的消息头，用于表述算法推理输出对应的图片信息。</p>
<p>启动推理。使用<code>DnnNode</code>基类中的<code>Run</code>接口以异步模式运行推理，接口的第四个参数为<code>false</code>表示使用效率更高的异步推理模式。<code>Run</code>接口定义如下：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // - 参数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //   - [in] inputs 输入数据智能指针列表</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //   - [in] outputs 输出数据智能指针</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //   - [in] rois 抠图roi数据，只对ModelRoiInferType模型有效</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //   - [in] is_sync_mode 预测模式，true为同步模式，false为异步模式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //   - [in] alloctask_timeout_ms 申请推理任务超时时间，单位毫秒</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //                               默认一直等待直到申请成功</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //   - [in] infer_timeout_ms 推理超时时间，单位毫秒，默认1000毫秒推  理超时</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int Run(std::vector&lt;std::shared_ptr&lt;DNNInput&gt;&gt; &amp;inputs,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const std::shared_ptr&lt;DnnNodeOutput&gt; &amp;output = nullptr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const std::shared_ptr&lt;std::vector&lt;hbDNNRoi&gt;&gt; rois = nullptr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const bool is_sync_mode = true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const int alloctask_timeout_ms = -1,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          const int infer_timeout_ms = 1000);</span><br></span></code></pre></div></div>
<p>完整的图片订阅结果回调<code>FeedImg</code>实现如下：</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void BodyDetNode::FeedImg(const hbm_img_msgs::msg::HbmMsg1080P::ConstSharedPtr img_msg) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!rclcpp::ok()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 对订阅到的图片消息进行验证，本示例只支持处理NV12格式图片数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!img_msg) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (&quot;nv12&quot; != std::string(reinterpret_cast&lt;const char*&gt;(img_msg-&gt;encoding.data()))) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Only support nv12 img encoding!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 根据模型输入图片分辨率，使用hobot_dnn中提供的方法创建模型输入数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto inputs = std::vector&lt;std::shared_ptr&lt;hobot::dnn_node::DNNInput&gt;&gt;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hobot::dnn_node::ImageProc::GetNV12PyramidFromNV12Img(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      reinterpret_cast&lt;const char*&gt;(img_msg-&gt;data.data()),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      img_msg-&gt;height, img_msg-&gt;width, model_input_height_, model_input_width_)};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建模型输出数据，填充消息头信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto dnn_output = std::make_shared&lt;FasterRcnnOutput&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header = std::make_shared&lt;std_msgs::msg::Header&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header-&gt;set__frame_id(std::to_string(img_msg-&gt;index));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_output-&gt;image_msg_header-&gt;set__stamp(img_msg-&gt;time_stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 以异步模式运行推理</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Run(inputs, dnn_output, nullptr, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p><strong>实现推理结果回调</strong></p>
<p>算法推理结果回调是将解析后结构化的模型输出数据经过MOT算法处理后，输出带有目标编号的人体检测框和消失的目标编号数据，封装成ROS Msg后发布。</p>
<p>创建<code>Filter2DResult</code>类型的结构化推理结果数据。</p>
<p>使用hobot dnn内置的Parse解析方法，解析人体检测算法输出。</p>
<p>运行多目标跟踪算法。将算法推理输出的人体检测框转成<code>MOT</code>算法输入数据类型，并根据消息头计算当前帧的时间戳，经过<code>MOT</code>算法处理后得到带有目标编号的人体检测框和消失的目标编号。</p>
<p>发布算法推理结果。创建ROS Msg，填充算法推理结果对应的图片消息头（帧ID和时间戳），带有目标编号的人体检测框，算法推理输  出的帧率统计，消失的目标编号。发布的ROS Msg可以被其他ROS Node订阅和使用。</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int BodyDetNode::PostProcess(const std::shared_ptr&lt;hobot::dnn_node::DnnNodeOutput&gt; &amp;node_output) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!rclcpp::ok()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 验证输出数据的有效性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (node_output-&gt;output_tensors.empty() ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static_cast&lt;int32_t&gt;(node_output-&gt;output_tensors.size()) &lt; box_output_index_) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Invalid outputs&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建解析输出数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 检测框results的维度等于检测出来的目标类别数</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;std::shared_ptr&lt;hobot::dnn_node::parser_fasterrcnn::Filter2DResult&gt;&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      results;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 关键点数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::shared_ptr&lt;hobot::dnn_node::parser_fasterrcnn::LandmarksResult&gt; output_body_kps = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 使用hobot dnn内置的Parse解析方法，解析算法输出</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (hobot::dnn_node::parser_fasterrcnn::Parse(node_output, nullptr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  box_outputs_index_, -1, -1, results, output_body_kps) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_node_sample&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;Parse node_output fail!&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto filter2d_result = results.at(box_output_index_);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (!filter2d_result) return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 将算法推理输出的人体检测框转成MOT算法输入数据类型</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;MotBox&gt; in_box_list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (auto&amp; rect : filter2d_result-&gt;boxes) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    in_box_list.emplace_back(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MotBox(rect.left, rect.top, rect.right, rect.bottom, rect.conf));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 根据消息头计算当前帧的时间戳</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  auto fasterRcnn_output =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      std::dynamic_pointer_cast&lt;FasterRcnnOutput&gt;(node_output);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  time_t time_stamp =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fasterRcnn_output-&gt;image_msg_header-&gt;stamp.sec * 1000 +</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fasterRcnn_output-&gt;image_msg_header-&gt;stamp.nanosec / 1000 / 1000;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建MOT算法的输出：带有目标编号的人体检测框和消失的目标编号</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;MotBox&gt; out_box_list;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;std::shared_ptr&lt;MotTrackId&gt;&gt; disappeared_ids;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 运行多目标跟踪算法</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (hobot_mot_-&gt;DoProcess(in_box_list,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            out_box_list,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            disappeared_ids,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            time_stamp,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            model_input_width_,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            model_input_height_) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RCLCPP_ERROR(rclcpp::get_logger(&quot;dnn_demo&quot;), &quot;Do mot fail&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 创建用于发布推理结果的ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs::msg::PerceptionTargets::UniquePtr pub_data(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      new ai_msgs::msg::PerceptionTargets());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 将消息头填充到ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pub_data-&gt;header.set__stamp(fasterRcnn_output-&gt;image_msg_header-&gt;stamp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  pub_data-&gt;header.set__frame_id(fasterRcnn_output-&gt;image_msg_header-&gt;frame_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 将算法推理输出帧率填充到ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (node_output-&gt;rt_stat) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;set__fps(round(node_output-&gt;rt_stat-&gt;output_fps));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果算法推理统计有更新，输出算法模型输入和输出的帧率统计</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (node_output-&gt;rt_stat-&gt;fps_updated) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      RCLCPP_WARN(rclcpp::get_logger(&quot;dnn_demo&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  &quot;input fps: %.2f, out fps: %.2f&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  node_output-&gt;rt_stat-&gt;input_fps,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  node_output-&gt;rt_stat-&gt;output_fps);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (auto&amp; rect : out_box_list) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 验证目标跟踪结果的有效性</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (rect.id &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 将目标跟踪结果和检测框填充到ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Target target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__type(&quot;person&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__track_id(rect.id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Roi roi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.type = &quot;body&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__x_offset(rect.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__y_offset(rect.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__width(rect.x2 - rect.x1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.rect.set__height(rect.y2 - rect.y1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.rois.emplace_back(roi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;targets.emplace_back(std::move(target));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 将消失的目标填充到ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (const auto&amp; id_info : disappeared_ids) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (id_info-&gt;value &lt; 0 ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hobot_mot::DataState::INVALID == id_info-&gt;state_) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Target target;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__type(&quot;person&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.set__track_id(id_info-&gt;value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ai_msgs::msg::Roi roi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roi.type = &quot;body&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    target.rois.emplace_back(roi);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pub_data-&gt;disappeared_targets.emplace_back(std::move(target));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 发布ROS Msg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  msg_publisher_-&gt;publish(std::move(pub_data));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>dnn node中内置了多种检测、分类和分割算法的模型输出解析方法，RDK上安装tros.b后查询支持的解析方法如下：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# tree /opt/tros/include/dnn_node/util/output_parser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/tros/include/dnn_node/util/output_parser</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── classification</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── ptq_classification_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── fasterrcnn_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── fcos_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── nms.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ptq_efficientdet_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ptq_ssd_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ptq_yolo2_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── ptq_yolo3_darknet_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── ptq_yolo5_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── perception_common.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── segmentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── ptq_unet_output_parser.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── utils.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3 directories, 12 files</span><br></span></code></pre></div></div>
<p>可以看到<code>/opt/tros/include/dnn_node/util/output_parser</code>路径下有<code>classification</code>、<code>detection</code>和<code>segmentation</code>三个路径，分别对应分类、检测和分割算法的模型输出解析方法。</p>
<p><code>perception_common.h</code>为定义的解析后的感知结果数据类型。</p>
<p>算法模型和对应的输出解析方法如下：</p>
<table><thead><tr><th>算法类别</th><th>算法</th><th>算法输出解析方法</th></tr></thead><tbody><tr><td>目标检测</td><td><a href="/rdk_doc/Robot_development/boxs/detection/fcos">FCOS</a></td><td>fcos_output_parser.h</td></tr><tr><td>目标检测</td><td><a href="/rdk_doc/Robot_development/boxs/detection/efficientnet">EfficientNet_Det</a></td><td>ptq_efficientdet_output_parser.h</td></tr><tr><td>目标检测</td><td><a href="/rdk_doc/Robot_development/boxs/detection/mobilenet">MobileNet_SSD</a></td><td>ptq_ssd_output_parser.h</td></tr><tr><td>目标检测</td><td><a href="/rdk_doc/Robot_development/boxs/detection/yolo">YoloV2</a></td><td>ptq_yolo2_output_parser.h</td></tr><tr><td>目标检测</td><td><a href="/rdk_doc/Robot_development/boxs/detection/yolo">YoloV3</a></td><td>ptq_yolo3_darknet_output_parser.h</td></tr><tr><td>目标检测</td><td><a href="/rdk_doc/Robot_development/boxs/detection/yolo">YoloV5</a></td><td>ptq_yolo5_output_parser.h</td></tr><tr><td>人体检测</td><td><a href="/rdk_doc/rdk_s/Robot_development/03_boxs/function/mono2d_body_detection.md">FasterRcnn</a></td><td>fasterrcnn_output_parser.h</td></tr><tr><td>图片分类</td><td><a href="/rdk_doc/Robot_development/boxs/classification/mobilenetv2">mobilenetv2</a></td><td>ptq_classification_output_parser.h</td></tr><tr><td>语义分割</td><td><a href="/rdk_doc/Robot_development/boxs/segmentation/mobilenet_unet">mobilenet_unet</a></td><td>ptq_unet_output_parser.h</td></tr></tbody></table>
<p><strong>入口函数</strong></p>
<p>创建<code>BodyDetNode</code>的实例，在<code>BodyDetNode</code>的构造中初始化和启动推理任务，直到用户输入退出信号才停止推理。</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char** argv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::init(argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::spin(std::make_shared&lt;BodyDetNode&gt;());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp::shutdown();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="23-编译依赖">2.3 编译依赖<a href="#23-编译依赖" class="hash-link" aria-label="2.3 编译依赖的直接链接" title="2.3 编译依赖的直接链接">​</a></h5>
<p>步骤1的创建package中通过<code>ros2 pkg create</code>命令创建了cpp_dnn_demo package，在<code>dev_ws/src/cpp_dnn_demo</code>路径下已经自动创建了CMakeLists.txt和package.xml。</p>
<p>在package.xml中自动添加了编译依赖的pkg，涉及到的依赖包括<code>rclcpp</code>、<code>sensor_msgs</code>、<code>ai_msgs</code>、<code>hbm_img_msgs</code>、<code>dnn_node</code>和<code>hobot_mot</code>。其中<code>ai_msgs</code>为TogatherROS中定义的算法输出消息格式，<code>hbm_img_msgs</code>为TogatherROS中定义的用于零拷贝通信方式下使用的图片消息格式，<code>dnn_node</code>为算法推理框架，<code>hobot_mot</code>为多目标跟踪算法。在TogatherROS安装时已安装这些pkg。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="24-编译脚本">2.4 编译脚本<a href="#24-编译脚本" class="hash-link" aria-label="2.4 编译脚本的直接链接" title="2.4 编译脚本的直接链接">​</a></h5>
<p>在 CMakeLists.txt 中添加pkg依赖和编译安装信息。</p>
<p>（1）添加多目标跟踪算法和算法推理引擎库依赖</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">link_directories(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /opt/tros/lib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /usr/lib/hbbpu/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre></div></div>
<p>（2）添加pkg编译信息</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  src/body_det_demo.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_target_dependencies(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensor_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot_mot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hbm_img_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre></div></div>
<p>（3）添加pkg安装信息，实现通过ros2 run运行编译出来的pkg</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">install(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TARGETS ${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RUNTIME DESTINATION lib/${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span></code></pre></div></div>
<p>完整的CMakeLists.txt如下：</p>
<div class="language-cmake codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cmake codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cmake_minimum_required(VERSION 3.5)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project(cpp_dnn_demo)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Default to C99</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(NOT CMAKE_C_STANDARD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set(CMAKE_C_STANDARD 99)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Default to C++14</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(NOT CMAKE_CXX_STANDARD)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  set(CMAKE_CXX_STANDARD 14)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if(CMAKE_COMPILER_IS_GNUCXX OR CMAKE_CXX_COMPILER_ID MATCHES &quot;Clang&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  add_compile_options(-Wall -Wextra -Wpedantic)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">endif()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># find dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(ament_cmake REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(rclcpp REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(sensor_msgs REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(ai_msgs REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(hbm_img_msgs REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(dnn_node REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">find_package(hobot_mot REQUIRED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">link_directories(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /opt/tros/lib/  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  /usr/lib/hbbpu/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add_executable(${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  src/body_det_demo.cpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_target_dependencies(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rclcpp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  dnn_node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  sensor_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ai_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hobot_mot</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  hbm_img_msgs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Install executables</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">install(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TARGETS ${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RUNTIME DESTINATION lib/${PROJECT_NAME}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ament_package()</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-编译和运行">3 编译和运行<a href="#3-编译和运行" class="hash-link" aria-label="3 编译和运行的直接链接" title="3 编译和运行的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="31-编译">3.1 编译<a href="#31-编译" class="hash-link" aria-label="3.1 编译的直接链接" title="3.1 编译的直接链接">​</a></h5>
<p>在安装了tros.b的RDK上，执行以下命令编译pkg：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 编译pkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colcon build --packages-select cpp_dnn_demo</span><br></span></code></pre></div></div>
<p>如果编译成功，在编译所在路径下产生cpp_dnn_demo pkg的部署包install，编译终端输出如下信息：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Starting &gt;&gt;&gt; cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Processing: cpp_dnn_demo]                              </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Finished &lt;&lt;&lt; cpp_dnn_demo [32.7s]                       </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Summary: 1 package finished [33.4s]</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="32-编译常见错误">3.2 编译常见错误<a href="#32-编译常见错误" class="hash-link" aria-label="3.2 编译常见错误的直接链接" title="3.2 编译常见错误的直接链接">​</a></h5>
<p>1、ModuleNotFoundError: No module named &#x27;ament_package&#x27;</p>
<p>具体错误信息如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># colcon build --packages-select cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting &gt;&gt;&gt; cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- stderr: cpp_dnn_demo                         </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMake Error at CMakeLists.txt:19 (find_package):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  By not providing &quot;Findament_cmake.cmake&quot; in CMAKE_MODULE_PATH this project</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  has asked CMake to find a package configuration file provided by</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ament_cmake&quot;, but CMake did not find one.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Could not find a package configuration file provided by &quot;ament_cmake&quot; with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  any of the following names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ament_cmakeConfig.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ament_cmake-config.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Add the installation prefix of &quot;ament_cmake&quot; to CMAKE_PREFIX_PATH or set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ament_cmake_DIR&quot; to a directory containing one of the above files.  If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;ament_cmake&quot; provides a separate development package or SDK, be sure it</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  has been installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Failed   &lt;&lt;&lt; cpp_dnn_demo [2.83s, exited with code 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Summary: 0 packages finished [3.44s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1 package failed: cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  1 package had stderr output: cpp_dnn_demo</span><br></span></code></pre></div></div>
<p>说明ROS2环境没有配置成功。在终端输入ros2命令进行环境检查：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ros2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-bash: ros2: command not found</span><br></span></code></pre></div></div>
<p>如果提示“command not found”，说明ROS2环境没有配置成功，检查source /opt/tros/setup.bash命令是否执行成功。配置成功的输出信息如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ros2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">usage: ros2 [-h] Call `ros2 &lt;command&gt; -h` for more detailed usage. ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 is an extensible command-line tool for ROS 2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optional arguments:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -h, --help            show this help message and exit</span><br></span></code></pre></div></div>
<p>2、查找不到dnn_node package</p>
<p>具体错误信息如下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">colcon build --packages-select cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Starting &gt;&gt;&gt; cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Processing: cpp_dnn_demo]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--- stderr: cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CMake Error at CMakeLists.txt:22 (find_package):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> By not providing &quot;Finddnn_node.cmake&quot; in CMAKE_MODULE_PATH this project has</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> asked CMake to find a package configuration file provided by &quot;dnn_node&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> but CMake did not find one.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Could not find a package configuration file provided by &quot;dnn_node&quot; with any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> of the following names:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnn_nodeConfig.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dnn_node-config.cmake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Add the installation prefix of &quot;dnn_node&quot; to CMAKE_PREFIX_PATH or set</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;dnn_node_DIR&quot; to a directory containing one of the above files. If</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> &quot;dnn_node&quot; provides a separate development package or SDK, be sure it has</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> been installed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Failed &lt;&lt;&lt; cpp_dnn_demo [59.7s, exited with code 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Summary: 0 packages finished [1min 1s]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1 package failed: cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 1 package had stderr output: cpp_dnn_demo</span><br></span></code></pre></div></div>
<p>说明hobot_dnn环境没有配置成功，检查/opt/tros/share/dnn_node是否存在。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="33-运行">3.3 运行<a href="#33-运行" class="hash-link" aria-label="3.3 运行的直接链接" title="3.3 运行的直接链接">​</a></h5>
<p>为了更好的展示算法推理效果，体验感知能力，使用tros.b中的MIPI摄像头图像采集、图像编码和WEB数据展示Node，提供数据传感和展示的能力，实现在RDK上发布摄像头采集到的图像，对图像进行算法推理检测出人体框后，在PC端的WEB浏览器上实时渲染展示图像和人体框检测结果。</p>
<p>运行时系统流程图如下：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/pipeline.jpg" alt="" class="img_ev3q"></p>
<p>RDK上的运行4个node，其中算法推理为本示例。</p>
<p>系统启动流程如下：</p>
<p>（1）RDK上打开终端1，启动算法推理node</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd ~/dev_ws</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 配置cpp_dnn_demo环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source ./install/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从tros.b的安装路径中拷贝出运行示例需要的配置文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 模型文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p config &amp;&amp; cp /opt/tros/lib/dnn_benchmark_example/config/X3/multitask_body_kps_960x544.hbm config/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 多目标跟踪配置文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /opt/tros/${TROS_DISTRO}/lib/hobot_mot/config/iou2_method_param.json config/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 运行cpp_dnn_demo pkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run cpp_dnn_demo cpp_dnn_demo --ros-args --log-level warn</span><br></span></code></pre></div></div>
<p>（2）RDK上打开终端2，启动tros.b中的图像发布、编码和展示Node</p>
<p>由于启动的Node比较多，使用启动脚本通过launch批量启动Node。在RDK的任意路径下创建启动脚本<code>cpp_dnn_demo.launch.py</code>，内容如下：</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> LaunchDescription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch_ros</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">actions </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> IncludeLaunchDescription</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> launch</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">launch_description_sources </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> PythonLaunchDescriptionSource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> ament_index_python </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_package_share_directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> ament_index_python</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">packages </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> get_package_prefix</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generate_launch_description</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    web_service_launch_include </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> IncludeLaunchDescription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PythonLaunchDescriptionSource</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            os</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                get_package_share_directory</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;websocket&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&#x27;launch/websocket_service.launch.py&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> LaunchDescription</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        web_service_launch_include</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 启动图片发布pkg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            package</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;mipi_cam&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            executable</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;mipi_cam&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            output</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;screen&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;out_format&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;nv12&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;image_width&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">960</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;image_height&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">544</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;io_method&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared_mem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;video_device&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;F37&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            arguments</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;--ros-args&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--log-level&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 启动jpeg图片编码&amp;发布pkg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            package</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;hobot_codec&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            executable</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;hobot_codec_republish&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            output</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;screen&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;channel&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;in_mode&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;shared_mem&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;in_format&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;nv12&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;out_mode&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ros&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;out_format&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jpeg&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;sub_topic&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/hbmem_img&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;pub_topic&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/image_jpeg&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            arguments</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;--ros-args&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--log-level&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># 启动web展示pkg</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Node</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            package</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;websocket&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            executable</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;websocket&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            output</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;screen&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;image_topic&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/image_jpeg&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;image_type&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mjpeg&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;smart_topic&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/cpp_dnn_demo&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            arguments</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;--ros-args&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;--log-level&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>使用启动脚本：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动图像发布、编码和展示node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 launch cpp_dnn_demo.launch.py</span><br></span></code></pre></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="34-运行常见错误">3.4 运行常见错误<a href="#34-运行常见错误" class="hash-link" aria-label="3.4 运行常见错误的直接链接" title="3.4 运行常见错误的直接链接">​</a></h5>
<p>如果启动报如下错误信息：</p>
<p><code>error while loading shared libraries: libdnn_node.so: cannot open shared object file: No such file or directory</code></p>
<p>说明配置hobot_dnn环境失败，检查/opt/tros/share/dnn_node是否存在。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="35-运行结果">3.5 运行结果<a href="#35-运行结果" class="hash-link" aria-label="3.5 运行结果的直接链接" title="3.5 运行结果的直接链接">​</a></h5>
<p>运行成功后，启动终端输出如下信息：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~/dev_ws# ros2 run cpp_dnn_demo cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[BPU_PLAT]BPU Platform Version(1.3.1)!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[C][154775][10-25][00:33:53:266][configuration.cpp:49][EasyDNN]EasyDNN version: 0.4.11</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[HBRT] set log level as 0. version = 3.14.5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[DNN] Runtime version = 1.9.7_(3.14.5 HBRT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629233.325690884] [dnn]: Run default SetOutputParser.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629233.326263403] [dnn]: Set output parser with default dnn node parser, you will get all output tensors and should parse output_tensors in PostProcess.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(MOTMethod.cpp:34): MOTMethod::Init config/iou2_method_param.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(IOU2.cpp:29): IOU2 Mot::Init config/iou2_method_param.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629234.410291616] [dnn_demo]: input fps: 31.22, out fps: 31.28</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629235.410357068] [dnn_demo]: input fps: 30.00, out fps: 30.00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629236.444863458] [dnn_demo]: input fps: 30.01, out fps: 29.98</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629237.476656118] [dnn_demo]: input fps: 30.00, out fps: 30.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629238.478156431] [dnn_demo]: input fps: 30.01, out fps: 29.97</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629239.510039629] [dnn_demo]: input fps: 30.01, out fps: 30.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629240.511561150] [dnn_demo]: input fps: 30.00, out fps: 29.97</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629241.543333811] [dnn_demo]: input fps: 30.01, out fps: 30.07</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629242.544654089] [dnn_demo]: input fps: 30.01, out fps: 29.97</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[WARN] [1666629243.576435625] [dnn_demo]: input fps: 30.01, out fps: 30.07</span><br></span></code></pre></div></div>
<p>输出log显示，初始化时算法推理使用的模型输入图片分辨率为960x544，使用一个推理任务，<code>MOT</code>算法引擎使用的配置文件为<code>config/iou2_method_param.json</code>。推理时算法输入和输出帧率为30fps，每秒钟刷新一次统计帧率。</p>
<p>在RDK上使用ros2命令查询并输出推理Node发布的<code>/cpp_dnn_demo</code>话题消息内容：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# ros2 topic list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/hbmem_img08172824022201080202012021072315</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/image_jpeg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/parameter_events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/rosout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# ros2 topic echo /cpp_dnn_demo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">header:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stamp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sec: 1659938514</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nanosec: 550421888</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_id: &#x27;7623&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fps: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">perfs: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 306</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 106</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 416</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 151</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 135</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 89</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 423</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 155</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 569</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 161</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 340</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 677</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 121</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 398</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 123</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: body</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 478</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 163</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 348</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 103</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disappeared_targets: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">---</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<p>输出的<code>/cpp_dnn_demo</code>话题消息表明算法检测出5个人体框（rois type为body），并输出了每个检测框的坐标（rect）和对应的目标跟踪结果(track_id)。</p>
<p>在PC端的WEB浏览器上输入 <code>http://IP:8000</code>（IP为RDK的IP地址，如本示例使用的IP地址为10.64.28.88）查看实时的图片和算法推理渲染效果：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/render.jpg" alt="" class="img_ev3q"></p>
<p>每个检测框上渲染了检测框类型（如<code>body</code>表示是人体检测框）和目标跟踪结果，浏览器左下角的<code>fps</code>字段表示实时的算法推理输出帧率。</p>
<p>输入<code>Ctrl+C</code>命令退出程序。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="本节 总结">本节总结<a href="#本节总结" class="hash-link" aria-label="本节总结的直接链接" title="本节总结的直接链接">​</a></h3>
<p>本章节介绍了如何使用D-Robotics提供的模型，基于<code>hobot_dnn</code>创建并运行一个人体检测的算法推理示例。使用从摄像头发布的图片，获取算法输出并在PC端浏览器上实时渲染展示图片和算法推理结果。</p>
<p>用户可以参考`hobot_dnn)中的<a href="https://github.com/D-Robotics/hobot_dnn/blob/develop/README.md" target="_blank" rel="noopener noreferrer">README.md</a>和<a href="https://github.com/D-Robotics/hobot_dnn/blob/develop/docs/API-Manual/API-Manual.md" target="_blank" rel="noopener noreferrer">接口说明文档</a>，了解更丰富的算法推理功能。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="算法wokflow构建">算法wokflow构建<a href="#算法wokflow构建" class="hash-link" aria-label="算法wokflow构建的直接链接" title="算法wokflow构建的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="功能背景-1">功能背景<a href="#功能背景-1" class="hash-link" aria-label="功能背景的直接链接" title="功能背景的直接链接">​</a></h3>
<p>ROS2的节点（<a href="http://docs.ros.org/en/foxy/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Nodes/Understanding-ROS2-Nodes.html" target="_blank" rel="noopener noreferrer">Node</a>）将复杂的机器人软件系统拆解成多个功能和逻辑独立的模块，例如一个机器人应用可能包含多个传感和算法感知功能的Node。Node之间通过“话题”（<a href="http://docs.ros.org/en/foxy/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Topics/Understanding-ROS2-Topics.html" target="_blank" rel="noopener noreferrer">Topic</a>）进行数据交换，机器人软件系统中不同功能的ROS2 Node通过Topic连接起来形成一个有向无环图（DAG）。</p>
<p>TogetheROS.Bot软件栈中包含丰富的机器人开发组件和算法Node，其中 传感Node支持从摄像头采集图像数据并发布，用于感知算法推理使用。感知算法库中的人手框检测算法Node使用图像数据进行推理，输出人手框检测结果；人手关键点检测算法Node使用图像数据和人手框检测结果推理输出人手关键点检测结果。因此人手关键点检测算法Node需要基于Topic通信，订阅人手框检测算法Node发布的人手框消息。</p>
<p>通过阅读本章节，用户可以在RDK上使用tros.b中的传感Node、人手框检测和人手关键点检测算法Node，基于ROS2 Topic通信，串联起传感和感知Node，实现开发复杂机器人算法应用的目标。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="前置条件-1">前置条件<a href="#前置条件-1" class="hash-link" aria-label="前置条件的直接链接" title="前置条件的直接链接">​</a></h3>
<p>1 RDK开发板，并且已安装好相关软件，包括：</p>
<ul>
<li>
<p>Ubuntu 20.04/Ubuntu 22.04系统镜像。</p>
</li>
<li>
<p>tros.b软件包。</p>
</li>
</ul>
<p>2 RDK已安装F37或者GC4663摄像头。</p>
<p>3 和RDK在同一网段（有线或者连接同一无线网，IP地址前三段需保持一致）的PC，PC端需要安装的环境包括：</p>
<ul>
<li>
<p>Ubuntu 20.04/Ubuntu 22.04系统</p>
</li>
<li>
<p><a href="https://docs.ros.org/en/foxy/Installation/Ubuntu-Install-Debians.html" target="_blank" rel="noopener noreferrer">ROS2 Foxy桌面版</a></p>
</li>
<li>
<p><a href="http://docs.ros.org/en/foxy/Concepts/About-RQt.html" target="_blank" rel="noopener noreferrer">rqt图形化工具</a></p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="任务内容-1">任务内容<a href="#任务内容-1" class="hash-link" aria-label="任务内容的直接链接" title="任务内容的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-启动数据采集node">1 启动数据采集Node<a href="#1-启动数据采集node" class="hash-link" aria-label="1 启动数据采集Node的直 接链接" title="1 启动数据采集Node的直接链接">​</a></h4>
<p>RDK上打开一个终端启动图像发布Node，从F37摄像头采集图像数据并发布，用于算法推理使用：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run mipi_cam mipi_cam --ros-args -p out_format:=nv12 -p image_width:=960 -p image_height:=544 -p video_device:=F37 -p io_method:=shared_mem --log-level warn</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-启动人手框检测算法node">2 启动人手框检测算法Node<a href="#2-启动人手框检测算法node" class="hash-link" aria-label="2 启动人手框检测算法Node的直接链接" title="2 启动人手框检测算法Node的直接链接">​</a></h4>
<p>RDK上打开一个终端启动人手框检测算法Node，订阅数据采集Node发布的图像消息，检测并发布人手检测框消息。</p>
<p>启动命令中指定了发布的Topic为<code>hobot_hand_detection</code>。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从tros.b的安装路径中拷贝出运行示例需要的配置文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /opt/tros/${TROS_DISTRO}/lib/mono2d_body_detection/config/ .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run mono2d_body_detection mono2d_body_detection --ros-args --log-level warn --ros-args -p ai_msg_pub_topic_name:=hobot_hand_detection</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-启动人手关键点检测算法node">3 启动人手关键点检测算法Node<a href="#3-启动人手关键点检测算法node" class="hash-link" aria-label="3 启动人手关键点检测算法Node的直接链接" title="3 启动人手关键点检测算法Node的直接链接">​</a></h4>
<p>RDK上打开一个终端启动人手关键点检测算法Node，订阅数据采集Node发布的图像消息以及人手框检测算法Node发布的人手框消息。</p>
<p>启动命令中指定了发布消息的Topic为<code>hobot_hand_lmk_detection</code>，订阅消息的Topic为<code>hobot_hand_detection</code>。</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 从tros.b的安装路径中拷贝出运行示例需要的配置文件。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp -r /opt/tros/${TROS_DISTRO}/lib/hand_lmk_detection/config/ .</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 run hand_lmk_detection hand_lmk_detection --ros-args --log-level warn --ros-args -p ai_msg_pub_topic_name:=hobot_hand_lmk_detection -p ai_msg_sub_topic_name:=hobot_hand_detection</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-查看算法推理结果输出">4 查看算法推理结果输出<a href="#4-查看算法推理结果输出" class="hash-link" aria-label="4 查看算法推理结果输出的直接链接" title="4 查看算法推理结果输出的直接链接">​</a></h4>
<p>RDK上打开一个终端使用ROS2命令查看算法推理Node发布的Topic消息。</p>
<p><strong>查看人手框检测算法Node发布出来的人手框检测消息</strong></p>
<p>查询命令：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic echo /hobot_hand_detection</span><br></span></code></pre></div></div>
<p>输出结果：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">header:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stamp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sec: 1660034025</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nanosec: 429969208</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_id: &#x27;8049&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fps: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: hand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 619</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 229</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 168</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disappeared_targets: []</span><br></span></code></pre></div></div>
<p>可以看到人手框检测算法Node发布出来的消息中包含一个人手框检测结果（roi type为hand）。</p>
<p><strong>查看人手关键点检测算法Node发布出来的人手关键点检测消息</strong></p>
<p>查询命令：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 启动Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ros2 topic echo /hobot_hand_lmk_detection</span><br></span></code></pre></div></div>
<p>输出结果：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">header:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stamp:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sec: 1660034025</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nanosec: 429969208</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  frame_id: &#x27;8049&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fps: 30</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">targets:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- type: person</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  track_id: 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  rois:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: hand</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rect:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      x_offset: 619</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y_offset: 128</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      height: 229</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      width: 168</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      do_rectify: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  attributes: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  points:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - type: hand_kps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    point:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 715.2421875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 348.0546875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 673.4921875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 315.8515625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 655.2265625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 294.3828125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 639.5703125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 262.1796875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 621.3046875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 229.9765625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 686.5390625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 247.8671875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 683.9296875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 201.3515625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 683.9296875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 176.3046875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 681.3203125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 147.6796875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 712.6328125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 240.7109375</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 717.8515625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 194.1953125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 720.4609375</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 161.9921875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 723.0703125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 129.7890625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 736.1171875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 247.8671875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 743.9453125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 201.3515625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 749.1640625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 172.7265625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 749.1640625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 140.5234375</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 759.6015625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 262.1796875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 770.0390625</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 226.3984375</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 775.2578125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 204.9296875</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - x: 775.2578125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      y: 179.8828125</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      z: 0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    confidence: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  captures: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">disappeared_targets: []</span><br></span></code></pre></div></div>
<p>可以看到人手关键点检测算法Node在订阅到人手检测框消息并用于推理后，发布出来的消息中包含一个人手框和人手关键点检测结果（roi type为hand，points type为hand_kps）。发布出来的人手框消息内容来源于订阅到的人手框消息，和上一步查出来的数据一致。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5-node串联出来的graph">5 Node串联出来的Graph<a href="#5-node串联出来的graph" class="hash-link" aria-label="5 Node串联出来的Graph的直接链接" title="5 Node串联出来的Graph的直接链接">​</a></h4>
<p>RDK上打开一个终端使用ROS2命令查看运行时设备的Node和Topic信息：</p>
<div class="language-shell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-shell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 配置tros.b环境</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# source /opt/tros/setup.bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询Node信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# ros2 node list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/hand_lmk_det</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/mipi_cam</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/mono2d_body_det</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 查询Topic信息</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">root@ubuntu:~# ros2 topic list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/hbmem_img08172824022201080202012021072315</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/hobot_hand_detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/hobot_hand_lmk_detection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/image_raw</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/parameter_events</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/rosout</span><br></span></code></pre></div></div>
<p>查询到RDK上运行着3个Node。</p>
<p>在PC端（<strong>PC需要和RDK处于同一网段</strong>）通过rqt的Node Graph功能可以可视化的展示RDK上运行的Node，Node发布和订阅的topic，以及Node基于这些Topic组成的graph，如下图：</p>
<p><img decoding="async" loading="lazy" src="https://rdk-doc.oss-cn-beijing.aliyuncs.com/doc/img/05_Robot_development/05_tros_dev/image/ai_predict/rosgraph_handlmk.jpg" alt="" class="img_ev3q"></p>
<p>其中椭圆形框内为Node名，矩形框内为Topic名。可以看到，整个graph由3个Node和2个Topic组成。</p>
<p>mipi_cam（传感Node）为起点，实现从摄像头采集和发布图像。</p>
<p>mono2d_body_det（算法感知Node）为中间节点，订阅mipi_cam Node发布的图像数据，实现人手框的检测。</p>
<p>hand_lmk_det（算法感知Node）为终点，订阅mipi_cam Node发布的图像数据以及mono2d_body_det Node发布的人手框检测数据，实现人手关键点的检测。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="本节总结-1">本节总结<a href="#本节总结-1" class="hash-link" aria-label="本节总结的直接链接" title="本节总结的直接链接">​</a></h3>
<p>本章节介绍了在RDK上使用tros.b中的传感Node、人手框检测和人手关键点检测算法Node，基于ROS2 Topic通信，串联起两个感知算法Node，实现从摄像头采集图像后用于算法推理并发布检测出的人手关键点消息的功能。</p>
<p>基于本章节介绍的算法串联原理，用户可以在RDK上串联更多算法Node，开发出功能丰富的机器人算法应用。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">最后<!-- -->于 <b><time datetime="2025-08-30T10:07:09.000Z" itemprop="dateModified">2025年8月30日</time></b> <!-- -->更新</span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/rdk_doc/Robot_development/tros_dev/zero_copy"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">5.5.1 使用“zero-copy”</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rdk_doc/Robot_development/tros_dev/breakpad"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">5.5.3 breakpad使用</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#模型推理开发" class="table-of-contents__link toc-highlight">模型推理开发</a><ul><li><a href="#功能背景" class="table-of-contents__link toc-highlight">功能背景</a></li><li><a href="#前置条件" class="table-of-contents__link toc-highlight">前置条件</a></li><li><a href="#任务内容" class="table-of-contents__link toc-highlight">任务内容</a><ul><li><a href="#1-创建package" class="table-of-contents__link toc-highlight">1 创建package</a></li><li><a href="#2-编写示例" class="table-of-contents__link toc-highlight">2 编写示例</a><ul><li><a href="#21-node设计" class="table-of-contents__link toc-highlight">2.1 Node设计</a></li><li><a href="#22-代码说明" class="table-of-contents__link toc-highlight">2.2 代码说明</a></li><li><a href="#23-编译依赖" class="table-of-contents__link toc-highlight">2.3 编译依赖</a></li><li><a href="#24-编译脚本" class="table-of-contents__link toc-highlight">2.4 编译脚本</a></li></ul></li><li><a href="#3-编译和运行" class="table-of-contents__link toc-highlight">3 编译和运行</a><ul><li><a href="#31-编译" class="table-of-contents__link toc-highlight">3.1 编译</a></li><li><a href="#32-编译常见错误" class="table-of-contents__link toc-highlight">3.2 编译常见错误</a></li><li><a href="#33-运行" class="table-of-contents__link toc-highlight">3.3 运行</a></li><li><a href="#34-运行常见错误" class="table-of-contents__link toc-highlight">3.4 运行常见错误</a></li><li><a href="#35-运行结果" class="table-of-contents__link toc-highlight">3.5 运行结果</a></li></ul></li></ul></li><li><a href="#本节总结" class="table-of-contents__link toc-highlight">本节总结</a></li></ul></li><li><a href="#算法wokflow构建" class="table-of-contents__link toc-highlight">算法wokflow构建</a><ul><li><a href="#功能背景-1" class="table-of-contents__link toc-highlight">功能背景</a></li><li><a href="#前置条件-1" class="table-of-contents__link toc-highlight">前置条件</a></li><li><a href="#任务内容-1" class="table-of-contents__link toc-highlight">任务内容</a><ul><li><a href="#1-启动数据采集node" class="table-of-contents__link toc-highlight">1 启动数据采集Node</a></li><li><a href="#2-启动人手框检测算法node" class="table-of-contents__link toc-highlight">2 启动人手框检测算法Node</a></li><li><a href="#3-启动人手关键点检测算法node" class="table-of-contents__link toc-highlight">3 启动人手关键点检测算法Node</a></li><li><a href="#4-查看算法推理结果输出" class="table-of-contents__link toc-highlight">4 查看算法推理结果输出</a></li><li><a href="#5-node串联出来的graph" class="table-of-contents__link toc-highlight">5 Node串联出来的Graph</a></li></ul></li><li><a href="#本节总结-1" class="table-of-contents__link toc-highlight">本节总结</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">友情链接</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.guyuehome.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">古月居<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">联系我们</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/D-Robotics" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://space.bilibili.com/437998606" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiLiBiLi<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 D-Robotics.</div></div></div></footer></div>
</body>
</html>